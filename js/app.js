require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({WHOfuq:[function(a,b){var c="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};(function(a,b,c,d){var e={};!function(a,b){a.VERSION="1.0.0",a.COMPILER_REVISION=4,a.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},a.helpers={},a.partials={};var c=Object.prototype.toString,d="[object Function]",e="[object Object]";a.registerHelper=function(b,d,f){if(c.call(b)===e){if(f||d)throw new a.Exception("Arg not supported with multiple helpers");a.Utils.extend(this.helpers,b)}else f&&(d.not=f),this.helpers[b]=d},a.registerPartial=function(b,d){c.call(b)===e?a.Utils.extend(this.partials,b):this.partials[b]=d},a.registerHelper("helperMissing",function(a){if(2===arguments.length)return b;throw new Error("Missing helper: '"+a+"'")}),a.registerHelper("blockHelperMissing",function(b,e){var f=e.inverse||function(){},g=e.fn,h=c.call(b);return h===d&&(b=b.call(this)),b===!0?g(this):b===!1||null==b?f(this):"[object Array]"===h?b.length>0?a.helpers.each(b,e):f(this):g(b)}),a.K=function(){},a.createFrame=Object.create||function(b){a.K.prototype=b;var c=new a.K;return a.K.prototype=null,c},a.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(b,c){if(a.logger.level<=b){var d=a.logger.methodMap[b];"undefined"!=typeof console&&console[d]&&console[d].call(console,c)}}},a.log=function(b,c){a.logger.log(b,c)},a.registerHelper("each",function(b,e){var f,g=e.fn,h=e.inverse,i=0,j="",k=c.call(b);if(k===d&&(b=b.call(this)),e.data&&(f=a.createFrame(e.data)),b&&"object"==typeof b)if(b instanceof Array)for(var l=b.length;l>i;i++)f&&(f.index=i),j+=g(b[i],{data:f});else for(var m in b)b.hasOwnProperty(m)&&(f&&(f.key=m),j+=g(b[m],{data:f}),i++);return 0===i&&(j=h(this)),j}),a.registerHelper("if",function(b,e){var f=c.call(b);return f===d&&(b=b.call(this)),!b||a.Utils.isEmpty(b)?e.inverse(this):e.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn})}),a.registerHelper("with",function(b,e){var f=c.call(b);return f===d&&(b=b.call(this)),a.Utils.isEmpty(b)?void 0:e.fn(b)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)});var f=function(){function a(){this.yy={}}var b={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,simpleInverse:6,statements:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,params:27,hash:28,dataName:29,param:30,STRING:31,INTEGER:32,BOOLEAN:33,hashSegments:34,hashSegment:35,ID:36,EQUALS:37,DATA:38,pathSegments:39,SEP:40,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",31:"STRING",32:"INTEGER",33:"BOOLEAN",36:"ID",37:"EQUALS",38:"DATA",40:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[27,2],[27,1],[30,1],[30,1],[30,1],[30,1],[30,1],[28,1],[34,2],[34,1],[35,3],[35,3],[35,3],[35,3],[35,3],[26,1],[26,1],[26,1],[29,2],[21,1],[39,3],[39,1]],performAction:function(a,b,c,d,e,f){var g=f.length-1;switch(e){case 1:return f[g-1];case 2:this.$=new d.ProgramNode([],f[g]);break;case 3:this.$=new d.ProgramNode(f[g-2],f[g]);break;case 4:this.$=new d.ProgramNode(f[g-1],[]);break;case 5:this.$=new d.ProgramNode(f[g]);break;case 6:this.$=new d.ProgramNode([],[]);break;case 7:this.$=new d.ProgramNode([]);break;case 8:this.$=[f[g]];break;case 9:f[g-1].push(f[g]),this.$=f[g-1];break;case 10:this.$=new d.BlockNode(f[g-2],f[g-1].inverse,f[g-1],f[g]);break;case 11:this.$=new d.BlockNode(f[g-2],f[g-1],f[g-1].inverse,f[g]);break;case 12:this.$=f[g];break;case 13:this.$=f[g];break;case 14:this.$=new d.ContentNode(f[g]);break;case 15:this.$=new d.CommentNode(f[g]);break;case 16:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1]);break;case 17:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1]);break;case 18:this.$=f[g-1];break;case 19:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1],"&"===f[g-2][2]);break;case 20:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1],!0);break;case 21:this.$=new d.PartialNode(f[g-1]);break;case 22:this.$=new d.PartialNode(f[g-2],f[g-1]);break;case 23:break;case 24:this.$=[[f[g-2]].concat(f[g-1]),f[g]];break;case 25:this.$=[[f[g-1]].concat(f[g]),null];break;case 26:this.$=[[f[g-1]],f[g]];break;case 27:this.$=[[f[g]],null];break;case 28:this.$=[[f[g]],null];break;case 29:f[g-1].push(f[g]),this.$=f[g-1];break;case 30:this.$=[f[g]];break;case 31:this.$=f[g];break;case 32:this.$=new d.StringNode(f[g]);break;case 33:this.$=new d.IntegerNode(f[g]);break;case 34:this.$=new d.BooleanNode(f[g]);break;case 35:this.$=f[g];break;case 36:this.$=new d.HashNode(f[g]);break;case 37:f[g-1].push(f[g]),this.$=f[g-1];break;case 38:this.$=[f[g]];break;case 39:this.$=[f[g-2],f[g]];break;case 40:this.$=[f[g-2],new d.StringNode(f[g])];break;case 41:this.$=[f[g-2],new d.IntegerNode(f[g])];break;case 42:this.$=[f[g-2],new d.BooleanNode(f[g])];break;case 43:this.$=[f[g-2],f[g]];break;case 44:this.$=new d.PartialNameNode(f[g]);break;case 45:this.$=new d.PartialNameNode(new d.StringNode(f[g]));break;case 46:this.$=new d.PartialNameNode(new d.IntegerNode(f[g]));break;case 47:this.$=new d.DataNode(f[g]);break;case 48:this.$=new d.IdNode(f[g]);break;case 49:f[g-2].push({part:f[g],separator:f[g-1]}),this.$=f[g-2];break;case 50:this.$=[{part:f[g]}]}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],25:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],25:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],25:[1,16]},{17:23,18:[1,22],21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],25:[2,8]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{4:30,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{17:31,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:32,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:33,21:24,29:25,36:[1,28],38:[1,27],39:26},{21:35,26:34,31:[1,36],32:[1,37],36:[1,28],39:26},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],25:[1,16]},{17:23,21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,4],7:38,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],25:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{18:[1,39]},{18:[2,27],21:44,24:[2,27],27:40,28:41,29:48,30:42,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,28],24:[2,28]},{18:[2,48],24:[2,48],31:[2,48],32:[2,48],33:[2,48],36:[2,48],38:[2,48],40:[1,51]},{21:52,36:[1,28],39:26},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],38:[2,50],40:[2,50]},{10:53,20:[1,54]},{10:55,20:[1,54]},{18:[1,56]},{18:[1,57]},{24:[1,58]},{18:[1,59],21:60,36:[1,28],39:26},{18:[2,44],36:[2,44]},{18:[2,45],36:[2,45]},{18:[2,46],36:[2,46]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],25:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{18:[2,25],21:44,24:[2,25],28:61,29:48,30:62,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,26],24:[2,26]},{18:[2,30],24:[2,30],31:[2,30],32:[2,30],33:[2,30],36:[2,30],38:[2,30]},{18:[2,36],24:[2,36],35:63,36:[1,64]},{18:[2,31],24:[2,31],31:[2,31],32:[2,31],33:[2,31],36:[2,31],38:[2,31]},{18:[2,32],24:[2,32],31:[2,32],32:[2,32],33:[2,32],36:[2,32],38:[2,32]},{18:[2,33],24:[2,33],31:[2,33],32:[2,33],33:[2,33],36:[2,33],38:[2,33]},{18:[2,34],24:[2,34],31:[2,34],32:[2,34],33:[2,34],36:[2,34],38:[2,34]},{18:[2,35],24:[2,35],31:[2,35],32:[2,35],33:[2,35],36:[2,35],38:[2,35]},{18:[2,38],24:[2,38],36:[2,38]},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],37:[1,65],38:[2,50],40:[2,50]},{36:[1,66]},{18:[2,47],24:[2,47],31:[2,47],32:[2,47],33:[2,47],36:[2,47],38:[2,47]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{21:67,36:[1,28],39:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,68]},{18:[2,24],24:[2,24]},{18:[2,29],24:[2,29],31:[2,29],32:[2,29],33:[2,29],36:[2,29],38:[2,29]},{18:[2,37],24:[2,37],36:[2,37]},{37:[1,65]},{21:69,29:73,31:[1,70],32:[1,71],33:[1,72],36:[1,28],38:[1,27],39:26},{18:[2,49],24:[2,49],31:[2,49],32:[2,49],33:[2,49],36:[2,49],38:[2,49],40:[2,49]},{18:[1,74]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{18:[2,39],24:[2,39],36:[2,39]},{18:[2,40],24:[2,40],36:[2,40]},{18:[2,41],24:[2,41],36:[2,41]},{18:[2,42],24:[2,42],36:[2,42]},{18:[2,43],24:[2,43],36:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]}],defaultActions:{17:[2,1]},parseError:function(a){throw new Error(a)},parse:function(a){function b(){var a;return a=c.lexer.lex()||1,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;f.push(l);var m=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var n,o,p,q,r,s,t,u,v,w={};;){if(p=d[d.length-1],this.defaultActions[p]?q=this.defaultActions[p]:((null===n||"undefined"==typeof n)&&(n=b()),q=g[p]&&g[p][n]),"undefined"==typeof q||!q.length||!q[0]){var x="";if(!k){v=[];for(s in g[p])this.terminals_[s]&&s>2&&v.push("'"+this.terminals_[s]+"'");x=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(i+1)+": Unexpected "+(1==n?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[n]||n,line:this.lexer.yylineno,loc:l,expected:v})}}if(q[0]instanceof Array&&q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+n);switch(q[0]){case 1:d.push(n),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(q[1]),n=null,o?(n=o,o=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,l=this.lexer.yylloc,k>0&&k--);break;case 2:if(t=this.productions_[q[1]][1],w.$=e[e.length-t],w._$={first_line:f[f.length-(t||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(t||1)].first_column,last_column:f[f.length-1].last_column},m&&(w._$.range=[f[f.length-(t||1)].range[0],f[f.length-1].range[1]]),r=this.performAction.call(w,h,j,i,this.yy,q[1],e,f),"undefined"!=typeof r)return r;t&&(d=d.slice(0,-1*t*2),e=e.slice(0,-1*t),f=f.slice(0,-1*t)),d.push(this.productions_[q[1]][0]),e.push(w.$),f.push(w._$),u=g[d[d.length-2]][d[d.length-1]],d.push(u);break;case 3:return!0}}return!0}},c=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e;this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),g=0;g<f.length&&(c=this._input.match(this.rules[f[g]]),!c||b&&!(c[0].length>b[0].length)||(b=c,d=g,this.options.flex));g++);return b?(e=b[0].match(/(?:\r\n?|\n).*/g),e&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,f[d],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a?a:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.options={},a.performAction=function(a,b,c,d){switch(c){case 0:return b.yytext="\\",14;case 1:if("\\"!==b.yytext.slice(-1)&&this.begin("mu"),"\\"===b.yytext.slice(-1)&&(b.yytext=b.yytext.substr(0,b.yyleng-1),this.begin("emu")),b.yytext)return 14;break;case 2:return 14;case 3:return"\\"!==b.yytext.slice(-1)&&this.popState(),"\\"===b.yytext.slice(-1)&&(b.yytext=b.yytext.substr(0,b.yyleng-1)),14;case 4:return b.yytext=b.yytext.substr(0,b.yyleng-4),this.popState(),15;case 5:return 25;case 6:return 16;case 7:return 20;case 8:return 19;case 9:return 19;case 10:return 23;case 11:return 22;case 12:this.popState(),this.begin("com");break;case 13:return b.yytext=b.yytext.substr(3,b.yyleng-5),this.popState(),15;case 14:return 22;case 15:return 37;case 16:return 36;case 17:return 36;case 18:return 40;case 19:break;case 20:return this.popState(),24;case 21:return this.popState(),18;case 22:return b.yytext=b.yytext.substr(1,b.yyleng-2).replace(/\\"/g,'"'),31;case 23:return b.yytext=b.yytext.substr(1,b.yyleng-2).replace(/\\'/g,"'"),31;case 24:return 38;case 25:return 33;case 26:return 33;case 27:return 32;case 28:return 36;case 29:return b.yytext=b.yytext.substr(1,b.yyleng-2),36;case 30:return"INVALID";case 31:return 5}},a.rules=[/^(?:\\\\(?=(\{\{)))/,/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[}\/ ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:-?[0-9]+(?=[}\s]))/,/^(?:[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],a.conditions={mu:{rules:[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],inclusive:!1},emu:{rules:[3],inclusive:!1},com:{rules:[4],inclusive:!1},INITIAL:{rules:[0,1,2,31],inclusive:!0}},a}();return b.lexer=c,a.prototype=b,b.Parser=a,new a}();a.Parser=f,a.parse=function(b){return b.constructor===a.AST.ProgramNode?b:(a.Parser.yy=a.AST,a.Parser.parse(b))},a.AST={},a.AST.ProgramNode=function(b,c){this.type="program",this.statements=b,c&&(this.inverse=new a.AST.ProgramNode(c))},a.AST.MustacheNode=function(a,b,c){this.type="mustache",this.escaped=!c,this.hash=b;var d=this.id=a[0],e=this.params=a.slice(1),f=this.eligibleHelper=d.isSimple;this.isHelper=f&&(e.length||b)},a.AST.PartialNode=function(a,b){this.type="partial",this.partialName=a,this.context=b},a.AST.BlockNode=function(b,c,d,e){var f=function(b,c){if(b.original!==c.original)throw new a.Exception(b.original+" doesn't match "+c.original)};f(b.id,e),this.type="block",this.mustache=b,this.program=c,this.inverse=d,this.inverse&&!this.program&&(this.isInverse=!0)},a.AST.ContentNode=function(a){this.type="content",this.string=a},a.AST.HashNode=function(a){this.type="hash",this.pairs=a},a.AST.IdNode=function(b){this.type="ID";for(var c="",d=[],e=0,f=0,g=b.length;g>f;f++){var h=b[f].part;if(c+=(b[f].separator||"")+h,".."===h||"."===h||"this"===h){if(d.length>0)throw new a.Exception("Invalid path: "+c);".."===h?e++:this.isScoped=!0}else d.push(h)}this.original=c,this.parts=d,this.string=d.join("."),this.depth=e,this.isSimple=1===b.length&&!this.isScoped&&0===e,this.stringModeValue=this.string},a.AST.PartialNameNode=function(a){this.type="PARTIAL_NAME",this.name=a.original},a.AST.DataNode=function(a){this.type="DATA",this.id=a},a.AST.StringNode=function(a){this.type="STRING",this.original=this.string=this.stringModeValue=a},a.AST.IntegerNode=function(a){this.type="INTEGER",this.original=this.integer=a,this.stringModeValue=Number(a)},a.AST.BooleanNode=function(a){this.type="BOOLEAN",this.bool=a,this.stringModeValue="true"===a},a.AST.CommentNode=function(a){this.type="comment",this.comment=a};var g=["description","fileName","lineNumber","message","name","number","stack"];a.Exception=function(){for(var a=Error.prototype.constructor.apply(this,arguments),b=0;b<g.length;b++)this[g[b]]=a[g[b]]},a.Exception.prototype=new Error,a.SafeString=function(a){this.string=a},a.SafeString.prototype.toString=function(){return this.string.toString()};var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,j=/[&<>"'`]/,k=function(a){return h[a]||"&amp;"};a.Utils={extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},escapeExpression:function(b){return b instanceof a.SafeString?b.toString():null==b||b===!1?"":(b=b.toString(),j.test(b)?b.replace(i,k):b)},isEmpty:function(a){return a||0===a?"[object Array]"===c.call(a)&&0===a.length?!0:!1:!0}};var l=a.Compiler=function(){},m=a.JavaScriptCompiler=function(){};l.prototype={compiler:l,disassemble:function(){for(var a,b,c,d=this.opcodes,e=[],f=0,g=d.length;g>f;f++)if(a=d[f],"DECLARE"===a.opcode)e.push("DECLARE "+a.name+"="+a.value);else{b=[];for(var h=0;h<a.args.length;h++)c=a.args[h],"string"==typeof c&&(c='"'+c.replace("\n","\\n")+'"'),b.push(c);e.push(a.opcode+" "+b.join(" "))}return e.join("\n")},equals:function(a){var b=this.opcodes.length;if(a.opcodes.length!==b)return!1;for(var c=0;b>c;c++){var d=this.opcodes[c],e=a.opcodes[c];if(d.opcode!==e.opcode||d.args.length!==e.args.length)return!1;for(var f=0;f<d.args.length;f++)if(d.args[f]!==e.args[f])return!1}if(b=this.children.length,a.children.length!==b)return!1;for(c=0;b>c;c++)if(!this.children[c].equals(a.children[c]))return!1;return!0},guid:0,compile:function(a,b){this.children=[],this.depths={list:[]},this.options=b;var c=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},c)for(var d in c)this.options.knownHelpers[d]=c[d];return this.program(a)},accept:function(a){return this[a.type](a)},program:function(a){var b,c=a.statements;this.opcodes=[];for(var d=0,e=c.length;e>d;d++)b=c[d],this[b.type](b);return this.isSimple=1===e,this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(a){var b,c=(new this.compiler).compile(a,this.options),d=this.guid++;this.usePartial=this.usePartial||c.usePartial,this.children[d]=c;for(var e=0,f=c.depths.list.length;f>e;e++)b=c.depths.list[e],2>b||this.addDepth(b-1);return d},block:function(a){var b=a.mustache,c=a.program,d=a.inverse;c&&(c=this.compileProgram(c)),d&&(d=this.compileProgram(d));var e=this.classifyMustache(b);"helper"===e?this.helperMustache(b,c,d):"simple"===e?(this.simpleMustache(b),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(b,c,d),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(a){var b,c,d=a.pairs;this.opcode("pushHash");for(var e=0,f=d.length;f>e;e++)b=d[e],c=b[1],this.options.stringParams?(c.depth&&this.addDepth(c.depth),this.opcode("getContext",c.depth||0),this.opcode("pushStringParam",c.stringModeValue,c.type)):this.accept(c),this.opcode("assignToHash",b[0]);this.opcode("popHash")},partial:function(a){var b=a.partialName;this.usePartial=!0,a.context?this.ID(a.context):this.opcode("push","depth0"),this.opcode("invokePartial",b.name),this.opcode("append")},content:function(a){this.opcode("appendContent",a.string)},mustache:function(a){var b=this.options,c=this.classifyMustache(a);"simple"===c?this.simpleMustache(a):"helper"===c?this.helperMustache(a):this.ambiguousMustache(a),a.escaped&&!b.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(a,b,c){var d=a.id,e=d.parts[0],f=null!=b||null!=c;this.opcode("getContext",d.depth),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("invokeAmbiguous",e,f)},simpleMustache:function(a){var b=a.id;"DATA"===b.type?this.DATA(b):b.parts.length?this.ID(b):(this.addDepth(b.depth),this.opcode("getContext",b.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(a,b,c){var d=this.setupFullMustacheParams(a,b,c),e=a.id.parts[0];if(this.options.knownHelpers[e])this.opcode("invokeKnownHelper",d.length,e);else{if(this.options.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+e);this.opcode("invokeHelper",d.length,e)}},ID:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var b=a.parts[0];b?this.opcode("lookupOnContext",a.parts[0]):this.opcode("pushContext");for(var c=1,d=a.parts.length;d>c;c++)this.opcode("lookup",a.parts[c])},DATA:function(b){if(this.options.data=!0,b.id.isScoped||b.id.depth)throw new a.Exception("Scoped data references are not supported: "+b.original);this.opcode("lookupData");for(var c=b.id.parts,d=0,e=c.length;e>d;d++)this.opcode("lookup",c[d])},STRING:function(a){this.opcode("pushString",a.string)},INTEGER:function(a){this.opcode("pushLiteral",a.integer)},BOOLEAN:function(a){this.opcode("pushLiteral",a.bool)},comment:function(){},opcode:function(a){this.opcodes.push({opcode:a,args:[].slice.call(arguments,1)})},declare:function(a,b){this.opcodes.push({opcode:"DECLARE",name:a,value:b})},addDepth:function(a){if(isNaN(a))throw new Error("EWOT");0!==a&&(this.depths[a]||(this.depths[a]=!0,this.depths.list.push(a)))},classifyMustache:function(a){var b=a.isHelper,c=a.eligibleHelper,d=this.options;if(c&&!b){var e=a.id.parts[0];d.knownHelpers[e]?b=!0:d.knownHelpersOnly&&(c=!1)}return b?"helper":c?"ambiguous":"simple"},pushParams:function(a){for(var b,c=a.length;c--;)b=a[c],this.options.stringParams?(b.depth&&this.addDepth(b.depth),this.opcode("getContext",b.depth||0),this.opcode("pushStringParam",b.stringModeValue,b.type)):this[b.type](b)},setupMustacheParams:function(a){var b=a.params;return this.pushParams(b),a.hash?this.hash(a.hash):this.opcode("emptyHash"),b},setupFullMustacheParams:function(a,b,c){var d=a.params;return this.pushParams(d),this.opcode("pushProgram",b),this.opcode("pushProgram",c),a.hash?this.hash(a.hash):this.opcode("emptyHash"),d}};var n=function(a){this.value=a};m.prototype={nameLookup:function(a,b){return/^[0-9]+$/.test(b)?a+"["+b+"]":m.isValidJavaScriptVariableName(b)?a+"."+b:a+"['"+b+"']"},appendToBuffer:function(a){return this.environment.isSimple?"return "+a+";":{appendToBuffer:!0,content:a,toString:function(){return"buffer += "+a+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(b,c,d,e){this.environment=b,this.options=c||{},a.log(a.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!d,this.context=d||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(b,c);var f,g=b.opcodes;for(this.i=0,r=g.length;this.i<r;this.i++)f=g[this.i],"DECLARE"===f.opcode?this[f.name]=f.value:this[f.opcode].apply(this,f.args);return this.createFunctionContext(e)},nextOpcode:function(){var a=this.environment.opcodes;return a[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var a=[];if(this.isChild)a.push("");else{var b=this.namespace,c="helpers = this.merge(helpers, "+b+".helpers);";this.environment.usePartial&&(c=c+" partials = this.merge(partials, "+b+".partials);"),this.options.data&&(c+=" data = data || {};"),a.push(c)}this.environment.isSimple?a.push(""):a.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=a},createFunctionContext:function(b){var c=this.stackVars.concat(this.registers.list);if(c.length>0&&(this.source[1]=this.source[1]+", "+c.join(", ")),!this.isChild)for(var d in this.context.aliases)this.context.aliases.hasOwnProperty(d)&&(this.source[1]=this.source[1]+", "+d+"="+this.context.aliases[d]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var e=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],f=0,g=this.environment.depths.list.length;g>f;f++)e.push("depth"+this.environment.depths.list[f]);var h=this.mergeSource();if(!this.isChild){var i=a.COMPILER_REVISION,j=a.REVISION_CHANGES[i];h="this.compilerInfo = ["+i+",'"+j+"'];\n"+h}if(b)return e.push(h),Function.apply(this,e);var k="function "+(this.name||"")+"("+e.join(",")+") {\n  "+h+"}";return a.log(a.logger.DEBUG,k+"\n\n"),k},mergeSource:function(){for(var a,c="",d=0,e=this.source.length;e>d;d++){var f=this.source[d];f.appendToBuffer?a=a?a+"\n    + "+f.content:f.content:(a&&(c+="buffer += "+a+";\n  ",a=b),c+=f+"\n  ")}return c},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a),this.replaceStack(function(b){return a.splice(1,0,b),"blockHelperMissing.call("+a.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a);var b=this.topStack();a.splice(1,0,b),a[a.length-1]="options",this.source.push("if (!"+this.lastHelper+") { "+b+" = blockHelperMissing.call("+a.join(", ")+"); }")},appendContent:function(a){this.source.push(this.appendToBuffer(this.quotedString(a)))},append:function(){this.flushInline();var a=this.popStack();this.source.push("if("+a+" || "+a+" === 0) { "+this.appendToBuffer(a)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(a){this.lastContext!==a&&(this.lastContext=a)},lookupOnContext:function(a){this.push(this.nameLookup("depth"+this.lastContext,a,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(a){return"typeof "+a+" === functionType ? "+a+".apply(depth0) : "+a})},lookup:function(a){this.replaceStack(function(b){return b+" == null || "+b+" === false ? "+b+" : "+this.nameLookup(b,a,"context")})},lookupData:function(){this.push("data")},pushStringParam:function(a,b){this.pushStackLiteral("depth"+this.lastContext),this.pushString(b),"string"==typeof a?this.pushString(a):this.pushStackLiteral(a)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var a=this.hash;this.hash=b,this.options.stringParams&&(this.register("hashContexts","{"+a.contexts.join(",")+"}"),this.register("hashTypes","{"+a.types.join(",")+"}")),this.push("{\n    "+a.values.join(",\n    ")+"\n  }")},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},push:function(a){return this.inlineStack.push(a),a},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){null!=a?this.pushStackLiteral(this.programExpression(a)):this.pushStackLiteral(null)},invokeHelper:function(a,b){this.context.aliases.helperMissing="helpers.helperMissing";var c=this.lastHelper=this.setupHelper(a,b,!0),d=this.nameLookup("depth"+this.lastContext,b,"context");this.push(c.name+" || "+d),this.replaceStack(function(a){return a+" ? "+a+".call("+c.callParams+") : helperMissing.call("+c.helperMissingParams+")"})},invokeKnownHelper:function(a,b){var c=this.setupHelper(a,b);this.push(c.name+".call("+c.callParams+")")},invokeAmbiguous:function(a,b){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");
var c=this.setupHelper(0,a,b),d=this.lastHelper=this.nameLookup("helpers",a,"helper"),e=this.nameLookup("depth"+this.lastContext,a,"context"),f=this.nextStack();this.source.push("if ("+f+" = "+d+") { "+f+" = "+f+".call("+c.callParams+"); }"),this.source.push("else { "+f+" = "+e+"; "+f+" = typeof "+f+" === functionType ? "+f+".apply(depth0) : "+f+"; }")},invokePartial:function(a){var b=[this.nameLookup("partials",a,"partial"),"'"+a+"'",this.popStack(),"helpers","partials"];this.options.data&&b.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+b.join(", ")+")")},assignToHash:function(a){var b,c,d=this.popStack();this.options.stringParams&&(c=this.popStack(),b=this.popStack());var e=this.hash;b&&e.contexts.push("'"+a+"': "+b),c&&e.types.push("'"+a+"': "+c),e.values.push("'"+a+"': ("+d+")")},compiler:m,compileChildren:function(a,b){for(var c,d,e=a.children,f=0,g=e.length;g>f;f++){c=e[f],d=new this.compiler;var h=this.matchExistingProgram(c);null==h?(this.context.programs.push(""),h=this.context.programs.length,c.index=h,c.name="program"+h,this.context.programs[h]=d.compile(c,b,this.context),this.context.environments[h]=c):(c.index=h,c.name="program"+h)}},matchExistingProgram:function(a){for(var b=0,c=this.context.environments.length;c>b;b++){var d=this.context.environments[b];if(d&&d.equals(a))return b}},programExpression:function(a){if(this.context.aliases.self="this",null==a)return"self.noop";for(var b,c=this.environment.children[a],d=c.depths.list,e=[c.index,c.name,"data"],f=0,g=d.length;g>f;f++)b=d[f],1===b?e.push("depth0"):e.push("depth"+(b-1));return(0===d.length?"self.program(":"self.programWithDepth(")+e.join(", ")+")"},register:function(a,b){this.useRegister(a),this.source.push(a+" = "+b+";")},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},pushStackLiteral:function(a){return this.push(new n(a))},pushStack:function(a){this.flushInline();var b=this.incrStack();return a&&this.source.push(b+" = "+a+";"),this.compileStack.push(b),b},replaceStack:function(a){var b,c="",d=this.isInline();if(d){var e=this.popStack(!0);if(e instanceof n)b=e.value;else{var f=this.stackSlot?this.topStackName():this.incrStack();c="("+this.push(f)+" = "+e+"),",b=this.topStack()}}else b=this.topStack();var g=a.call(this,b);return d?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+c+g+")")):(/^stack/.test(b)||(b=this.nextStack()),this.source.push(b+" = ("+c+g+");")),b},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;if(a.length){this.inlineStack=[];for(var b=0,c=a.length;c>b;b++){var d=a[b];d instanceof n?this.compileStack.push(d):this.pushStack(d)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var b=this.isInline(),c=(b?this.inlineStack:this.compileStack).pop();return!a&&c instanceof n?c.value:(b||this.stackSlot--,c)},topStack:function(a){var b=this.isInline()?this.inlineStack:this.compileStack,c=b[b.length-1];return!a&&c instanceof n?c.value:c},quotedString:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(a,b,c){var d=[];this.setupParams(a,d,c);var e=this.nameLookup("helpers",b,"helper");return{params:d,name:e,callParams:["depth0"].concat(d).join(", "),helperMissingParams:c&&["depth0",this.quotedString(b)].concat(d).join(", ")}},setupParams:function(a,b,c){var d,e,f,g=[],h=[],i=[];g.push("hash:"+this.popStack()),e=this.popStack(),f=this.popStack(),(f||e)&&(f||(this.context.aliases.self="this",f="self.noop"),e||(this.context.aliases.self="this",e="self.noop"),g.push("inverse:"+e),g.push("fn:"+f));for(var j=0;a>j;j++)d=this.popStack(),b.push(d),this.options.stringParams&&(i.push(this.popStack()),h.push(this.popStack()));return this.options.stringParams&&(g.push("contexts:["+h.join(",")+"]"),g.push("types:["+i.join(",")+"]"),g.push("hashContexts:hashContexts"),g.push("hashTypes:hashTypes")),this.options.data&&g.push("data:data"),g="{"+g.join(",")+"}",c?(this.register("options",g),b.push("options")):b.push(g),b.join(", ")}};for(var o="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),p=m.RESERVED_WORDS={},q=0,r=o.length;r>q;q++)p[o[q]]=!0;m.isValidJavaScriptVariableName=function(a){return!m.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(a)?!0:!1},a.precompile=function(b,c){if(null==b||"string"!=typeof b&&b.constructor!==a.AST.ProgramNode)throw new a.Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+b);c=c||{},"data"in c||(c.data=!0);var d=a.parse(b),e=(new l).compile(d,c);return(new m).compile(e,c)},a.compile=function(c,d){function e(){var e=a.parse(c),f=(new l).compile(e,d),g=(new m).compile(f,d,b,!0);return a.template(g)}if(null==c||"string"!=typeof c&&c.constructor!==a.AST.ProgramNode)throw new a.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+c);d=d||{},"data"in d||(d.data=!0);var f;return function(a,b){return f||(f=e()),f.call(this,a,b)}},a.VM={template:function(b){var c={escapeExpression:a.Utils.escapeExpression,invokePartial:a.VM.invokePartial,programs:[],program:function(b,c,d){var e=this.programs[b];return d?e=a.VM.program(b,c,d):e||(e=this.programs[b]=a.VM.program(b,c)),e},merge:function(b,c){var d=b||c;return b&&c&&(d={},a.Utils.extend(d,c),a.Utils.extend(d,b)),d},programWithDepth:a.VM.programWithDepth,noop:a.VM.noop,compilerInfo:null};return function(d,e){e=e||{};var f=b.call(c,a,d,e.helpers,e.partials,e.data),g=c.compilerInfo||[],h=g[0]||1,i=a.COMPILER_REVISION;if(h!==i){if(i>h){var j=a.REVISION_CHANGES[i],k=a.REVISION_CHANGES[h];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+j+") or downgrade your runtime to an older version ("+k+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+g[1]+")."}return f}},programWithDepth:function(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){return e=e||{},b.apply(this,[a,e.data||c].concat(d))};return e.program=a,e.depth=d.length,e},program:function(a,b,c){var d=function(a,d){return d=d||{},b(a,d.data||c)};return d.program=a,d.depth=0,d},noop:function(){return""},invokePartial:function(c,d,e,f,g,h){var i={helpers:f,partials:g,data:h};if(c===b)throw new a.Exception("The partial "+d+" could not be found");if(c instanceof Function)return c(e,i);if(a.compile)return g[d]=a.compile(c,{data:h!==b}),g[d](e,i);throw new a.Exception("The partial "+d+" could not be compiled when running in runtime-only mode")}},a.template=a.VM.template}(e),d("undefined"!=typeof e?e:window.Handlebars)}).call(c,void 0,void 0,void 0,function(a){b.exports=a})},{}],handlebars:[function(a,b){b.exports=a("WHOfuq")},{}],tAW9mx:[function(a,b){var c="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};(function(a,b,c,d){!function(b,d){function e(a){var b=a.length,c=hb.type(a);return hb.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||"function"!==c&&(0===b||"number"==typeof b&&b>0&&b-1 in a)}function f(a){var b=qb[a]={};return hb.each(a.match(jb)||[],function(a,c){b[c]=!0}),b}function g(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=hb.expando+Math.random()}function h(a,b,c){var e;if(c===d&&1===a.nodeType)if(e="data-"+b.replace(ub,"-$1").toLowerCase(),c=a.getAttribute(e),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:tb.test(c)?JSON.parse(c):c}catch(f){}rb.set(a,b,c)}else c=d;return c}function i(){return!0}function j(){return!1}function k(){try{return V.activeElement}catch(a){}}function l(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function m(a,b,c){if(hb.isFunction(b))return hb.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return hb.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(Eb.test(b))return hb.filter(b,a,c);b=hb.filter(b,a)}return hb.grep(a,function(a){return db.call(b,a)>=0!==c})}function n(a,b){return hb.nodeName(a,"table")&&hb.nodeName(1===b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function o(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function p(a){var b=Pb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function q(a,b){for(var c=a.length,d=0;c>d;d++)sb.set(a[d],"globalEval",!b||sb.get(b[d],"globalEval"))}function r(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(sb.hasData(a)&&(f=sb.access(a),g=sb.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)hb.event.add(b,e,j[e][c])}rb.hasData(a)&&(h=rb.access(a),i=hb.extend({},h),rb.set(b,i))}}function s(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return b===d||b&&hb.nodeName(a,b)?hb.merge([a],c):c}function t(a,b){var c=b.nodeName.toLowerCase();"input"===c&&Mb.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}function u(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=bc.length;e--;)if(b=bc[e]+c,b in a)return b;return d}function v(a,b){return a=b||a,"none"===hb.css(a,"display")||!hb.contains(a.ownerDocument,a)}function w(a){return b.getComputedStyle(a,null)}function x(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=sb.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&v(d)&&(f[g]=sb.access(d,"olddisplay",B(d.nodeName)))):f[g]||(e=v(d),(c&&"none"!==c||!e)&&sb.set(d,"olddisplay",e?c:hb.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function y(a,b,c){var d=Wb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function z(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=hb.css(a,c+ac[f],!0,e)),d?("content"===c&&(g-=hb.css(a,"padding"+ac[f],!0,e)),"margin"!==c&&(g-=hb.css(a,"border"+ac[f]+"Width",!0,e))):(g+=hb.css(a,"padding"+ac[f],!0,e),"padding"!==c&&(g+=hb.css(a,"border"+ac[f]+"Width",!0,e)));return g}function A(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=w(a),g=hb.support.boxSizing&&"border-box"===hb.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Sb(a,b,f),(0>e||null==e)&&(e=a.style[b]),Xb.test(e))return e;d=g&&(hb.support.boxSizingReliable||e===a.style[b]),e=parseFloat(e)||0}return e+z(a,b,c||(g?"border":"content"),d,f)+"px"}function B(a){var b=V,c=Zb[a];return c||(c=C(a,b),"none"!==c&&c||(Tb=(Tb||hb("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement),b=(Tb[0].contentWindow||Tb[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),c=C(a,b),Tb.detach()),Zb[a]=c),c}function C(a,b){var c=hb(b.createElement(a)).appendTo(b.body),d=hb.css(c[0],"display");return c.remove(),d}function D(a,b,c,d){var e;if(hb.isArray(b))hb.each(b,function(b,e){c||dc.test(a)?d(a,e):D(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==hb.type(b))d(a,b);else for(e in b)D(a+"["+e+"]",b[e],c,d)}function E(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(jb)||[];if(hb.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function F(a,b,c,d){function e(h){var i;return f[h]=!0,hb.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===uc;return e(b.dataTypes[0])||!f["*"]&&e("*")}function G(a,b){var c,e,f=hb.ajaxSettings.flatOptions||{};for(c in b)b[c]!==d&&((f[c]?a:e||(e={}))[c]=b[c]);return e&&hb.extend(!0,a,e),a}function H(a,b,c){for(var e,f,g,h,i=a.contents,j=a.dataTypes;"*"===j[0];)j.shift(),e===d&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(f in i)if(i[f]&&i[f].test(e)){j.unshift(f);break}if(j[0]in c)g=j[0];else{for(f in c){if(!j[0]||a.converters[f+" "+j[0]]){g=f;break}h||(h=f)}g=g||h}return g?(g!==j[0]&&j.unshift(g),c[g]):void 0}function I(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function J(){return setTimeout(function(){Dc=d}),Dc=hb.now()}function K(a,b,c){for(var d,e=(Jc[b]||[]).concat(Jc["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function L(a,b,c){var d,e,f=0,g=Ic.length,h=hb.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Dc||J(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:hb.extend({},b),opts:hb.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Dc||J(),duration:c.duration,tweens:[],createTween:function(b,c){var d=hb.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(M(k,j.opts.specialEasing);g>f;f++)if(d=Ic[f].call(j,a,k,j.opts))return d;return hb.map(k,K,j),hb.isFunction(j.opts.start)&&j.opts.start.call(a,j),hb.fx.timer(hb.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function M(a,b){var c,d,e,f,g;for(c in a)if(d=hb.camelCase(c),e=b[d],f=a[c],hb.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=hb.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function N(a,b,c){var e,f,g,h,i,j,k=this,l={},m=a.style,n=a.nodeType&&v(a),o=sb.get(a,"fxshow");c.queue||(i=hb._queueHooks(a,"fx"),null==i.unqueued&&(i.unqueued=0,j=i.empty.fire,i.empty.fire=function(){i.unqueued||j()}),i.unqueued++,k.always(function(){k.always(function(){i.unqueued--,hb.queue(a,"fx").length||i.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[m.overflow,m.overflowX,m.overflowY],"inline"===hb.css(a,"display")&&"none"===hb.css(a,"float")&&(m.display="inline-block")),c.overflow&&(m.overflow="hidden",k.always(function(){m.overflow=c.overflow[0],m.overflowX=c.overflow[1],m.overflowY=c.overflow[2]}));for(e in b)if(f=b[e],Fc.exec(f)){if(delete b[e],g=g||"toggle"===f,f===(n?"hide":"show")){if("show"!==f||!o||o[e]===d)continue;n=!0}l[e]=o&&o[e]||hb.style(a,e)}if(!hb.isEmptyObject(l)){o?"hidden"in o&&(n=o.hidden):o=sb.access(a,"fxshow",{}),g&&(o.hidden=!n),n?hb(a).show():k.done(function(){hb(a).hide()}),k.done(function(){var b;sb.remove(a,"fxshow");for(b in l)hb.style(a,b,l[b])});for(e in l)h=K(n?o[e]:0,e,k),e in o||(o[e]=h.start,n&&(h.end=h.start,h.start="width"===e||"height"===e?1:0))}}function O(a,b,c,d,e){return new O.prototype.init(a,b,c,d,e)}function P(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=ac[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function Q(a){return hb.isWindow(a)?a:9===a.nodeType&&a.defaultView}var R,S,T=typeof d,U=b.location,V=b.document,W=V.documentElement,X=b.jQuery,Y=b.$,Z={},$=[],_="2.0.3",ab=$.concat,bb=$.push,cb=$.slice,db=$.indexOf,eb=Z.toString,fb=Z.hasOwnProperty,gb=_.trim,hb=function(a,b){return new hb.fn.init(a,b,R)},ib=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,jb=/\S+/g,kb=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,lb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,mb=/^-ms-/,nb=/-([\da-z])/gi,ob=function(a,b){return b.toUpperCase()},pb=function(){V.removeEventListener("DOMContentLoaded",pb,!1),b.removeEventListener("load",pb,!1),hb.ready()};hb.fn=hb.prototype={jquery:_,constructor:hb,init:function(a,b,c){var e,f;if(!a)return this;if("string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:kb.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof hb?b[0]:b,hb.merge(this,hb.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:V,!0)),lb.test(e[1])&&hb.isPlainObject(b))for(e in b)hb.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}return f=V.getElementById(e[2]),f&&f.parentNode&&(this.length=1,this[0]=f),this.context=V,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):hb.isFunction(a)?c.ready(a):(a.selector!==d&&(this.selector=a.selector,this.context=a.context),hb.makeArray(a,this))},selector:"",length:0,toArray:function(){return cb.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){var b=hb.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return hb.each(this,a,b)},ready:function(a){return hb.ready.promise().done(a),this},slice:function(){return this.pushStack(cb.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},map:function(a){return this.pushStack(hb.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:bb,sort:[].sort,splice:[].splice},hb.fn.init.prototype=hb.fn,hb.extend=hb.fn.extend=function(){var a,b,c,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||hb.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(a=arguments[i]))for(b in a)c=h[b],e=a[b],h!==e&&(k&&e&&(hb.isPlainObject(e)||(f=hb.isArray(e)))?(f?(f=!1,g=c&&hb.isArray(c)?c:[]):g=c&&hb.isPlainObject(c)?c:{},h[b]=hb.extend(k,g,e)):e!==d&&(h[b]=e));return h},hb.extend({expando:"jQuery"+(_+Math.random()).replace(/\D/g,""),noConflict:function(a){return b.$===hb&&(b.$=Y),a&&b.jQuery===hb&&(b.jQuery=X),hb},isReady:!1,readyWait:1,holdReady:function(a){a?hb.readyWait++:hb.ready(!0)},ready:function(a){(a===!0?--hb.readyWait:hb.isReady)||(hb.isReady=!0,a!==!0&&--hb.readyWait>0||(S.resolveWith(V,[hb]),hb.fn.trigger&&hb(V).trigger("ready").off("ready")))},isFunction:function(a){return"function"===hb.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?Z[eb.call(a)]||"object":typeof a},isPlainObject:function(a){if("object"!==hb.type(a)||a.nodeType||hb.isWindow(a))return!1;try{if(a.constructor&&!fb.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||V;var d=lb.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=hb.buildFragment([a],b,e),e&&hb(e).remove(),hb.merge([],d.childNodes))},parseJSON:JSON.parse,parseXML:function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(e){b=d}return(!b||b.getElementsByTagName("parsererror").length)&&hb.error("Invalid XML: "+a),b},noop:function(){},globalEval:function(a){var b,c=eval;a=hb.trim(a),a&&(1===a.indexOf("use strict")?(b=V.createElement("script"),b.text=a,V.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(mb,"ms-").replace(nb,ob)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,f=0,g=a.length,h=e(a);if(c){if(h)for(;g>f&&(d=b.apply(a[f],c),d!==!1);f++);else for(f in a)if(d=b.apply(a[f],c),d===!1)break}else if(h)for(;g>f&&(d=b.call(a[f],f,a[f]),d!==!1);f++);else for(f in a)if(d=b.call(a[f],f,a[f]),d===!1)break;return a},trim:function(a){return null==a?"":gb.call(a)},makeArray:function(a,b){var c=b||[];return null!=a&&(e(Object(a))?hb.merge(c,"string"==typeof a?[a]:a):bb.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:db.call(b,a,c)},merge:function(a,b){var c=b.length,e=a.length,f=0;if("number"==typeof c)for(;c>f;f++)a[e++]=b[f];else for(;b[f]!==d;)a[e++]=b[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;for(c=!!c;g>f;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=e(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&(i[i.length]=d);else for(f in a)d=b(a[f],f,c),null!=d&&(i[i.length]=d);return ab.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(c=a[b],b=a,a=c),hb.isFunction(a)?(e=cb.call(arguments,2),f=function(){return a.apply(b||this,e.concat(cb.call(arguments)))},f.guid=a.guid=a.guid||hb.guid++,f):d},access:function(a,b,c,e,f,g,h){var i=0,j=a.length,k=null==c;if("object"===hb.type(c)){f=!0;for(i in c)hb.access(a,b,i,c[i],!0,g,h)}else if(e!==d&&(f=!0,hb.isFunction(e)||(h=!0),k&&(h?(b.call(a,e),b=null):(k=b,b=function(a,b,c){return k.call(hb(a),c)})),b))for(;j>i;i++)b(a[i],c,h?e:e.call(a[i],i,b(a[i],c)));return f?a:k?b.call(a):j?b(a[0],c):g},now:Date.now,swap:function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e}}),hb.ready.promise=function(a){return S||(S=hb.Deferred(),"complete"===V.readyState?setTimeout(hb.ready):(V.addEventListener("DOMContentLoaded",pb,!1),b.addEventListener("load",pb,!1))),S.promise(a)},hb.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){Z["[object "+b+"]"]=b.toLowerCase()}),R=hb(V),function(a,b){function c(a,b,c,d){var e,f,g,h,i,j,k,l,o,p;if((b?b.ownerDocument||b:O)!==G&&F(b),b=b||G,c=c||[],!a||"string"!=typeof a)return c;if(1!==(h=b.nodeType)&&9!==h)return[];if(I&&!d){if(e=tb.exec(a))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&M(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return ab.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&x.getElementsByClassName&&b.getElementsByClassName)return ab.apply(c,b.getElementsByClassName(g)),c}if(x.qsa&&(!J||!J.test(a))){if(l=k=N,o=b,p=9===h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=m(a),(k=b.getAttribute("id"))?l=k.replace(wb,"\\$&"):b.setAttribute("id",l),l="[id='"+l+"'] ",i=j.length;i--;)j[i]=l+n(j[i]);o=nb.test(a)&&b.parentNode||b,p=j.join(",")}if(p)try{return ab.apply(c,o.querySelectorAll(p)),c}catch(q){}finally{k||b.removeAttribute("id")}}}return v(a.replace(kb,"$1"),b,c,d)}function d(){function a(c,d){return b.push(c+=" ")>z.cacheLength&&delete a[b.shift()],a[c]=d}var b=[];return a}function e(a){return a[N]=!0,a}function f(a){var b=G.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function g(a,b){for(var c=a.split("|"),d=a.length;d--;)z.attrHandle[c[d]]=b}function h(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||X)-(~a.sourceIndex||X);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function i(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function j(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function k(a){return e(function(b){return b=+b,e(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function l(){}function m(a,b){var d,e,f,g,h,i,j,k=S[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=z.preFilter;h;){(!d||(e=lb.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=mb.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(kb," ")}),h=h.slice(d.length));for(g in z.filter)!(e=rb[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return b?h.length:h?c.error(a):S(a,i).slice(0)}function n(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function o(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=Q++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=P+" "+f;if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e)if(j=b[N]||(b[N]={}),(i=j[d])&&i[0]===k){if((h=i[1])===!0||h===y)return h===!0}else if(i=j[d]=[k],i[1]=a(b,c,g)||y,i[1]===!0)return!0}}function p(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function q(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function r(a,b,c,d,f,g){return d&&!d[N]&&(d=r(d)),f&&!f[N]&&(f=r(f,g)),e(function(e,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=e||u(b||"*",h.nodeType?[h]:h,[]),r=!a||!e&&b?p:q(p,m,a,h,i),s=c?f||(e?a:o||d)?[]:g:r;if(c&&c(r,s,h,i),d)for(j=q(s,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(s[n[k]]=!(r[n[k]]=l));if(e){if(f||a){if(f){for(j=[],k=s.length;k--;)(l=s[k])&&j.push(r[k]=l);f(null,s=[],j,i)}for(k=s.length;k--;)(l=s[k])&&(j=f?cb.call(e,l):m[k])>-1&&(e[j]=!(g[j]=l))}}else s=q(s===g?s.splice(o,s.length):s),f?f(null,g,s,i):ab.apply(g,s)})}function s(a){for(var b,c,d,e=a.length,f=z.relative[a[0].type],g=f||z.relative[" "],h=f?1:0,i=o(function(a){return a===b},g,!0),j=o(function(a){return cb.call(b,a)>-1},g,!0),k=[function(a,c,d){return!f&&(d||c!==D)||((b=c).nodeType?i(a,c,d):j(a,c,d))}];e>h;h++)if(c=z.relative[a[h].type])k=[o(p(k),c)];else{if(c=z.filter[a[h].type].apply(null,a[h].matches),c[N]){for(d=++h;e>d&&!z.relative[a[d].type];d++);return r(h>1&&p(k),h>1&&n(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(kb,"$1"),c,d>h&&s(a.slice(h,d)),e>d&&s(a=a.slice(d)),e>d&&n(a))}k.push(c)}return p(k)}function t(a,b){var d=0,f=b.length>0,g=a.length>0,h=function(e,h,i,j,k){var l,m,n,o=[],p=0,r="0",s=e&&[],t=null!=k,u=D,v=e||g&&z.find.TAG("*",k&&h.parentNode||h),w=P+=null==u?1:Math.random()||.1;for(t&&(D=h!==G&&h,y=d);null!=(l=v[r]);r++){if(g&&l){for(m=0;n=a[m++];)if(n(l,h,i)){j.push(l);break}t&&(P=w,y=++d)}f&&((l=!n&&l)&&p--,e&&s.push(l))}if(p+=r,f&&r!==p){for(m=0;n=b[m++];)n(s,o,h,i);if(e){if(p>0)for(;r--;)s[r]||o[r]||(o[r]=$.call(j));o=q(o)}ab.apply(j,o),t&&!e&&o.length>0&&p+b.length>1&&c.uniqueSort(j)}return t&&(P=w,D=u),s};return f?e(h):h}function u(a,b,d){for(var e=0,f=b.length;f>e;e++)c(a,b[e],d);return d}function v(a,b,c,d){var e,f,g,h,i,j=m(a);if(!d&&1===j.length){if(f=j[0]=j[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&x.getById&&9===b.nodeType&&I&&z.relative[f[1].type]){if(b=(z.find.ID(g.matches[0].replace(xb,yb),b)||[])[0],!b)return c;a=a.slice(f.shift().value.length)}for(e=rb.needsContext.test(a)?0:f.length;e--&&(g=f[e],!z.relative[h=g.type]);)if((i=z.find[h])&&(d=i(g.matches[0].replace(xb,yb),nb.test(f[0].type)&&b.parentNode||b))){if(f.splice(e,1),a=d.length&&n(f),!a)return ab.apply(c,d),c;break}}return C(a,j)(d,b,!I,c,nb.test(a)),c}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N="sizzle"+-new Date,O=a.document,P=0,Q=0,R=d(),S=d(),T=d(),U=!1,V=function(a,b){return a===b?(U=!0,0):0},W=typeof b,X=1<<31,Y={}.hasOwnProperty,Z=[],$=Z.pop,_=Z.push,ab=Z.push,bb=Z.slice,cb=Z.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},db="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",eb="[\\x20\\t\\r\\n\\f]",fb="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",gb=fb.replace("w","w#"),ib="\\["+eb+"*("+fb+")"+eb+"*(?:([*^$|!~]?=)"+eb+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+gb+")|)|)"+eb+"*\\]",jb=":("+fb+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+ib.replace(3,8)+")*)|.*)\\)|)",kb=new RegExp("^"+eb+"+|((?:^|[^\\\\])(?:\\\\.)*)"+eb+"+$","g"),lb=new RegExp("^"+eb+"*,"+eb+"*"),mb=new RegExp("^"+eb+"*([>+~]|"+eb+")"+eb+"*"),nb=new RegExp(eb+"*[+~]"),ob=new RegExp("="+eb+"*([^\\]'\"]*)"+eb+"*\\]","g"),pb=new RegExp(jb),qb=new RegExp("^"+gb+"$"),rb={ID:new RegExp("^#("+fb+")"),CLASS:new RegExp("^\\.("+fb+")"),TAG:new RegExp("^("+fb.replace("w","w*")+")"),ATTR:new RegExp("^"+ib),PSEUDO:new RegExp("^"+jb),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+eb+"*(even|odd|(([+-]|)(\\d*)n|)"+eb+"*(?:([+-]|)"+eb+"*(\\d+)|))"+eb+"*\\)|)","i"),bool:new RegExp("^(?:"+db+")$","i"),needsContext:new RegExp("^"+eb+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+eb+"*((?:-\\d)?\\d*)"+eb+"*\\)|)(?=[^-]|$)","i")},sb=/^[^{]+\{\s*\[native \w/,tb=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ub=/^(?:input|select|textarea|button)$/i,vb=/^h\d$/i,wb=/'|\\/g,xb=new RegExp("\\\\([\\da-f]{1,6}"+eb+"?|("+eb+")|.)","ig"),yb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{ab.apply(Z=bb.call(O.childNodes),O.childNodes),Z[O.childNodes.length].nodeType}catch(zb){ab={apply:Z.length?function(a,b){_.apply(a,bb.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}B=c.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},x=c.support={},F=c.setDocument=function(a){var b=a?a.ownerDocument||a:O,c=b.defaultView;return b!==G&&9===b.nodeType&&b.documentElement?(G=b,H=b.documentElement,I=!B(b),c&&c.attachEvent&&c!==c.top&&c.attachEvent("onbeforeunload",function(){F()}),x.attributes=f(function(a){return a.className="i",!a.getAttribute("className")}),x.getElementsByTagName=f(function(a){return a.appendChild(b.createComment("")),!a.getElementsByTagName("*").length}),x.getElementsByClassName=f(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),x.getById=f(function(a){return H.appendChild(a).id=N,!b.getElementsByName||!b.getElementsByName(N).length}),x.getById?(z.find.ID=function(a,b){if(typeof b.getElementById!==W&&I){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},z.filter.ID=function(a){var b=a.replace(xb,yb);return function(a){return a.getAttribute("id")===b}}):(delete z.find.ID,z.filter.ID=function(a){var b=a.replace(xb,yb);return function(a){var c=typeof a.getAttributeNode!==W&&a.getAttributeNode("id");return c&&c.value===b}}),z.find.TAG=x.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==W?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},z.find.CLASS=x.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==W&&I?b.getElementsByClassName(a):void 0},K=[],J=[],(x.qsa=sb.test(b.querySelectorAll))&&(f(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||J.push("\\["+eb+"*(?:value|"+db+")"),a.querySelectorAll(":checked").length||J.push(":checked")
}),f(function(a){var c=b.createElement("input");c.setAttribute("type","hidden"),a.appendChild(c).setAttribute("t",""),a.querySelectorAll("[t^='']").length&&J.push("[*^$]="+eb+"*(?:''|\"\")"),a.querySelectorAll(":enabled").length||J.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),J.push(",.*:")})),(x.matchesSelector=sb.test(L=H.webkitMatchesSelector||H.mozMatchesSelector||H.oMatchesSelector||H.msMatchesSelector))&&f(function(a){x.disconnectedMatch=L.call(a,"div"),L.call(a,"[s!='']:x"),K.push("!=",jb)}),J=J.length&&new RegExp(J.join("|")),K=K.length&&new RegExp(K.join("|")),M=sb.test(H.contains)||H.compareDocumentPosition?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},V=H.compareDocumentPosition?function(a,c){if(a===c)return U=!0,0;var d=c.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(c);return d?1&d||!x.sortDetached&&c.compareDocumentPosition(a)===d?a===b||M(O,a)?-1:c===b||M(O,c)?1:E?cb.call(E,a)-cb.call(E,c):0:4&d?-1:1:a.compareDocumentPosition?-1:1}:function(a,c){var d,e=0,f=a.parentNode,g=c.parentNode,i=[a],j=[c];if(a===c)return U=!0,0;if(!f||!g)return a===b?-1:c===b?1:f?-1:g?1:E?cb.call(E,a)-cb.call(E,c):0;if(f===g)return h(a,c);for(d=a;d=d.parentNode;)i.unshift(d);for(d=c;d=d.parentNode;)j.unshift(d);for(;i[e]===j[e];)e++;return e?h(i[e],j[e]):i[e]===O?-1:j[e]===O?1:0},b):G},c.matches=function(a,b){return c(a,null,null,b)},c.matchesSelector=function(a,b){if((a.ownerDocument||a)!==G&&F(a),b=b.replace(ob,"='$1']"),!(!x.matchesSelector||!I||K&&K.test(b)||J&&J.test(b)))try{var d=L.call(a,b);if(d||x.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return c(b,G,null,[a]).length>0},c.contains=function(a,b){return(a.ownerDocument||a)!==G&&F(a),M(a,b)},c.attr=function(a,c){(a.ownerDocument||a)!==G&&F(a);var d=z.attrHandle[c.toLowerCase()],e=d&&Y.call(z.attrHandle,c.toLowerCase())?d(a,c,!I):b;return e===b?x.attributes||!I?a.getAttribute(c):(e=a.getAttributeNode(c))&&e.specified?e.value:null:e},c.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},c.uniqueSort=function(a){var b,c=[],d=0,e=0;if(U=!x.detectDuplicates,E=!x.sortStable&&a.slice(0),a.sort(V),U){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return a},A=c.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=A(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d];d++)c+=A(b);return c},z=c.selectors={cacheLength:50,createPseudo:e,match:rb,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(xb,yb),a[3]=(a[4]||a[5]||"").replace(xb,yb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||c.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&c.error(a[0]),a},PSEUDO:function(a){var c,d=!a[5]&&a[2];return rb.CHILD.test(a[0])?null:(a[3]&&a[4]!==b?a[2]=a[4]:d&&pb.test(d)&&(c=m(d,!0))&&(c=d.indexOf(")",d.length-c)-d.length)&&(a[0]=a[0].slice(0,c),a[2]=d.slice(0,c)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(xb,yb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=R[a+" "];return b||(b=new RegExp("(^|"+eb+")"+a+"("+eb+"|$)"))&&R(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==W&&a.getAttribute("class")||"")})},ATTR:function(a,b,d){return function(e){var f=c.attr(e,a);return null==f?"!="===b:b?(f+="","="===b?f===d:"!="===b?f!==d:"^="===b?d&&0===f.indexOf(d):"*="===b?d&&f.indexOf(d)>-1:"$="===b?d&&f.slice(-d.length)===d:"~="===b?(" "+f+" ").indexOf(d)>-1:"|="===b?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[N]||(q[N]={}),j=k[a]||[],n=j[0]===P&&j[1],m=j[0]===P&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[P,n,m];break}}else if(s&&(j=(b[N]||(b[N]={}))[a])&&j[0]===P)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[N]||(l[N]={}))[a]=[P,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var d,f=z.pseudos[a]||z.setFilters[a.toLowerCase()]||c.error("unsupported pseudo: "+a);return f[N]?f(b):f.length>1?(d=[a,a,"",b],z.setFilters.hasOwnProperty(a.toLowerCase())?e(function(a,c){for(var d,e=f(a,b),g=e.length;g--;)d=cb.call(a,e[g]),a[d]=!(c[d]=e[g])}):function(a){return f(a,0,d)}):f}},pseudos:{not:e(function(a){var b=[],c=[],d=C(a.replace(kb,"$1"));return d[N]?e(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:e(function(a){return function(b){return c(a,b).length>0}}),contains:e(function(a){return function(b){return(b.textContent||b.innerText||A(b)).indexOf(a)>-1}}),lang:e(function(a){return qb.test(a||"")||c.error("unsupported lang: "+a),a=a.replace(xb,yb).toLowerCase(),function(b){var c;do if(c=I?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===H},focus:function(a){return a===G.activeElement&&(!G.hasFocus||G.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeName>"@"||3===a.nodeType||4===a.nodeType)return!1;return!0},parent:function(a){return!z.pseudos.empty(a)},header:function(a){return vb.test(a.nodeName)},input:function(a){return ub.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||b.toLowerCase()===a.type)},first:k(function(){return[0]}),last:k(function(a,b){return[b-1]}),eq:k(function(a,b,c){return[0>c?c+b:c]}),even:k(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:k(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:k(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:k(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},z.pseudos.nth=z.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})z.pseudos[w]=i(w);for(w in{submit:!0,reset:!0})z.pseudos[w]=j(w);l.prototype=z.filters=z.pseudos,z.setFilters=new l,C=c.compile=function(a,b){var c,d=[],e=[],f=T[a+" "];if(!f){for(b||(b=m(a)),c=b.length;c--;)f=s(b[c]),f[N]?d.push(f):e.push(f);f=T(a,t(e,d))}return f},x.sortStable=N.split("").sort(V).join("")===N,x.detectDuplicates=U,F(),x.sortDetached=f(function(a){return 1&a.compareDocumentPosition(G.createElement("div"))}),f(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||g("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),x.attributes&&f(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||g("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),f(function(a){return null==a.getAttribute("disabled")})||g(db,function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&d.specified?d.value:a[b]===!0?b.toLowerCase():null}),hb.find=c,hb.expr=c.selectors,hb.expr[":"]=hb.expr.pseudos,hb.unique=c.uniqueSort,hb.text=c.getText,hb.isXMLDoc=c.isXML,hb.contains=c.contains}(b);var qb={};hb.Callbacks=function(a){a="string"==typeof a?qb[a]||f(a):hb.extend({},a);var b,c,e,g,h,i,j=[],k=!a.once&&[],l=function(d){for(b=a.memory&&d,c=!0,i=g||0,g=0,h=j.length,e=!0;j&&h>i;i++)if(j[i].apply(d[0],d[1])===!1&&a.stopOnFalse){b=!1;break}e=!1,j&&(k?k.length&&l(k.shift()):b?j=[]:m.disable())},m={add:function(){if(j){var c=j.length;!function d(b){hb.each(b,function(b,c){var e=hb.type(c);"function"===e?a.unique&&m.has(c)||j.push(c):c&&c.length&&"string"!==e&&d(c)})}(arguments),e?h=j.length:b&&(g=c,l(b))}return this},remove:function(){return j&&hb.each(arguments,function(a,b){for(var c;(c=hb.inArray(b,j,c))>-1;)j.splice(c,1),e&&(h>=c&&h--,i>=c&&i--)}),this},has:function(a){return a?hb.inArray(a,j)>-1:!(!j||!j.length)},empty:function(){return j=[],h=0,this},disable:function(){return j=k=b=d,this},disabled:function(){return!j},lock:function(){return k=d,b||m.disable(),this},locked:function(){return!k},fireWith:function(a,b){return!j||c&&!k||(b=b||[],b=[a,b.slice?b.slice():b],e?k.push(b):l(b)),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!c}};return m},hb.extend({Deferred:function(a){var b=[["resolve","done",hb.Callbacks("once memory"),"resolved"],["reject","fail",hb.Callbacks("once memory"),"rejected"],["notify","progress",hb.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return hb.Deferred(function(c){hb.each(b,function(b,f){var g=f[0],h=hb.isFunction(a[b])&&a[b];e[f[1]](function(){var a=h&&h.apply(this,arguments);a&&hb.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[g+"With"](this===d?c.promise():this,h?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?hb.extend(a,d):d}},e={};return d.pipe=d.then,hb.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=cb.call(arguments),g=f.length,h=1!==g||a&&hb.isFunction(a.promise)?g:0,i=1===h?a:hb.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?cb.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&hb.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}}),hb.support=function(a){var c=V.createElement("input"),d=V.createDocumentFragment(),e=V.createElement("div"),f=V.createElement("select"),g=f.appendChild(V.createElement("option"));return c.type?(c.type="checkbox",a.checkOn=""!==c.value,a.optSelected=g.selected,a.reliableMarginRight=!0,a.boxSizingReliable=!0,a.pixelPosition=!1,c.checked=!0,a.noCloneChecked=c.cloneNode(!0).checked,f.disabled=!0,a.optDisabled=!g.disabled,c=V.createElement("input"),c.value="t",c.type="radio",a.radioValue="t"===c.value,c.setAttribute("checked","t"),c.setAttribute("name","t"),d.appendChild(c),a.checkClone=d.cloneNode(!0).cloneNode(!0).lastChild.checked,a.focusinBubbles="onfocusin"in b,e.style.backgroundClip="content-box",e.cloneNode(!0).style.backgroundClip="",a.clearCloneStyle="content-box"===e.style.backgroundClip,hb(function(){var c,d,f="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",g=V.getElementsByTagName("body")[0];g&&(c=V.createElement("div"),c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",g.appendChild(c).appendChild(e),e.innerHTML="",e.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",hb.swap(g,null!=g.style.zoom?{zoom:1}:{},function(){a.boxSizing=4===e.offsetWidth}),b.getComputedStyle&&(a.pixelPosition="1%"!==(b.getComputedStyle(e,null)||{}).top,a.boxSizingReliable="4px"===(b.getComputedStyle(e,null)||{width:"4px"}).width,d=e.appendChild(V.createElement("div")),d.style.cssText=e.style.cssText=f,d.style.marginRight=d.style.width="0",e.style.width="1px",a.reliableMarginRight=!parseFloat((b.getComputedStyle(d,null)||{}).marginRight)),g.removeChild(c))}),a):a}({});var rb,sb,tb=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,ub=/([A-Z])/g;g.uid=1,g.accepts=function(a){return a.nodeType?1===a.nodeType||9===a.nodeType:!0},g.prototype={key:function(a){if(!g.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=g.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,hb.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(hb.isEmptyObject(f))hb.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return b===d?c:c[b]},access:function(a,b,c){var e;return b===d||b&&"string"==typeof b&&c===d?(e=this.get(a,b),e!==d?e:this.get(a,hb.camelCase(b))):(this.set(a,b,c),c!==d?c:b)},remove:function(a,b){var c,e,f,g=this.key(a),h=this.cache[g];if(b===d)this.cache[g]={};else{hb.isArray(b)?e=b.concat(b.map(hb.camelCase)):(f=hb.camelCase(b),b in h?e=[b,f]:(e=f,e=e in h?[e]:e.match(jb)||[])),c=e.length;for(;c--;)delete h[e[c]]}},hasData:function(a){return!hb.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}},rb=new g,sb=new g,hb.extend({acceptData:g.accepts,hasData:function(a){return rb.hasData(a)||sb.hasData(a)},data:function(a,b,c){return rb.access(a,b,c)},removeData:function(a,b){rb.remove(a,b)},_data:function(a,b,c){return sb.access(a,b,c)},_removeData:function(a,b){sb.remove(a,b)}}),hb.fn.extend({data:function(a,b){var c,e,f=this[0],g=0,i=null;if(a===d){if(this.length&&(i=rb.get(f),1===f.nodeType&&!sb.get(f,"hasDataAttrs"))){for(c=f.attributes;g<c.length;g++)e=c[g].name,0===e.indexOf("data-")&&(e=hb.camelCase(e.slice(5)),h(f,e,i[e]));sb.set(f,"hasDataAttrs",!0)}return i}return"object"==typeof a?this.each(function(){rb.set(this,a)}):hb.access(this,function(b){var c,e=hb.camelCase(a);if(f&&b===d){if(c=rb.get(f,a),c!==d)return c;if(c=rb.get(f,e),c!==d)return c;if(c=h(f,e,d),c!==d)return c}else this.each(function(){var c=rb.get(this,e);rb.set(this,e,b),-1!==a.indexOf("-")&&c!==d&&rb.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){rb.remove(this,a)})}}),hb.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=sb.get(a,b),c&&(!d||hb.isArray(c)?d=sb.access(a,b,hb.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=hb.queue(a,b),d=c.length,e=c.shift(),f=hb._queueHooks(a,b),g=function(){hb.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return sb.get(a,c)||sb.access(a,c,{empty:hb.Callbacks("once memory").add(function(){sb.remove(a,[b+"queue",c])})})}}),hb.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?hb.queue(this[0],a):b===d?this:this.each(function(){var c=hb.queue(this,a,b);hb._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&hb.dequeue(this,a)})},dequeue:function(a){return this.each(function(){hb.dequeue(this,a)})},delay:function(a,b){return a=hb.fx?hb.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,e=1,f=hb.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(b=a,a=d),a=a||"fx";h--;)c=sb.get(g[h],a+"queueHooks"),c&&c.empty&&(e++,c.empty.add(i));return i(),f.promise(b)}});var vb,wb,xb=/[\t\r\n\f]/g,yb=/\r/g,zb=/^(?:input|select|textarea|button)$/i;hb.fn.extend({attr:function(a,b){return hb.access(this,hb.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){hb.removeAttr(this,a)})},prop:function(a,b){return hb.access(this,hb.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[hb.propFix[a]||a]})},addClass:function(a){var b,c,d,e,f,g=0,h=this.length,i="string"==typeof a&&a;if(hb.isFunction(a))return this.each(function(b){hb(this).addClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(jb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(xb," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");c.className=hb.trim(d)}return this},removeClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=0===arguments.length||"string"==typeof a&&a;if(hb.isFunction(a))return this.each(function(b){hb(this).removeClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(jb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(xb," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");c.className=a?hb.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):hb.isFunction(a)?this.each(function(c){hb(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var b,d=0,e=hb(this),f=a.match(jb)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(c===T||"boolean"===c)&&(this.className&&sb.set(this,"__className__",this.className),this.className=this.className||a===!1?"":sb.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(xb," ").indexOf(b)>=0)return!0;return!1},val:function(a){var b,c,e,f=this[0];{if(arguments.length)return e=hb.isFunction(a),this.each(function(c){var f;1===this.nodeType&&(f=e?a.call(this,c,hb(this).val()):a,null==f?f="":"number"==typeof f?f+="":hb.isArray(f)&&(f=hb.map(f,function(a){return null==a?"":a+""})),b=hb.valHooks[this.type]||hb.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&b.set(this,f,"value")!==d||(this.value=f))});if(f)return b=hb.valHooks[f.type]||hb.valHooks[f.nodeName.toLowerCase()],b&&"get"in b&&(c=b.get(f,"value"))!==d?c:(c=f.value,"string"==typeof c?c.replace(yb,""):null==c?"":c)}}}),hb.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(hb.support.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&hb.nodeName(c.parentNode,"optgroup"))){if(b=hb(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=hb.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=hb.inArray(hb(d).val(),f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}},attr:function(a,b,c){var e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return typeof a.getAttribute===T?hb.prop(a,b,c):(1===g&&hb.isXMLDoc(a)||(b=b.toLowerCase(),e=hb.attrHooks[b]||(hb.expr.match.bool.test(b)?wb:vb)),c===d?e&&"get"in e&&null!==(f=e.get(a,b))?f:(f=hb.find.attr(a,b),null==f?d:f):null!==c?e&&"set"in e&&(f=e.set(a,c,b))!==d?f:(a.setAttribute(b,c+""),c):(hb.removeAttr(a,b),void 0))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(jb);if(f&&1===a.nodeType)for(;c=f[e++];)d=hb.propFix[c]||c,hb.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!hb.support.radioValue&&"radio"===b&&hb.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var e,f,g,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h)return g=1!==h||!hb.isXMLDoc(a),g&&(b=hb.propFix[b]||b,f=hb.propHooks[b]),c!==d?f&&"set"in f&&(e=f.set(a,c,b))!==d?e:a[b]=c:f&&"get"in f&&null!==(e=f.get(a,b))?e:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||zb.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),wb={set:function(a,b,c){return b===!1?hb.removeAttr(a,c):a.setAttribute(c,c),c}},hb.each(hb.expr.match.bool.source.match(/\w+/g),function(a,b){var c=hb.expr.attrHandle[b]||hb.find.attr;hb.expr.attrHandle[b]=function(a,b,e){var f=hb.expr.attrHandle[b],g=e?d:(hb.expr.attrHandle[b]=d)!=c(a,b,e)?b.toLowerCase():null;return hb.expr.attrHandle[b]=f,g}}),hb.support.optSelected||(hb.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),hb.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){hb.propFix[this.toLowerCase()]=this}),hb.each(["radio","checkbox"],function(){hb.valHooks[this]={set:function(a,b){return hb.isArray(b)?a.checked=hb.inArray(hb(a).val(),b)>=0:void 0}},hb.support.checkOn||(hb.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var Ab=/^key/,Bb=/^(?:mouse|contextmenu)|click/,Cb=/^(?:focusinfocus|focusoutblur)$/,Db=/^([^.]*)(?:\.(.+)|)$/;hb.event={global:{},add:function(a,b,c,e,f){var g,h,i,j,k,l,m,n,o,p,q,r=sb.get(a);if(r){for(c.handler&&(g=c,c=g.handler,f=g.selector),c.guid||(c.guid=hb.guid++),(j=r.events)||(j=r.events={}),(h=r.handle)||(h=r.handle=function(a){return typeof hb===T||a&&hb.event.triggered===a.type?d:hb.event.dispatch.apply(h.elem,arguments)},h.elem=a),b=(b||"").match(jb)||[""],k=b.length;k--;)i=Db.exec(b[k])||[],o=q=i[1],p=(i[2]||"").split(".").sort(),o&&(m=hb.event.special[o]||{},o=(f?m.delegateType:m.bindType)||o,m=hb.event.special[o]||{},l=hb.extend({type:o,origType:q,data:e,handler:c,guid:c.guid,selector:f,needsContext:f&&hb.expr.match.needsContext.test(f),namespace:p.join(".")},g),(n=j[o])||(n=j[o]=[],n.delegateCount=0,m.setup&&m.setup.call(a,e,p,h)!==!1||a.addEventListener&&a.addEventListener(o,h,!1)),m.add&&(m.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),f?n.splice(n.delegateCount++,0,l):n.push(l),hb.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=sb.hasData(a)&&sb.get(a);if(q&&(i=q.events)){for(b=(b||"").match(jb)||[""],j=b.length;j--;)if(h=Db.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=hb.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||hb.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)hb.event.remove(a,n+b[j],c,d,!0);hb.isEmptyObject(i)&&(delete q.handle,sb.remove(a,"events"))}},trigger:function(a,c,e,f){var g,h,i,j,k,l,m,n=[e||V],o=fb.call(a,"type")?a.type:a,p=fb.call(a,"namespace")?a.namespace.split("."):[];if(h=i=e=e||V,3!==e.nodeType&&8!==e.nodeType&&!Cb.test(o+hb.event.triggered)&&(o.indexOf(".")>=0&&(p=o.split("."),o=p.shift(),p.sort()),k=o.indexOf(":")<0&&"on"+o,a=a[hb.expando]?a:new hb.Event(o,"object"==typeof a&&a),a.isTrigger=f?2:3,a.namespace=p.join("."),a.namespace_re=a.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,a.result=d,a.target||(a.target=e),c=null==c?[a]:hb.makeArray(c,[a]),m=hb.event.special[o]||{},f||!m.trigger||m.trigger.apply(e,c)!==!1)){if(!f&&!m.noBubble&&!hb.isWindow(e)){for(j=m.delegateType||o,Cb.test(j+o)||(h=h.parentNode);h;h=h.parentNode)n.push(h),i=h;i===(e.ownerDocument||V)&&n.push(i.defaultView||i.parentWindow||b)}for(g=0;(h=n[g++])&&!a.isPropagationStopped();)a.type=g>1?j:m.bindType||o,l=(sb.get(h,"events")||{})[a.type]&&sb.get(h,"handle"),l&&l.apply(h,c),l=k&&h[k],l&&hb.acceptData(h)&&l.apply&&l.apply(h,c)===!1&&a.preventDefault();return a.type=o,f||a.isDefaultPrevented()||m._default&&m._default.apply(n.pop(),c)!==!1||!hb.acceptData(e)||k&&hb.isFunction(e[o])&&!hb.isWindow(e)&&(i=e[k],i&&(e[k]=null),hb.event.triggered=o,e[o](),hb.event.triggered=d,i&&(e[k]=i)),a.result}},dispatch:function(a){a=hb.event.fix(a);var b,c,e,f,g,h=[],i=cb.call(arguments),j=(sb.get(this,"events")||{})[a.type]||[],k=hb.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){for(h=hb.event.handlers.call(this,a,j),b=0;(f=h[b++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,c=0;(g=f.handlers[c++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((hb.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),e!==d&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,e,f,g,h=[],i=b.delegateCount,j=a.target;if(i&&j.nodeType&&(!a.button||"click"!==a.type))for(;j!==this;j=j.parentNode||this)if(j.disabled!==!0||"click"!==a.type){for(e=[],c=0;i>c;c++)g=b[c],f=g.selector+" ",e[f]===d&&(e[f]=g.needsContext?hb(f,this).index(j)>=0:hb.find(f,this,null,[j]).length),e[f]&&e.push(g);e.length&&h.push({elem:j,handlers:e})}return i<b.length&&h.push({elem:this,handlers:b.slice(i)}),h},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f,g=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||V,e=c.documentElement,f=c.body,a.pageX=b.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),a.which||g===d||(a.which=1&g?1:2&g?3:4&g?2:0),a}},fix:function(a){if(a[hb.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Bb.test(e)?this.mouseHooks:Ab.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new hb.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=V),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==k()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===k()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&hb.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return hb.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){a.result!==d&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=hb.extend(new hb.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?hb.event.trigger(e,null,b):hb.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},hb.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},hb.Event=function(a,b){return this instanceof hb.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.getPreventDefault&&a.getPreventDefault()?i:j):this.type=a,b&&hb.extend(this,b),this.timeStamp=a&&a.timeStamp||hb.now(),this[hb.expando]=!0,void 0):new hb.Event(a,b)},hb.Event.prototype={isDefaultPrevented:j,isPropagationStopped:j,isImmediatePropagationStopped:j,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=i,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=i,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=i,this.stopPropagation()}},hb.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){hb.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!hb.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),hb.support.focusinBubbles||hb.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){hb.event.simulate(b,a.target,hb.event.fix(a),!0)};hb.event.special[b]={setup:function(){0===c++&&V.addEventListener(a,d,!0)},teardown:function(){0===--c&&V.removeEventListener(a,d,!0)}}}),hb.fn.extend({on:function(a,b,c,e,f){var g,h;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=d);for(h in a)this.on(h,b,c,a[h],f);return this}if(null==c&&null==e?(e=b,c=b=d):null==e&&("string"==typeof b?(e=c,c=d):(e=c,c=b,b=d)),e===!1)e=j;else if(!e)return this;return 1===f&&(g=e,e=function(a){return hb().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=hb.guid++)),this.each(function(){hb.event.add(this,a,e,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,hb(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(f in a)this.off(f,b,a[f]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=d),c===!1&&(c=j),this.each(function(){hb.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){hb.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?hb.event.trigger(a,b,c,!0):void 0}});var Eb=/^.[^:#\[\.,]*$/,Fb=/^(?:parents|prev(?:Until|All))/,Gb=hb.expr.match.needsContext,Hb={children:!0,contents:!0,next:!0,prev:!0};hb.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(hb(a).filter(function(){for(b=0;e>b;b++)if(hb.contains(d[b],this))return!0}));for(b=0;e>b;b++)hb.find(a,d[b],c);return c=this.pushStack(e>1?hb.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},has:function(a){var b=hb(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(hb.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(m(this,a||[],!0))},filter:function(a){return this.pushStack(m(this,a||[],!1))},is:function(a){return!!m(this,"string"==typeof a&&Gb.test(a)?hb(a):a||[],!1).length},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=Gb.test(a)||"string"!=typeof a?hb(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&hb.find.matchesSelector(c,a))){c=f.push(c);break}return this.pushStack(f.length>1?hb.unique(f):f)},index:function(a){return a?"string"==typeof a?db.call(hb(a),this[0]):db.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){var c="string"==typeof a?hb(a,b):hb.makeArray(a&&a.nodeType?[a]:a),d=hb.merge(this.get(),c);return this.pushStack(hb.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),hb.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null
},parents:function(a){return hb.dir(a,"parentNode")},parentsUntil:function(a,b,c){return hb.dir(a,"parentNode",c)},next:function(a){return l(a,"nextSibling")},prev:function(a){return l(a,"previousSibling")},nextAll:function(a){return hb.dir(a,"nextSibling")},prevAll:function(a){return hb.dir(a,"previousSibling")},nextUntil:function(a,b,c){return hb.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return hb.dir(a,"previousSibling",c)},siblings:function(a){return hb.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return hb.sibling(a.firstChild)},contents:function(a){return a.contentDocument||hb.merge([],a.childNodes)}},function(a,b){hb.fn[a]=function(c,d){var e=hb.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=hb.filter(d,e)),this.length>1&&(Hb[a]||hb.unique(e),Fb.test(a)&&e.reverse()),this.pushStack(e)}}),hb.extend({filter:function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?hb.find.matchesSelector(d,a)?[d]:[]:hb.find.matches(a,hb.grep(b,function(a){return 1===a.nodeType}))},dir:function(a,b,c){for(var e=[],f=c!==d;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(f&&hb(a).is(c))break;e.push(a)}return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Ib=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Jb=/<([\w:]+)/,Kb=/<|&#?\w+;/,Lb=/<(?:script|style|link)/i,Mb=/^(?:checkbox|radio)$/i,Nb=/checked\s*(?:[^=]|=\s*.checked.)/i,Ob=/^$|\/(?:java|ecma)script/i,Pb=/^true\/(.*)/,Qb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Rb={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Rb.optgroup=Rb.option,Rb.tbody=Rb.tfoot=Rb.colgroup=Rb.caption=Rb.thead,Rb.th=Rb.td,hb.fn.extend({text:function(a){return hb.access(this,function(a){return a===d?hb.text(this):this.empty().append((this[0]&&this[0].ownerDocument||V).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=n(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=n(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?hb.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||hb.cleanData(s(c)),c.parentNode&&(b&&hb.contains(c.ownerDocument,c)&&q(s(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(hb.cleanData(s(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return hb.clone(this,a,b)})},html:function(a){return hb.access(this,function(a){var b=this[0]||{},c=0,e=this.length;if(a===d&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!Lb.test(a)&&!Rb[(Jb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Ib,"<$1></$2>");try{for(;e>c;c++)b=this[c]||{},1===b.nodeType&&(hb.cleanData(s(b,!1)),b.innerHTML=a);b=0}catch(f){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=hb.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;return this.domManip(arguments,function(c){var d=a[b++],e=a[b++];e&&(d&&d.parentNode!==e&&(d=this.nextSibling),hb(this).remove(),e.insertBefore(c,d))},!0),b?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){a=ab.apply([],a);var d,e,f,g,h,i,j=0,k=this.length,l=this,m=k-1,n=a[0],q=hb.isFunction(n);if(q||!(1>=k||"string"!=typeof n||hb.support.checkClone)&&Nb.test(n))return this.each(function(d){var e=l.eq(d);q&&(a[0]=n.call(this,d,e.html())),e.domManip(a,b,c)});if(k&&(d=hb.buildFragment(a,this[0].ownerDocument,!1,!c&&this),e=d.firstChild,1===d.childNodes.length&&(d=e),e)){for(f=hb.map(s(d,"script"),o),g=f.length;k>j;j++)h=d,j!==m&&(h=hb.clone(h,!0,!0),g&&hb.merge(f,s(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,hb.map(f,p),j=0;g>j;j++)h=f[j],Ob.test(h.type||"")&&!sb.access(h,"globalEval")&&hb.contains(i,h)&&(h.src?hb._evalUrl(h.src):hb.globalEval(h.textContent.replace(Qb,"")))}return this}}),hb.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){hb.fn[a]=function(a){for(var c,d=[],e=hb(a),f=e.length-1,g=0;f>=g;g++)c=g===f?this:this.clone(!0),hb(e[g])[b](c),bb.apply(d,c.get());return this.pushStack(d)}}),hb.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=hb.contains(a.ownerDocument,a);if(!(hb.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||hb.isXMLDoc(a)))for(g=s(h),f=s(a),d=0,e=f.length;e>d;d++)t(f[d],g[d]);if(b)if(c)for(f=f||s(a),g=g||s(h),d=0,e=f.length;e>d;d++)r(f[d],g[d]);else r(a,h);return g=s(h,"script"),g.length>0&&q(g,!i&&s(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=0,l=a.length,m=b.createDocumentFragment(),n=[];l>k;k++)if(e=a[k],e||0===e)if("object"===hb.type(e))hb.merge(n,e.nodeType?[e]:e);else if(Kb.test(e)){for(f=f||m.appendChild(b.createElement("div")),g=(Jb.exec(e)||["",""])[1].toLowerCase(),h=Rb[g]||Rb._default,f.innerHTML=h[1]+e.replace(Ib,"<$1></$2>")+h[2],j=h[0];j--;)f=f.lastChild;hb.merge(n,f.childNodes),f=m.firstChild,f.textContent=""}else n.push(b.createTextNode(e));for(m.textContent="",k=0;e=n[k++];)if((!d||-1===hb.inArray(e,d))&&(i=hb.contains(e.ownerDocument,e),f=s(m.appendChild(e),"script"),i&&q(f),c))for(j=0;e=f[j++];)Ob.test(e.type||"")&&c.push(e);return m},cleanData:function(a){for(var b,c,e,f,h,i,j=hb.event.special,k=0;(c=a[k])!==d;k++){if(g.accepts(c)&&(h=c[sb.expando],h&&(b=sb.cache[h]))){if(e=Object.keys(b.events||{}),e.length)for(i=0;(f=e[i])!==d;i++)j[f]?hb.event.remove(c,f):hb.removeEvent(c,f,b.handle);sb.cache[h]&&delete sb.cache[h]}delete rb.cache[c[rb.expando]]}},_evalUrl:function(a){return hb.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),hb.fn.extend({wrapAll:function(a){var b;return hb.isFunction(a)?this.each(function(b){hb(this).wrapAll(a.call(this,b))}):(this[0]&&(b=hb(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return hb.isFunction(a)?this.each(function(b){hb(this).wrapInner(a.call(this,b))}):this.each(function(){var b=hb(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=hb.isFunction(a);return this.each(function(c){hb(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){hb.nodeName(this,"body")||hb(this).replaceWith(this.childNodes)}).end()}});var Sb,Tb,Ub=/^(none|table(?!-c[ea]).+)/,Vb=/^margin/,Wb=new RegExp("^("+ib+")(.*)$","i"),Xb=new RegExp("^("+ib+")(?!px)[a-z%]+$","i"),Yb=new RegExp("^([+-])=("+ib+")","i"),Zb={BODY:"block"},$b={position:"absolute",visibility:"hidden",display:"block"},_b={letterSpacing:0,fontWeight:400},ac=["Top","Right","Bottom","Left"],bc=["Webkit","O","Moz","ms"];hb.fn.extend({css:function(a,b){return hb.access(this,function(a,b,c){var e,f,g={},h=0;if(hb.isArray(b)){for(e=w(a),f=b.length;f>h;h++)g[b[h]]=hb.css(a,b[h],!1,e);return g}return c!==d?hb.style(a,b,c):hb.css(a,b)},a,b,arguments.length>1)},show:function(){return x(this,!0)},hide:function(){return x(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){v(this)?hb(this).show():hb(this).hide()})}}),hb.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Sb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,h,i=hb.camelCase(b),j=a.style;return b=hb.cssProps[i]||(hb.cssProps[i]=u(j,i)),h=hb.cssHooks[b]||hb.cssHooks[i],c===d?h&&"get"in h&&(f=h.get(a,!1,e))!==d?f:j[b]:(g=typeof c,"string"===g&&(f=Yb.exec(c))&&(c=(f[1]+1)*f[2]+parseFloat(hb.css(a,b)),g="number"),null==c||"number"===g&&isNaN(c)||("number"!==g||hb.cssNumber[i]||(c+="px"),hb.support.clearCloneStyle||""!==c||0!==b.indexOf("background")||(j[b]="inherit"),h&&"set"in h&&(c=h.set(a,c,e))===d||(j[b]=c)),void 0)}},css:function(a,b,c,e){var f,g,h,i=hb.camelCase(b);return b=hb.cssProps[i]||(hb.cssProps[i]=u(a.style,i)),h=hb.cssHooks[b]||hb.cssHooks[i],h&&"get"in h&&(f=h.get(a,!0,c)),f===d&&(f=Sb(a,b,e)),"normal"===f&&b in _b&&(f=_b[b]),""===c||c?(g=parseFloat(f),c===!0||hb.isNumeric(g)?g||0:f):f}}),Sb=function(a,b,c){var e,f,g,h=c||w(a),i=h?h.getPropertyValue(b)||h[b]:d,j=a.style;return h&&(""!==i||hb.contains(a.ownerDocument,a)||(i=hb.style(a,b)),Xb.test(i)&&Vb.test(b)&&(e=j.width,f=j.minWidth,g=j.maxWidth,j.minWidth=j.maxWidth=j.width=i,i=h.width,j.width=e,j.minWidth=f,j.maxWidth=g)),i},hb.each(["height","width"],function(a,b){hb.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&Ub.test(hb.css(a,"display"))?hb.swap(a,$b,function(){return A(a,b,d)}):A(a,b,d):void 0},set:function(a,c,d){var e=d&&w(a);return y(a,c,d?z(a,b,d,hb.support.boxSizing&&"border-box"===hb.css(a,"boxSizing",!1,e),e):0)}}}),hb(function(){hb.support.reliableMarginRight||(hb.cssHooks.marginRight={get:function(a,b){return b?hb.swap(a,{display:"inline-block"},Sb,[a,"marginRight"]):void 0}}),!hb.support.pixelPosition&&hb.fn.position&&hb.each(["top","left"],function(a,b){hb.cssHooks[b]={get:function(a,c){return c?(c=Sb(a,b),Xb.test(c)?hb(a).position()[b]+"px":c):void 0}}})}),hb.expr&&hb.expr.filters&&(hb.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},hb.expr.filters.visible=function(a){return!hb.expr.filters.hidden(a)}),hb.each({margin:"",padding:"",border:"Width"},function(a,b){hb.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+ac[d]+b]=f[d]||f[d-2]||f[0];return e}},Vb.test(a)||(hb.cssHooks[a+b].set=y)});var cc=/%20/g,dc=/\[\]$/,ec=/\r?\n/g,fc=/^(?:submit|button|image|reset|file)$/i,gc=/^(?:input|select|textarea|keygen)/i;hb.fn.extend({serialize:function(){return hb.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=hb.prop(this,"elements");return a?hb.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!hb(this).is(":disabled")&&gc.test(this.nodeName)&&!fc.test(a)&&(this.checked||!Mb.test(a))}).map(function(a,b){var c=hb(this).val();return null==c?null:hb.isArray(c)?hb.map(c,function(a){return{name:b.name,value:a.replace(ec,"\r\n")}}):{name:b.name,value:c.replace(ec,"\r\n")}}).get()}}),hb.param=function(a,b){var c,e=[],f=function(a,b){b=hb.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(b===d&&(b=hb.ajaxSettings&&hb.ajaxSettings.traditional),hb.isArray(a)||a.jquery&&!hb.isPlainObject(a))hb.each(a,function(){f(this.name,this.value)});else for(c in a)D(c,a[c],b,f);return e.join("&").replace(cc,"+")},hb.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){hb.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),hb.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var hc,ic,jc=hb.now(),kc=/\?/,lc=/#.*$/,mc=/([?&])_=[^&]*/,nc=/^(.*?):[ \t]*([^\r\n]*)$/gm,oc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,pc=/^(?:GET|HEAD)$/,qc=/^\/\//,rc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,sc=hb.fn.load,tc={},uc={},vc="*/".concat("*");try{ic=U.href}catch(wc){ic=V.createElement("a"),ic.href="",ic=ic.href}hc=rc.exec(ic.toLowerCase())||[],hb.fn.load=function(a,b,c){if("string"!=typeof a&&sc)return sc.apply(this,arguments);var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i),a=a.slice(0,i)),hb.isFunction(b)?(c=b,b=d):b&&"object"==typeof b&&(f="POST"),h.length>0&&hb.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){g=arguments,h.html(e?hb("<div>").append(hb.parseHTML(a)).find(e):a)}).complete(c&&function(a,b){h.each(c,g||[a.responseText,b,a])}),this},hb.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){hb.fn[b]=function(a){return this.on(b,a)}}),hb.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ic,type:"GET",isLocal:oc.test(hc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":vc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":hb.parseJSON,"text xml":hb.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?G(G(a,hb.ajaxSettings),b):G(hb.ajaxSettings,a)},ajaxPrefilter:E(tc),ajaxTransport:E(uc),ajax:function(a,b){function c(a,b,c,h){var j,l,s,t,v,x=b;2!==u&&(u=2,i&&clearTimeout(i),e=d,g=h||"",w.readyState=a>0?4:0,j=a>=200&&300>a||304===a,c&&(t=H(m,w,c)),t=I(m,t,w,j),j?(m.ifModified&&(v=w.getResponseHeader("Last-Modified"),v&&(hb.lastModified[f]=v),v=w.getResponseHeader("etag"),v&&(hb.etag[f]=v)),204===a||"HEAD"===m.type?x="nocontent":304===a?x="notmodified":(x=t.state,l=t.data,s=t.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),w.status=a,w.statusText=(b||x)+"",j?p.resolveWith(n,[l,x,w]):p.rejectWith(n,[w,x,s]),w.statusCode(r),r=d,k&&o.trigger(j?"ajaxSuccess":"ajaxError",[w,m,j?l:s]),q.fireWith(n,[w,x]),k&&(o.trigger("ajaxComplete",[w,m]),--hb.active||hb.event.trigger("ajaxStop")))}"object"==typeof a&&(b=a,a=d),b=b||{};var e,f,g,h,i,j,k,l,m=hb.ajaxSetup({},b),n=m.context||m,o=m.context&&(n.nodeType||n.jquery)?hb(n):hb.event,p=hb.Deferred(),q=hb.Callbacks("once memory"),r=m.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!h)for(h={};b=nc.exec(g);)h[b[1].toLowerCase()]=b[2];b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(m.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return e&&e.abort(b),c(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,m.url=((a||m.url||ic)+"").replace(lc,"").replace(qc,hc[1]+"//"),m.type=b.method||b.type||m.method||m.type,m.dataTypes=hb.trim(m.dataType||"*").toLowerCase().match(jb)||[""],null==m.crossDomain&&(j=rc.exec(m.url.toLowerCase()),m.crossDomain=!(!j||j[1]===hc[1]&&j[2]===hc[2]&&(j[3]||("http:"===j[1]?"80":"443"))===(hc[3]||("http:"===hc[1]?"80":"443")))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=hb.param(m.data,m.traditional)),F(tc,m,b,w),2===u)return w;k=m.global,k&&0===hb.active++&&hb.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!pc.test(m.type),f=m.url,m.hasContent||(m.data&&(f=m.url+=(kc.test(f)?"&":"?")+m.data,delete m.data),m.cache===!1&&(m.url=mc.test(f)?f.replace(mc,"$1_="+jc++):f+(kc.test(f)?"&":"?")+"_="+jc++)),m.ifModified&&(hb.lastModified[f]&&w.setRequestHeader("If-Modified-Since",hb.lastModified[f]),hb.etag[f]&&w.setRequestHeader("If-None-Match",hb.etag[f])),(m.data&&m.hasContent&&m.contentType!==!1||b.contentType)&&w.setRequestHeader("Content-Type",m.contentType),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+vc+"; q=0.01":""):m.accepts["*"]);for(l in m.headers)w.setRequestHeader(l,m.headers[l]);if(m.beforeSend&&(m.beforeSend.call(n,w,m)===!1||2===u))return w.abort();v="abort";for(l in{success:1,error:1,complete:1})w[l](m[l]);if(e=F(uc,m,b,w)){w.readyState=1,k&&o.trigger("ajaxSend",[w,m]),m.async&&m.timeout>0&&(i=setTimeout(function(){w.abort("timeout")},m.timeout));try{u=1,e.send(s,c)}catch(x){if(!(2>u))throw x;c(-1,x)}}else c(-1,"No Transport");return w},getJSON:function(a,b,c){return hb.get(a,b,c,"json")},getScript:function(a,b){return hb.get(a,d,b,"script")}}),hb.each(["get","post"],function(a,b){hb[b]=function(a,c,e,f){return hb.isFunction(c)&&(f=f||e,e=c,c=d),hb.ajax({url:a,type:b,dataType:f,data:c,success:e})}}),hb.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return hb.globalEval(a),a}}}),hb.ajaxPrefilter("script",function(a){a.cache===d&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),hb.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=hb("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),V.head.appendChild(b[0])},abort:function(){c&&c()}}}});var xc=[],yc=/(=)\?(?=&|$)|\?\?/;hb.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=xc.pop()||hb.expando+"_"+jc++;return this[a]=!0,a}}),hb.ajaxPrefilter("json jsonp",function(a,c,e){var f,g,h,i=a.jsonp!==!1&&(yc.test(a.url)?"url":"string"==typeof a.data&&!(a.contentType||"").indexOf("application/x-www-form-urlencoded")&&yc.test(a.data)&&"data");return i||"jsonp"===a.dataTypes[0]?(f=a.jsonpCallback=hb.isFunction(a.jsonpCallback)?a.jsonpCallback():a.jsonpCallback,i?a[i]=a[i].replace(yc,"$1"+f):a.jsonp!==!1&&(a.url+=(kc.test(a.url)?"&":"?")+a.jsonp+"="+f),a.converters["script json"]=function(){return h||hb.error(f+" was not called"),h[0]},a.dataTypes[0]="json",g=b[f],b[f]=function(){h=arguments},e.always(function(){b[f]=g,a[f]&&(a.jsonpCallback=c.jsonpCallback,xc.push(f)),h&&hb.isFunction(g)&&g(h[0]),h=g=d}),"script"):void 0}),hb.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var zc=hb.ajaxSettings.xhr(),Ac={0:200,1223:204},Bc=0,Cc={};b.ActiveXObject&&hb(b).on("unload",function(){for(var a in Cc)Cc[a]();Cc=d}),hb.support.cors=!!zc&&"withCredentials"in zc,hb.support.ajax=zc=!!zc,hb.ajaxTransport(function(a){var b;return hb.support.cors||zc&&!a.crossDomain?{send:function(c,e){var f,g,h=a.xhr();if(h.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(f in a.xhrFields)h[f]=a.xhrFields[f];a.mimeType&&h.overrideMimeType&&h.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(f in c)h.setRequestHeader(f,c[f]);b=function(a){return function(){b&&(delete Cc[g],b=h.onload=h.onerror=null,"abort"===a?h.abort():"error"===a?e(h.status||404,h.statusText):e(Ac[h.status]||h.status,h.statusText,"string"==typeof h.responseText?{text:h.responseText}:d,h.getAllResponseHeaders()))}},h.onload=b(),h.onerror=b("error"),b=Cc[g=Bc++]=b("abort"),h.send(a.hasContent&&a.data||null)},abort:function(){b&&b()}}:void 0});var Dc,Ec,Fc=/^(?:toggle|show|hide)$/,Gc=new RegExp("^(?:([+-])=|)("+ib+")([a-z%]*)$","i"),Hc=/queueHooks$/,Ic=[N],Jc={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Gc.exec(b),f=e&&e[3]||(hb.cssNumber[a]?"":"px"),g=(hb.cssNumber[a]||"px"!==f&&+d)&&Gc.exec(hb.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,hb.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};hb.Animation=hb.extend(L,{tweener:function(a,b){hb.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Jc[c]=Jc[c]||[],Jc[c].unshift(b)},prefilter:function(a,b){b?Ic.unshift(a):Ic.push(a)}}),hb.Tween=O,O.prototype={constructor:O,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(hb.cssNumber[c]?"":"px")},cur:function(){var a=O.propHooks[this.prop];return a&&a.get?a.get(this):O.propHooks._default.get(this)},run:function(a){var b,c=O.propHooks[this.prop];return this.pos=b=this.options.duration?hb.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):O.propHooks._default.set(this),this}},O.prototype.init.prototype=O.prototype,O.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=hb.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){hb.fx.step[a.prop]?hb.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[hb.cssProps[a.prop]]||hb.cssHooks[a.prop])?hb.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},O.propHooks.scrollTop=O.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},hb.each(["toggle","show","hide"],function(a,b){var c=hb.fn[b];hb.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(P(b,!0),a,d,e)}}),hb.fn.extend({fadeTo:function(a,b,c,d){return this.filter(v).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=hb.isEmptyObject(a),f=hb.speed(b,c,d),g=function(){var b=L(this,hb.extend({},a),f);(e||sb.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var e=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=d),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,d=null!=a&&a+"queueHooks",f=hb.timers,g=sb.get(this);if(d)g[d]&&g[d].stop&&e(g[d]);else for(d in g)g[d]&&g[d].stop&&Hc.test(d)&&e(g[d]);for(d=f.length;d--;)f[d].elem!==this||null!=a&&f[d].queue!==a||(f[d].anim.stop(c),b=!1,f.splice(d,1));(b||!c)&&hb.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=sb.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=hb.timers,g=d?d.length:0;for(c.finish=!0,hb.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),hb.each({slideDown:P("show"),slideUp:P("hide"),slideToggle:P("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){hb.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),hb.speed=function(a,b,c){var d=a&&"object"==typeof a?hb.extend({},a):{complete:c||!c&&b||hb.isFunction(a)&&a,duration:a,easing:c&&b||b&&!hb.isFunction(b)&&b};return d.duration=hb.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in hb.fx.speeds?hb.fx.speeds[d.duration]:hb.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){hb.isFunction(d.old)&&d.old.call(this),d.queue&&hb.dequeue(this,d.queue)},d},hb.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},hb.timers=[],hb.fx=O.prototype.init,hb.fx.tick=function(){var a,b=hb.timers,c=0;for(Dc=hb.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||hb.fx.stop(),Dc=d},hb.fx.timer=function(a){a()&&hb.timers.push(a)&&hb.fx.start()},hb.fx.interval=13,hb.fx.start=function(){Ec||(Ec=setInterval(hb.fx.tick,hb.fx.interval))},hb.fx.stop=function(){clearInterval(Ec),Ec=null},hb.fx.speeds={slow:600,fast:200,_default:400},hb.fx.step={},hb.expr&&hb.expr.filters&&(hb.expr.filters.animated=function(a){return hb.grep(hb.timers,function(b){return a===b.elem}).length}),hb.fn.offset=function(a){if(arguments.length)return a===d?this:this.each(function(b){hb.offset.setOffset(this,a,b)});var b,c,e=this[0],f={top:0,left:0},g=e&&e.ownerDocument;if(g)return b=g.documentElement,hb.contains(b,e)?(typeof e.getBoundingClientRect!==T&&(f=e.getBoundingClientRect()),c=Q(g),{top:f.top+c.pageYOffset-b.clientTop,left:f.left+c.pageXOffset-b.clientLeft}):f},hb.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=hb.css(a,"position"),l=hb(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=hb.css(a,"top"),i=hb.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),hb.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},hb.fn.extend({position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===hb.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),hb.nodeName(a[0],"html")||(d=a.offset()),d.top+=hb.css(a[0],"borderTopWidth",!0),d.left+=hb.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-hb.css(c,"marginTop",!0),left:b.left-d.left-hb.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||W;a&&!hb.nodeName(a,"html")&&"static"===hb.css(a,"position");)a=a.offsetParent;return a||W})}}),hb.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var e="pageYOffset"===c;hb.fn[a]=function(f){return hb.access(this,function(a,f,g){var h=Q(a);return g===d?h?h[c]:a[f]:(h?h.scrollTo(e?b.pageXOffset:g,e?g:b.pageYOffset):a[f]=g,void 0)},a,f,arguments.length,null)}}),hb.each({Height:"height",Width:"width"},function(a,b){hb.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,e){hb.fn[e]=function(e,f){var g=arguments.length&&(c||"boolean"!=typeof e),h=c||(e===!0||f===!0?"margin":"border");return hb.access(this,function(b,c,e){var f;return hb.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(f=b.documentElement,Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])):e===d?hb.css(b,c,h):hb.style(b,c,e,h)},b,g?e:d,g,null)}})}),hb.fn.size=function(){return this.length},hb.fn.andSelf=hb.fn.addBack,"object"==typeof a&&a&&"object"==typeof a.exports?a.exports=hb:"function"==typeof c&&c.amd&&c("jquery",[],function(){return hb}),"object"==typeof b&&"object"==typeof b.document&&(b.jQuery=b.$=hb)}(window),d("undefined"!=typeof $?$:window.$)}).call(c,void 0,void 0,void 0,function(a){b.exports=a})},{}],jquery:[function(a,b){b.exports=a("tAW9mx")},{}],5:[function(a,b){function c(a,b){return this instanceof c?(this.base=a,this.vec=b,this.mag=d.length(this.vec),this.max=d.create(),d.add(this.max,this.base,this.vec),void 0):new c(a,b)}b.exports=c;var d=a("gl-matrix").vec3,e=c,f=e.prototype;f.width=function(){return this.vec[0]},f.height=function(){return this.vec[1]},f.depth=function(){return this.vec[2]},f.x0=function(){return this.base[0]},f.y0=function(){return this.base[1]},f.z0=function(){return this.base[2]},f.x1=function(){return this.max[0]},f.y1=function(){return this.max[1]},f.z1=function(){return this.max[2]},f.translate=function(a){return d.add(this.max,this.max,a),d.add(this.base,this.base,a),this},f.expand=function(a){var b=d.create(),e=d.create();return d.max(b,a.max,this.max),d.min(e,a.base,this.base),d.sub(b,b,e),new c(e,b)},f.intersects=function(a){return a.base[0]>this.max[0]?!1:a.base[1]>this.max[1]?!1:a.base[2]>this.max[2]?!1:a.max[0]<this.base[0]?!1:a.max[1]<this.base[1]?!1:a.max[2]<this.base[2]?!1:!0},f.union=function(a){if(!this.intersects(a))return null;var b=Math.max(a.base[0],this.base[0]),d=Math.max(a.base[1],this.base[1]),e=Math.max(a.base[2],this.base[2]),f=Math.min(a.max[0],this.max[0]),g=Math.min(a.max[1],this.max[1]),h=Math.min(a.max[2],this.max[2]);return new c([b,d,e],[f-b,g-d,h-e])}},{"gl-matrix":6}],6:[function(a,b,c){!function(){"use strict";var a={};"undefined"==typeof c?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(a.exports={},define(function(){return a.exports})):a.exports=window:a.exports=c,function(a){var b={};if(!c)var c=1e-6;b.create=function(){return new Float32Array(2)},b.clone=function(a){var b=new Float32Array(2);return b[0]=a[0],b[1]=a[1],b},b.fromValues=function(a,b){var c=new Float32Array(2);return c[0]=a,c[1]=b,c},b.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},b.set=function(a,b,c){return a[0]=b,a[1]=c,a},b.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},b.sub=b.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},b.mul=b.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},b.div=b.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},b.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},b.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},b.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},b.dist=b.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},b.sqrDist=b.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},b.len=b.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},b.sqrLen=b.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},b.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},b.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},b.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},b.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},b.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},b.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=d*c[0]+e*c[1],a[1]=d*c[2]+e*c[3],a},b.forEach=function(){var a=new Float32Array(2);return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),b.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof a&&(a.vec2=b);var d={};if(!c)var c=1e-6;d.create=function(){return new Float32Array(3)},d.clone=function(a){var b=new Float32Array(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},d.fromValues=function(a,b,c){var d=new Float32Array(3);return d[0]=a,d[1]=b,d[2]=c,d},d.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},d.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},d.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},d.sub=d.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},d.mul=d.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},d.div=d.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},d.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},d.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},d.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},d.dist=d.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},d.sqrDist=d.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},d.len=d.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},d.sqrLen=d.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},d.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},d.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},d.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]
},d.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},d.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},d.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12],a[1]=c[1]*d+c[5]*e+c[9]*f+c[13],a[2]=c[2]*d+c[6]*e+c[10]*f+c[14],a},d.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},d.forEach=function(){var a=new Float32Array(3);return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),d.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},"undefined"!=typeof a&&(a.vec3=d);var e={};if(!c)var c=1e-6;e.create=function(){return new Float32Array(4)},e.clone=function(a){var b=new Float32Array(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.fromValues=function(a,b,c,d){var e=new Float32Array(4);return e[0]=a,e[1]=b,e[2]=c,e[3]=d,e},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.sub=e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.mul=e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},e.div=e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.dist=e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},e.sqrDist=e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},e.len=e.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},e.sqrLen=e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=b[0]*g,a[1]=b[1]*g,a[2]=b[2]*g,a[3]=b[3]*g),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},e.forEach=function(){var a=new Float32Array(4);return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.vec4=e);var f={},g=new Float32Array([1,0,0,1]);if(!c)var c=1e-6;f.create=function(){return new Float32Array(g)},f.clone=function(a){var b=new Float32Array(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},f.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},f.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},f.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},f.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},f.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},f.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},f.mul=f.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+e*j,a[1]=d*i+e*k,a[2]=f*h+g*j,a[3]=f*i+g*k,a},f.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=d*-h+e*i,a[2]=f*i+g*h,a[3]=f*-h+g*i,a},f.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*i,a[2]=f*h,a[3]=g*i,a},f.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.mat2=f);var h={},i=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!c)var c=1e-6;h.create=function(){return new Float32Array(i)},h.clone=function(a){var b=new Float32Array(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},h.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},h.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},h.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},h.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},h.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},h.mul=h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},h.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},"undefined"!=typeof a&&(a.mat3=h);var j={},k=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!c)var c=1e-6;j.create=function(){return new Float32Array(k)},j.clone=function(a){var b=new Float32Array(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},j.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},j.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},j.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},j.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},j.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},j.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},j.mul=j.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},j.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},j.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},j.rotate=function(a,b,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<c?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(d),g=Math.cos(d),h=1-g,i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=b[8],r=b[9],s=b[10],t=b[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},j.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},j.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},j.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},j.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},j.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},j.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},j.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},j.lookAt=function(a,b,d,e){var f,g,h,i,k,l,m,n,o,p,q=b[0],r=b[1],s=b[2],t=e[0],u=e[1],v=e[2],w=d[0],x=d[1],y=d[2];return Math.abs(q-w)<c&&Math.abs(r-x)<c&&Math.abs(s-y)<c?j.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,f=u*o-v*n,g=v*m-t*o,h=t*n-u*m,p=Math.sqrt(f*f+g*g+h*h),p?(p=1/p,f*=p,g*=p,h*=p):(f=0,g=0,h=0),i=n*h-o*g,k=o*f-m*h,l=m*g-n*f,p=Math.sqrt(i*i+k*k+l*l),p?(p=1/p,i*=p,k*=p,l*=p):(i=0,k=0,l=0),a[0]=f,a[1]=i,a[2]=m,a[3]=0,a[4]=g,a[5]=k,a[6]=n,a[7]=0,a[8]=h,a[9]=l,a[10]=o,a[11]=0,a[12]=-(f*q+g*r+h*s),a[13]=-(i*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},j.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},"undefined"!=typeof a&&(a.mat4=j);var l={},m=new Float32Array([0,0,0,1]);if(!c)var c=1e-6;l.create=function(){return new Float32Array(m)},l.clone=e.clone,l.fromValues=e.fromValues,l.copy=e.copy,l.set=e.set,l.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},l.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},l.add=e.add,l.mul=l.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},l.scale=e.scale,l.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},l.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},l.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},l.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},l.dot=e.dot,l.lerp=e.lerp,l.slerp=function(a,b,c,d){var e,f,g,h,i=b[0],j=b[1],k=b[2],l=b[3],m=c[0],n=c[1],o=c[2],p=b[3],q=i*m+j*n+k*o+l*p;return Math.abs(q)>=1?(a!==b&&(a[0]=i,a[1]=j,a[2]=k,a[3]=l),a):(e=Math.acos(q),f=Math.sqrt(1-q*q),Math.abs(f)<.001?(a[0]=.5*i+.5*m,a[1]=.5*j+.5*n,a[2]=.5*k+.5*o,a[3]=.5*l+.5*p,a):(g=Math.sin((1-d)*e)/f,h=Math.sin(d*e)/f,a[0]=i*g+m*h,a[1]=j*g+n*h,a[2]=k*g+o*h,a[3]=l*g+p*h,a))},l.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},l.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},l.len=l.length=e.length,l.sqrLen=l.squaredLength=e.squaredLength,l.normalize=e.normalize,l.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.quat=l)}(a.exports)}()},{}],7:[function(a,b){function c(a){d.Stream.call(this),this.writable=!0,a&&(this.cb=a),this.body=[],this.on("error",function(){})}var d=a("stream"),e=a("bops"),f=a("util");f.inherits(c,d.Stream),c.prototype.write=function(a){this.emit("data",a),this.body.push(a)},c.prototype.destroy=function(){},c.prototype.arrayConcat=function(a){return 0===a.length?[]:1===a.length?a[0]:a.reduce(function(a,b){return a.concat(b)})},c.prototype.isArray=function(a){return Array.isArray(a)},c.prototype.getBody=function(){return 0!==this.body.length?"string"==typeof this.body[0]?this.body.join(""):this.isArray(this.body[0])?this.arrayConcat(this.body):e.is(this.body[0])?e.join(this.body):this.body:void 0},c.prototype.end=function(){this.emit("end"),this.cb&&this.cb(this.getBody())},b.exports=function(a){return new c(a)},b.exports.ConcatStream=c},{bops:8,stream:50,util:59}],8:[function(a,b){function c(a,b){for(var c in a)b[c]=a[c]}var d={};b.exports=d,d.from=a("./from.js"),d.to=a("./to.js"),d.is=a("./is.js"),d.subarray=a("./subarray.js"),d.join=a("./join.js"),d.copy=a("./copy.js"),d.create=a("./create.js"),c(a("./read.js"),d),c(a("./write.js"),d)},{"./copy.js":11,"./create.js":12,"./from.js":13,"./is.js":14,"./join.js":15,"./read.js":17,"./subarray.js":18,"./to.js":19,"./write.js":20}],9:[function(a,b){!function(){"use strict";function a(a){var b,c,e,f,g,h;if(a.length%4>0)throw"Invalid string. Length must be a multiple of 4";for(g=a.indexOf("="),g=g>0?a.length-g:0,h=[],e=g>0?a.length-4:a.length,b=0,c=0;e>b;b+=4,c+=3)f=d.indexOf(a[b])<<18|d.indexOf(a[b+1])<<12|d.indexOf(a[b+2])<<6|d.indexOf(a[b+3]),h.push((16711680&f)>>16),h.push((65280&f)>>8),h.push(255&f);return 2===g?(f=d.indexOf(a[b])<<2|d.indexOf(a[b+1])>>4,h.push(255&f)):1===g&&(f=d.indexOf(a[b])<<10|d.indexOf(a[b+1])<<4|d.indexOf(a[b+2])>>2,h.push(f>>8&255),h.push(255&f)),h}function c(a){function b(a){return d[a>>18&63]+d[a>>12&63]+d[a>>6&63]+d[63&a]}var c,e,f,g=a.length%3,h="";for(c=0,f=a.length-g;f>c;c+=3)e=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(e);switch(g){case 1:e=a[a.length-1],h+=d[e>>2],h+=d[e<<4&63],h+="==";break;case 2:e=(a[a.length-2]<<8)+a[a.length-1],h+=d[e>>10],h+=d[e>>4&63],h+=d[e<<2&63],h+="="}return h}var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b.exports.toByteArray=a,b.exports.fromByteArray=c}()},{}],10:[function(a,b){function c(a,b,c){b=void 0===b?0:b,c=void 0===c?a.length:c;var i,k,l=0,m=128,n=0;for(g.length=f.length=0;l<a.length;)k=a[l],!n&&k&m?(i=d(k),n+=i,8>i&&(g[g.length]=k&j[6-i])):n?(g[g.length]=k&j[6],--n,!n&&g.length&&(f[f.length]=h(e(g,i)),g.length=0)):f[f.length]=h(k),++l;return g.length&&!n&&(f[f.length]=h(e(g,i)),g.length=0),f.join("")}function d(a){for(var b=0;7>b&&a&i[b];++b);return b}function e(a){for(var b=0,c=0,d=a.length;d>c;++c)b|=a[c]<<6*(d-c-1);return b}b.exports=c;var f=[],g=[],h=String.fromCharCode,i=[64,32,16,8,4,2,1],j=[0,1,3,7,15,31,63,127]},{}],11:[function(a,b){function c(a,b,c,f,g){return c=arguments.length<3?0:c,f=arguments.length<4?0:f,g=arguments.length<5?a.length:g,g!==f&&0!==b.length&&0!==a.length?(g>a.length&&(g=a.length),b.length-c<g-f&&(g=b.length-c+start),a.buffer!==b.buffer?d(a,b,c,f,g):e(a,b,c,f,g)):void 0}function d(a,b,c,d,e){for(var f=e-d+c,g=c,h=d;f>g;++g,++h)b[g]=a[h]}function e(a,b,c,d,e){for(var g=e+d,h=new Uint8Array(f.call(a,d,g)),i=0;g>d;++d,++i)b[c++]=h[i]}b.exports=c;var f=[].slice},{}],12:[function(a,b){b.exports=function(a){return new Uint8Array(a)}},{}],13:[function(a,b){function c(a,b){return Array.isArray(a)?new Uint8Array(a):h[b||"utf8"](a)}function d(a){for(var b=a.length/2,c=new Uint8Array(b),d="",e=0,f=a.length;f>e;++e)d+=a.charAt(e),e>0&&e%2===1&&(c[e>>>1]=parseInt(d,16),d="");return c}function e(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e)if(c=a.charCodeAt(e),128&c){b=encodeURIComponent(a.charAt(e)).substr(1).split("%");for(var g=0,h=b.length;h>g;++g)d[d.length]=parseInt(b[g],16)}else d[d.length]=c;return new Uint8Array(d)}function f(a){return new Uint8Array(g.toByteArray(a))}b.exports=c;var g=a("base64-js"),h={hex:d,utf8:e,base64:f}},{"base64-js":9}],14:[function(a,b){b.exports=function(a){return a instanceof Uint8Array}},{}],15:[function(a,b){function c(a,b){if(!a.length)return new Uint8Array(0);for(var c=void 0!==b?b:d(a),e=new Uint8Array(c),f=a[0],g=f.length,h=0,i=0,j=0;c>j;)i!==g?e[j++]=f[i++]:(i=0,++h,f=a[h],g=f&&f.length);return e}function d(a){for(var b=0,c=0,d=a.length;d>c;++c)b+=a[c].byteLength;return b}b.exports=c},{}],16:[function(a,b){function c(a){return new DataView(a.buffer,0)}function d(a){var b=f.get(a.buffer);return b||f.set(a.buffer,b=new DataView(a.buffer,0)),b}var e,f;b.exports=e={},f="undefined"==typeof WeakMap?null:new WeakMap,e.get=f?d:c},{}],17:[function(a,b){function c(a,b){return a[b]}function d(a,b){var c=a[b];return 128>c?c:c-256}function e(a,b){var c=q.get(a);return c.getUint16(b+a.byteOffset,!0)}function f(a,b){var c=q.get(a);return c.getUint32(b+a.byteOffset,!0)}function g(a,b){var c=q.get(a);return c.getInt16(b+a.byteOffset,!0)}function h(a,b){var c=q.get(a);return c.getInt32(b+a.byteOffset,!0)}function i(a,b){var c=q.get(a);return c.getFloat32(b+a.byteOffset,!0)}function j(a,b){var c=q.get(a);return c.getFloat64(b+a.byteOffset,!0)}function k(a,b){var c=q.get(a);return c.getUint16(b+a.byteOffset,!1)}function l(a,b){var c=q.get(a);return c.getUint32(b+a.byteOffset,!1)}function m(a,b){var c=q.get(a);return c.getInt16(b+a.byteOffset,!1)}function n(a,b){var c=q.get(a);return c.getInt32(b+a.byteOffset,!1)}function o(a,b){var c=q.get(a);return c.getFloat32(b+a.byteOffset,!1)}function p(a,b){var c=q.get(a);return c.getFloat64(b+a.byteOffset,!1)}b.exports={readUInt8:c,readInt8:d,readUInt16LE:e,readUInt32LE:f,readInt16LE:g,readInt32LE:h,readFloatLE:i,readDoubleLE:j,readUInt16BE:k,readUInt32BE:l,readInt16BE:m,readInt32BE:n,readFloatBE:o,readDoubleBE:p};var q=a("./mapped.js")},{"./mapped.js":16}],18:[function(a,b){function c(a,b,c){return a.subarray(b||0,c||a.length)}b.exports=c},{}],19:[function(a,b){function c(a,b){return i[b||"utf8"](a)}function d(a){for(var b,c="",d=0,e=a.length;e>d;++d)b=a[d],c+=((240&b)>>>4).toString(16),c+=(15&b).toString(16);return c}function e(a){return h(a)}function f(a){return g.fromByteArray(a)}b.exports=c;var g=a("base64-js"),h=a("to-utf8"),i={hex:d,utf8:e,base64:f}},{"base64-js":9,"to-utf8":10}],20:[function(a,b){function c(a,b,c){return a[c]=b}function d(a,b,c){return a[c]=0>b?b+256:b}function e(a,b,c){var d=q.get(a);return d.setUint16(c+a.byteOffset,b,!0)}function f(a,b,c){var d=q.get(a);return d.setUint32(c+a.byteOffset,b,!0)}function g(a,b,c){var d=q.get(a);return d.setInt16(c+a.byteOffset,b,!0)}function h(a,b,c){var d=q.get(a);return d.setInt32(c+a.byteOffset,b,!0)}function i(a,b,c){var d=q.get(a);return d.setFloat32(c+a.byteOffset,b,!0)}function j(a,b,c){var d=q.get(a);return d.setFloat64(c+a.byteOffset,b,!0)}function k(a,b,c){var d=q.get(a);return d.setUint16(c+a.byteOffset,b,!1)}function l(a,b,c){var d=q.get(a);return d.setUint32(c+a.byteOffset,b,!1)}function m(a,b,c){var d=q.get(a);return d.setInt16(c+a.byteOffset,b,!1)}function n(a,b,c){var d=q.get(a);return d.setInt32(c+a.byteOffset,b,!1)}function o(a,b,c){var d=q.get(a);return d.setFloat32(c+a.byteOffset,b,!1)}function p(a,b,c){var d=q.get(a);return d.setFloat64(c+a.byteOffset,b,!1)}b.exports={writeUInt8:c,writeInt8:d,writeUInt16LE:e,writeUInt32LE:f,writeInt16LE:g,writeInt32LE:h,writeFloatLE:i,writeDoubleLE:j,writeUInt16BE:k,writeUInt32BE:l,writeInt16BE:m,writeInt32BE:n,writeFloatBE:o,writeDoubleBE:p};var q=a("./mapped.js")},{"./mapped.js":16}],21:[function(a,b){function c(a){var b=e.fromStream(a);a.on("error",function(a){b.emit("error",a)});var c=new d,f=e.toStream(c);f.pipe(a),f.on("error",function(a){b.emit("error",a)});var g=b.on.bind(b);return{on:g,addListener:g,once:b.once.bind(b),removeListener:b.removeListener.bind(b),emit:c.emit.bind(c),writeEmitter:c,readEmitter:b}}var d=a("events").EventEmitter,e=a("emit-stream");b.exports=c},{"emit-stream":27,events:33}],22:[function(a,b){function c(a){return e(d(a))}var d=a("./object_duplex_stream"),e=a("./emitter");b.exports=c},{"./emitter":21,"./object_duplex_stream":29}],23:[function(a,b,c){function d(a,b){return"string"==typeof a?b==a:a&&"function"==typeof a.exec?a.exec(b):"boolean"==typeof a?a:"function"==typeof a?a(b):!1}var e=a("__browserify_process"),f=a("__browserify_Buffer"),g=a("jsonparse"),h=a("stream").Stream,i=a("through");c.parse=function(a){var b=new g,c=i(function(a){if("string"==typeof a)if(e.browser){for(var c=new Array(a.length),d=0;d<a.length;d++)c[d]=a.charCodeAt(d);a=new Int32Array(c)}else a=new f(a);b.write(a)},function(a){a&&c.write(a),c.queue(null)});"string"==typeof a&&(a=a.split(".").map(function(a){return"*"===a?!0:a}));var h=0;return a&&a.length||(a=null),b.onValue=function(){if(this.root||1!=this.stack.length||(c.root=this.value),a&&this.stack.length===a.length){for(var b=[],e=0;e<a.length-1;e++){var f=a[e],g=this.stack[1+ +e];if(!g)return;var i=d(f,g.key);if(b.push(g.key),!i)return}var g=this,f=a[a.length-1],i=d(f,g.key);i&&(b.push(g.key),h++,c.queue(this.value[this.key]),delete this.value[this.key])}},b._onToken=b.onToken,b.onToken=function(d,e){b._onToken(d,e),0===this.stack.length&&c.root&&(a||c.queue(c.root),c.emit("root",c.root,h),h=0,c.root=null)},b.onError=function(a){c.emit("error",a)},c},c.stringify=function(a,b,c){a===!1?(a="",b="\n",c=""):null==a&&(a="[\n",b="\n,\n",c="\n]\n");var d,e=!0,f=!1;return d=i(function(c){f=!0;var g=JSON.stringify(c);e?(e=!1,d.queue(a+g)):d.queue(b+g)},function(){f||d.queue(a),d.queue(c),d.queue(null)})},c.stringifyObject=function(a,b,c){a===!1?(a="",b="\n",c=""):null==a&&(a="{\n",b="\n,\n",c="\n}\n");var d=new h,e=!0,f=!1;return d=i(function(c){f=!0;var g=JSON.stringify(c[0])+":"+JSON.stringify(c[1]);e?(e=!1,d.queue(a+g)):d.queue(b+g)},function(){f||d.queue(a),d.queue(c),d.queue(null)})}},{__browserify_Buffer:39,__browserify_process:40,jsonparse:24,stream:50,through:25}],24:[function(a,b){function c(a){for(var b=Object.keys(f),c=0,d=b.length;d>c;c++){var e=b[c];if(f[e]===a)return e}return a&&"0x"+a.toString(16)}function d(){this.tState=r,this.value=void 0,this.string=void 0,this.unicode=void 0,this.negative=void 0,this.magnatude=void 0,this.position=void 0,this.exponent=void 0,this.negativeExponent=void 0,this.key=void 0,this.mode=void 0,this.stack=[],this.state=Q,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new e(2),3:new e(3),4:new e(4)}}var e=a("__browserify_Buffer"),f={},g=f.LEFT_BRACE=1,h=f.RIGHT_BRACE=2,i=f.LEFT_BRACKET=3,j=f.RIGHT_BRACKET=4,k=f.COLON=5,l=f.COMMA=6,m=f.TRUE=7,n=f.FALSE=8,o=f.NULL=9,p=f.STRING=10,q=f.NUMBER=11,r=f.START=17,s=f.TRUE1=33,t=f.TRUE2=34,u=f.TRUE3=35,v=f.FALSE1=49,w=f.FALSE2=50,x=f.FALSE3=51,y=f.FALSE4=52,z=f.NULL1=65,A=f.NULL3=66,B=f.NULL2=67,C=f.NUMBER1=81,D=f.NUMBER2=82,E=f.NUMBER3=83,F=f.NUMBER4=84,G=f.NUMBER5=85,H=f.NUMBER6=86,I=f.NUMBER7=87,J=f.NUMBER8=88,K=f.STRING1=97,L=f.STRING2=98,M=f.STRING3=99,N=f.STRING4=100,O=f.STRING5=101,P=f.STRING6=102,Q=f.VALUE=113,R=f.KEY=114,S=f.OBJECT=129,T=f.ARRAY=130,U=d.prototype;U.charError=function(a,b){this.onError(new Error("Unexpected "+JSON.stringify(String.fromCharCode(a[b]))+" at position "+b+" in state "+c(this.tState)))},U.onError=function(a){throw a},U.write=function(a){"string"==typeof a&&(a=new e(a));for(var b,c=0,d=a.length;d>c;c++)if(this.tState===r)b=a[c],123===b?this.onToken(g,"{"):125===b?this.onToken(h,"}"):91===b?this.onToken(i,"["):93===b?this.onToken(j,"]"):58===b?this.onToken(k,":"):44===b?this.onToken(l,","):116===b?this.tState=s:102===b?this.tState=v:110===b?this.tState=z:34===b?(this.string="",this.tState=K):45===b?(this.negative=!0,this.tState=C):48===b?(this.magnatude=0,this.tState=D):b>48&&64>b?(this.magnatude=b-48,this.tState=E):32===b||9===b||10===b||13===b||this.charError(a,c);else if(this.tState===K)if(b=a[c],this.bytes_remaining>0){for(var f=0;f<this.bytes_remaining;f++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+f]=a[f];this.string+=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,c=c+f-1}else if(0===this.bytes_remaining&&b>=128)if(b>=194&&223>=b&&(this.bytes_in_sequence=2),b>=224&&239>=b&&(this.bytes_in_sequence=3),b>=240&&244>=b&&(this.bytes_in_sequence=4),this.bytes_in_sequence+c>a.length){for(var Q=0;Q<=a.length-1-c;Q++)this.temp_buffs[this.bytes_in_sequence][Q]=a[c+Q];this.bytes_remaining=c+this.bytes_in_sequence-a.length,c=a.length-1}else this.string+=a.slice(c,c+this.bytes_in_sequence).toString(),c=c+this.bytes_in_sequence-1;else 34===b?(this.tState=r,this.onToken(p,this.string),this.string=void 0):92===b?this.tState=L:b>=32?this.string+=String.fromCharCode(b):this.charError(a,c);else this.tState===L?(b=a[c],34===b?(this.string+='"',this.tState=K):92===b?(this.string+="\\",this.tState=K):47===b?(this.string+="/",this.tState=K):98===b?(this.string+="\b",this.tState=K):102===b?(this.string+="\f",this.tState=K):110===b?(this.string+="\n",this.tState=K):114===b?(this.string+="\r",this.tState=K):116===b?(this.string+="	",this.tState=K):117===b?(this.unicode="",this.tState=M):this.charError(a,c)):this.tState===M||this.tState===N||this.tState===O||this.tState===P?(b=a[c],b>=48&&64>b||b>64&&70>=b||b>96&&102>=b?(this.unicode+=String.fromCharCode(b),this.tState++===P&&(this.string+=String.fromCharCode(parseInt(this.unicode,16)),this.unicode=void 0,this.tState=K)):this.charError(a,c)):this.tState===C?(b=a[c],48===b?(this.magnatude=0,this.tState=D):b>48&&64>b?(this.magnatude=b-48,this.tState=E):this.charError(a,c)):this.tState===D?(b=a[c],46===b?(this.position=.1,this.tState=F):101===b||69===b?(this.exponent=0,this.tState=H):(this.tState=r,this.onToken(q,0),this.magnatude=void 0,this.negative=void 0,c--)):this.tState===E?(b=a[c],46===b?(this.position=.1,this.tState=F):101===b||69===b?(this.exponent=0,this.tState=H):b>=48&&64>b?this.magnatude=10*this.magnatude+b-48:(this.tState=r,this.negative&&(this.magnatude=-this.magnatude,this.negative=void 0),this.onToken(q,this.magnatude),this.magnatude=void 0,c--)):this.tState===F?(b=a[c],b>=48&&64>b?(this.magnatude+=this.position*(b-48),this.position/=10,this.tState=G):this.charError(a,c)):this.tState===G?(b=a[c],b>=48&&64>b?(this.magnatude+=this.position*(b-48),this.position/=10):101===b||69===b?(this.exponent=0,this.tState=H):(this.tState=r,this.negative&&(this.magnatude=-this.magnatude,this.negative=void 0),this.onToken(q,this.negative?-this.magnatude:this.magnatude),this.magnatude=void 0,this.position=void 0,c--)):this.tState===H?(b=a[c],43===b||45===b?(45===b&&(this.negativeExponent=!0),this.tState=I):b>=48&&64>b?(this.exponent=10*this.exponent+(b-48),this.tState=J):this.charError(a,c)):this.tState===I?(b=a[c],b>=48&&64>b?(this.exponent=10*this.exponent+(b-48),this.tState=J):this.charError(a,c)):this.tState===J?(b=a[c],b>=48&&64>b?this.exponent=10*this.exponent+(b-48):(this.negativeExponent&&(this.exponent=-this.exponent,this.negativeExponent=void 0),this.magnatude*=Math.pow(10,this.exponent),this.exponent=void 0,this.negative&&(this.magnatude=-this.magnatude,this.negative=void 0),this.tState=r,this.onToken(q,this.magnatude),this.magnatude=void 0,c--)):this.tState===s?114===a[c]?this.tState=t:this.charError(a,c):this.tState===t?117===a[c]?this.tState=u:this.charError(a,c):this.tState===u?101===a[c]?(this.tState=r,this.onToken(m,!0)):this.charError(a,c):this.tState===v?97===a[c]?this.tState=w:this.charError(a,c):this.tState===w?108===a[c]?this.tState=x:this.charError(a,c):this.tState===x?115===a[c]?this.tState=y:this.charError(a,c):this.tState===y?101===a[c]?(this.tState=r,this.onToken(n,!1)):this.charError(a,c):this.tState===z?117===a[c]?this.tState=A:this.charError(a,c):this.tState===A?108===a[c]?this.tState=B:this.charError(a,c):this.tState===B&&(108===a[c]?(this.tState=r,this.onToken(o,null)):this.charError(a,c))
},U.onToken=function(){},U.parseError=function(a,b){this.onError(new Error("Unexpected "+c(a)+(b?"("+JSON.stringify(b)+")":"")+" in state "+c(this.state)))},U.onError=function(a){throw a},U.push=function(){this.stack.push({value:this.value,key:this.key,mode:this.mode})},U.pop=function(){var a=this.value,b=this.stack.pop();this.value=b.value,this.key=b.key,this.mode=b.mode,this.emit(a),this.mode||(this.state=Q)},U.emit=function(a){this.mode&&(this.state=l),this.onValue(a)},U.onValue=function(){},U.onToken=function(a,b){this.state===Q?a===p||a===q||a===m||a===n||a===o?(this.value&&(this.value[this.key]=b),this.emit(b)):a===g?(this.push(),this.value=this.value?this.value[this.key]={}:{},this.key=void 0,this.state=R,this.mode=S):a===i?(this.push(),this.value=this.value?this.value[this.key]=[]:[],this.key=0,this.mode=T,this.state=Q):a===h?this.mode===S?this.pop():this.parseError(a,b):a===j?this.mode===T?this.pop():this.parseError(a,b):this.parseError(a,b):this.state===R?a===p?(this.key=b,this.state=k):a===h?this.pop():this.parseError(a,b):this.state===k?a===k?this.state=Q:this.parseError(a,b):this.state===l?a===l?this.mode===T?(this.key++,this.state=Q):this.mode===S&&(this.state=R):a===j&&this.mode===T||a===h&&this.mode===S?this.pop():this.parseError(a,b):this.parseError(a,b)},b.exports=d},{__browserify_Buffer:39}],25:[function(a,b,c){function d(a,b){function c(){for(;i.length&&!j.paused;){var a=i.shift();if(null===a)return j.emit("end");j.emit("data",a)}}function d(){j.writable=!1,b.call(j),j.readable||j.destroy()}a=a||function(a){this.queue(a)},b=b||function(){this.queue(null)};var g=!1,h=!1,i=[],j=new f;return j.readable=j.writable=!0,j.paused=!1,j.write=function(b){return a.call(this,b),!j.paused},j.queue=j.push=function(a){return i.push(a),c(),j},j.on("end",function(){j.readable=!1,j.writable||e.nextTick(function(){j.destroy()})}),j.end=function(a){return g?void 0:(g=!0,arguments.length&&j.write(a),d(),j)},j.destroy=function(){return h?void 0:(h=!0,g=!0,i.length=0,j.writable=j.readable=!1,j.emit("close"),j)},j.pause=function(){return j.paused?void 0:(j.paused=!0,j.emit("pause"),j)},j.resume=function(){return j.paused&&(j.paused=!1),c(),j.paused||j.emit("drain"),j},j}var e=a("__browserify_process"),f=a("stream");c=b.exports=d,d.through=d},{__browserify_process:40,stream:50}],26:[function(a,b){function c(a,b){function c(){return a.writable}function i(){return b.readable}function j(b){function c(){return a[b].apply(a,arguments)}o[b]=c}function k(a){function c(){o.emit(a);var c=b[a];return c?c.apply(b,arguments):(b.emit(a),void 0)}o[a]=c}function l(a){function c(){var b=h.call(arguments);b.unshift(a),o.emit.apply(o,b)}b.on(a,c)}function m(){if(!p){p=!0;var a=h.call(arguments);a.unshift("end"),o.emit.apply(o,a)}}function n(a){o.emit("error",a)}var o=new d,p=!1;return Object.defineProperties(o,{writable:{get:c},readable:{get:i}}),e.forEach(j),f.forEach(k),g.forEach(l),b.on("end",m),a.on("error",n),b.on("error",n),o}var d=a("stream"),e=["write","end","destroy"],f=["resume","pause"],g=["data","close"],h=Array.prototype.slice;b.exports=c},{stream:50}],27:[function(a,b,c){var d=a("events").EventEmitter,e=a("through");c=b.exports=function(a){return"function"==typeof a.pipe?c.fromStream(a):c.toStream(a)},c.toStream=function(a){var b=e(function(a){this.emit("data",a)},function(){var c=a._emitStreams.indexOf(b);a._emitStreams.splice(c,1)});if(!a._emitStreams){a._emitStreams=[];var c=a.emit;a.emit=function(){var b=[].slice.call(arguments);a._emitStreams.forEach(function(a){a.writable&&a.write(b)}),c.apply(a,arguments)}}return a._emitStreams.push(b),b},c.fromStream=function(a){var b=new d;return a.pipe(e(function(a){b.emit.apply(b,a)})),b}},{events:33,through:28}],28:[function(a,b,c){function d(a,b,c){function d(){for(;j.length&&!l.paused;){var a=j.shift();if(null===a)return l.emit("end");l.emit("data",a)}}function g(){l.writable=!1,b.call(l),!l.readable&&l.autoDestroy&&l.destroy()}a=a||function(a){this.queue(a)},b=b||function(){this.queue(null)};var h=!1,i=!1,j=[],k=!1,l=new f;return l.readable=l.writable=!0,l.paused=!1,l.autoDestroy=!(c&&c.autoDestroy===!1),l.write=function(b){return a.call(this,b),!l.paused},l.queue=l.push=function(a){return k?l:(null==a&&(k=!0),j.push(a),d(),l)},l.on("end",function(){l.readable=!1,!l.writable&&l.autoDestroy&&e.nextTick(function(){l.destroy()})}),l.end=function(a){return h?void 0:(h=!0,arguments.length&&l.write(a),g(),l)},l.destroy=function(){return i?void 0:(i=!0,h=!0,j.length=0,l.writable=l.readable=!1,l.emit("close"),l)},l.pause=function(){return l.paused?void 0:(l.paused=!0,l)},l.resume=function(){return l.paused&&(l.paused=!1,l.emit("resume")),d(),l.paused||l.emit("drain"),l},l}var e=a("__browserify_process"),f=a("stream");c=b.exports=d,d.through=d},{__browserify_process:40,stream:50}],29:[function(a,b){function c(a){var b=d.stringify();b.pipe(a);var c=d.parse([!0]);a.pipe(c);var f=e(b,c);return f}var d=a("JSONStream"),e=a("duplexer");b.exports=c},{JSONStream:23,duplexer:26}],30:[function(a,b){function c(a){if(!a||"[object Object]"!==e.call(a)||a.nodeType||a.setInterval)return!1;var b=d.call(a,"constructor"),c=d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!c)return!1;var f;for(f in a);return void 0===f||d.call(a,f)}var d=Object.prototype.hasOwnProperty,e=Object.prototype.toString;b.exports=function f(){var a,b,d,e,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},j=2),"object"!=typeof i&&"function"!=typeof i&&(i={});k>j;j++)if(null!=(a=arguments[j]))for(b in a)d=i[b],e=a[b],i!==e&&(l&&e&&(c(e)||(g=Array.isArray(e)))?(g?(g=!1,h=d&&Array.isArray(d)?d:[]):h=d&&c(d)?d:{},i[b]=f(l,h,e)):void 0!==e&&(i[b]=e));return i}},{}],31:[function(){},{}],32:[function(a,b){b.exports=a(31)},{}],33:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length))throw b=arguments[1],b instanceof Error?b:TypeError('Uncaught, unspecified "error" event.');if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],34:[function(a,b){var c=b.exports,d=(a("events").EventEmitter,a("./lib/request"));c.request=function(a,b){a||(a={}),a.host||a.port||(a.port=parseInt(window.location.port,10)),!a.host&&a.hostname&&(a.host=a.hostname),a.scheme||(a.scheme=window.location.protocol.split(":")[0]),a.host||(a.host=window.location.hostname||window.location.host),/:/.test(a.host)&&(a.port||(a.port=a.host.split(":")[1]),a.host=a.host.split(":")[0]),a.port||(a.port="https"==a.scheme?443:80);var c=new d(new e,a);return b&&c.on("response",b),c},c.get=function(a,b){a.method="GET";var d=c.request(a,b);return d.end(),d},c.Agent=function(){},c.Agent.defaultMaxSockets=4;var e=function(){if("undefined"==typeof window)throw new Error("no window object present");if(window.XMLHttpRequest)return window.XMLHttpRequest;if(window.ActiveXObject){for(var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"],b=0;b<a.length;b++)try{var c=new window.ActiveXObject(a[b]);return function(){if(c){var d=c;return c=null,d}return new window.ActiveXObject(a[b])}}catch(d){}throw new Error("ajax not supported in this browser")}throw new Error("ajax not supported in this browser")}()},{"./lib/request":35,events:33}],35:[function(a,b){var c=a("stream"),d=a("./response"),e=a("Base64"),f=a("inherits"),g=b.exports=function(a,b){var c=this;c.writable=!0,c.xhr=a,c.body=[],c.uri=(b.scheme||"http")+"://"+b.host+(b.port?":"+b.port:"")+(b.path||"/");try{a.withCredentials=!0}catch(f){}if(a.open(b.method||"GET",c.uri,!0),b.headers)for(var g=h(b.headers),j=0;j<g.length;j++){var k=g[j];if(c.isSafeRequestHeader(k)){var l=b.headers[k];if(i(l))for(var m=0;m<l.length;m++)a.setRequestHeader(k,l[m]);else a.setRequestHeader(k,l)}}b.auth&&this.setHeader("Authorization","Basic "+e.btoa(b.auth));var n=new d;n.on("close",function(){c.emit("close")}),n.on("ready",function(){c.emit("response",n)}),a.onreadystatechange=function(){n.handle(a)}};f(g,c),g.prototype.setHeader=function(a,b){if(i(b))for(var c=0;c<b.length;c++)this.xhr.setRequestHeader(a,b[c]);else this.xhr.setRequestHeader(a,b)},g.prototype.write=function(a){this.body.push(a)},g.prototype.destroy=function(){this.xhr.abort(),this.emit("close")},g.prototype.end=function(a){if(void 0!==a&&this.body.push(a),0===this.body.length)this.xhr.send("");else if("string"==typeof this.body[0])this.xhr.send(this.body.join(""));else if(i(this.body[0])){for(var b=[],c=0;c<this.body.length;c++)b.push.apply(b,this.body[c]);this.xhr.send(b)}else if(/Array/.test(Object.prototype.toString.call(this.body[0]))){for(var d=0,c=0;c<this.body.length;c++)d+=this.body[c].length;for(var b=new this.body[0].constructor(d),e=0,c=0;c<this.body.length;c++)for(var f=this.body[c],g=0;g<f.length;g++)b[e++]=f[g];this.xhr.send(b)}else{for(var b="",c=0;c<this.body.length;c++)b+=this.body[c].toString();this.xhr.send(b)}},g.unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"],g.prototype.isSafeRequestHeader=function(a){return a?-1===j(g.unsafeHeaders,a.toLowerCase()):!1};var h=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b},i=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},j=function(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1}},{"./response":36,Base64:37,inherits:38,stream:50}],36:[function(a,b){function c(a){for(var b=a.getAllResponseHeaders().split(/\r?\n/),c={},d=0;d<b.length;d++){var e=b[d];if(""!==e){var f=e.match(/^([^:]+):\s*(.*)/);if(f){var g=f[1].toLowerCase(),i=f[2];void 0!==c[g]?h(c[g])?c[g].push(i):c[g]=[c[g],i]:c[g]=i}else c[e]=!0}}return c}var d=a("stream"),e=a("util"),f=b.exports=function(){this.offset=0,this.readable=!0};e.inherits(f,d);var g={streaming:!0,status2:!0};f.prototype.getResponse=function(a){var b=String(a.responseType).toLowerCase();return"blob"===b?a.responseBlob||a.response:"arraybuffer"===b?a.response:a.responseText},f.prototype.getHeader=function(a){return this.headers[a.toLowerCase()]},f.prototype.handle=function(a){if(2===a.readyState&&g.status2){try{this.statusCode=a.status,this.headers=c(a)}catch(b){g.status2=!1}g.status2&&this.emit("ready")}else if(g.streaming&&3===a.readyState){try{this.statusCode||(this.statusCode=a.status,this.headers=c(a),this.emit("ready"))}catch(b){}try{this._emitData(a)}catch(b){g.streaming=!1}}else 4===a.readyState&&(this.statusCode||(this.statusCode=a.status,this.emit("ready")),this._emitData(a),a.error?this.emit("error",this.getResponse(a)):this.emit("end"),this.emit("close"))},f.prototype._emitData=function(a){var b=this.getResponse(a);return b.toString().match(/ArrayBuffer/)?(this.emit("data",new Uint8Array(b,this.offset)),this.offset=b.byteLength,void 0):(b.length>this.offset&&(this.emit("data",b.slice(this.offset)),this.offset=b.length),void 0)};var h=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},{stream:50,util:59}],37:[function(a,b,c){!function(){function a(a){this.message=a}var b="undefined"!=typeof c?c:this,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.prototype=new Error,a.prototype.name="InvalidCharacterError",b.btoa||(b.btoa=function(b){for(var c,e,f=0,g=d,h="";b.charAt(0|f)||(g="=",f%1);h+=g.charAt(63&c>>8-f%1*8)){if(e=b.charCodeAt(f+=.75),e>255)throw new a("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");c=c<<8|e}return h}),b.atob||(b.atob=function(b){if(b=b.replace(/=+$/,""),b.length%4==1)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var c,e,f=0,g=0,h="";e=b.charAt(g++);~e&&(c=f%4?64*c+e:e,f++%4)?h+=String.fromCharCode(255&c>>(-2*f&6)):0)e=d.indexOf(e);return h})}()},{}],38:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],39:[function(a,b){a=function c(b,d,e){function f(h,i){if(!d[h]){if(!b[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);throw new Error("Cannot find module '"+h+"'")}var k=d[h]={exports:{}};b[h][0].call(k.exports,function(a){var c=b[h][1][a];return f(c?c:a)},k,k.exports,c,b,d,e)}return d[h].exports}for(var g="function"==typeof a&&a,h=0;h<e.length;h++)f(e[h]);return f}({PcZj9L:[function(a,b,c){function d(a,b,c){if(!(this instanceof d))return new d(a,b,c);var e=typeof a;if("base64"===b&&"string"===e)for(a=C(a);a.length%4!==0;)a+="=";var f;if("number"===e)f=F(a);else if("string"===e)f=d.byteLength(a,b);else{if("object"!==e)throw new Error("First argument needs to be a number, array or string.");f=F(a.length)}var g;U?g=D(new Uint8Array(f)):(g=this,g.length=f);var h;if(d.isBuffer(a))g.set(a);else if(H(a))for(h=0;f>h;h++)g[h]=d.isBuffer(a)?a.readUInt8(h):a[h];else if("string"===e)g.write(a,0,b);else if("number"===e&&!U&&!c)for(h=0;f>h;h++)g[h]=0;return g}function e(a,b,c,e){c=Number(c)||0;var f=a.length-c;e?(e=Number(e),e>f&&(e=f)):e=f;var g=b.length;if(g%2!==0)throw new Error("Invalid hex string");e>g/2&&(e=g/2);for(var h=0;e>h;h++){var i=parseInt(b.substr(2*h,2),16);if(isNaN(i))throw new Error("Invalid hex string");a[c+h]=i}return d._charsWritten=2*h,h}function f(a,b,c,e){return d._charsWritten=M(J(b),a,c,e)}function g(a,b,c,e){return d._charsWritten=M(K(b),a,c,e)}function h(a,b,c,d){return g(a,b,c,d)}function i(a,b,c,e){return d._charsWritten=M(L(b),a,c,e)}function k(a,b,c){return 0===b&&c===a.length?S.fromByteArray(a):S.fromByteArray(a.slice(b,c))}function l(a,b,c){var d="",e="";c=Math.min(a.length,c);for(var f=b;c>f;f++)a[f]<=127?(d+=N(e)+String.fromCharCode(a[f]),e=""):e+="%"+a[f].toString(16);return d+N(e)}function m(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(a[e]);return d}function n(a,b,c){return m(a,b,c)}function o(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;f++)e+=I(a[f]);return e}function p(a,b,c,d){d||(R("boolean"==typeof c,"missing or invalid endian"),R(void 0!==b&&null!==b,"missing offset"),R(b+1<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){if(U){if(e>b+1)return a._dataview.getUint16(b,c);var f=new DataView(new ArrayBuffer(2));return f.setUint8(0,a[e-1]),f.getUint16(0,c)}var g;return c?(g=a[b],e>b+1&&(g|=a[b+1]<<8)):(g=a[b]<<8,e>b+1&&(g|=a[b+1])),g}}function q(a,b,c,d){d||(R("boolean"==typeof c,"missing or invalid endian"),R(void 0!==b&&null!==b,"missing offset"),R(b+3<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){if(U){if(e>b+3)return a._dataview.getUint32(b,c);for(var f=new DataView(new ArrayBuffer(4)),g=0;e>g+b;g++)f.setUint8(g,a[g+b]);return f.getUint32(0,c)}var h;return c?(e>b+2&&(h=a[b+2]<<16),e>b+1&&(h|=a[b+1]<<8),h|=a[b],e>b+3&&(h+=a[b+3]<<24>>>0)):(e>b+1&&(h=a[b+1]<<16),e>b+2&&(h|=a[b+2]<<8),e>b+3&&(h|=a[b+3]),h+=a[b]<<24>>>0),h}}function r(a,b,c,d){d||(R("boolean"==typeof c,"missing or invalid endian"),R(void 0!==b&&null!==b,"missing offset"),R(b+1<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){if(U){if(b+1===e){var f=new DataView(new ArrayBuffer(2));return f.setUint8(0,a[e-1]),f.getInt16(0,c)}return a._dataview.getInt16(b,c)}var g=p(a,b,c,!0),h=32768&g;return h?-1*(65535-g+1):g}}function s(a,b,c,d){d||(R("boolean"==typeof c,"missing or invalid endian"),R(void 0!==b&&null!==b,"missing offset"),R(b+3<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){if(U){if(b+3>=e){for(var f=new DataView(new ArrayBuffer(4)),g=0;e>g+b;g++)f.setUint8(g,a[g+b]);return f.getInt32(0,c)}return a._dataview.getInt32(b,c)}var h=q(a,b,c,!0),i=2147483648&h;return i?-1*(4294967295-h+1):h}}function t(a,b,c,d){return d||(R("boolean"==typeof c,"missing or invalid endian"),R(b+3<a.length,"Trying to read beyond buffer length")),U?a._dataview.getFloat32(b,c):T.read(a,b,c,23,4)}function u(a,b,c,d){return d||(R("boolean"==typeof c,"missing or invalid endian"),R(b+7<a.length,"Trying to read beyond buffer length")),U?a._dataview.getFloat64(b,c):T.read(a,b,c,52,8)}function v(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+1<a.length,"trying to write beyond buffer length"),O(b,65535));var f=a.length;if(!(c>=f))if(U)if(c+1===f){var g=new DataView(new ArrayBuffer(2));g.setUint16(0,b,d),a[c]=g.getUint8(0)}else a._dataview.setUint16(c,b,d);else for(var h=0,i=Math.min(f-c,2);i>h;h++)a[c+h]=(b&255<<8*(d?h:1-h))>>>8*(d?h:1-h)}function w(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+3<a.length,"trying to write beyond buffer length"),O(b,4294967295));var f=a.length;if(!(c>=f)){var g;if(U)if(c+3>=f){var h=new DataView(new ArrayBuffer(4));for(h.setUint32(0,b,d),g=0;f>g+c;g++)a[g+c]=h.getUint8(g)}else a._dataview.setUint32(c,b,d);else for(g=0,j=Math.min(f-c,4);j>g;g++)a[c+g]=b>>>8*(d?g:3-g)&255}}function x(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+1<a.length,"Trying to write beyond buffer length"),P(b,32767,-32768));var f=a.length;if(!(c>=f))if(U)if(c+1===f){var g=new DataView(new ArrayBuffer(2));g.setInt16(0,b,d),a[c]=g.getUint8(0)}else a._dataview.setInt16(c,b,d);else b>=0?v(a,b,c,d,e):v(a,65535+b+1,c,d,e)}function y(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+3<a.length,"Trying to write beyond buffer length"),P(b,2147483647,-2147483648));var f=a.length;if(!(c>=f))if(U)if(c+3>=f){var g=new DataView(new ArrayBuffer(4));g.setInt32(0,b,d);for(var h=0;f>h+c;h++)a[h+c]=g.getUint8(h)}else a._dataview.setInt32(c,b,d);else b>=0?w(a,b,c,d,e):w(a,4294967295+b+1,c,d,e)}function z(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+3<a.length,"Trying to write beyond buffer length"),Q(b,3.4028234663852886e38,-3.4028234663852886e38));var f=a.length;if(!(c>=f))if(U)if(c+3>=f){var g=new DataView(new ArrayBuffer(4));g.setFloat32(0,b,d);for(var h=0;f>h+c;h++)a[h+c]=g.getUint8(h)}else a._dataview.setFloat32(c,b,d);else T.write(a,b,c,d,23,4)}function A(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+7<a.length,"Trying to write beyond buffer length"),Q(b,1.7976931348623157e308,-1.7976931348623157e308));var f=a.length;if(!(c>=f))if(U)if(c+7>=f){var g=new DataView(new ArrayBuffer(8));g.setFloat64(0,b,d);for(var h=0;f>h+c;h++)a[h+c]=g.getUint8(h)}else a._dataview.setFloat64(c,b,d);else T.write(a,b,c,d,52,8)}function B(){return new d(this).buffer}function C(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function D(a){return a._isBuffer=!0,a.write=V.write,a.toString=V.toString,a.toLocaleString=V.toString,a.toJSON=V.toJSON,a.copy=V.copy,a.slice=V.slice,a.readUInt8=V.readUInt8,a.readUInt16LE=V.readUInt16LE,a.readUInt16BE=V.readUInt16BE,a.readUInt32LE=V.readUInt32LE,a.readUInt32BE=V.readUInt32BE,a.readInt8=V.readInt8,a.readInt16LE=V.readInt16LE,a.readInt16BE=V.readInt16BE,a.readInt32LE=V.readInt32LE,a.readInt32BE=V.readInt32BE,a.readFloatLE=V.readFloatLE,a.readFloatBE=V.readFloatBE,a.readDoubleLE=V.readDoubleLE,a.readDoubleBE=V.readDoubleBE,a.writeUInt8=V.writeUInt8,a.writeUInt16LE=V.writeUInt16LE,a.writeUInt16BE=V.writeUInt16BE,a.writeUInt32LE=V.writeUInt32LE,a.writeUInt32BE=V.writeUInt32BE,a.writeInt8=V.writeInt8,a.writeInt16LE=V.writeInt16LE,a.writeInt16BE=V.writeInt16BE,a.writeInt32LE=V.writeInt32LE,a.writeInt32BE=V.writeInt32BE,a.writeFloatLE=V.writeFloatLE,a.writeFloatBE=V.writeFloatBE,a.writeDoubleLE=V.writeDoubleLE,a.writeDoubleBE=V.writeDoubleBE,a.fill=V.fill,a.inspect=V.inspect,a.toArrayBuffer=B,0!==a.byteLength&&(a._dataview=new DataView(a.buffer,a.byteOffset,a.byteLength)),a}function E(a,b,c){return"number"!=typeof a?c:(a=~~a,a>=b?b:a>=0?a:(a+=b,a>=0?a:0))}function F(a){return a=~~Math.ceil(+a),0>a?0:a}function G(a){return(Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)})(a)}function H(a){return G(a)||d.isBuffer(a)||a&&"object"==typeof a&&"number"==typeof a.length}function I(a){return 16>a?"0"+a.toString(16):a.toString(16)}function J(a){for(var b=[],c=0;c<a.length;c++)if(a.charCodeAt(c)<=127)b.push(a.charCodeAt(c));else for(var d=encodeURIComponent(a.charAt(c)).substr(1).split("%"),e=0;e<d.length;e++)b.push(parseInt(d[e],16));return b}function K(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function L(a){return S.toByteArray(a)}function M(a,b,c,d){for(var e=0;d>e&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}function N(a){try{return decodeURIComponent(a)}catch(b){return String.fromCharCode(65533)}}function O(a,b){R("number"==typeof a,"cannot write a non-number as a number"),R(a>=0,"specified a negative value for writing an unsigned value"),R(b>=a,"value is larger than maximum value for type"),R(Math.floor(a)===a,"value has a fractional component")}function P(a,b,c){R("number"==typeof a,"cannot write a non-number as a number"),R(b>=a,"value larger than maximum allowed value"),R(a>=c,"value smaller than minimum allowed value"),R(Math.floor(a)===a,"value has a fractional component")}function Q(a,b,c){R("number"==typeof a,"cannot write a non-number as a number"),R(b>=a,"value larger than maximum allowed value"),R(a>=c,"value smaller than minimum allowed value")}function R(a,b){if(!a)throw new Error(b||"Failed assertion")}var S=a("base64-js"),T=a("ieee754");c.Buffer=d,c.SlowBuffer=d,c.INSPECT_MAX_BYTES=50,d.poolSize=8192;var U=function(){if("undefined"==typeof Uint8Array||"undefined"==typeof ArrayBuffer||"undefined"==typeof DataView)return!1;try{var a=new Uint8Array(0);return a.foo=function(){return 42},42===a.foo()}catch(b){return!1}}();d.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":return!0;default:return!1}},d.isBuffer=function(a){return a&&a._isBuffer},d.byteLength=function(a,b){switch(b||"utf8"){case"hex":return a.length/2;case"utf8":case"utf-8":return J(a).length;case"ascii":case"binary":return a.length;case"base64":return L(a).length;default:throw new Error("Unknown encoding")}},d.concat=function(a,b){if(!G(a))throw new Error("Usage: Buffer.concat(list, [totalLength])\nlist should be an Array.");if(0===a.length)return new d(0);if(1===a.length)return a[0];var c;if("number"!=typeof b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var e=new d(b),f=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(e,f),f+=g.length}return e},d.prototype.write=function(a,b,c,d){if(isFinite(b))isFinite(c)||(d=c,c=void 0);else{var j=d;d=b,b=c,c=j}b=Number(b)||0;var k=this.length-b;switch(c?(c=Number(c),c>k&&(c=k)):c=k,d=String(d||"utf8").toLowerCase()){case"hex":return e(this,a,b,c);case"utf8":case"utf-8":return f(this,a,b,c);case"ascii":return g(this,a,b,c);case"binary":return h(this,a,b,c);case"base64":return i(this,a,b,c);default:throw new Error("Unknown encoding")}},d.prototype.toString=function(a,b,c){var d=this;if(a=String(a||"utf8").toLowerCase(),b=Number(b)||0,c=void 0!==c?Number(c):c=d.length,c===b)return"";switch(a){case"hex":return o(d,b,c);case"utf8":case"utf-8":return l(d,b,c);case"ascii":return m(d,b,c);case"binary":return n(d,b,c);case"base64":return k(d,b,c);default:throw new Error("Unknown encoding")}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.copy=function(a,b,c,d){var e=this;if(c||(c=0),d||0===d||(d=this.length),b||(b=0),d!==c&&0!==a.length&&0!==e.length){if(c>d)throw new Error("sourceEnd < sourceStart");if(0>b||b>=a.length)throw new Error("targetStart out of bounds");if(0>c||c>=e.length)throw new Error("sourceStart out of bounds");if(0>d||d>e.length)throw new Error("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);for(var f=0;d-c>f;f++)a[f+b]=this[f+c]}},d.prototype.slice=function(a,b){var c=this.length;if(a=E(a,c,0),b=E(b,c,c),U)return D(this.subarray(a,b));for(var e=b-a,f=new d(e,void 0,!0),g=0;e>g;g++)f[g]=this[g+a];return f},d.prototype.readUInt8=function(a,b){var c=this;return b||(R(void 0!==a&&null!==a,"missing offset"),R(a<c.length,"Trying to read beyond buffer length")),a>=c.length?void 0:c[a]},d.prototype.readUInt16LE=function(a,b){return p(this,a,!0,b)},d.prototype.readUInt16BE=function(a,b){return p(this,a,!1,b)},d.prototype.readUInt32LE=function(a,b){return q(this,a,!0,b)},d.prototype.readUInt32BE=function(a,b){return q(this,a,!1,b)},d.prototype.readInt8=function(a,b){var c=this;if(b||(R(void 0!==a&&null!==a,"missing offset"),R(a<c.length,"Trying to read beyond buffer length")),!(a>=c.length)){if(U)return c._dataview.getInt8(a);var d=128&c[a];return d?-1*(255-c[a]+1):c[a]}},d.prototype.readInt16LE=function(a,b){return r(this,a,!0,b)},d.prototype.readInt16BE=function(a,b){return r(this,a,!1,b)},d.prototype.readInt32LE=function(a,b){return s(this,a,!0,b)},d.prototype.readInt32BE=function(a,b){return s(this,a,!1,b)},d.prototype.readFloatLE=function(a,b){return t(this,a,!0,b)},d.prototype.readFloatBE=function(a,b){return t(this,a,!1,b)},d.prototype.readDoubleLE=function(a,b){return u(this,a,!0,b)},d.prototype.readDoubleBE=function(a,b){return u(this,a,!1,b)},d.prototype.writeUInt8=function(a,b,c){var d=this;c||(R(void 0!==a&&null!==a,"missing value"),R(void 0!==b&&null!==b,"missing offset"),R(b<d.length,"trying to write beyond buffer length"),O(a,255)),b>=d.length||(d[b]=a)},d.prototype.writeUInt16LE=function(a,b,c){v(this,a,b,!0,c)},d.prototype.writeUInt16BE=function(a,b,c){v(this,a,b,!1,c)},d.prototype.writeUInt32LE=function(a,b,c){w(this,a,b,!0,c)},d.prototype.writeUInt32BE=function(a,b,c){w(this,a,b,!1,c)},d.prototype.writeInt8=function(a,b,c){var d=this;c||(R(void 0!==a&&null!==a,"missing value"),R(void 0!==b&&null!==b,"missing offset"),R(b<d.length,"Trying to write beyond buffer length"),P(a,127,-128)),b>=d.length||(U?d._dataview.setInt8(b,a):a>=0?d.writeUInt8(a,b,c):d.writeUInt8(255+a+1,b,c))},d.prototype.writeInt16LE=function(a,b,c){x(this,a,b,!0,c)},d.prototype.writeInt16BE=function(a,b,c){x(this,a,b,!1,c)},d.prototype.writeInt32LE=function(a,b,c){y(this,a,b,!0,c)},d.prototype.writeInt32BE=function(a,b,c){y(this,a,b,!1,c)},d.prototype.writeFloatLE=function(a,b,c){z(this,a,b,!0,c)},d.prototype.writeFloatBE=function(a,b,c){z(this,a,b,!1,c)},d.prototype.writeDoubleLE=function(a,b,c){A(this,a,b,!0,c)},d.prototype.writeDoubleBE=function(a,b,c){A(this,a,b,!1,c)},d.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),"string"==typeof a&&(a=a.charCodeAt(0)),"number"!=typeof a||isNaN(a))throw new Error("value is not a number");if(b>c)throw new Error("end < start");if(c!==b&&0!==this.length){if(0>b||b>=this.length)throw new Error("start out of bounds");if(0>c||c>this.length)throw new Error("end out of bounds");for(var d=b;c>d;d++)this[d]=a}},d.prototype.inspect=function(){for(var a=[],b=this.length,d=0;b>d;d++)if(a[d]=I(this[d]),d===c.INSPECT_MAX_BYTES){a[d+1]="...";break}return"<Buffer "+a.join(" ")+">"};var V=d.prototype},{"base64-js":3,ieee754:4}],"native-buffer-browserify":[function(a,b){b.exports=a("PcZj9L")},{}],3:[function(a,b){function c(a,b){var c=a.length,d=Number(arguments[1])||0;for(d=0>d?Math.ceil(d):Math.floor(d),0>d&&(d+=c);c>d;d++)if("string"==typeof a&&a.charAt(d)===b||"string"!=typeof a&&a[d]===b)return d;return-1}!function(){"use strict";function a(a){var b,d,f,g,h,i;if(a.length%4>0)throw"Invalid string. Length must be a multiple of 4";for(h=c(a,"="),h=h>0?a.length-h:0,i=[],f=h>0?a.length-4:a.length,b=0,d=0;f>b;b+=4,d+=3)g=c(e,a.charAt(b))<<18|c(e,a.charAt(b+1))<<12|c(e,a.charAt(b+2))<<6|c(e,a.charAt(b+3)),i.push((16711680&g)>>16),i.push((65280&g)>>8),i.push(255&g);return 2===h?(g=c(e,a.charAt(b))<<2|c(e,a.charAt(b+1))>>4,i.push(255&g)):1===h&&(g=c(e,a.charAt(b))<<10|c(e,a.charAt(b+1))<<4|c(e,a.charAt(b+2))>>2,i.push(g>>8&255),i.push(255&g)),i}function d(a){function b(a){return e.charAt(a>>18&63)+e.charAt(a>>12&63)+e.charAt(a>>6&63)+e.charAt(63&a)}var c,d,f,g=a.length%3,h="";for(c=0,f=a.length-g;f>c;c+=3)d=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(d);switch(g){case 1:d=a[a.length-1],h+=e.charAt(d>>2),h+=e.charAt(d<<4&63),h+="==";
break;case 2:d=(a[a.length-2]<<8)+a[a.length-1],h+=e.charAt(d>>10),h+=e.charAt(d>>4&63),h+=e.charAt(d<<2&63),h+="="}return h}var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b.exports.toByteArray=a,b.exports.fromByteArray=d}()},{}],4:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?0/0:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||1/0===b?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}]},{},[]),b.exports=a("native-buffer-browserify").Buffer},{}],40:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){if(a.source===window&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var b=c.shift();b()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],41:[function(a,b,c){function d(a,b,c){if(!(this instanceof d))return new d(a,b,c);var e=typeof a;if("base64"===b&&"string"===e)for(a=C(a);a.length%4!==0;)a+="=";var f;if("number"===e)f=F(a);else if("string"===e)f=d.byteLength(a,b);else{if("object"!==e)throw new Error("First argument needs to be a number, array or string.");f=F(a.length)}var g;U?g=D(new Uint8Array(f)):(g=this,g.length=f);var h;if(d.isBuffer(a))g.set(a);else if(H(a))for(h=0;f>h;h++)g[h]=d.isBuffer(a)?a.readUInt8(h):a[h];else if("string"===e)g.write(a,0,b);else if("number"===e&&!U&&!c)for(h=0;f>h;h++)g[h]=0;return g}function e(a,b,c,e){c=Number(c)||0;var f=a.length-c;e?(e=Number(e),e>f&&(e=f)):e=f;var g=b.length;if(g%2!==0)throw new Error("Invalid hex string");e>g/2&&(e=g/2);for(var h=0;e>h;h++){var i=parseInt(b.substr(2*h,2),16);if(isNaN(i))throw new Error("Invalid hex string");a[c+h]=i}return d._charsWritten=2*h,h}function f(a,b,c,e){return d._charsWritten=M(J(b),a,c,e)}function g(a,b,c,e){return d._charsWritten=M(K(b),a,c,e)}function h(a,b,c,d){return g(a,b,c,d)}function i(a,b,c,e){return d._charsWritten=M(L(b),a,c,e)}function k(a,b,c){return 0===b&&c===a.length?S.fromByteArray(a):S.fromByteArray(a.slice(b,c))}function l(a,b,c){var d="",e="";c=Math.min(a.length,c);for(var f=b;c>f;f++)a[f]<=127?(d+=N(e)+String.fromCharCode(a[f]),e=""):e+="%"+a[f].toString(16);return d+N(e)}function m(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(a[e]);return d}function n(a,b,c){return m(a,b,c)}function o(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;f++)e+=I(a[f]);return e}function p(a,b,c,d){d||(R("boolean"==typeof c,"missing or invalid endian"),R(void 0!==b&&null!==b,"missing offset"),R(b+1<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){if(U){if(e>b+1)return a._dataview.getUint16(b,c);var f=new DataView(new ArrayBuffer(2));return f.setUint8(0,a[e-1]),f.getUint16(0,c)}var g;return c?(g=a[b],e>b+1&&(g|=a[b+1]<<8)):(g=a[b]<<8,e>b+1&&(g|=a[b+1])),g}}function q(a,b,c,d){d||(R("boolean"==typeof c,"missing or invalid endian"),R(void 0!==b&&null!==b,"missing offset"),R(b+3<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){if(U){if(e>b+3)return a._dataview.getUint32(b,c);for(var f=new DataView(new ArrayBuffer(4)),g=0;e>g+b;g++)f.setUint8(g,a[g+b]);return f.getUint32(0,c)}var h;return c?(e>b+2&&(h=a[b+2]<<16),e>b+1&&(h|=a[b+1]<<8),h|=a[b],e>b+3&&(h+=a[b+3]<<24>>>0)):(e>b+1&&(h=a[b+1]<<16),e>b+2&&(h|=a[b+2]<<8),e>b+3&&(h|=a[b+3]),h+=a[b]<<24>>>0),h}}function r(a,b,c,d){d||(R("boolean"==typeof c,"missing or invalid endian"),R(void 0!==b&&null!==b,"missing offset"),R(b+1<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){if(U){if(b+1===e){var f=new DataView(new ArrayBuffer(2));return f.setUint8(0,a[e-1]),f.getInt16(0,c)}return a._dataview.getInt16(b,c)}var g=p(a,b,c,!0),h=32768&g;return h?-1*(65535-g+1):g}}function s(a,b,c,d){d||(R("boolean"==typeof c,"missing or invalid endian"),R(void 0!==b&&null!==b,"missing offset"),R(b+3<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){if(U){if(b+3>=e){for(var f=new DataView(new ArrayBuffer(4)),g=0;e>g+b;g++)f.setUint8(g,a[g+b]);return f.getInt32(0,c)}return a._dataview.getInt32(b,c)}var h=q(a,b,c,!0),i=2147483648&h;return i?-1*(4294967295-h+1):h}}function t(a,b,c,d){return d||(R("boolean"==typeof c,"missing or invalid endian"),R(b+3<a.length,"Trying to read beyond buffer length")),U?a._dataview.getFloat32(b,c):T.read(a,b,c,23,4)}function u(a,b,c,d){return d||(R("boolean"==typeof c,"missing or invalid endian"),R(b+7<a.length,"Trying to read beyond buffer length")),U?a._dataview.getFloat64(b,c):T.read(a,b,c,52,8)}function v(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+1<a.length,"trying to write beyond buffer length"),O(b,65535));var f=a.length;if(!(c>=f))if(U)if(c+1===f){var g=new DataView(new ArrayBuffer(2));g.setUint16(0,b,d),a[c]=g.getUint8(0)}else a._dataview.setUint16(c,b,d);else for(var h=0,i=Math.min(f-c,2);i>h;h++)a[c+h]=(b&255<<8*(d?h:1-h))>>>8*(d?h:1-h)}function w(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+3<a.length,"trying to write beyond buffer length"),O(b,4294967295));var f=a.length;if(!(c>=f)){var g;if(U)if(c+3>=f){var h=new DataView(new ArrayBuffer(4));for(h.setUint32(0,b,d),g=0;f>g+c;g++)a[g+c]=h.getUint8(g)}else a._dataview.setUint32(c,b,d);else for(g=0,j=Math.min(f-c,4);j>g;g++)a[c+g]=b>>>8*(d?g:3-g)&255}}function x(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+1<a.length,"Trying to write beyond buffer length"),P(b,32767,-32768));var f=a.length;if(!(c>=f))if(U)if(c+1===f){var g=new DataView(new ArrayBuffer(2));g.setInt16(0,b,d),a[c]=g.getUint8(0)}else a._dataview.setInt16(c,b,d);else b>=0?v(a,b,c,d,e):v(a,65535+b+1,c,d,e)}function y(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+3<a.length,"Trying to write beyond buffer length"),P(b,2147483647,-2147483648));var f=a.length;if(!(c>=f))if(U)if(c+3>=f){var g=new DataView(new ArrayBuffer(4));g.setInt32(0,b,d);for(var h=0;f>h+c;h++)a[h+c]=g.getUint8(h)}else a._dataview.setInt32(c,b,d);else b>=0?w(a,b,c,d,e):w(a,4294967295+b+1,c,d,e)}function z(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+3<a.length,"Trying to write beyond buffer length"),Q(b,3.4028234663852886e38,-3.4028234663852886e38));var f=a.length;if(!(c>=f))if(U)if(c+3>=f){var g=new DataView(new ArrayBuffer(4));g.setFloat32(0,b,d);for(var h=0;f>h+c;h++)a[h+c]=g.getUint8(h)}else a._dataview.setFloat32(c,b,d);else T.write(a,b,c,d,23,4)}function A(a,b,c,d,e){e||(R(void 0!==b&&null!==b,"missing value"),R("boolean"==typeof d,"missing or invalid endian"),R(void 0!==c&&null!==c,"missing offset"),R(c+7<a.length,"Trying to write beyond buffer length"),Q(b,1.7976931348623157e308,-1.7976931348623157e308));var f=a.length;if(!(c>=f))if(U)if(c+7>=f){var g=new DataView(new ArrayBuffer(8));g.setFloat64(0,b,d);for(var h=0;f>h+c;h++)a[h+c]=g.getUint8(h)}else a._dataview.setFloat64(c,b,d);else T.write(a,b,c,d,52,8)}function B(){return new d(this).buffer}function C(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function D(a){return a._isBuffer=!0,a.write=V.write,a.toString=V.toString,a.toLocaleString=V.toString,a.toJSON=V.toJSON,a.copy=V.copy,a.slice=V.slice,a.readUInt8=V.readUInt8,a.readUInt16LE=V.readUInt16LE,a.readUInt16BE=V.readUInt16BE,a.readUInt32LE=V.readUInt32LE,a.readUInt32BE=V.readUInt32BE,a.readInt8=V.readInt8,a.readInt16LE=V.readInt16LE,a.readInt16BE=V.readInt16BE,a.readInt32LE=V.readInt32LE,a.readInt32BE=V.readInt32BE,a.readFloatLE=V.readFloatLE,a.readFloatBE=V.readFloatBE,a.readDoubleLE=V.readDoubleLE,a.readDoubleBE=V.readDoubleBE,a.writeUInt8=V.writeUInt8,a.writeUInt16LE=V.writeUInt16LE,a.writeUInt16BE=V.writeUInt16BE,a.writeUInt32LE=V.writeUInt32LE,a.writeUInt32BE=V.writeUInt32BE,a.writeInt8=V.writeInt8,a.writeInt16LE=V.writeInt16LE,a.writeInt16BE=V.writeInt16BE,a.writeInt32LE=V.writeInt32LE,a.writeInt32BE=V.writeInt32BE,a.writeFloatLE=V.writeFloatLE,a.writeFloatBE=V.writeFloatBE,a.writeDoubleLE=V.writeDoubleLE,a.writeDoubleBE=V.writeDoubleBE,a.fill=V.fill,a.inspect=V.inspect,a.toArrayBuffer=B,0!==a.byteLength&&(a._dataview=new DataView(a.buffer,a.byteOffset,a.byteLength)),a}function E(a,b,c){return"number"!=typeof a?c:(a=~~a,a>=b?b:a>=0?a:(a+=b,a>=0?a:0))}function F(a){return a=~~Math.ceil(+a),0>a?0:a}function G(a){return(Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)})(a)}function H(a){return G(a)||d.isBuffer(a)||a&&"object"==typeof a&&"number"==typeof a.length}function I(a){return 16>a?"0"+a.toString(16):a.toString(16)}function J(a){for(var b=[],c=0;c<a.length;c++)if(a.charCodeAt(c)<=127)b.push(a.charCodeAt(c));else for(var d=encodeURIComponent(a.charAt(c)).substr(1).split("%"),e=0;e<d.length;e++)b.push(parseInt(d[e],16));return b}function K(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function L(a){return S.toByteArray(a)}function M(a,b,c,d){for(var e=0;d>e&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}function N(a){try{return decodeURIComponent(a)}catch(b){return String.fromCharCode(65533)}}function O(a,b){R("number"==typeof a,"cannot write a non-number as a number"),R(a>=0,"specified a negative value for writing an unsigned value"),R(b>=a,"value is larger than maximum value for type"),R(Math.floor(a)===a,"value has a fractional component")}function P(a,b,c){R("number"==typeof a,"cannot write a non-number as a number"),R(b>=a,"value larger than maximum allowed value"),R(a>=c,"value smaller than minimum allowed value"),R(Math.floor(a)===a,"value has a fractional component")}function Q(a,b,c){R("number"==typeof a,"cannot write a non-number as a number"),R(b>=a,"value larger than maximum allowed value"),R(a>=c,"value smaller than minimum allowed value")}function R(a,b){if(!a)throw new Error(b||"Failed assertion")}var S=a("base64-js"),T=a("ieee754");c.Buffer=d,c.SlowBuffer=d,c.INSPECT_MAX_BYTES=50,d.poolSize=8192;var U=function(){if("undefined"==typeof Uint8Array||"undefined"==typeof ArrayBuffer||"undefined"==typeof DataView)return!1;try{var a=new Uint8Array(0);return a.foo=function(){return 42},42===a.foo()}catch(b){return!1}}();d.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":return!0;default:return!1}},d.isBuffer=function(a){return a&&a._isBuffer},d.byteLength=function(a,b){switch(b||"utf8"){case"hex":return a.length/2;case"utf8":case"utf-8":return J(a).length;case"ascii":case"binary":return a.length;case"base64":return L(a).length;default:throw new Error("Unknown encoding")}},d.concat=function(a,b){if(!G(a))throw new Error("Usage: Buffer.concat(list, [totalLength])\nlist should be an Array.");if(0===a.length)return new d(0);if(1===a.length)return a[0];var c;if("number"!=typeof b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var e=new d(b),f=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(e,f),f+=g.length}return e},d.prototype.write=function(a,b,c,d){if(isFinite(b))isFinite(c)||(d=c,c=void 0);else{var j=d;d=b,b=c,c=j}b=Number(b)||0;var k=this.length-b;switch(c?(c=Number(c),c>k&&(c=k)):c=k,d=String(d||"utf8").toLowerCase()){case"hex":return e(this,a,b,c);case"utf8":case"utf-8":return f(this,a,b,c);case"ascii":return g(this,a,b,c);case"binary":return h(this,a,b,c);case"base64":return i(this,a,b,c);default:throw new Error("Unknown encoding")}},d.prototype.toString=function(a,b,c){var d=this;if(a=String(a||"utf8").toLowerCase(),b=Number(b)||0,c=void 0!==c?Number(c):c=d.length,c===b)return"";switch(a){case"hex":return o(d,b,c);case"utf8":case"utf-8":return l(d,b,c);case"ascii":return m(d,b,c);case"binary":return n(d,b,c);case"base64":return k(d,b,c);default:throw new Error("Unknown encoding")}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.copy=function(a,b,c,d){var e=this;if(c||(c=0),d||0===d||(d=this.length),b||(b=0),d!==c&&0!==a.length&&0!==e.length){if(c>d)throw new Error("sourceEnd < sourceStart");if(0>b||b>=a.length)throw new Error("targetStart out of bounds");if(0>c||c>=e.length)throw new Error("sourceStart out of bounds");if(0>d||d>e.length)throw new Error("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);for(var f=0;d-c>f;f++)a[f+b]=this[f+c]}},d.prototype.slice=function(a,b){var c=this.length;if(a=E(a,c,0),b=E(b,c,c),U)return D(this.subarray(a,b));for(var e=b-a,f=new d(e,void 0,!0),g=0;e>g;g++)f[g]=this[g+a];return f},d.prototype.readUInt8=function(a,b){var c=this;return b||(R(void 0!==a&&null!==a,"missing offset"),R(a<c.length,"Trying to read beyond buffer length")),a>=c.length?void 0:c[a]},d.prototype.readUInt16LE=function(a,b){return p(this,a,!0,b)},d.prototype.readUInt16BE=function(a,b){return p(this,a,!1,b)},d.prototype.readUInt32LE=function(a,b){return q(this,a,!0,b)},d.prototype.readUInt32BE=function(a,b){return q(this,a,!1,b)},d.prototype.readInt8=function(a,b){var c=this;if(b||(R(void 0!==a&&null!==a,"missing offset"),R(a<c.length,"Trying to read beyond buffer length")),!(a>=c.length)){if(U)return c._dataview.getInt8(a);var d=128&c[a];return d?-1*(255-c[a]+1):c[a]}},d.prototype.readInt16LE=function(a,b){return r(this,a,!0,b)},d.prototype.readInt16BE=function(a,b){return r(this,a,!1,b)},d.prototype.readInt32LE=function(a,b){return s(this,a,!0,b)},d.prototype.readInt32BE=function(a,b){return s(this,a,!1,b)},d.prototype.readFloatLE=function(a,b){return t(this,a,!0,b)},d.prototype.readFloatBE=function(a,b){return t(this,a,!1,b)},d.prototype.readDoubleLE=function(a,b){return u(this,a,!0,b)},d.prototype.readDoubleBE=function(a,b){return u(this,a,!1,b)},d.prototype.writeUInt8=function(a,b,c){var d=this;c||(R(void 0!==a&&null!==a,"missing value"),R(void 0!==b&&null!==b,"missing offset"),R(b<d.length,"trying to write beyond buffer length"),O(a,255)),b>=d.length||(d[b]=a)},d.prototype.writeUInt16LE=function(a,b,c){v(this,a,b,!0,c)},d.prototype.writeUInt16BE=function(a,b,c){v(this,a,b,!1,c)},d.prototype.writeUInt32LE=function(a,b,c){w(this,a,b,!0,c)},d.prototype.writeUInt32BE=function(a,b,c){w(this,a,b,!1,c)},d.prototype.writeInt8=function(a,b,c){var d=this;c||(R(void 0!==a&&null!==a,"missing value"),R(void 0!==b&&null!==b,"missing offset"),R(b<d.length,"Trying to write beyond buffer length"),P(a,127,-128)),b>=d.length||(U?d._dataview.setInt8(b,a):a>=0?d.writeUInt8(a,b,c):d.writeUInt8(255+a+1,b,c))},d.prototype.writeInt16LE=function(a,b,c){x(this,a,b,!0,c)},d.prototype.writeInt16BE=function(a,b,c){x(this,a,b,!1,c)},d.prototype.writeInt32LE=function(a,b,c){y(this,a,b,!0,c)},d.prototype.writeInt32BE=function(a,b,c){y(this,a,b,!1,c)},d.prototype.writeFloatLE=function(a,b,c){z(this,a,b,!0,c)},d.prototype.writeFloatBE=function(a,b,c){z(this,a,b,!1,c)},d.prototype.writeDoubleLE=function(a,b,c){A(this,a,b,!0,c)},d.prototype.writeDoubleBE=function(a,b,c){A(this,a,b,!1,c)},d.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),"string"==typeof a&&(a=a.charCodeAt(0)),"number"!=typeof a||isNaN(a))throw new Error("value is not a number");if(b>c)throw new Error("end < start");if(c!==b&&0!==this.length){if(0>b||b>=this.length)throw new Error("start out of bounds");if(0>c||c>this.length)throw new Error("end out of bounds");for(var d=b;c>d;d++)this[d]=a}},d.prototype.inspect=function(){for(var a=[],b=this.length,d=0;b>d;d++)if(a[d]=I(this[d]),d===c.INSPECT_MAX_BYTES){a[d+1]="...";break}return"<Buffer "+a.join(" ")+">"};var V=d.prototype},{"base64-js":42,ieee754:43}],42:[function(a,b){function c(a,b){var c=a.length,d=Number(arguments[1])||0;for(d=0>d?Math.ceil(d):Math.floor(d),0>d&&(d+=c);c>d;d++)if("string"==typeof a&&a.charAt(d)===b||"string"!=typeof a&&a[d]===b)return d;return-1}!function(){"use strict";function a(a){var b,d,f,g,h,i;if(a.length%4>0)throw"Invalid string. Length must be a multiple of 4";for(h=c(a,"="),h=h>0?a.length-h:0,i=[],f=h>0?a.length-4:a.length,b=0,d=0;f>b;b+=4,d+=3)g=c(e,a.charAt(b))<<18|c(e,a.charAt(b+1))<<12|c(e,a.charAt(b+2))<<6|c(e,a.charAt(b+3)),i.push((16711680&g)>>16),i.push((65280&g)>>8),i.push(255&g);return 2===h?(g=c(e,a.charAt(b))<<2|c(e,a.charAt(b+1))>>4,i.push(255&g)):1===h&&(g=c(e,a.charAt(b))<<10|c(e,a.charAt(b+1))<<4|c(e,a.charAt(b+2))>>2,i.push(g>>8&255),i.push(255&g)),i}function d(a){function b(a){return e.charAt(a>>18&63)+e.charAt(a>>12&63)+e.charAt(a>>6&63)+e.charAt(63&a)}var c,d,f,g=a.length%3,h="";for(c=0,f=a.length-g;f>c;c+=3)d=(a[c]<<16)+(a[c+1]<<8)+a[c+2],h+=b(d);switch(g){case 1:d=a[a.length-1],h+=e.charAt(d>>2),h+=e.charAt(d<<4&63),h+="==";break;case 2:d=(a[a.length-2]<<8)+a[a.length-1],h+=e.charAt(d>>10),h+=e.charAt(d>>4&63),h+=e.charAt(d<<2&63),h+="="}return h}var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b.exports.toByteArray=a,b.exports.fromByteArray=d}()},{}],43:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?0/0:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||1/0===b?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],44:[function(a,b,c){function d(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function e(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var f=a("__browserify_process"),g=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,h=function(a){return g.exec(a).slice(1)};c.resolve=function(){for(var a="",b=!1,c=arguments.length-1;c>=-1&&!b;c--){var g=c>=0?arguments[c]:f.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(a=g+"/"+a,b="/"===g.charAt(0))}return a=d(e(a.split("/"),function(a){return!!a}),!b).join("/"),(b?"/":"")+a||"."},c.normalize=function(a){var b=c.isAbsolute(a),f="/"===i(a,-1);return a=d(e(a.split("/"),function(a){return!!a}),!b).join("/"),a||b||(a="."),a&&f&&(a+="/"),(b?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(e(a,function(a){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=h(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=h(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return h(a)[3]};var i="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return 0>b&&(b=a.length+b),a.substr(b,c)}},{__browserify_process:40}],45:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};!function(a){function e(a){throw RangeError(H[a])}function f(a,b){for(var c=a.length;c--;)a[c]=b(a[c]);return a}function g(a,b){return f(a.split(G),b).join(".")}function h(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function i(a){return f(a,function(a){var b="";return a>65535&&(a-=65536,b+=K(a>>>10&1023|55296),a=56320|1023&a),b+=K(a)}).join("")}function j(a){return 10>a-48?a-22:26>a-65?a-65:26>a-97?a-97:w}function k(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function l(a,b,c){var d=0;for(a=c?J(a/A):a>>1,a+=J(a/b);a>I*y>>1;d+=w)a=J(a/I);return J(d+(I+1)*a/(a+z))}function m(a){var b,c,d,f,g,h,k,m,n,o,p=[],q=a.length,r=0,s=C,t=B;for(c=a.lastIndexOf(D),0>c&&(c=0),d=0;c>d;++d)a.charCodeAt(d)>=128&&e("not-basic"),p.push(a.charCodeAt(d));for(f=c>0?c+1:0;q>f;){for(g=r,h=1,k=w;f>=q&&e("invalid-input"),m=j(a.charCodeAt(f++)),(m>=w||m>J((v-r)/h))&&e("overflow"),r+=m*h,n=t>=k?x:k>=t+y?y:k-t,!(n>m);k+=w)o=w-n,h>J(v/o)&&e("overflow"),h*=o;b=p.length+1,t=l(r-g,b,0==g),J(r/b)>v-s&&e("overflow"),s+=J(r/b),r%=b,p.splice(r++,0,s)}return i(p)}function n(a){var b,c,d,f,g,i,j,m,n,o,p,q,r,s,t,u=[];for(a=h(a),q=a.length,b=C,c=0,g=B,i=0;q>i;++i)p=a[i],128>p&&u.push(K(p));for(d=f=u.length,f&&u.push(D);q>d;){for(j=v,i=0;q>i;++i)p=a[i],p>=b&&j>p&&(j=p);for(r=d+1,j-b>J((v-c)/r)&&e("overflow"),c+=(j-b)*r,b=j,i=0;q>i;++i)if(p=a[i],b>p&&++c>v&&e("overflow"),p==b){for(m=c,n=w;o=g>=n?x:n>=g+y?y:n-g,!(o>m);n+=w)t=m-o,s=w-o,u.push(K(k(o+t%s,0))),m=J(t/s);u.push(K(k(m,0))),g=l(c,r,d==f),c=0,++d}++c,++b}return u.join("")}function o(a){return g(a,function(a){return E.test(a)?m(a.slice(4).toLowerCase()):a})}function p(a){return g(a,function(a){return F.test(a)?"xn--"+n(a):a})}var q="object"==typeof c&&c,r="object"==typeof b&&b&&b.exports==q&&b,s="object"==typeof d&&d;(s.global===s||s.window===s)&&(a=s);var t,u,v=2147483647,w=36,x=1,y=26,z=38,A=700,B=72,C=128,D="-",E=/^xn--/,F=/[^ -~]/,G=/\x2E|\u3002|\uFF0E|\uFF61/g,H={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=w-x,J=Math.floor,K=String.fromCharCode;if(t={version:"1.2.3",ucs2:{decode:h,encode:i},decode:m,encode:n,toASCII:p,toUnicode:o},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return t});else if(q&&!q.nodeType)if(r)r.exports=t;else for(u in t)t.hasOwnProperty(u)&&(q[u]=t[u]);else a.punycode=t}(this)},{}],46:[function(a,b){"use strict";function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}b.exports=function(a,b,e,f){b=b||"&",e=e||"=";var g={};if("string"!=typeof a||0===a.length)return g;var h=/\+/g;a=a.split(b);var i=1e3;f&&"number"==typeof f.maxKeys&&(i=f.maxKeys);var j=a.length;i>0&&j>i&&(j=i);for(var k=0;j>k;++k){var l,m,n,o,p=a[k].replace(h,"%20"),q=p.indexOf(e);q>=0?(l=p.substr(0,q),m=p.substr(q+1)):(l=p,m=""),n=decodeURIComponent(l),o=decodeURIComponent(m),c(g,n)?d(g[n])?g[n].push(o):g[n]=[g[n],o]:g[n]=o}return g};var d=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},{}],47:[function(a,b){"use strict";function c(a,b){if(a.map)return a.map(b);for(var c=[],d=0;d<a.length;d++)c.push(b(a[d],d));return c}var d=function(a){switch(typeof a){case"string":return a;case"boolean":return a?"true":"false";case"number":return isFinite(a)?a:"";default:return""}};b.exports=function(a,b,g,h){return b=b||"&",g=g||"=",null===a&&(a=void 0),"object"==typeof a?c(f(a),function(c){var f=encodeURIComponent(d(c))+g;return e(a[c])?a[c].map(function(a){return f+encodeURIComponent(d(a))}).join(b):f+encodeURIComponent(d(a[c]))}).join(b):h?encodeURIComponent(d(h))+g+encodeURIComponent(d(a)):""};var e=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},f=Object.keys||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}},{}],48:[function(a,b,c){"use strict";c.decode=c.parse=a("./decode"),c.encode=c.stringify=a("./encode")},{"./decode":46,"./encode":47}],49:[function(a,b){function c(a){return this instanceof c?(g.call(this,a),h.call(this,a),a&&a.readable===!1&&(this.readable=!1),a&&a.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,a&&a.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",d),void 0):new c(a)}function d(){if(!this.allowHalfOpen&&!this._writableState.ended){var a=this;f(function(){a.end()})}}b.exports=c;var e=a("inherits"),f=a("process/browser.js").nextTick,g=a("./readable.js"),h=a("./writable.js");e(c,g),c.prototype.write=h.prototype.write,c.prototype.end=h.prototype.end,c.prototype._write=h.prototype._write},{"./readable.js":53,"./writable.js":55,inherits:38,"process/browser.js":51}],50:[function(a,b){function c(){d.call(this)}b.exports=c;var d=a("events").EventEmitter,e=a("inherits");e(c,d),c.Readable=a("./readable.js"),c.Writable=a("./writable.js"),c.Duplex=a("./duplex.js"),c.Transform=a("./transform.js"),c.PassThrough=a("./passthrough.js"),c.Stream=c,c.prototype.pipe=function(a,b){function c(b){a.writable&&!1===a.write(b)&&j.pause&&j.pause()}function e(){j.readable&&j.resume&&j.resume()}function f(){k||(k=!0,a.end())}function g(){k||(k=!0,"function"==typeof a.destroy&&a.destroy())}function h(a){if(i(),0===d.listenerCount(this,"error"))throw a}function i(){j.removeListener("data",c),a.removeListener("drain",e),j.removeListener("end",f),j.removeListener("close",g),j.removeListener("error",h),a.removeListener("error",h),j.removeListener("end",i),j.removeListener("close",i),a.removeListener("close",i)}var j=this;j.on("data",c),a.on("drain",e),a._isStdio||b&&b.end===!1||(j.on("end",f),j.on("close",g));var k=!1;return j.on("error",h),a.on("error",h),j.on("end",i),j.on("close",i),a.on("close",i),a.emit("pipe",j),a}},{"./duplex.js":49,"./passthrough.js":52,"./readable.js":53,"./transform.js":54,"./writable.js":55,events:33,inherits:38}],51:[function(a,b){b.exports=a(40)},{}],52:[function(a,b){function c(a){return this instanceof c?(d.call(this,a),void 0):new c(a)}b.exports=c;var d=a("./transform.js"),e=a("inherits");e(c,d),c.prototype._transform=function(a,b,c){c(null,a)}},{"./transform.js":54,inherits:38}],53:[function(a,b){function c(b){b=b||{};var c=b.highWaterMark;this.highWaterMark=c||0===c?c:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!b.objectMode,this.defaultEncoding=b.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,b.encoding&&(x||(x=a("string_decoder").StringDecoder),this.decoder=new x(b.encoding),this.encoding=b.encoding)}function d(a){return this instanceof d?(this._readableState=new c(a,this),this.readable=!0,z.call(this),void 0):new d(a)}function e(a,b,c,d,e){var g=i(b,c);if(g)a.emit("error",g);else if(null===c||void 0===c)b.reading=!1,b.ended||j(a,b);else if(b.objectMode||c&&c.length>0)if(b.ended&&!e){var h=new Error("stream.push() after EOF");a.emit("error",h)}else if(b.endEmitted&&e){var h=new Error("stream.unshift() after end event");a.emit("error",h)}else!b.decoder||e||d||(c=b.decoder.write(c)),b.length+=b.objectMode?1:c.length,e?b.buffer.unshift(c):(b.reading=!1,b.buffer.push(c)),b.needReadable&&k(a),m(a,b);else e||(b.reading=!1);return f(b)}function f(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function g(a){if(a>=D)a=D;else{a--;for(var b=1;32>b;b<<=1)a|=a>>b;a++}return a}function h(a,b){return 0===b.length&&b.ended?0:b.objectMode?0===a?0:1:isNaN(a)||null===a?b.flowing&&b.buffer.length?b.buffer[0].length:b.length:0>=a?0:(a>b.highWaterMark&&(b.highWaterMark=g(a)),a>b.length?b.ended?b.length:(b.needReadable=!0,0):a)}function i(a,b){var c=null;return A.isBuffer(b)||"string"==typeof b||null===b||void 0===b||a.objectMode||c||(c=new TypeError("Invalid non-string/buffer chunk")),c}function j(a,b){if(b.decoder&&!b.ended){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0,b.length>0?k(a):t(a)}function k(a){var b=a._readableState;b.needReadable=!1,b.emittedReadable||(b.emittedReadable=!0,b.sync?B(function(){l(a)}):l(a))}function l(a){a.emit("readable")}function m(a,b){b.readingMore||(b.readingMore=!0,B(function(){n(a,b)}))}function n(a,b){for(var c=b.length;!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark&&(a.read(0),c!==b.length);)c=b.length;b.readingMore=!1}function o(a){return function(){var b=a._readableState;b.awaitDrain--,0===b.awaitDrain&&p(a)}}function p(a){function b(a){var b=a.write(c);!1===b&&d.awaitDrain++}var c,d=a._readableState;for(d.awaitDrain=0;d.pipesCount&&null!==(c=a.read());)if(1===d.pipesCount?b(d.pipes,0,null):u(d.pipes,b),a.emit("data",c),d.awaitDrain>0)return;return 0===d.pipesCount?(d.flowing=!1,y.listenerCount(a,"data")>0&&r(a),void 0):(d.ranOut=!0,void 0)}function q(){this._readableState.ranOut&&(this._readableState.ranOut=!1,p(this))}function r(a,b){var c=a._readableState;if(c.flowing)throw new Error("Cannot switch to old mode now.");var d=b||!1,e=!1;a.readable=!0,a.pipe=z.prototype.pipe,a.on=a.addListener=z.prototype.on,a.on("readable",function(){e=!0;for(var b;!d&&null!==(b=a.read());)a.emit("data",b);null===b&&(e=!1,a._readableState.needReadable=!0)}),a.pause=function(){d=!0,this.emit("pause")},a.resume=function(){d=!1,e?B(function(){a.emit("readable")}):this.read(0),this.emit("resume")},a.emit("readable")}function s(a,b){var c,d=b.buffer,e=b.length,f=!!b.decoder,g=!!b.objectMode;if(0===d.length)return null;if(0===e)c=null;else if(g)c=d.shift();else if(!a||a>=e)c=f?d.join(""):A.concat(d,e),d.length=0;else if(a<d[0].length){var h=d[0];c=h.slice(0,a),d[0]=h.slice(a)}else if(a===d[0].length)c=d.shift();else{c=f?"":new A(a);for(var i=0,j=0,k=d.length;k>j&&a>i;j++){var h=d[0],l=Math.min(a-i,h.length);f?c+=h.slice(0,l):h.copy(c,i,0,l),l<h.length?d[0]=h.slice(l):d.shift(),i+=l}}return c}function t(a){var b=a._readableState;if(b.length>0)throw new Error("endReadable called on non-empty stream");!b.endEmitted&&b.calledRead&&(b.ended=!0,B(function(){b.endEmitted||0!==b.length||(b.endEmitted=!0,a.readable=!1,a.emit("end"))}))}function u(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}function v(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}var w=a("__browserify_process");b.exports=d,d.ReadableState=c;var x,y=a("events").EventEmitter,z=a("./index.js"),A=a("buffer").Buffer,B=a("process/browser.js").nextTick,C=a("inherits");C(d,z),d.prototype.push=function(a,b){var c=this._readableState;
return"string"!=typeof a||c.objectMode||(b=b||c.defaultEncoding,b!==c.encoding&&(a=new A(a,b),b="")),e(this,c,a,b,!1)},d.prototype.unshift=function(a){var b=this._readableState;return e(this,b,a,"",!0)},d.prototype.setEncoding=function(b){x||(x=a("string_decoder").StringDecoder),this._readableState.decoder=new x(b),this._readableState.encoding=b};var D=8388608;d.prototype.read=function(a){var b=this._readableState;b.calledRead=!0;var c=a;if(("number"!=typeof a||a>0)&&(b.emittedReadable=!1),0===a&&b.needReadable&&(b.length>=b.highWaterMark||b.ended))return k(this),null;if(a=h(a,b),0===a&&b.ended)return 0===b.length&&t(this),null;var d=b.needReadable;b.length-a<=b.highWaterMark&&(d=!0),(b.ended||b.reading)&&(d=!1),d&&(b.reading=!0,b.sync=!0,0===b.length&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1),d&&!b.reading&&(a=h(c,b));var e;return e=a>0?s(a,b):null,null===e&&(b.needReadable=!0,a=0),b.length-=a,0!==b.length||b.ended||(b.needReadable=!0),b.ended&&!b.endEmitted&&0===b.length&&t(this),e},d.prototype._read=function(){this.emit("error",new Error("not implemented"))},d.prototype.pipe=function(a,b){function c(a){a===j&&e()}function d(){a.end()}function e(){a.removeListener("close",g),a.removeListener("finish",h),a.removeListener("drain",n),a.removeListener("error",f),a.removeListener("unpipe",c),j.removeListener("end",d),j.removeListener("end",e),(!a._writableState||a._writableState.needDrain)&&n()}function f(b){i(),0===r&&0===y.listenerCount(a,"error")&&a.emit("error",b)}function g(){a.removeListener("finish",h),i()}function h(){a.removeListener("close",g),i()}function i(){j.unpipe(a)}var j=this,k=this._readableState;switch(k.pipesCount){case 0:k.pipes=a;break;case 1:k.pipes=[k.pipes,a];break;default:k.pipes.push(a)}k.pipesCount+=1;var l=(!b||b.end!==!1)&&a!==w.stdout&&a!==w.stderr,m=l?d:e;k.endEmitted?B(m):j.once("end",m),a.on("unpipe",c);var n=o(j);a.on("drain",n);var r=y.listenerCount(a,"error");return a.once("error",f),a.once("close",g),a.once("finish",h),a.emit("pipe",j),k.flowing||(this.on("readable",q),k.flowing=!0,B(function(){p(j)})),a},d.prototype.unpipe=function(a){var b=this._readableState;if(0===b.pipesCount)return this;if(1===b.pipesCount)return a&&a!==b.pipes?this:(a||(a=b.pipes),b.pipes=null,b.pipesCount=0,this.removeListener("readable",q),b.flowing=!1,a&&a.emit("unpipe",this),this);if(!a){var c=b.pipes,d=b.pipesCount;b.pipes=null,b.pipesCount=0,this.removeListener("readable",q),b.flowing=!1;for(var e=0;d>e;e++)c[e].emit("unpipe",this);return this}var e=v(b.pipes,a);return-1===e?this:(b.pipes.splice(e,1),b.pipesCount-=1,1===b.pipesCount&&(b.pipes=b.pipes[0]),a.emit("unpipe",this),this)},d.prototype.on=function(a,b){var c=z.prototype.on.call(this,a,b);if("data"!==a||this._readableState.flowing||r(this),"readable"===a&&this.readable){var d=this._readableState;d.readableListening||(d.readableListening=!0,d.emittedReadable=!1,d.needReadable=!0,d.reading?d.length&&k(this,d):this.read(0))}return c},d.prototype.addListener=d.prototype.on,d.prototype.resume=function(){r(this),this.read(0),this.emit("resume")},d.prototype.pause=function(){r(this,!0),this.emit("pause")},d.prototype.wrap=function(a){var b=this._readableState,c=!1,d=this;a.on("end",function(){if(b.decoder&&!b.ended){var a=b.decoder.end();a&&a.length&&d.push(a)}d.push(null)}),a.on("data",function(e){if(b.decoder&&(e=b.decoder.write(e)),e&&(b.objectMode||e.length)){var f=d.push(e);f||(c=!0,a.pause())}});for(var e in a)"function"==typeof a[e]&&"undefined"==typeof this[e]&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));var f=["error","close","destroy","pause","resume"];return u(f,function(b){a.on(b,function(a){return d.emit.apply(d,b,a)})}),d._read=function(){c&&(c=!1,a.resume())},d},d._fromList=s},{"./index.js":50,__browserify_process:40,buffer:41,events:33,inherits:38,"process/browser.js":51,string_decoder:56}],54:[function(a,b){function c(a,b){this.afterTransform=function(a,c){return d(b,a,c)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function d(a,b,c){var d=a._transformState;d.transforming=!1;var e=d.writecb;if(!e)return a.emit("error",new Error("no writecb in Transform class"));d.writechunk=null,d.writecb=null,null!==c&&void 0!==c&&a.push(c),e&&e(b);var f=a._readableState;f.reading=!1,(f.needReadable||f.length<f.highWaterMark)&&a._read(f.highWaterMark)}function e(a){if(!(this instanceof e))return new e(a);g.call(this,a);var b=(this._transformState=new c(a,this),this);this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(a){f(b,a)}):f(b)})}function f(a,b){if(b)return a.emit("error",b);var c=a._writableState,d=(a._readableState,a._transformState);if(c.length)throw new Error("calling transform done when ws.length != 0");if(d.transforming)throw new Error("calling transform done when still transforming");return a.push(null)}b.exports=e;var g=a("./duplex.js"),h=a("inherits");h(e,g),e.prototype.push=function(a,b){return this._transformState.needTransform=!1,g.prototype.push.call(this,a,b)},e.prototype._transform=function(){throw new Error("not implemented")},e.prototype._write=function(a,b,c){var d=this._transformState;if(d.writecb=c,d.writechunk=a,d.writeencoding=b,!d.transforming){var e=this._readableState;(d.needTransform||e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark)}},e.prototype._read=function(){var a=this._transformState;a.writechunk&&a.writecb&&!a.transforming?(a.transforming=!0,this._transform(a.writechunk,a.writeencoding,a.afterTransform)):a.needTransform=!0}},{"./duplex.js":49,inherits:38}],55:[function(a,b){function c(a,b,c){this.chunk=a,this.encoding=b,this.callback=c}function d(a,b){a=a||{};var c=a.highWaterMark;this.highWaterMark=c||0===c?c:16384,this.objectMode=!!a.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var d=a.decodeStrings===!1;this.decodeStrings=!d,this.defaultEncoding=a.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){m(b,a)},this.writecb=null,this.writelen=0,this.buffer=[]}function e(a){return this instanceof e||this instanceof w.Duplex?(this._writableState=new d(a,this),this.writable=!0,w.call(this),void 0):new e(a)}function f(a,b,c){var d=new Error("write after end");a.emit("error",d),x(function(){c(d)})}function g(a,b,c,d){var e=!0;if(!y.isBuffer(c)&&"string"!=typeof c&&null!==c&&void 0!==c&&!b.objectMode){var f=new TypeError("Invalid non-string/buffer chunk");a.emit("error",f),x(function(){d(f)}),e=!1}return e}function h(a,b,c){return a.objectMode||a.decodeStrings===!1||"string"!=typeof b||(b=new y(b,c)),b}function i(a,b,d,e,f){d=h(b,d,e);var g=b.objectMode?1:d.length;b.length+=g;var i=b.length<b.highWaterMark;return b.needDrain=!i,b.writing?b.buffer.push(new c(d,e,f)):j(a,b,g,d,e,f),i}function j(a,b,c,d,e,f){b.writelen=c,b.writecb=f,b.writing=!0,b.sync=!0,a._write(d,e,b.onwrite),b.sync=!1}function k(a,b,c,d,e){c?x(function(){e(d)}):e(d),a.emit("error",d)}function l(a){a.writing=!1,a.writecb=null,a.length-=a.writelen,a.writelen=0}function m(a,b){var c=a._writableState,d=c.sync,e=c.writecb;if(l(c),b)k(a,c,d,b,e);else{var f=q(a,c);f||c.bufferProcessing||!c.buffer.length||p(a,c),d?x(function(){n(a,c,f,e)}):n(a,c,f,e)}}function n(a,b,c,d){c||o(a,b),d(),c&&r(a,b)}function o(a,b){0===b.length&&b.needDrain&&(b.needDrain=!1,a.emit("drain"))}function p(a,b){b.bufferProcessing=!0;for(var c=0;c<b.buffer.length;c++){var d=b.buffer[c],e=d.chunk,f=d.encoding,g=d.callback,h=b.objectMode?1:e.length;if(j(a,b,h,e,f,g),b.writing){c++;break}}b.bufferProcessing=!1,c<b.buffer.length?b.buffer=b.buffer.slice(c):b.buffer.length=0}function q(a,b){return b.ending&&0===b.length&&!b.finished&&!b.writing}function r(a,b){var c=q(a,b);return c&&(b.finished=!0,a.emit("finish")),c}function s(a,b,c){b.ending=!0,r(a,b),c&&(b.finished?x(c):a.once("finish",c)),b.ended=!0}b.exports=e,e.WritableState=d;var t="undefined"!=typeof Uint8Array?function(a){return a instanceof Uint8Array}:function(a){return a&&a.constructor&&"Uint8Array"===a.constructor.name},u="undefined"!=typeof ArrayBuffer?function(a){return a instanceof ArrayBuffer}:function(a){return a&&a.constructor&&"ArrayBuffer"===a.constructor.name},v=a("inherits"),w=a("./index.js"),x=a("process/browser.js").nextTick,y=a("buffer").Buffer;v(e,w),e.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},e.prototype.write=function(a,b,c){var d=this._writableState,e=!1;return"function"==typeof b&&(c=b,b=null),t(a)&&(a=new y(a)),u(a)&&"undefined"!=typeof Uint8Array&&(a=new y(new Uint8Array(a))),y.isBuffer(a)?b="buffer":b||(b=d.defaultEncoding),"function"!=typeof c&&(c=function(){}),d.ended?f(this,d,c):g(this,d,a,c)&&(e=i(this,d,a,b,c)),e},e.prototype._write=function(a,b,c){c(new Error("not implemented"))},e.prototype.end=function(a,b,c){var d=this._writableState;"function"==typeof a?(c=a,a=null,b=null):"function"==typeof b&&(c=b,b=null),"undefined"!=typeof a&&null!==a&&this.write(a,b),d.ending||d.finished||s(this,d,c)}},{"./index.js":50,buffer:41,inherits:38,"process/browser.js":51}],56:[function(a,b,c){function d(a){if(a&&!h.isEncoding(a))throw new Error("Unknown encoding: "+a)}function e(a){return a.toString(this.encoding)}function f(a){var b=this.charReceived=a.length%2;return this.charLength=b?2:0,b}function g(a){var b=this.charReceived=a.length%3;return this.charLength=b?3:0,b}var h=a("buffer").Buffer,i=c.StringDecoder=function(a){switch(this.encoding=(a||"utf8").toLowerCase().replace(/[-_]/,""),d(a),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=f;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=g;break;default:return this.write=e,void 0}this.charBuffer=new h(6),this.charReceived=0,this.charLength=0};i.prototype.write=function(a){for(var b="",c=0;this.charLength;){var d=a.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:a.length;if(a.copy(this.charBuffer,this.charReceived,c,d),this.charReceived+=d-c,c=d,this.charReceived<this.charLength)return"";b=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var e=b.charCodeAt(b.length-1);if(!(e>=55296&&56319>=e)){if(this.charReceived=this.charLength=0,d==a.length)return b;a=a.slice(d,a.length);break}this.charLength+=this.surrogateSize,b=""}var f=this.detectIncompleteChar(a),g=a.length;this.charLength&&(a.copy(this.charBuffer,0,a.length-f,g),this.charReceived=f,g-=f),b+=a.toString(this.encoding,0,g);var g=b.length-1,e=b.charCodeAt(g);if(e>=55296&&56319>=e){var h=this.surrogateSize;return this.charLength+=h,this.charReceived+=h,this.charBuffer.copy(this.charBuffer,h,0,h),this.charBuffer.write(b.charAt(b.length-1),this.encoding),b.substring(0,g)}return b},i.prototype.detectIncompleteChar=function(a){for(var b=a.length>=3?3:a.length;b>0;b--){var c=a[a.length-b];if(1==b&&c>>5==6){this.charLength=2;break}if(2>=b&&c>>4==14){this.charLength=3;break}if(3>=b&&c>>3==30){this.charLength=4;break}}return b},i.prototype.end=function(a){var b="";if(a&&a.length&&(b=this.write(a)),this.charReceived){var c=this.charReceived,d=this.charBuffer,e=this.encoding;b+=d.slice(0,c).toString(e)}return b}},{buffer:41}],57:[function(a,b,c){!function(){"use strict";function b(a,b,c){if(a&&"object"==typeof a&&a.href)return a;if("string"!=typeof a)throw new TypeError("Parameter 'url' must be a string, not "+typeof a);var e={},f=a;f=f.trim();var j=i.exec(f);if(j){j=j[0];var k=j.toLowerCase();e.protocol=k,f=f.substr(j.length)}if(c||j||f.match(/^\/\/[^@\/]+@[^@\/]+/)){var l="//"===f.substr(0,2);!l||j&&t[j]||(f=f.substr(2),e.slashes=!0)}if(!t[j]&&(l||j&&!u[j])){var w=f.indexOf("@");if(-1!==w){for(var x=f.slice(0,w),y=!0,z=0,A=o.length;A>z;z++)if(-1!==x.indexOf(o[z])){y=!1;break}y&&(e.auth=decodeURIComponent(x),f=f.substr(w+1))}for(var B=-1,z=0,A=n.length;A>z;z++){var C=f.indexOf(n[z]);-1!==C&&(0>B||B>C)&&(B=C)}-1!==B?(e.host=f.substr(0,B),f=f.substr(B)):(e.host=f,f="");for(var D=g(e.host),E=Object.keys(D),z=0,A=E.length;A>z;z++){var F=E[z];e[F]=D[F]}e.hostname=e.hostname||"";var G="["===e.hostname[0]&&"]"===e.hostname[e.hostname.length-1];if(e.hostname.length>p)e.hostname="";else if(!G)for(var H=e.hostname.split(/\./),z=0,A=H.length;A>z;z++){var I=H[z];if(I&&!I.match(q)){for(var J="",K=0,L=I.length;L>K;K++)J+=I.charCodeAt(K)>127?"x":I[K];if(!J.match(q)){var M=H.slice(0,z),N=H.slice(z+1),O=I.match(r);O&&(M.push(O[1]),N.unshift(O[2])),N.length&&(f="/"+N.join(".")+f),e.hostname=M.join(".");break}}}if(e.hostname=e.hostname.toLowerCase(),!G){for(var P=e.hostname.split("."),Q=[],z=0;z<P.length;++z){var R=P[z];Q.push(R.match(/[^A-Za-z0-9_-]/)?"xn--"+h.encode(R):R)}e.hostname=Q.join(".")}e.host=(e.hostname||"")+(e.port?":"+e.port:""),e.href+=e.host,G&&(e.hostname=e.hostname.substr(1,e.hostname.length-2),"/"!==f[0]&&(f="/"+f))}if(!s[k])for(var z=0,A=m.length;A>z;z++){var S=m[z],T=encodeURIComponent(S);T===S&&(T=escape(S)),f=f.split(S).join(T)}var U=f.indexOf("#");-1!==U&&(e.hash=f.substr(U),f=f.slice(0,U));var V=f.indexOf("?");return-1!==V?(e.search=f.substr(V),e.query=f.substr(V+1),b&&(e.query=v.parse(e.query)),f=f.slice(0,V)):b&&(e.search="",e.query={}),f&&(e.pathname=f),u[j]&&e.hostname&&!e.pathname&&(e.pathname="/"),(e.pathname||e.search)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=d(e),e}function d(a){"string"==typeof a&&(a=b(a));var c=a.auth||"";c&&(c=encodeURIComponent(c),c=c.replace(/%3A/i,":"),c+="@");var d=a.protocol||"",e=a.pathname||"",f=a.hash||"",g=!1,h="";void 0!==a.host?g=c+a.host:void 0!==a.hostname&&(g=c+(-1===a.hostname.indexOf(":")?a.hostname:"["+a.hostname+"]"),a.port&&(g+=":"+a.port)),a.query&&"object"==typeof a.query&&Object.keys(a.query).length&&(h=v.stringify(a.query));var i=a.search||h&&"?"+h||"";return d&&":"!==d.substr(-1)&&(d+=":"),a.slashes||(!d||u[d])&&g!==!1?(g="//"+(g||""),e&&"/"!==e.charAt(0)&&(e="/"+e)):g||(g=""),f&&"#"!==f.charAt(0)&&(f="#"+f),i&&"?"!==i.charAt(0)&&(i="?"+i),d+g+e+i+f}function e(a,b){return d(f(a,b))}function f(a,c){if(!a)return c;if(a=b(d(a),!1,!0),c=b(d(c),!1,!0),a.hash=c.hash,""===c.href)return a.href=d(a),a;if(c.slashes&&!c.protocol)return c.protocol=a.protocol,u[c.protocol]&&c.hostname&&!c.pathname&&(c.path=c.pathname="/"),c.href=d(c),c;if(c.protocol&&c.protocol!==a.protocol){if(!u[c.protocol])return c.href=d(c),c;if(a.protocol=c.protocol,!c.host&&!t[c.protocol]){for(var e=(c.pathname||"").split("/");e.length&&!(c.host=e.shift()););c.host||(c.host=""),c.hostname||(c.hostname=""),""!==e[0]&&e.unshift(""),e.length<2&&e.unshift(""),c.pathname=e.join("/")}return a.pathname=c.pathname,a.search=c.search,a.query=c.query,a.host=c.host||"",a.auth=c.auth,a.hostname=c.hostname||c.host,a.port=c.port,(void 0!==a.pathname||void 0!==a.search)&&(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.slashes=a.slashes||c.slashes,a.href=d(a),a}var f=a.pathname&&"/"===a.pathname.charAt(0),g=void 0!==c.host||c.pathname&&"/"===c.pathname.charAt(0),h=g||f||a.host&&c.pathname,i=h,j=a.pathname&&a.pathname.split("/")||[],e=c.pathname&&c.pathname.split("/")||[],k=a.protocol&&!u[a.protocol];if(k&&(delete a.hostname,delete a.port,a.host&&(""===j[0]?j[0]=a.host:j.unshift(a.host)),delete a.host,c.protocol&&(delete c.hostname,delete c.port,c.host&&(""===e[0]?e[0]=c.host:e.unshift(c.host)),delete c.host),h=h&&(""===e[0]||""===j[0])),g)a.host=c.host||""===c.host?c.host:a.host,a.hostname=c.hostname||""===c.hostname?c.hostname:a.hostname,a.search=c.search,a.query=c.query,j=e;else if(e.length)j||(j=[]),j.pop(),j=j.concat(e),a.search=c.search,a.query=c.query;else if("search"in c){if(k){a.hostname=a.host=j.shift();var l=a.host&&a.host.indexOf("@")>0?a.host.split("@"):!1;l&&(a.auth=l.shift(),a.host=a.hostname=l.shift())}return a.search=c.search,a.query=c.query,(void 0!==a.pathname||void 0!==a.search)&&(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=d(a),a}if(!j.length)return delete a.pathname,a.search?delete a.path:a.path="/"+a.search,a.href=d(a),a;for(var m=j.slice(-1)[0],n=(a.host||c.host)&&("."===m||".."===m)||""===m,o=0,p=j.length;p>=0;p--)m=j[p],"."==m?j.splice(p,1):".."===m?(j.splice(p,1),o++):o&&(j.splice(p,1),o--);if(!h&&!i)for(;o--;o)j.unshift("..");!h||""===j[0]||j[0]&&"/"===j[0].charAt(0)||j.unshift(""),n&&"/"!==j.join("/").substr(-1)&&j.push("");var q=""===j[0]||j[0]&&"/"===j[0].charAt(0);if(k){a.hostname=a.host=q?"":j.length?j.shift():"";var l=a.host&&a.host.indexOf("@")>0?a.host.split("@"):!1;l&&(a.auth=l.shift(),a.host=a.hostname=l.shift())}return h=h||a.host&&j.length,h&&!q&&j.unshift(""),a.pathname=j.join("/"),(void 0!==a.pathname||void 0!==a.search)&&(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=c.auth||a.auth,a.slashes=a.slashes||c.slashes,a.href=d(a),a}function g(a){var b={},c=j.exec(a);return c&&(c=c[0],":"!==c&&(b.port=c.substr(1)),a=a.substr(0,a.length-c.length)),a&&(b.hostname=a),b}var h=a("punycode");c.parse=b,c.resolve=e,c.resolveObject=f,c.format=d;var i=/^([a-z0-9.+-]+:)/i,j=/:[0-9]*$/,k=["<",">",'"',"`"," ","\r","\n","	"],l=["{","}","|","\\","^","~","`"].concat(k),m=["'"].concat(k),n=["%","/","?",";","#"].concat(l).concat(m),o=["/","@","?","#"].concat(k),p=255,q=/^[a-zA-Z0-9][a-z0-9A-Z_-]{0,62}$/,r=/^([a-zA-Z0-9][a-z0-9A-Z_-]{0,62})(.*)$/,s={javascript:!0,"javascript:":!0},t={javascript:!0,"javascript:":!0},u={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=a("querystring")}()},{punycode:45,querystring:48}],58:[function(a,b){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],59:[function(a,b,c){function d(a,b){var d={seen:[],stylize:f};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),o(b)?d.showHidden=b:b&&c._extend(d,b),u(d.showHidden)&&(d.showHidden=!1),u(d.depth)&&(d.depth=2),u(d.colors)&&(d.colors=!1),u(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=e),h(d,a,d.depth)}function e(a,b){var c=d.styles[b];return c?"["+d.colors[c][0]+"m"+a+"["+d.colors[c][1]+"m":a}function f(a){return a}function g(a){var b={};return a.forEach(function(a){b[a]=!0}),b}function h(a,b,d){if(a.customInspect&&b&&z(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return s(e)||(e=h(a,e,d)),e}var f=i(a,b);if(f)return f;var o=Object.keys(b),p=g(o);if(a.showHidden&&(o=Object.getOwnPropertyNames(b)),y(b)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return j(b);if(0===o.length){if(z(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(v(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(x(b))return a.stylize(Date.prototype.toString.call(b),"date");if(y(b))return j(b)}var r="",t=!1,u=["{","}"];if(n(b)&&(t=!0,u=["[","]"]),z(b)){var w=b.name?": "+b.name:"";r=" [Function"+w+"]"}if(v(b)&&(r=" "+RegExp.prototype.toString.call(b)),x(b)&&(r=" "+Date.prototype.toUTCString.call(b)),y(b)&&(r=" "+j(b)),0===o.length&&(!t||0==b.length))return u[0]+r+u[1];if(0>d)return v(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var A;return A=t?k(a,b,d,p,o):o.map(function(c){return l(a,b,d,p,c,t)}),a.seen.pop(),m(A,r,u)}function i(a,b){if(u(b))return a.stylize("undefined","undefined");if(s(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return r(b)?a.stylize(""+b,"number"):o(b)?a.stylize(""+b,"boolean"):p(b)?a.stylize("null","null"):void 0}function j(a){return"["+Error.prototype.toString.call(a)+"]"}function k(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)E(b,String(g))?f.push(l(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(l(a,b,c,d,e,!0))}),f}function l(a,b,c,d,e,f){var g,i,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?i=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(i=a.stylize("[Setter]","special")),E(d,e)||(g="["+e+"]"),i||(a.seen.indexOf(j.value)<0?(i=p(c)?h(a,j.value,null):h(a,j.value,c-1),i.indexOf("\n")>-1&&(i=f?i.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+i.split("\n").map(function(a){return"   "+a}).join("\n"))):i=a.stylize("[Circular]","special")),u(g)){if(f&&e.match(/^\d+$/))return i;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+i}function m(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function n(a){return Array.isArray(a)}function o(a){return"boolean"==typeof a}function p(a){return null===a}function q(a){return null==a}function r(a){return"number"==typeof a}function s(a){return"string"==typeof a}function t(a){return"symbol"==typeof a}function u(a){return void 0===a}function v(a){return w(a)&&"[object RegExp]"===B(a)}function w(a){return"object"==typeof a&&null!==a}function x(a){return w(a)&&"[object Date]"===B(a)}function y(a){return w(a)&&("[object Error]"===B(a)||a instanceof Error)}function z(a){return"function"==typeof a}function A(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function B(a){return Object.prototype.toString.call(a)}function C(a){return 10>a?"0"+a.toString(10):a.toString(10)}function D(){var a=new Date,b=[C(a.getHours()),C(a.getMinutes()),C(a.getSeconds())].join(":");return[a.getDate(),K[a.getMonth()],b].join(" ")}function E(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var F=a("__browserify_process"),G="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},H=/%[sdj%]/g;c.format=function(a){if(!s(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(d(arguments[c]));return b.join(" ")}for(var c=1,e=arguments,f=e.length,g=String(a).replace(H,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(e[c++]);case"%d":return Number(e[c++]);case"%j":try{return JSON.stringify(e[c++])}catch(b){return"[Circular]"}default:return a}}),h=e[c];f>c;h=e[++c])g+=p(h)||!w(h)?" "+h:" "+d(h);return g},c.deprecate=function(a,b){function d(){if(!e){if(F.throwDeprecation)throw new Error(b);F.traceDeprecation?console.trace(b):console.error(b),e=!0}return a.apply(this,arguments)}if(u(G.process))return function(){return c.deprecate(a,b).apply(this,arguments)};if(F.noDeprecation===!0)return a;var e=!1;return d};var I,J={};c.debuglog=function(a){if(u(I)&&(I=F.env.NODE_DEBUG||""),a=a.toUpperCase(),!J[a])if(new RegExp("\\b"+a+"\\b","i").test(I)){var b=F.pid;J[a]=function(){var d=c.format.apply(c,arguments);console.error("%s %d: %s",a,b,d)}}else J[a]=function(){};return J[a]},c.inspect=d,d.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},d.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=n,c.isBoolean=o,c.isNull=p,c.isNullOrUndefined=q,c.isNumber=r,c.isString=s,c.isSymbol=t,c.isUndefined=u,c.isRegExp=v,c.isObject=w,c.isDate=x,c.isError=y,c.isFunction=z,c.isPrimitive=A,c.isBuffer=a("./support/isBuffer");var K=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",D(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!w(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}},{"./support/isBuffer":58,__browserify_process:40,inherits:38}],60:[function(a,b){var c=b.exports=function(a,b){if(b||(b=16),void 0===a&&(a=128),0>=a)return"0";for(var d=Math.log(Math.pow(2,a))/Math.log(b),e=2;1/0===d;e*=2)d=Math.log(Math.pow(2,a/e))/Math.log(b)*e;for(var f=d-Math.floor(d),g="",e=0;e<Math.floor(d);e++){var h=Math.floor(Math.random()*b).toString(b);g=h+g}if(f){var i=Math.pow(b,f),h=Math.floor(Math.random()*i).toString(b);g=h+g}var j=parseInt(g,b);return 1/0!==j&&j>=Math.pow(2,a)?c(a,b):g};c.rack=function(a,b,d){var e=function(e){var g=0;do{if(g++>10){if(!d)throw new Error("too many ID collisions, use more bits");a+=d}var h=c(a,b)}while(Object.hasOwnProperty.call(f,h));return f[h]=e,h},f=e.hats={};return e.get=function(a){return e.hats[a]},e.set=function(a,b){return e.hats[a]=b,e},e.bits=a||128,e.base=b||16,e}},{}],61:[function(a,b){function c(a){var b=this;a||(a={}),a.container||(a.container=document.body);var c=a.container.querySelector(".left"),e=a.container.querySelector(".right");c&&(a.container=c);var f={value:"// hello world\n",mode:"javascript",theme:"mistakes",lineNumbers:!0,autofocus:window===window.top,matchBrackets:!0,indentWithTabs:!1,smartIndent:!0,tabSize:2,indentUnit:2,updateInterval:500,dragAndDrop:!0,injectStyles:!1};this.opts=j({},f,a),this.editor=l(this.opts.container,this.opts),this.editor.setOption("theme",a.theme),this.editor.setCursor(this.editor.lineCount(),0),this.editor.on("change",function(){b.emit("change"),b.interval&&clearTimeout(b.interval),b.interval=setTimeout(b.update.bind(b),b.opts.updateInterval)}),this.element=this.editor.getWrapperElement(),this.errorLines=[],e&&(this.results=l(e,{mode:"javascript",tabSize:2,readOnly:"nocursor"}),this.results.setOption("theme",a.theme)),this.update(),this.opts.dragAndDrop&&this.addDropHandler(),this.opts.injectStyles&&(window.__jsEditor=this,d())}function d(){["./css/codemirror.css","./css/style.css","./css/theme.css"].forEach(function(a){var b=g.join(f,a);e(b)})}function e(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet"),b.setAttribute("type","text/css"),b.setAttribute("href",a),b.setAttribute("onload","__jsEditor.refresh()"),document.getElementsByTagName("head")[0].appendChild(b)}var f="/node_modules/javascript-editor",g=a("path"),h=a("events"),i=a("inherits"),j=a("extend"),k=a("esprima"),l=a("codemirror");a("./javascript")(l),b.exports=function(a){return new c(a)},i(c,h.EventEmitter),c.prototype.refresh=function(){this.editor.refresh()},c.prototype.update=function(){var a=this.validate(this.editor.getValue());return this.emit("valid",a),a},c.prototype.validate=function(a){for(var b=this;b.errorLines.length>0;)b.editor.removeLineClass(b.errorLines.shift().num,"background","errorLine");try{for(var c=k.parse(a,{tolerant:!0,loc:!0}).errors,d=0;d<c.length;d++){var e=c[d],f=e.lineNumber-1;b.errorLines.push({num:f,message:e.message}),b.editor.addLineClass(f,"background","errorLine")}}catch(e){var f=e.lineNumber-1;b.errorLines.push({num:f,message:e.message}),b.editor.addLineClass(f,"background","errorLine")}if(this.results){if(0===b.errorLines.length)return this.results.setValue("");for(var g=b.errorLines[b.errorLines.length-1].num,h=[],d=0;g>d;d++)h[d]="";b.errorLines.map(function(a){h[a.num]=a.message}),this.results.setValue(h.join("\n"))}return 0===b.errorLines.length},c.prototype.addDropHandler=function(){var a=this;this.element.addEventListener("drop",function(b){b.preventDefault(),b.stopPropagation();var c=b.dataTransfer.files[0],d=new FileReader;d.onload=function(b){a.editor.setValue(b.target.result)},d.readAsText(c)},!1)},c.prototype.getValue=function(){return this.editor.getValue()},c.prototype.setValue=function(a){return this.editor.setValue(a)}},{"./javascript":62,codemirror:63,esprima:64,events:33,extend:65,inherits:66,path:44}],62:[function(a,b){b.exports=function(a){a.defineMode("javascript",function(b,c){function d(a,b,c){return b.tokenize=c,c(a,b)}function e(a,b){for(var c,d=!1;null!=(c=a.next());){if(c==b&&!d)return!1;d=!d&&"\\"==c}return d}function f(a,b,c){return N=a,O=c,b}function g(a,b){var c=a.next();if('"'==c||"'"==c)return d(a,b,h(c));if(/[\[\]{}\(\),;\:\.]/.test(c))return f(c);if("0"==c&&a.eat(/x/i))return a.eatWhile(/[\da-f]/i),f("number","number");if(/\d/.test(c)||"-"==c&&a.eat(/\d/))return a.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),f("number","number");if("/"==c)return a.eat("*")?d(a,b,i):a.eat("/")?(a.skipToEnd(),f("comment","comment")):"operator"==b.lastType||"keyword c"==b.lastType||/^[\[{}\(,;:]$/.test(b.lastType)?(e(a,"/"),a.eatWhile(/[gimy]/),f("regexp","string-2")):(a.eatWhile(T),f("operator",null,a.current()));if("#"==c)return a.skipToEnd(),f("error","error");if(T.test(c))return a.eatWhile(T),f("operator",null,a.current());a.eatWhile(/[\w\$_]/);var g=a.current(),j=S.propertyIsEnumerable(g)&&S[g];return j&&"."!=b.lastType?f(j.type,j.style,g):f("variable","variable",g)}function h(a){return function(b,c){return e(b,a)||(c.tokenize=g),f("string","string")}}function i(a,b){for(var c,d=!1;c=a.next();){if("/"==c&&d){b.tokenize=g;break}d="*"==c}return f("comment","comment")}function j(a,b,c,d,e,f){this.indented=a,this.column=b,this.type=c,this.prev=e,this.info=f,null!=d&&(this.align=d)}function k(a,b){for(var c=a.localVars;c;c=c.next)if(c.name==b)return!0}function l(a,b,c,d,e){var f=a.cc;for(V.state=a,V.stream=e,V.marked=null,V.cc=f,a.lexical.hasOwnProperty("align")||(a.lexical.align=!0);;){var g=f.length?f.pop():Q?v:u;if(g(c,d)){for(;f.length&&f[f.length-1].lex;)f.pop()();return V.marked?V.marked:"variable"==c&&k(a,d)?"variable-2":b}}}function m(){for(var a=arguments.length-1;a>=0;a--)V.cc.push(arguments[a])}function n(){return m.apply(null,arguments),!0}function o(a){function b(b){for(var c=b;c;c=c.next)if(c.name==a)return!0;return!1}var c=V.state;if(c.context){if(V.marked="def",b(c.localVars))return;c.localVars={name:a,next:c.localVars}}else{if(b(c.globalVars))return;c.globalVars={name:a,next:c.globalVars}}}function p(){V.state.context={prev:V.state.context,vars:V.state.localVars},V.state.localVars=W}function q(){V.state.localVars=V.state.context.vars,V.state.context=V.state.context.prev}function r(a,b){var c=function(){var c=V.state;c.lexical=new j(c.indented,V.stream.column(),a,null,c.lexical,b)};return c.lex=!0,c}function s(){var a=V.state;a.lexical.prev&&(")"==a.lexical.type&&(a.indented=a.lexical.indented),a.lexical=a.lexical.prev)}function t(a){return function(b){return b==a?n():";"==a?m():n(arguments.callee)}}function u(a){return"var"==a?n(r("vardef"),F,t(";"),s):"keyword a"==a?n(r("form"),v,u,s):"keyword b"==a?n(r("form"),u,s):"{"==a?n(r("}"),C,s):";"==a?n():"function"==a?n(L):"for"==a?n(r("form"),t("("),r(")"),H,t(")"),s,u,s):"variable"==a?n(r("stat"),y):"switch"==a?n(r("form"),v,r("}","switch"),t("{"),C,s,s):"case"==a?n(v,t(":")):"default"==a?n(t(":")):"catch"==a?n(r("form"),p,t("("),M,t(")"),u,s,q):m(r("stat"),v,t(";"),s)}function v(a){return U.hasOwnProperty(a)?n(x):"function"==a?n(L):"keyword c"==a?n(w):"("==a?n(r(")"),w,t(")"),s,x):"operator"==a?n(v):"["==a?n(r("]"),B(v,"]"),s,x):"{"==a?n(r("}"),B(A,"}"),s,x):n()}function w(a){return a.match(/[;\}\)\],]/)?m():m(v)}function x(a,b){if("operator"==a)return/\+\+|--/.test(b)?n(x):"?"==b?n(v,t(":"),v):n(v);if(";"!=a)return"("==a?n(r(")"),B(v,")"),s,x):"."==a?n(z,x):"["==a?n(r("]"),v,t("]"),s,x):void 0}function y(a){return":"==a?n(s,u):m(x,t(";"),s)}function z(a){return"variable"==a?(V.marked="property",n()):void 0}function A(a){return"variable"==a?V.marked="property":("number"==a||"string"==a)&&(V.marked=a+" property"),U.hasOwnProperty(a)?n(t(":"),v):void 0}function B(a,b){function c(d){return","==d?n(a,c):d==b?n():n(t(b))}return function(d){return d==b?n():m(a,c)}}function C(a){return"}"==a?n():m(u,C)}function D(a){return":"==a?n(E):m()}function E(a){return"variable"==a?(V.marked="variable-3",n()):m()}function F(a,b){return"variable"==a?(o(b),R?n(D,G):n(G)):m()}function G(a,b){return"="==b?n(v,G):","==a?n(F):void 0}function H(a){return"var"==a?n(F,t(";"),J):";"==a?n(J):"variable"==a?n(I):n(J)
}function I(a,b){return"in"==b?n(v):n(x,J)}function J(a,b){return";"==a?n(K):"in"==b?n(v):n(v,t(";"),K)}function K(a){")"!=a&&n(v)}function L(a,b){return"variable"==a?(o(b),n(L)):"("==a?n(r(")"),p,B(M,")"),s,u,q):void 0}function M(a,b){return"variable"==a?(o(b),R?n(D):n()):void 0}var N,O,P=b.indentUnit,Q=c.json,R=c.typescript,S=function(){function a(a){return{type:a,style:"keyword"}}var b=a("keyword a"),c=a("keyword b"),d=a("keyword c"),e=a("operator"),f={type:"atom",style:"atom"},g={"if":b,"while":b,"with":b,"else":c,"do":c,"try":c,"finally":c,"return":d,"break":d,"continue":d,"new":d,"delete":d,"throw":d,"var":a("var"),"const":a("var"),let:a("var"),"function":a("function"),"catch":a("catch"),"for":a("for"),"switch":a("switch"),"case":a("case"),"default":a("default"),"in":e,"typeof":e,"instanceof":e,"true":f,"false":f,"null":f,undefined:f,NaN:f,Infinity:f};if(R){var h={type:"variable",style:"variable-3"},i={"interface":a("interface"),"class":a("class"),"extends":a("extends"),constructor:a("constructor"),"public":a("public"),"private":a("private"),"protected":a("protected"),"static":a("static"),"super":a("super"),string:h,number:h,bool:h,any:h};for(var j in i)g[j]=i[j]}return g}(),T=/[+\-*&%=<>!?|~^]/,U={atom:!0,number:!0,variable:!0,string:!0,regexp:!0},V={state:null,column:null,marked:null,cc:null},W={name:"this",next:{name:"arguments"}};return s.lex=!0,{startState:function(a){return{tokenize:g,lastType:null,cc:[],lexical:new j((a||0)-P,0,"block",!1),localVars:c.localVars,globalVars:c.globalVars,context:c.localVars&&{vars:c.localVars},indented:0}},token:function(a,b){if(a.sol()&&(b.lexical.hasOwnProperty("align")||(b.lexical.align=!1),b.indented=a.indentation()),a.eatSpace())return null;var c=b.tokenize(a,b);return"comment"==N?c:(b.lastType=N,l(b,c,N,O,a))},indent:function(b,c){if(b.tokenize==i)return a.Pass;if(b.tokenize!=g)return 0;var d=c&&c.charAt(0),e=b.lexical;"stat"==e.type&&"}"==d&&(e=e.prev);var f=e.type,h=d==f;return"vardef"==f?e.indented+("operator"==b.lastType||","==b.lastType?4:0):"form"==f&&"{"==d?e.indented:"form"==f?e.indented+P:"stat"==f?e.indented+("operator"==b.lastType||","==b.lastType?P:0):"switch"!=e.info||h?e.align?e.column+(h?0:1):e.indented+(h?0:P):e.indented+(/^(?:case|default)\b/.test(c)?P:2*P)},electricChars:":{}",jsonMode:Q}}),a.defineMIME("text/javascript","javascript"),a.defineMIME("text/ecmascript","javascript"),a.defineMIME("application/javascript","javascript"),a.defineMIME("application/ecmascript","javascript"),a.defineMIME("application/json",{name:"javascript",json:!0}),a.defineMIME("text/typescript",{name:"javascript",typescript:!0}),a.defineMIME("application/typescript",{name:"javascript",typescript:!0})}},{}],63:[function(a,b){!function(){"use strict";function a(b,d){if(!(this instanceof a))return new a(b,d);this.options=d=d||{};for(var e in Re)!d.hasOwnProperty(e)&&Re.hasOwnProperty(e)&&(d[e]=Re[e]);n(d);var f="string"==typeof d.value?0:d.value.first,g=this.display=c(b,f);g.wrapper.CodeMirror=this,k(this),d.autofocus&&!ze&&ib(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,draggingText:!1,highlight:new Ld},i(this),d.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");var h=d.value;"string"==typeof h&&(h=new bf(d.value,d.mode)),ab(this,fd)(this,h),me&&setTimeout(Ud(hb,this,!0),20),kb(this);var j;try{j=document.activeElement==g.input}catch(l){}j||d.autofocus&&!ze?setTimeout(Ud(Ab,this),20):Bb(this),ab(this,function(){for(var a in Qe)Qe.propertyIsEnumerable(a)&&Qe[a](this,d[a],Se);for(var b=0;b<We.length;++b)We[b](this)})()}function c(a,b){var c={},d=c.input=Xd("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none;");pe?d.style.width="1000px":d.setAttribute("wrap","off"),d.setAttribute("autocorrect","off"),d.setAttribute("autocapitalize","off"),c.inputDiv=Xd("div",[d],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),c.scrollbarH=Xd("div",[Xd("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),c.scrollbarV=Xd("div",[Xd("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),c.scrollbarFiller=Xd("div",null,"CodeMirror-scrollbar-filler"),c.lineDiv=Xd("div"),c.selectionDiv=Xd("div",null,null,"position: relative; z-index: 1"),c.cursor=Xd("div","","CodeMirror-cursor"),c.otherCursor=Xd("div","","CodeMirror-cursor CodeMirror-secondarycursor"),c.measure=Xd("div",null,"CodeMirror-measure"),c.lineSpace=Xd("div",[c.measure,c.selectionDiv,c.lineDiv,c.cursor,c.otherCursor],null,"position: relative; outline: none"),c.mover=Xd("div",[Xd("div",[c.lineSpace],"CodeMirror-lines")],null,"position: relative"),c.sizer=Xd("div",[c.mover],"CodeMirror-sizer"),c.heightForcer=Xd("div",null,null,"position: absolute; height: "+gf+"px; width: 1px;"),c.gutters=Xd("div",null,"CodeMirror-gutters"),c.lineGutter=null;var e=Xd("div",[c.sizer,c.heightForcer,c.gutters],null,"position: relative; min-height: 100%");return c.scroller=Xd("div",[e],"CodeMirror-scroll"),c.scroller.setAttribute("tabIndex","-1"),c.wrapper=Xd("div",[c.inputDiv,c.scrollbarH,c.scrollbarV,c.scrollbarFiller,c.scroller],"CodeMirror"),ne&&(c.gutters.style.zIndex=-1,c.scroller.style.paddingRight=0),a.appendChild?a.appendChild(c.wrapper):a(c.wrapper),ye&&(d.style.width="0px"),pe||(c.scroller.draggable=!0),ue?(c.inputDiv.style.height="1px",c.inputDiv.style.position="absolute"):ne&&(c.scrollbarH.style.minWidth=c.scrollbarV.style.minWidth="18px"),c.viewOffset=c.lastSizeC=0,c.showingFrom=c.showingTo=b,c.lineNumWidth=c.lineNumInnerWidth=c.lineNumChars=null,c.prevInput="",c.alignWidgets=!1,c.pollingFast=!1,c.poll=new Ld,c.draggingText=!1,c.cachedCharWidth=c.cachedTextHeight=null,c.measureLineCache=[],c.measureLineCachePos=0,c.inaccurateSelection=!1,c.maxLine=null,c.maxLineLength=0,c.maxLineChanged=!1,c.wheelDX=c.wheelDY=c.wheelStartX=c.wheelStartY=null,c}function d(b){b.doc.mode=a.getMode(b.options,b.doc.modeOption),b.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null)}),b.doc.frontier=b.doc.first,G(b,100),b.state.modeGen++,b.curOp&&db(b)}function e(a){a.options.lineWrapping?(a.display.wrapper.className+=" CodeMirror-wrap",a.display.sizer.style.minWidth=""):(a.display.wrapper.className=a.display.wrapper.className.replace(" CodeMirror-wrap",""),m(a)),g(a),db(a),R(a),setTimeout(function(){o(a.display,a.doc.height)},100)}function f(a){var b=Y(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/Z(a.display)-3);return function(e){return Jc(a.doc,e)?0:c?(Math.ceil(e.text.length/d)||1)*b:b}}function g(a){var b=a.doc,c=f(a);b.iter(function(a){var b=c(a);b!=a.height&&jd(a,b)})}function h(a){var b=Ye[a.options.keyMap].style;a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(b?" cm-keymap-"+b:"")}function i(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-"),R(a)}function j(a){k(a),db(a)}function k(a){var b=a.display.gutters,c=a.options.gutters;Yd(b);for(var d=0;d<c.length;++d){var e=c[d],f=b.appendChild(Xd("div",null,"CodeMirror-gutter "+e));"CodeMirror-linenumbers"==e&&(a.display.lineGutter=f,f.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none"}function l(a,b){if(0==b.height)return 0;for(var c,d=b.text.length,e=b;c=Gc(e);){var f=c.find();e=gd(a,f.from.line),d+=f.from.ch-f.to.ch}for(e=b;c=Hc(e);){var f=c.find();d-=e.text.length-f.from.ch,e=gd(a,f.to.line),d+=e.text.length-f.to.ch}return d}function m(a){var b=a.display,c=a.doc;b.maxLine=gd(c,c.first),b.maxLineLength=l(c,b.maxLine),b.maxLineChanged=!0,c.iter(function(a){var d=l(c,a);d>b.maxLineLength&&(b.maxLineLength=d,b.maxLine=a)})}function n(a){for(var b=!1,c=0;c<a.gutters.length;++c)"CodeMirror-linenumbers"==a.gutters[c]&&(a.lineNumbers?b=!0:a.gutters.splice(c--,1));!b&&a.lineNumbers&&a.gutters.push("CodeMirror-linenumbers")}function o(a,b){var c=b+2*K(a);a.sizer.style.minHeight=a.heightForcer.style.top=c+"px";var d=Math.max(c,a.scroller.scrollHeight),e=a.scroller.scrollWidth>a.scroller.clientWidth,f=d>a.scroller.clientHeight;f?(a.scrollbarV.style.display="block",a.scrollbarV.style.bottom=e?ae(a.measure)+"px":"0",a.scrollbarV.firstChild.style.height=d-a.scroller.clientHeight+a.scrollbarV.clientHeight+"px"):a.scrollbarV.style.display="",e?(a.scrollbarH.style.display="block",a.scrollbarH.style.right=f?ae(a.measure)+"px":"0",a.scrollbarH.firstChild.style.width=a.scroller.scrollWidth-a.scroller.clientWidth+a.scrollbarH.clientWidth+"px"):a.scrollbarH.style.display="",e&&f?(a.scrollbarFiller.style.display="block",a.scrollbarFiller.style.height=a.scrollbarFiller.style.width=ae(a.measure)+"px"):a.scrollbarFiller.style.display="",ve&&0===ae(a.measure)&&(a.scrollbarV.style.minWidth=a.scrollbarH.style.minHeight=we?"18px":"12px")}function p(a,b,c){var d=a.scroller.scrollTop,e=a.wrapper.clientHeight;"number"==typeof c?d=c:c&&(d=c.top,e=c.bottom-c.top),d=Math.floor(d-K(a));var f=Math.ceil(d+e);return{from:ld(b,d),to:ld(b,f)}}function q(a){var b=a.display;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var c=t(b)-b.scroller.scrollLeft+a.doc.scrollLeft,d=b.gutters.offsetWidth,e=c+"px",f=b.lineDiv.firstChild;f;f=f.nextSibling)if(f.alignable)for(var g=0,h=f.alignable;g<h.length;++g)h[g].style.left=e;a.options.fixedGutter&&(b.gutters.style.left=c+d+"px")}}function r(a){if(!a.options.lineNumbers)return!1;var b=a.doc,c=s(a.options,b.first+b.size-1),d=a.display;if(c.length!=d.lineNumChars){var e=d.measure.appendChild(Xd("div",[Xd("div",c)],"CodeMirror-linenumber CodeMirror-gutter-elt")),f=e.firstChild.offsetWidth,g=e.offsetWidth-f;return d.lineGutter.style.width="",d.lineNumInnerWidth=Math.max(f,d.lineGutter.offsetWidth-g),d.lineNumWidth=d.lineNumInnerWidth+g,d.lineNumChars=d.lineNumInnerWidth?c.length:-1,d.lineGutter.style.width=d.lineNumWidth+"px",!0}return!1}function s(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function t(a){return _d(a.scroller).left-_d(a.sizer).left}function u(a,b,c){var d=a.display.showingFrom,e=a.display.showingTo,f=v(a,b,c);return f&&(Id(a,"update",a),(a.display.showingFrom!=d||a.display.showingTo!=e)&&Id(a,"viewportChange",a,a.display.showingFrom,a.display.showingTo)),C(a),o(a.display,a.doc.height),f}function v(a,b,c){var d=a.display,e=a.doc;if(!d.wrapper.clientWidth)return d.showingFrom=d.showingTo=e.first,d.viewOffset=0,void 0;var f=p(d,e,c);if(!(0==b.length&&f.from>d.showingFrom&&f.to<d.showingTo)){r(a)&&(b=[{from:e.first,to:e.first+e.size}]);var g=d.sizer.style.marginLeft=d.gutters.offsetWidth+"px";d.scrollbarH.style.left=a.options.fixedGutter?g:"0";var h=1/0;if(a.options.lineNumbers)for(var i=0;i<b.length;++i)if(b[i].diff){h=b[i].from;break}var j=e.first+e.size,k=Math.max(f.from-a.options.viewportMargin,e.first),l=Math.min(j,f.to+a.options.viewportMargin);if(d.showingFrom<k&&k-d.showingFrom<20&&(k=Math.max(e.first,d.showingFrom)),d.showingTo>l&&d.showingTo-l<20&&(l=Math.min(j,d.showingTo)),Je)for(k=kd(Ic(e,gd(e,k)));j>l&&Jc(e,gd(e,l));)++l;var m=[{from:Math.max(d.showingFrom,e.first),to:Math.min(d.showingTo,j)}];if(m=m[0].from>=m[0].to?[]:x(m,b),Je)for(var i=0;i<m.length;++i)for(var n,o=m[i];n=Hc(gd(e,o.to-1));){var q=n.find().from.line;if(!(q>o.from)){m.splice(i--,1);break}o.to=q}for(var s=0,i=0;i<m.length;++i){var o=m[i];o.from<k&&(o.from=k),o.to>l&&(o.to=l),o.from>=o.to?m.splice(i--,1):s+=o.to-o.from}if(s==l-k&&k==d.showingFrom&&l==d.showingTo)return w(a),void 0;m.sort(function(a,b){return a.from-b.from});var t=document.activeElement;.7*(l-k)>s&&(d.lineDiv.style.display="none"),z(a,k,l,m,h),d.lineDiv.style.display="",document.activeElement!=t&&t.offsetHeight&&t.focus();var u=k!=d.showingFrom||l!=d.showingTo||d.lastSizeC!=d.wrapper.clientHeight;u&&(d.lastSizeC=d.wrapper.clientHeight),d.showingFrom=k,d.showingTo=l,G(a,100);for(var y,A=d.lineDiv.offsetTop,B=d.lineDiv.firstChild;B;B=B.nextSibling)if(B.lineObj){if(ne){var C=B.offsetTop+B.offsetHeight;y=C-A,A=C}else{var D=_d(B);y=D.bottom-D.top}var E=B.lineObj.height-y;if(2>y&&(y=Y(d)),E>.001||-.001>E){jd(B.lineObj,y);var F=B.lineObj.widgets;if(F)for(var i=0;i<F.length;++i)F[i].height=F[i].node.offsetHeight}}return w(a),p(d,e,c).to>l&&v(a,[],c),!0}}function w(a){var b=a.display.viewOffset=md(a,gd(a.doc,a.display.showingFrom));a.display.mover.style.top=b+"px"}function x(a,b){for(var c=0,d=b.length||0;d>c;++c){for(var e=b[c],f=[],g=e.diff||0,h=0,i=a.length;i>h;++h){var j=a[h];e.to<=j.from&&e.diff?f.push({from:j.from+g,to:j.to+g}):e.to<=j.from||e.from>=j.to?f.push(j):(e.from>j.from&&f.push({from:j.from,to:e.from}),e.to<j.to&&f.push({from:e.to+g,to:j.to+g}))}a=f}return a}function y(a){for(var b=a.display,c={},d={},e=b.gutters.firstChild,f=0;e;e=e.nextSibling,++f)c[a.options.gutters[f]]=e.offsetLeft,d[a.options.gutters[f]]=e.offsetWidth;return{fixedPos:t(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function z(a,b,c,d,e){function f(b){var c=b.nextSibling;return pe&&Ae&&a.display.currentWheelTarget==b?(b.style.display="none",b.lineObj=null):b.parentNode.removeChild(b),c}var g=y(a),h=a.display,i=a.options.lineNumbers;d.length||pe&&a.display.currentWheelTarget||Yd(h.lineDiv);var j=h.lineDiv,k=j.firstChild,l=d.shift(),m=b;for(a.doc.iter(b,c,function(b){if(l&&l.to==m&&(l=d.shift()),Jc(a.doc,b)){if(0!=b.height&&jd(b,0),b.widgets&&k.previousSibling)for(var c=0;c<b.widgets.length;++c)if(b.widgets[c].showIfHidden){var h=k.previousSibling;if(/pre/i.test(h.nodeName)){var n=Xd("div",null,null,"position: relative");h.parentNode.replaceChild(n,h),n.appendChild(h),h=n}var o=h.appendChild(Xd("div",[b.widgets[c].node],"CodeMirror-linewidget"));B(b.widgets[c],o,h,g)}}else if(l&&l.from<=m&&l.to>m){for(;k.lineObj!=b;)k=f(k);i&&m>=e&&k.lineNumber&&$d(k.lineNumber,s(a.options,m)),k=k.nextSibling}else{if(b.widgets)for(var p,q=0,r=k;r&&20>q;++q,r=r.nextSibling)if(r.lineObj==b&&/div/i.test(r.nodeName)){p=r;break}var t=A(a,b,m,g,p);if(t!=p)j.insertBefore(t,k);else{for(;k!=p;)k=f(k);k=k.nextSibling}t.lineObj=b}++m});k;)k=f(k)}function A(a,b,c,d,e){var f,g=Yc(a,b),h=b.gutterMarkers,i=a.display;if(!(a.options.lineNumbers||h||b.bgClass||b.wrapClass||b.widgets))return g;if(e){e.alignable=null;for(var j,k=!0,l=0,m=e.firstChild;m;m=j)if(j=m.nextSibling,/\bCodeMirror-linewidget\b/.test(m.className)){for(var n=0,o=!0;n<b.widgets.length;++n){var p=b.widgets[n],q=!1;if(p.above||(q=o,o=!1),p.node==m.firstChild){B(p,m,e,d),++l,q&&e.insertBefore(g,m);break}}if(n==b.widgets.length){k=!1;break}}else e.removeChild(m);k&&l==b.widgets.length&&(f=e,e.className=b.wrapClass||"")}if(f||(f=Xd("div",null,b.wrapClass,"position: relative"),f.appendChild(g)),b.bgClass&&f.insertBefore(Xd("div",null,b.bgClass+" CodeMirror-linebackground"),f.firstChild),a.options.lineNumbers||h){var r=f.insertBefore(Xd("div",null,null,"position: absolute; left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px"),f.firstChild);if(a.options.fixedGutter&&(f.alignable||(f.alignable=[])).push(r),!a.options.lineNumbers||h&&h["CodeMirror-linenumbers"]||(f.lineNumber=r.appendChild(Xd("div",s(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+i.lineNumInnerWidth+"px"))),h)for(var t=0;t<a.options.gutters.length;++t){var u=a.options.gutters[t],v=h.hasOwnProperty(u)&&h[u];v&&r.appendChild(Xd("div",[v],"CodeMirror-gutter-elt","left: "+d.gutterLeft[u]+"px; width: "+d.gutterWidth[u]+"px"))}}if(ne&&(f.style.zIndex=2),b.widgets&&f!=e)for(var n=0,w=b.widgets;n<w.length;++n){var p=w[n],x=Xd("div",[p.node],"CodeMirror-linewidget");B(p,x,f,d),p.above?f.insertBefore(x,a.options.lineNumbers&&0!=b.height?r:g):f.appendChild(x),Id(p,"redraw")}return f}function B(a,b,c,d){if(a.noHScroll){(c.alignable||(c.alignable=[])).push(b);var e=d.wrapperWidth;b.style.left=d.fixedPos+"px",a.coverGutter||(e-=d.gutterTotalWidth,b.style.paddingLeft=d.gutterTotalWidth+"px"),b.style.width=e+"px"}a.coverGutter&&(b.style.zIndex=5,b.style.position="relative",a.noHScroll||(b.style.marginLeft=-d.gutterTotalWidth+"px"))}function C(a){var b=a.display,c=Pb(a.doc.sel.from,a.doc.sel.to);c||a.options.showCursorWhenSelecting?D(a):b.cursor.style.display=b.otherCursor.style.display="none",c?b.selectionDiv.style.display="none":E(a);var d=U(a,a.doc.sel.head,"div"),e=_d(b.wrapper),f=_d(b.lineDiv);b.inputDiv.style.top=Math.max(0,Math.min(b.wrapper.clientHeight-10,d.top+f.top-e.top))+"px",b.inputDiv.style.left=Math.max(0,Math.min(b.wrapper.clientWidth-10,d.left+f.left-e.left))+"px"}function D(a){var b=a.display,c=U(a,a.doc.sel.head,"div");b.cursor.style.left=c.left+"px",b.cursor.style.top=c.top+"px",b.cursor.style.height=Math.max(0,c.bottom-c.top)*a.options.cursorHeight+"px",b.cursor.style.display="",c.other?(b.otherCursor.style.display="",b.otherCursor.style.left=c.other.left+"px",b.otherCursor.style.top=c.other.top+"px",b.otherCursor.style.height=.85*(c.other.bottom-c.other.top)+"px"):b.otherCursor.style.display="none"}function E(a){function b(a,b,c,d){0>b&&(b=0),g.appendChild(Xd("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?h-a:c)+"px; height: "+(d-b)+"px"))}function c(c,d,f,g){function j(b){return T(a,Ob(c,b),"div",k)}var k=gd(e,c),l=k.text.length,m=g?1/0:-1/0;return ce(nd(k),d||0,null==f?l:f,function(a,c,e){var k=j("rtl"==e?c-1:a),n=j("rtl"==e?a:c-1),o=k.left,p=n.right;n.top-k.top>3&&(b(o,k.top,null,k.bottom),o=i,k.bottom<n.top&&b(o,k.bottom,null,n.top)),null==f&&c==l&&(p=h),null==d&&0==a&&(o=i),m=g?Math.min(n.top,m):Math.max(n.bottom,m),i+1>o&&(o=i),b(o,n.top,p-o,n.bottom)}),m}var d=a.display,e=a.doc,f=a.doc.sel,g=document.createDocumentFragment(),h=d.lineSpace.offsetWidth,i=L(a.display);if(f.from.line==f.to.line)c(f.from.line,f.from.ch,f.to.ch);else{for(var j,k,l=gd(e,f.from.line),m=l,n=[f.from.line,f.from.ch];j=Hc(m);){var o=j.find();if(n.push(o.from.ch,o.to.line,o.to.ch),o.to.line==f.to.line){n.push(f.to.ch),k=!0;break}m=gd(e,o.to.line)}if(k)for(var p=0;p<n.length;p+=3)c(n[p],n[p+1],n[p+2]);else{var q,r,s=gd(e,f.to.line);q=f.from.ch?c(f.from.line,f.from.ch,null,!1):md(a,l)-d.viewOffset,r=f.to.ch?c(f.to.line,Gc(s)?null:0,f.to.ch,!0):md(a,s)-d.viewOffset,r>q&&b(i,q,null,r)}}Zd(d.selectionDiv,g),d.selectionDiv.style.display=""}function F(a){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursor.style.visibility=b.otherCursor.style.visibility="",b.blinker=setInterval(function(){b.cursor.offsetHeight&&(b.cursor.style.visibility=b.otherCursor.style.visibility=(c=!c)?"":"hidden")},a.options.cursorBlinkRate)}function G(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.showingTo&&a.state.highlight.set(b,Ud(H,a))}function H(a){var b=a.doc;if(b.frontier<b.first&&(b.frontier=b.first),!(b.frontier>=a.display.showingTo)){var c,d=+new Date+a.options.workTime,e=mc(b.mode,J(a,b.frontier)),f=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.showingTo+500),function(g){if(b.frontier>=a.display.showingFrom){var h=g.styles;g.styles=Uc(a,g,e);for(var i=!h||h.length!=g.styles.length,j=0;!i&&j<h.length;++j)i=h[j]!=g.styles[j];i&&(c&&c.end==b.frontier?c.end++:f.push(c={start:b.frontier,end:b.frontier+1})),g.stateAfter=mc(b.mode,e)}else Wc(a,g,e),g.stateAfter=b.frontier%5==0?mc(b.mode,e):null;return++b.frontier,+new Date>d?(G(a,a.options.workDelay),!0):void 0}),f.length&&ab(a,function(){for(var a=0;a<f.length;++a)db(this,f[a].start,f[a].end)})()}}function I(a,b){for(var c,d,e=a.doc,f=b,g=b-100;f>g;--f){if(f<=e.first)return e.first;var h=gd(e,f-1);if(h.stateAfter)return f;var i=Md(h.text,null,a.options.tabSize);(null==d||c>i)&&(d=f-1,c=i)}return d}function J(a,b){var c=a.doc,d=a.display;if(!c.mode.startState)return!0;var e=I(a,b),f=e>c.first&&gd(c,e-1).stateAfter;return f=f?mc(c.mode,f):nc(c.mode),c.iter(e,b,function(g){Wc(a,g,f);var h=e==b-1||e%5==0||e>=d.showingFrom&&e<d.showingTo;g.stateAfter=h?mc(c.mode,f):null,++e}),f}function K(a){return a.lineSpace.offsetTop}function L(a){var b=Zd(a.measure,Xd("pre",null,null,"text-align: left")).appendChild(Xd("span","x"));return b.offsetLeft}function M(a,b,c,d){var e=-1;d=d||O(a,b);for(var f=c;;f+=e){var g=d[f];if(g)break;0>e&&0==f&&(e=1)}return{left:c>f?g.right:g.left,right:f>c?g.left:g.right,top:g.top,bottom:g.bottom}}function N(a,b){for(var c=a.display.measureLineCache,d=0;d<c.length;++d){var e=c[d];if(e.text==b.text&&e.markedSpans==b.markedSpans&&a.display.scroller.clientWidth==e.width&&e.classes==b.textClass+"|"+b.bgClass+"|"+b.wrapClass)return e.measure}}function O(a,b){var c=N(a,b);if(!c){c=P(a,b);var d=a.display.measureLineCache,e={text:b.text,width:a.display.scroller.clientWidth,markedSpans:b.markedSpans,measure:c,classes:b.textClass+"|"+b.bgClass+"|"+b.wrapClass};16==d.length?d[++a.display.measureLineCachePos%16]=e:d.push(e)}return c}function P(a,b){var c=a.display,d=Td(b.text.length),e=Yc(a,b,d);if(me&&!ne&&!a.options.lineWrapping&&e.childNodes.length>100){for(var f=document.createDocumentFragment(),g=10,h=e.childNodes.length,i=0,j=Math.ceil(h/g);j>i;++i){for(var k=Xd("div",null,null,"display: inline-block"),l=0;g>l&&h;++l)k.appendChild(e.firstChild),--h;f.appendChild(k)}e.appendChild(f)}Zd(c.measure,e);var m=_d(c.lineDiv),n=[],o=Td(b.text.length),p=e.offsetHeight;oe&&c.measure.first!=e&&Zd(c.measure,e);for(var q,i=0;i<d.length;++i)if(q=d[i]){for(var r=_d(q),s=Math.max(0,r.top-m.top),t=Math.min(r.bottom-m.top,p),l=0;l<n.length;l+=2){var u=n[l],v=n[l+1];if(!(u>t||s>v)&&(s>=u&&v>=t||u>=s&&t>=v||Math.min(t,v)-Math.max(s,u)>=t-s>>1)){n[l]=Math.min(s,u),n[l+1]=Math.max(t,v);break}}l==n.length&&n.push(s,t);var w=r.right;q.measureRight&&(w=_d(q.measureRight).left),o[i]={left:r.left-m.left,right:w-m.left,top:l}}for(var q,i=0;i<o.length;++i)if(q=o[i]){var x=q.top;q.top=n[x],q.bottom=n[x+1]}return o}function Q(a,b){var c=!1;if(b.markedSpans)for(var d=0;d<b.markedSpans;++d){var e=b.markedSpans[d];!e.collapsed||null!=e.to&&e.to!=b.text.length||(c=!0)}var f=!c&&N(a,b);if(f)return M(a,b,b.text.length,f).right;var g=Yc(a,b),h=g.appendChild(be(a.display.measure));return Zd(a.display.measure,g),_d(h).right-_d(a.display.lineDiv).left}function R(a){a.display.measureLineCache.length=a.display.measureLineCachePos=0,a.display.cachedCharWidth=a.display.cachedTextHeight=null,a.display.maxLineChanged=!0,a.display.lineNumChars=null}function S(a,b,c,d){if(b.widgets)for(var e=0;e<b.widgets.length;++e)if(b.widgets[e].above){var f=Oc(b.widgets[e]);c.top+=f,c.bottom+=f}if("line"==d)return c;d||(d="local");var g=md(a,b);if("local"!=d&&(g-=a.display.viewOffset),"page"==d){var h=_d(a.display.lineSpace);g+=h.top+(window.pageYOffset||(document.documentElement||document.body).scrollTop);var i=h.left+(window.pageXOffset||(document.documentElement||document.body).scrollLeft);c.left+=i,c.right+=i}return c.top+=g,c.bottom+=g,c}function T(a,b,c,d){return d||(d=gd(a.doc,b.line)),S(a,d,M(a,d,b.ch),c)}function U(a,b,c,d,e){function f(b,f){var g=M(a,d,b,e);return f?g.left=g.right:g.right=g.left,S(a,d,g,c)}d=d||gd(a.doc,b.line),e||(e=O(a,d));var g=nd(d),h=b.ch;if(!g)return f(h);for(var i,j,k=g[0].level,l=0;l<g.length;++l){var m,n,o=g[l],p=o.level%2;if(o.from<h&&o.to>h)return f(h,p);var q=p?o.to:o.from,r=p?o.from:o.to;if(q==h)n=l&&o.level<(m=g[l-1]).level?f(m.level%2?m.from:m.to-1,!0):f(p&&o.from!=o.to?h-1:h),p==k?i=n:j=n;else if(r==h){var m=l<g.length-1&&g[l+1];if(!p&&m&&m.from==m.to)continue;n=m&&o.level<m.level?f(m.level%2?m.to-1:m.from):f(p?h:h-1,!0),p==k?i=n:j=n}}return k&&!h&&(j=f(g[0].to-1)),i?(j&&(i.other=j),i):j}function V(a,b,c){var d=new Ob(a,b);return c&&(d.outside=!0),d}function W(a,b,c){var d=a.doc;if(c+=a.display.viewOffset,0>c)return V(d.first,0,!0);var e=ld(d,c),f=d.first+d.size-1;if(e>f)return V(d.first+d.size-1,gd(d,f).text.length,!0);for(0>b&&(b=0);;){var g=gd(d,e),h=X(a,g,e,b,c),i=Hc(g),j=i&&i.find();if(!(i&&h.ch>=j.from.ch))return h;e=j.to.line}}function X(a,b,c,d,e){function f(d){var e=U(a,Ob(c,d),"line",b,j);return h=!0,g>e.bottom?Math.max(0,e.left-i):g<e.top?e.left+i:(h=!1,e.left)}var g=e-md(a,b),h=!1,i=a.display.wrapper.clientWidth,j=O(a,b),k=nd(b),l=b.text.length,m=fe(b),n=ge(b),o=f(m),p=h,q=f(n),r=h;if(d>q)return V(c,n,r);for(;;){if(k?n==m||n==je(b,m,1):1>=n-m){for(var s=q-d>d-o,t=s?m:n;lf.test(b.text.charAt(t));)++t;var u=V(c,t,s?p:r);return u.after=s,u}var v=Math.ceil(l/2),w=m+v;if(k){w=m;for(var x=0;v>x;++x)w=je(b,w,1)}var y=f(w);y>d?(n=w,q=y,(r=h)&&(q+=1e3),l-=v):(m=w,o=y,p=h,l=v)}}function Y(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==De){De=Xd("pre");for(var b=0;49>b;++b)De.appendChild(document.createTextNode("x")),De.appendChild(Xd("br"));De.appendChild(document.createTextNode("x"))}Zd(a.measure,De);var c=De.offsetHeight/50;return c>3&&(a.cachedTextHeight=c),Yd(a.measure),c||1}function Z(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=Xd("span","x"),c=Xd("pre",[b]);Zd(a.measure,c);var d=b.offsetWidth;return d>2&&(a.cachedCharWidth=d),d||10}function $(a){a.curOp={changes:[],updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,updateMaxLine:!1,updateScrollPos:!1,id:++Ke},ff++||(ef=[])}function _(a){var b=a.curOp,c=a.doc,d=a.display;if(a.curOp=null,b.updateMaxLine&&m(a),d.maxLineChanged&&!a.options.lineWrapping){var e=Q(a,d.maxLine);d.sizer.style.minWidth=Math.max(0,e+3+gf)+"px",d.maxLineChanged=!1;var f=Math.max(0,d.sizer.offsetLeft+d.sizer.offsetWidth-d.scroller.clientWidth);f<c.scrollLeft&&!b.updateScrollPos&&sb(a,Math.min(d.scroller.scrollLeft,f),!0)}var g,h;if(b.updateScrollPos)g=b.updateScrollPos;else if(b.selectionChanged&&d.scroller.clientHeight){var i=U(a,c.sel.head);g=cc(a,i.left,i.top,i.left,i.bottom)}(b.changes.length||g&&null!=g.scrollTop)&&(h=u(a,b.changes,g&&g.scrollTop)),!h&&b.selectionChanged&&C(a),b.updateScrollPos?(d.scroller.scrollTop=d.scrollbarV.scrollTop=c.scrollTop=g.scrollTop,d.scroller.scrollLeft=d.scrollbarH.scrollLeft=c.scrollLeft=g.scrollLeft,q(a)):g&&_b(a),b.selectionChanged&&F(a),a.state.focused&&b.updateInput&&hb(a,b.userSelChange);var j=b.maybeHiddenMarkers,k=b.maybeUnhiddenMarkers;if(j)for(var l=0;l<j.length;++l)j[l].lines.length||Hd(j[l],"hide");if(k)for(var l=0;l<k.length;++l)k[l].lines.length&&Hd(k[l],"unhide");var n;if(--ff||(n=ef,ef=null),b.textChanged&&Hd(a,"change",a,b.textChanged),b.selectionChanged&&Hd(a,"cursorActivity",a),n)for(var l=0;l<n.length;++l)n[l]()}function ab(a,b){return function(){var c=a||this,d=!c.curOp;d&&$(c);try{var e=b.apply(c,arguments)}finally{d&&_(c)}return e}}function bb(a){return function(){var b,c=this.cm&&!this.cm.curOp;c&&$(this.cm);try{b=a.apply(this,arguments)}finally{c&&_(this.cm)}return b}}function cb(a,b){var c,d=!a.curOp;d&&$(a);try{c=b()}finally{d&&_(a)}return c}function db(a,b,c,d){null==b&&(b=a.doc.first),null==c&&(c=a.doc.first+a.doc.size),a.curOp.changes.push({from:b,to:c,diff:d})}function eb(a){a.display.pollingFast||a.display.poll.set(a.options.pollInterval,function(){gb(a),a.state.focused&&eb(a)})}function fb(a){function b(){var d=gb(a);d||c?(a.display.pollingFast=!1,eb(a)):(c=!0,a.display.poll.set(60,b))}var c=!1;a.display.pollingFast=!0,a.display.poll.set(20,b)}function gb(a){var b=a.display.input,c=a.display.prevInput,d=a.doc,e=d.sel;if(!a.state.focused||rf(b)||jb(a))return!1;var f=b.value;if(f==c&&Pb(e.from,e.to))return!1;if(me&&f&&0===b.selectionStart)return hb(a,!0),!1;var g=!a.curOp;g&&$(a),e.shift=!1;for(var h=0,i=Math.min(c.length,f.length);i>h&&c[h]==f[h];)++h;var j=e.from,k=e.to;h<c.length?j=Ob(j.line,j.ch-(c.length-h)):a.state.overwrite&&Pb(j,k)&&!a.state.pasteIncoming&&(k=Ob(k.line,Math.min(gd(d,k.line).text.length,k.ch+(f.length-h))));var l=a.curOp.updateInput;return Hb(a.doc,{from:j,to:k,text:qf(f.slice(h)),origin:a.state.pasteIncoming?"paste":"+input"},"end"),a.curOp.updateInput=l,f.length>1e3?b.value=a.display.prevInput="":a.display.prevInput=f,g&&_(a),a.state.pasteIncoming=!1,!0}function hb(a,b){var c,d,e=a.doc;Pb(e.sel.from,e.sel.to)?b&&(a.display.prevInput=a.display.input.value=""):(a.display.prevInput="",c=sf&&(e.sel.to.line-e.sel.from.line>100||(d=a.getSelection()).length>1e3),a.display.input.value=c?"-":d||a.getSelection(),a.state.focused&&Pd(a.display.input)),a.display.inaccurateSelection=c}function ib(a){"nocursor"==a.options.readOnly||ze&&document.activeElement==a.display.input||a.display.input.focus()}function jb(a){return a.options.readOnly||a.doc.cantEdit}function kb(a){function b(){a.state.focused&&setTimeout(Ud(ib,a),0)}function c(){g.cachedCharWidth=g.cachedTextHeight=null,R(a),cb(a,Ud(db,a))}function d(){for(var a=g.wrapper.parentNode;a&&a!=document.body;a=a.parentNode);a?setTimeout(d,5e3):Gd(window,"resize",c)}function e(b){a.options.onDragEvent&&a.options.onDragEvent(a,zd(b))||Cd(b)}function f(){g.inaccurateSelection&&(g.prevInput="",g.inaccurateSelection=!1,g.input.value=a.getSelection(),Pd(g.input))}var g=a.display;Fd(g.scroller,"mousedown",ab(a,nb)),Fd(g.scroller,"dblclick",ab(a,Ad)),Fd(g.lineSpace,"selectstart",function(a){lb(g,a)||Ad(a)}),He||Fd(g.scroller,"contextmenu",function(b){Cb(a,b)}),Fd(g.scroller,"scroll",function(){rb(a,g.scroller.scrollTop),sb(a,g.scroller.scrollLeft,!0),Hd(a,"scroll",a)}),Fd(g.scrollbarV,"scroll",function(){rb(a,g.scrollbarV.scrollTop)}),Fd(g.scrollbarH,"scroll",function(){sb(a,g.scrollbarH.scrollLeft)}),Fd(g.scroller,"mousewheel",function(b){tb(a,b)}),Fd(g.scroller,"DOMMouseScroll",function(b){tb(a,b)}),Fd(g.scrollbarH,"mousedown",b),Fd(g.scrollbarV,"mousedown",b),Fd(g.wrapper,"scroll",function(){g.wrapper.scrollTop=g.wrapper.scrollLeft=0}),Fd(window,"resize",c),setTimeout(d,5e3),Fd(g.input,"keyup",ab(a,function(b){a.options.onKeyEvent&&a.options.onKeyEvent(a,zd(b))||16==b.keyCode&&(a.doc.sel.shift=!1)})),Fd(g.input,"input",Ud(fb,a)),Fd(g.input,"keydown",ab(a,yb)),Fd(g.input,"keypress",ab(a,zb)),Fd(g.input,"focus",Ud(Ab,a)),Fd(g.input,"blur",Ud(Bb,a)),a.options.dragDrop&&(Fd(g.scroller,"dragstart",function(b){qb(a,b)}),Fd(g.scroller,"dragenter",e),Fd(g.scroller,"dragover",e),Fd(g.scroller,"drop",ab(a,ob))),Fd(g.scroller,"paste",function(b){lb(g,b)||(ib(a),fb(a))}),Fd(g.input,"paste",function(){a.state.pasteIncoming=!0,fb(a)}),Fd(g.input,"cut",f),Fd(g.input,"copy",f),ue&&Fd(g.sizer,"mouseup",function(){document.activeElement==g.input&&g.input.blur(),ib(a)})}function lb(a,b){for(var c=Dd(b);c!=a.wrapper;c=c.parentNode){if(!c)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(c.className)||c.parentNode==a.sizer&&c!=a.mover)return!0}}function mb(a,b,c){var d=a.display;if(!c){var e=Dd(b);if(e==d.scrollbarH||e==d.scrollbarH.firstChild||e==d.scrollbarV||e==d.scrollbarV.firstChild||e==d.scrollbarFiller)return null}var f,g,h=_d(d.lineSpace);try{f=b.clientX,g=b.clientY}catch(b){return null}return W(a,f-h.left,g-h.top)}function nb(a){function b(a){if("single"==k)return Wb(e.doc,Tb(g,i),a),void 0;if(o=Tb(g,o),q=Tb(g,q),"double"==k){var b=jc(gd(g,a.line).text,a);Qb(a,o)?Wb(e.doc,b.from,q):Wb(e.doc,o,b.to)}else"triple"==k&&(Qb(a,o)?Wb(e.doc,q,Tb(g,Ob(a.line,0))):Wb(e.doc,o,Tb(g,Ob(a.line+1,0))))}function c(a){var d=++s,h=mb(e,a,!0);if(h)if(Pb(h,m)){var i=a.clientY<r.top?-20:a.clientY>r.bottom?20:0;i&&setTimeout(ab(e,function(){s==d&&(f.scroller.scrollTop+=i,c(a))}),50)}else{e.state.focused||Ab(e),m=h,b(h);var j=p(f,g);(h.line>=j.to||h.line<j.from)&&setTimeout(ab(e,function(){s==d&&c(a)}),150)}}function d(a){s=1/0;var c=mb(e,a);c&&b(c),Ad(a),ib(e),Gd(document,"mousemove",t),Gd(document,"mouseup",u)}var e=this,f=e.display,g=e.doc,h=g.sel;if(h.shift=a.shiftKey,lb(f,a))return pe||(f.scroller.draggable=!1,setTimeout(function(){f.scroller.draggable=!0},100)),void 0;if(!pb(e,a)){var i=mb(e,a);switch(Ed(a)){case 3:return He&&Cb.call(e,e,a),void 0;case 2:return i&&Wb(e.doc,i),setTimeout(Ud(ib,e),20),Ad(a),void 0}if(!i)return Dd(a)==f.scroller&&Ad(a),void 0;e.state.focused||Ab(e);var j=+new Date,k="single";if(Fe&&Fe.time>j-400&&Pb(Fe.pos,i))k="triple",Ad(a),setTimeout(Ud(ib,e),20),kc(e,i.line);else if(Ee&&Ee.time>j-400&&Pb(Ee.pos,i)){k="double",Fe={time:j,pos:i},Ad(a);var l=jc(gd(g,i.line).text,i);Wb(e.doc,l.from,l.to)}else Ee={time:j,pos:i};var m=i;if(e.options.dragDrop&&mf&&!jb(e)&&!Pb(h.from,h.to)&&!Qb(i,h.from)&&!Qb(h.to,i)&&"single"==k){var n=ab(e,function(b){pe&&(f.scroller.draggable=!1),e.state.draggingText=!1,Gd(document,"mouseup",n),Gd(f.scroller,"drop",n),Math.abs(a.clientX-b.clientX)+Math.abs(a.clientY-b.clientY)<10&&(Ad(b),Wb(e.doc,i),ib(e))
});return pe&&(f.scroller.draggable=!0),e.state.draggingText=n,f.scroller.dragDrop&&f.scroller.dragDrop(),Fd(document,"mouseup",n),Fd(f.scroller,"drop",n),void 0}Ad(a),"single"==k&&Wb(e.doc,Tb(g,i));var o=h.from,q=h.to,r=_d(f.wrapper),s=0,t=ab(e,function(a){me||Ed(a)?c(a):d(a)}),u=ab(e,d);Fd(document,"mousemove",t),Fd(document,"mouseup",u)}}function ob(a){var b=this;if(!(lb(b.display,a)||b.options.onDragEvent&&b.options.onDragEvent(b,zd(a)))){Ad(a);var c=mb(b,a,!0),d=a.dataTransfer.files;if(c&&!jb(b))if(d&&d.length&&window.FileReader&&window.File)for(var e=d.length,f=Array(e),g=0,h=function(a,d){var h=new FileReader;h.onload=function(){f[d]=h.result,++g==e&&(c=Tb(b.doc,c),Hb(b.doc,{from:c,to:c,text:qf(f.join("\n")),origin:"paste"},"around"))},h.readAsText(a)},i=0;e>i;++i)h(d[i],i);else{if(b.state.draggingText&&!Qb(c,b.doc.sel.from)&&!Qb(b.doc.sel.to,c))return b.state.draggingText(a),setTimeout(Ud(ib,b),20),void 0;try{var f=a.dataTransfer.getData("Text");if(f){var j=b.doc.sel.from,k=b.doc.sel.to;Yb(b.doc,c,c),b.state.draggingText&&Nb(b.doc,"",j,k,"paste"),b.replaceSelection(f,null,"paste"),ib(b),Ab(b)}}catch(a){}}}}function pb(a,b){var c=a.display;try{var d=b.clientX,e=b.clientY}catch(b){return!1}if(d>=Math.floor(_d(c.gutters).right))return!1;if(Ad(b),!Kd(a,"gutterClick"))return!0;var f=_d(c.lineDiv);if(e>f.bottom)return!0;e-=f.top-c.viewOffset;for(var g=0;g<a.options.gutters.length;++g){var h=c.gutters.childNodes[g];if(h&&_d(h).right>=d){var i=ld(a.doc,e),j=a.options.gutters[g];Id(a,"gutterClick",a,i,j,b);break}}return!0}function qb(a,b){if(!lb(a.display,b)){var c=a.getSelection();if(b.dataTransfer.setData("Text",c),b.dataTransfer.setDragImage){var d=Xd("img",null,null,"position: fixed; left: 0; top: 0;");se&&(d.width=d.height=1,a.display.wrapper.appendChild(d),d._top=d.offsetTop),te&&(a.display.dragImg?d=a.display.dragImg:(a.display.dragImg=d,d.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a.display.wrapper.appendChild(d))),b.dataTransfer.setDragImage(d,0,0),se&&d.parentNode.removeChild(d)}}}function rb(a,b){Math.abs(a.doc.scrollTop-b)<2||(a.doc.scrollTop=b,le||u(a,[],b),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbarV.scrollTop!=b&&(a.display.scrollbarV.scrollTop=b),le&&u(a,[]))}function sb(a,b,c){(c?b==a.doc.scrollLeft:Math.abs(a.doc.scrollLeft-b)<2)||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,q(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbarH.scrollLeft!=b&&(a.display.scrollbarH.scrollLeft=b))}function tb(a,b){var c=b.wheelDeltaX,d=b.wheelDeltaY;if(null==c&&b.detail&&b.axis==b.HORIZONTAL_AXIS&&(c=b.detail),null==d&&b.detail&&b.axis==b.VERTICAL_AXIS?d=b.detail:null==d&&(d=b.wheelDelta),d&&Ae&&pe)for(var e=b.target;e!=g;e=e.parentNode)if(e.lineObj){a.display.currentWheelTarget=e;break}var f=a.display,g=f.scroller;if(c&&!le&&!se&&null!=Me)return d&&rb(a,Math.max(0,Math.min(g.scrollTop+d*Me,g.scrollHeight-g.clientHeight))),sb(a,Math.max(0,Math.min(g.scrollLeft+c*Me,g.scrollWidth-g.clientWidth))),Ad(b),f.wheelStartX=null,void 0;if(d&&null!=Me){var h=d*Me,i=a.doc.scrollTop,j=i+f.wrapper.clientHeight;0>h?i=Math.max(0,i+h-50):j=Math.min(a.doc.height,j+h+50),u(a,[],{top:i,bottom:j})}20>Le&&(null==f.wheelStartX?(f.wheelStartX=g.scrollLeft,f.wheelStartY=g.scrollTop,f.wheelDX=c,f.wheelDY=d,setTimeout(function(){if(null!=f.wheelStartX){var a=g.scrollLeft-f.wheelStartX,b=g.scrollTop-f.wheelStartY,c=b&&f.wheelDY&&b/f.wheelDY||a&&f.wheelDX&&a/f.wheelDX;f.wheelStartX=f.wheelStartY=null,c&&(Me=(Me*Le+c)/(Le+1),++Le)}},200)):(f.wheelDX+=c,f.wheelDY+=d))}function ub(a,b,c){if("string"==typeof b&&(b=Xe[b],!b))return!1;a.display.pollingFast&&gb(a)&&(a.display.pollingFast=!1);var d=a.doc,e=d.sel.shift,f=!1;try{jb(a)&&(a.state.suppressEdits=!0),c&&(d.sel.shift=!1),f=b(a)!=hf}finally{d.sel.shift=e,a.state.suppressEdits=!1}return f}function vb(a){var b=a.state.keyMaps.slice(0);return b.push(a.options.keyMap),a.options.extraKeys&&b.unshift(a.options.extraKeys),b}function wb(a,b){var c=oc(a.options.keyMap),d=c.auto;clearTimeout(Ne),d&&!qc(b)&&(Ne=setTimeout(function(){oc(a.options.keyMap)==c&&(a.options.keyMap=d.call?d.call(null,a):d)},50));var e=rc(b,!0),f=!1;if(!e)return!1;var g=vb(a);return f=b.shiftKey?pc("Shift-"+e,g,function(b){return ub(a,b,!0)})||pc(e,g,function(b){return"string"==typeof b&&/^go[A-Z]/.test(b)?ub(a,b):void 0}):pc(e,g,function(b){return ub(a,b)}),"stop"==f&&(f=!1),f&&(Ad(b),F(a),oe&&(b.oldKeyCode=b.keyCode,b.keyCode=0)),f}function xb(a,b,c){var d=pc("'"+c+"'",vb(a),function(b){return ub(a,b,!0)});return d&&(Ad(b),F(a)),d}function yb(a){var b=this;if(b.state.focused||Ab(b),me&&27==a.keyCode&&(a.returnValue=!1),!b.options.onKeyEvent||!b.options.onKeyEvent(b,zd(a))){var c=a.keyCode;b.doc.sel.shift=16==c||a.shiftKey;var d=wb(b,a);se&&(Pe=d?c:null,!d&&88==c&&!sf&&(Ae?a.metaKey:a.ctrlKey)&&b.replaceSelection(""))}}function zb(a){var b=this;if(!b.options.onKeyEvent||!b.options.onKeyEvent(b,zd(a))){var c=a.keyCode,d=a.charCode;if(se&&c==Pe)return Pe=null,Ad(a),void 0;if(!(se&&(!a.which||a.which<10)||ue)||!wb(b,a)){var e=String.fromCharCode(null==d?c:d);this.options.electricChars&&this.doc.mode.electricChars&&this.options.smartIndent&&!jb(this)&&this.doc.mode.electricChars.indexOf(e)>-1&&setTimeout(ab(b,function(){fc(b,b.doc.sel.to.line,"smart")}),75),xb(b,a,e)||fb(b)}}}function Ab(a){"nocursor"!=a.options.readOnly&&(a.state.focused||(Hd(a,"focus",a),a.state.focused=!0,-1==a.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(a.display.wrapper.className+=" CodeMirror-focused"),hb(a,!0)),eb(a),F(a))}function Bb(a){a.state.focused&&(Hd(a,"blur",a),a.state.focused=!1,a.display.wrapper.className=a.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.doc.sel.shift=!1)},150)}function Cb(a,b){function c(){if(d.inputDiv.style.position="relative",d.input.style.cssText=h,oe&&(d.scrollbarV.scrollTop=d.scroller.scrollTop=g),eb(a),null!=d.input.selectionStart&&(!me||oe)){clearTimeout(Oe);var b=d.input.value=" "+(Pb(e.from,e.to)?"":d.input.value),c=0;d.prevInput=" ",d.input.selectionStart=1,d.input.selectionEnd=b.length;var f=function(){" "==d.prevInput&&0==d.input.selectionStart?ab(a,Xe.selectAll)(a):c++<10?Oe=setTimeout(f,500):hb(a)};Oe=setTimeout(f,200)}}var d=a.display,e=a.doc.sel;if(!lb(d,b)){var f=mb(a,b),g=d.scroller.scrollTop;if(f&&!se){(Pb(e.from,e.to)||Qb(f,e.from)||!Qb(f,e.to))&&ab(a,Yb)(a.doc,f,f);var h=d.input.style.cssText;if(d.inputDiv.style.position="absolute",d.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(b.clientY-5)+"px; left: "+(b.clientX-5)+"px; z-index: 1000; background: white; outline: none;border-width: 0; outline: none; overflow: hidden; opacity: .05; -ms-opacity: .05; filter: alpha(opacity=5);",ib(a),hb(a,!0),Pb(e.from,e.to)&&(d.input.value=d.prevInput=" "),He){Cd(b);var i=function(){Gd(window,"mouseup",i),setTimeout(c,20)};Fd(window,"mouseup",i)}else setTimeout(c,50)}}}function Db(a){return Ob(a.from.line+a.text.length-1,Od(a.text).length+(1==a.text.length?a.from.ch:0))}function Eb(a,b,c){if(!Qb(b.from,c))return Tb(a,c);var d=b.text.length-1-(b.to.line-b.from.line);if(c.line>b.to.line+d){var e=c.line-d,f=a.first+a.size-1;return e>f?Ob(f,gd(a,f).text.length):Ub(c,gd(a,e).text.length)}if(c.line==b.to.line+d)return Ub(c,Od(b.text).length+(1==b.text.length?b.from.ch:0)+gd(a,b.to.line).text.length-b.to.ch);var g=c.line-b.from.line;return Ub(c,b.text[g].length+(g?0:b.from.ch))}function Fb(a,b,c){if(c&&"object"==typeof c)return{anchor:Eb(a,b,c.anchor),head:Eb(a,b,c.head)};if("start"==c)return{anchor:b.from,head:b.from};var d=Db(b);if("around"==c)return{anchor:b.from,head:d};if("end"==c)return{anchor:d,head:d};var e=function(a){if(Qb(a,b.from))return a;if(!Qb(b.to,a))return d;var c=a.line+b.text.length-(b.to.line-b.from.line)-1,e=a.ch;return a.line==b.to.line&&(e+=d.ch-b.to.ch),Ob(c,e)};return{anchor:e(a.sel.anchor),head:e(a.sel.head)}}function Gb(a,b){var c={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,update:function(b,c,d,e){b&&(this.from=Tb(a,b)),c&&(this.to=Tb(a,c)),d&&(this.text=d),void 0!==e&&(this.origin=e)},cancel:function(){this.canceled=!0}};return Hd(a,"beforeChange",a,c),a.cm&&Hd(a.cm,"beforeChange",a.cm,c),c.canceled?null:{from:c.from,to:c.to,text:c.text,origin:c.origin}}function Hb(a,b,c,d){if(a.cm){if(!a.cm.curOp)return ab(a.cm,Hb)(a,b,c,d);if(a.cm.state.suppressEdits)return}if(!(Kd(a,"beforeChange")||a.cm&&Kd(a.cm,"beforeChange"))||(b=Gb(a,b))){var e=Ie&&!d&&Ec(a,b.from,b.to);if(e){for(var f=e.length-1;f>=1;--f)Ib(a,{from:e[f].from,to:e[f].to,text:[""]});e.length&&Ib(a,{from:e[0].from,to:e[0].to,text:b.text},c)}else Ib(a,b,c)}}function Ib(a,b,c){var d=Fb(a,b,c);rd(a,b,d,a.cm?a.cm.curOp.id:0/0),Lb(a,b,d,Cc(a,b));var e=[];ed(a,function(a,c){c||-1!=Qd(e,a.history)||(xd(a.history,b),e.push(a.history)),Lb(a,b,null,Cc(a,b))})}function Jb(a,b){var c=a.history,d=("undo"==b?c.done:c.undone).pop();if(d){c.dirtyCounter+="undo"==b?-1:1;var e={changes:[],anchorBefore:d.anchorAfter,headBefore:d.headAfter,anchorAfter:d.anchorBefore,headAfter:d.headBefore};("undo"==b?c.undone:c.done).push(e);for(var f=d.changes.length-1;f>=0;--f){var g=d.changes[f];g.origin=b,e.changes.push(qd(a,g));var h=f?Fb(a,g,null):{anchor:d.anchorBefore,head:d.headBefore};Lb(a,g,h,Dc(a,g));var i=[];ed(a,function(a,b){b||-1!=Qd(i,a.history)||(xd(a.history,g),i.push(a.history)),Lb(a,g,null,Dc(a,g))})}}}function Kb(a,b){function c(a){return Ob(a.line+b,a.ch)}a.first+=b,a.cm&&db(a.cm,a.first,a.first,b),a.sel.head=c(a.sel.head),a.sel.anchor=c(a.sel.anchor),a.sel.from=c(a.sel.from),a.sel.to=c(a.sel.to)}function Lb(a,b,c,d){if(a.cm&&!a.cm.curOp)return ab(a.cm,Lb)(a,b,c,d);if(b.to.line<a.first)return Kb(a,b.text.length-1-(b.to.line-b.from.line)),void 0;if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var e=b.text.length-1-(a.first-b.from.line);Kb(a,e),b={from:Ob(a.first,0),to:Ob(b.to.line+e,b.to.ch),text:[Od(b.text)],origin:b.origin}}var f=a.lastLine();b.to.line>f&&(b={from:b.from,to:Ob(f,gd(a,f).text.length),text:[b.text[0]],origin:b.origin}),c||(c=Fb(a,b,null)),a.cm?Mb(a.cm,b,d,c):bd(a,b,d,c)}}function Mb(a,b,c,d){var e=a.doc,g=a.display,h=b.from,i=b.to,j=!1,k=h.line;a.options.lineWrapping||(k=kd(Ic(e,gd(e,h.line))),e.iter(k,i.line+1,function(a){return a==g.maxLine?(j=!0,!0):void 0})),bd(e,b,c,d,f(a)),a.options.lineWrapping||(e.iter(k,h.line+b.text.length,function(a){var b=l(e,a);b>g.maxLineLength&&(g.maxLine=a,g.maxLineLength=b,g.maxLineChanged=!0,j=!1)}),j&&(a.curOp.updateMaxLine=!0)),e.frontier=Math.min(e.frontier,h.line),G(a,400);var m=b.text.length-(i.line-h.line)-1;if(db(a,h.line,i.line+1,m),Kd(a,"change")){var n={from:h,to:i,text:b.text,origin:b.origin};if(a.curOp.textChanged){for(var o=a.curOp.textChanged;o.next;o=o.next);o.next=n}else a.curOp.textChanged=n}}function Nb(a,b,c,d,e){if(d||(d=c),Qb(d,c)){var f=d;d=c,c=f}"string"==typeof b&&(b=qf(b)),Hb(a,{from:c,to:d,text:b,origin:e},null)}function Ob(a,b){return this instanceof Ob?(this.line=a,this.ch=b,void 0):new Ob(a,b)}function Pb(a,b){return a.line==b.line&&a.ch==b.ch}function Qb(a,b){return a.line<b.line||a.line==b.line&&a.ch<b.ch}function Rb(a){return Ob(a.line,a.ch)}function Sb(a,b){return Math.max(a.first,Math.min(b,a.first+a.size-1))}function Tb(a,b){if(b.line<a.first)return Ob(a.first,0);var c=a.first+a.size-1;return b.line>c?Ob(c,gd(a,c).text.length):Ub(b,gd(a,b.line).text.length)}function Ub(a,b){var c=a.ch;return null==c||c>b?Ob(a.line,b):0>c?Ob(a.line,0):a}function Vb(a,b){return b>=a.first&&b<a.first+a.size}function Wb(a,b,c,d){if(a.sel.shift||a.sel.extend){var e=a.sel.anchor;if(c){var f=Qb(b,e);f!=Qb(c,e)?(e=b,b=c):f!=Qb(b,c)&&(b=c)}Yb(a,e,b,d)}else Yb(a,b,c||b,d);a.cm&&(a.cm.curOp.userSelChange=!0)}function Xb(a,b,c){var d={anchor:b,head:c};return Hd(a,"beforeSelectionChange",a,d),a.cm&&Hd(a.cm,"beforeSelectionChange",a.cm,d),d.anchor=Tb(a,d.anchor),d.head=Tb(a,d.head),d}function Yb(a,b,c,d,e){if(!e&&Kd(a,"beforeSelectionChange")||a.cm&&Kd(a.cm,"beforeSelectionChange")){var f=Xb(a,b,c);c=f.head,b=f.anchor}var g=a.sel;if(g.goalColumn=null,(e||!Pb(b,g.anchor))&&(b=$b(a,b,d,"push"!=e)),(e||!Pb(c,g.head))&&(c=$b(a,c,d,"push"!=e)),!Pb(g.anchor,b)||!Pb(g.head,c)){g.anchor=b,g.head=c;var h=Qb(c,b);g.from=h?c:b,g.to=h?b:c,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0),Id(a,"cursorActivity",a)}}function Zb(a){Yb(a.doc,a.doc.sel.from,a.doc.sel.to,null,"push")}function $b(a,b,c,d){var e=!1,f=b,g=c||1;a.cantEdit=!1;a:for(;;){var h,i=gd(a,f.line);if(i.markedSpans){for(var j=0;j<i.markedSpans.length;++j){var k=i.markedSpans[j],l=k.marker;if((null==k.from||(l.inclusiveLeft?k.from<=f.ch:k.from<f.ch))&&(null==k.to||(l.inclusiveRight?k.to>=f.ch:k.to>f.ch))){if(d&&l.clearOnEnter){(h||(h=[])).push(l);continue}if(!l.atomic)continue;var m=l.find()[0>g?"from":"to"];if(Pb(m,f)&&(m.ch+=g,m.ch<0?m=m.line>a.first?Tb(a,Ob(m.line-1)):null:m.ch>i.text.length&&(m=m.line<a.first+a.size-1?Ob(m.line+1,0):null),!m)){if(e)return d?(a.cantEdit=!0,Ob(a.first,0)):$b(a,b,c,!0);e=!0,m=b,g=-g}f=m;continue a}}if(h)for(var j=0;j<h.length;++j)h[j].clear()}return f}}function _b(a){var b=ac(a,a.doc.sel.head);if(a.state.focused){var c=a.display,d=_d(c.sizer),e=null;if(b.top+d.top<0?e=!0:b.bottom+d.top>(window.innerHeight||document.documentElement.clientHeight)&&(e=!1),null!=e&&!xe){var f="none"==c.cursor.style.display;f&&(c.cursor.style.display="",c.cursor.style.left=b.left+"px",c.cursor.style.top=b.top-c.viewOffset+"px"),c.cursor.scrollIntoView(e),f&&(c.cursor.style.display="none")}}}function ac(a,b){for(;;){var c=!1,d=U(a,b),e=cc(a,d.left,d.top,d.left,d.bottom),f=a.doc.scrollTop,g=a.doc.scrollLeft;if(null!=e.scrollTop&&(rb(a,e.scrollTop),Math.abs(a.doc.scrollTop-f)>1&&(c=!0)),null!=e.scrollLeft&&(sb(a,e.scrollLeft),Math.abs(a.doc.scrollLeft-g)>1&&(c=!0)),!c)return d}}function bc(a,b,c,d,e){var f=cc(a,b,c,d,e);null!=f.scrollTop&&rb(a,f.scrollTop),null!=f.scrollLeft&&sb(a,f.scrollLeft)}function cc(a,b,c,d,e){var f=a.display,g=K(f);c+=g,e+=g;var h=f.scroller.clientHeight-gf,i=f.scroller.scrollTop,j={},k=a.doc.height+2*g,l=g+10>c,m=e+g>k-10;i>c?j.scrollTop=l?0:Math.max(0,c):e>i+h&&(j.scrollTop=(m?k:e)-h);var n=f.scroller.clientWidth-gf,o=f.scroller.scrollLeft;b+=f.gutters.offsetWidth,d+=f.gutters.offsetWidth;var p=f.gutters.offsetWidth,q=p+10>b;return o+p>b||q?(q&&(b=0),j.scrollLeft=Math.max(0,b-10-p)):d>n+o-3&&(j.scrollLeft=d+10-n),j}function dc(a,b,c){a.curOp.updateScrollPos={scrollLeft:b,scrollTop:c}}function ec(a,b,c){var d=a.curOp.updateScrollPos||(a.curOp.updateScrollPos={scrollLeft:a.doc.scrollLeft,scrollTop:a.doc.scrollTop}),e=a.display.scroller;d.scrollTop=Math.max(0,Math.min(e.scrollHeight-e.clientHeight,d.scrollTop+c)),d.scrollLeft=Math.max(0,Math.min(e.scrollWidth-e.clientWidth,d.scrollLeft+b))}function fc(a,b,c,d){var e=a.doc;if(c||(c="add"),"smart"==c)if(a.doc.mode.indent)var f=J(a,b);else c="prev";var g,h=a.options.tabSize,i=gd(e,b),j=Md(i.text,null,h),k=i.text.match(/^\s*/)[0];if("smart"==c&&(g=a.doc.mode.indent(f,i.text.slice(k.length),i.text),g==hf)){if(!d)return;c="prev"}"prev"==c?g=b>e.first?Md(gd(e,b-1).text,null,h):0:"add"==c?g=j+a.options.indentUnit:"subtract"==c&&(g=j-a.options.indentUnit),g=Math.max(0,g);var l="",m=0;if(a.options.indentWithTabs)for(var n=Math.floor(g/h);n;--n)m+=h,l+="	";g>m&&(l+=Nd(g-m)),l!=k&&Nb(a.doc,l,Ob(b,0),Ob(b,k.length),"+input"),i.stateAfter=null}function gc(a,b,c){var d=b,e=b,f=a.doc;return"number"==typeof b?e=gd(f,Sb(f,b)):d=kd(b),null==d?null:c(e,d)?(db(a,d,d+1),e):null}function hc(a,b,c,d,e){function f(){var b=h+c;return b<a.first||b>=a.first+a.size?k=!1:(h=b,j=gd(a,b))}function g(a){var b=(e?je:ke)(j,i,c,!0);if(null==b){if(a||!f())return k=!1;i=e?(0>c?ge:fe)(j):0>c?j.text.length:0}else i=b;return!0}var h=b.line,i=b.ch,j=gd(a,h),k=!0;if("char"==d)g();else if("column"==d)g(!0);else if("word"==d)for(var l=!1;!(0>c)||g();){if(Vd(j.text.charAt(i)))l=!0;else if(l){0>c&&(c=1,g());break}if(c>0&&!g())break}var m=$b(a,Ob(h,i),c,!0);return k||(m.hitSide=!0),m}function ic(a,b,c,d){var e,f=a.doc,g=b.left;if("page"==d){var h=Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);e=b.top+c*(h-(0>c?1.5:.5)*Y(a.display))}else"line"==d&&(e=c>0?b.bottom+3:b.top-3);for(;;){var i=W(a,g,e);if(!i.outside)break;if(0>c?0>=e:e>=f.height){i.hitSide=!0;break}e+=5*c}return i}function jc(a,b){var c=b.ch,d=b.ch;if(a){b.after===!1||d==a.length?--c:++d;for(var e=a.charAt(c),f=Vd(e)?Vd:/\s/.test(e)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!Vd(a)};c>0&&f(a.charAt(c-1));)--c;for(;d<a.length&&f(a.charAt(d));)++d}return{from:Ob(b.line,c),to:Ob(b.line,d)}}function kc(a,b){Wb(a.doc,Ob(b,0),Tb(a.doc,Ob(b+1,0)))}function lc(b,c,d,e){a.defaults[b]=c,d&&(Qe[b]=e?function(a,b,c){c!=Se&&d(a,b,c)}:d)}function mc(a,b){if(b===!0)return b;if(a.copyState)return a.copyState(b);var c={};for(var d in b){var e=b[d];e instanceof Array&&(e=e.concat([])),c[d]=e}return c}function nc(a,b,c){return a.startState?a.startState(b,c):!0}function oc(a){return"string"==typeof a?Ye[a]:a}function pc(a,b,c){function d(b){b=oc(b);var e=b[a];if(e===!1)return"stop";if(null!=e&&c(e))return!0;if(b.nofallthrough)return"stop";var f=b.fallthrough;if(null==f)return!1;if("[object Array]"!=Object.prototype.toString.call(f))return d(f);for(var g=0,h=f.length;h>g;++g){var i=d(f[g]);if(i)return i}return!1}for(var e=0;e<b.length;++e){var f=d(b[e]);if(f)return f}}function qc(a){var b=tf[a.keyCode];return"Ctrl"==b||"Alt"==b||"Shift"==b||"Mod"==b}function rc(a,b){var c=tf[a.keyCode];return null==c||a.altGraphKey?!1:(a.altKey&&(c="Alt-"+c),(Ge?a.metaKey:a.ctrlKey)&&(c="Ctrl-"+c),(Ge?a.ctrlKey:a.metaKey)&&(c="Cmd-"+c),!b&&a.shiftKey&&(c="Shift-"+c),c)}function sc(a,b){this.pos=this.start=0,this.string=a,this.tabSize=b||8,this.lastColumnPos=this.lastColumnValue=0}function tc(a,b){this.lines=[],this.type=b,this.doc=a}function uc(a,b,c,d,e){if(d&&d.shared)return wc(a,b,c,d,e);if(a.cm&&!a.cm.curOp)return ab(a.cm,uc)(a,b,c,d,e);var f=new tc(a,e);if("range"==e&&!Qb(b,c))return f;d&&Sd(d,f),f.replacedWith&&(f.collapsed=!0,f.replacedWith=Xd("span",[f.replacedWith],"CodeMirror-widget")),f.collapsed&&(Je=!0);var g,h,i,j=b.line,k=0,l=a.cm;if(a.iter(j,c.line+1,function(d){l&&f.collapsed&&!l.options.lineWrapping&&Ic(a,d)==l.display.maxLine&&(i=!0);var e={from:null,to:null,marker:f};k+=d.text.length,j==b.line&&(e.from=b.ch,k-=b.ch),j==c.line&&(e.to=c.ch,k-=d.text.length-c.ch),f.collapsed&&(j==c.line&&(h=Fc(d,c.ch)),j==b.line?g=Fc(d,b.ch):jd(d,0)),zc(d,e),++j}),f.collapsed&&a.iter(b.line,c.line+1,function(b){Jc(a,b)&&jd(b,0)}),f.readOnly&&(Ie=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory()),f.collapsed){if(g!=h)throw new Error("Inserting collapsed marker overlapping an existing one");f.size=k,f.atomic=!0}return l&&(i&&(l.curOp.updateMaxLine=!0),(f.className||f.startStyle||f.endStyle||f.collapsed)&&db(l,b.line,c.line+1),f.atomic&&Zb(l)),f}function vc(a,b){this.markers=a,this.primary=b;for(var c=0,d=this;c<a.length;++c)a[c].parent=this,Fd(a[c],"clear",function(){d.clear()})}function wc(a,b,c,d,e){d=Sd(d),d.shared=!1;var f=[uc(a,b,c,d,e)],g=f[0];return ed(a,function(a){f.push(uc(a,Tb(a,b),Tb(a,c),d,e));for(var h=0;h<a.linked.length;++h)if(a.linked[h].isParent)return;g=Od(f)}),new vc(f,g)}function xc(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function yc(a,b){for(var c,d=0;d<a.length;++d)a[d]!=b&&(c||(c=[])).push(a[d]);return c}function zc(a,b){a.markedSpans=a.markedSpans?a.markedSpans.concat([b]):[b],b.marker.attachLine(a)}function Ac(a,b,c){if(a)for(var d,e=0;e<a.length;++e){var f=a[e],g=f.marker,h=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);if(h||"bookmark"==g.type&&f.from==b&&(!c||!f.marker.insertLeft)){var i=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);(d||(d=[])).push({from:f.from,to:i?null:f.to,marker:g})}}return d}function Bc(a,b,c){if(a)for(var d,e=0;e<a.length;++e){var f=a[e],g=f.marker,h=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);if(h||"bookmark"==g.type&&f.from==b&&(!c||f.marker.insertLeft)){var i=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);(d||(d=[])).push({from:i?null:f.from-b,to:null==f.to?null:f.to-b,marker:g})}}return d}function Cc(a,b){var c=Vb(a,b.from.line)&&gd(a,b.from.line).markedSpans,d=Vb(a,b.to.line)&&gd(a,b.to.line).markedSpans;if(!c&&!d)return null;var e=b.from.ch,f=b.to.ch,g=Pb(b.from,b.to),h=Ac(c,e,g),i=Bc(d,f,g),j=1==b.text.length,k=Od(b.text).length+(j?e:0);if(h)for(var l=0;l<h.length;++l){var m=h[l];if(null==m.to){var n=xc(i,m.marker);n?j&&(m.to=null==n.to?null:n.to+k):m.to=e}}if(i)for(var l=0;l<i.length;++l){var m=i[l];if(null!=m.to&&(m.to+=k),null==m.from){var n=xc(h,m.marker);n||(m.from=k,j&&(h||(h=[])).push(m))}else m.from+=k,j&&(h||(h=[])).push(m)}var o=[h];if(!j){var p,q=b.text.length-2;if(q>0&&h)for(var l=0;l<h.length;++l)null==h[l].to&&(p||(p=[])).push({from:null,to:null,marker:h[l].marker});for(var l=0;q>l;++l)o.push(p);o.push(i)}return o}function Dc(a,b){var c=td(a,b),d=Cc(a,b);if(!c)return d;if(!d)return c;for(var e=0;e<c.length;++e){var f=c[e],g=d[e];if(f&&g)a:for(var h=0;h<g.length;++h){for(var i=g[h],j=0;j<f.length;++j)if(f[j].marker==i.marker)continue a;f.push(i)}else g&&(c[e]=g)}return c}function Ec(a,b,c){var d=null;if(a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=Qd(d,c)||(d||(d=[])).push(c)}}),!d)return null;for(var e=[{from:b,to:c}],f=0;f<d.length;++f)for(var g=d[f],h=g.find(),i=0;i<e.length;++i){var j=e[i];if(!Qb(j.to,h.from)&&!Qb(h.to,j.from)){var k=[i,1];(Qb(j.from,h.from)||!g.inclusiveLeft&&Pb(j.from,h.from))&&k.push({from:j.from,to:h.from}),(Qb(h.to,j.to)||!g.inclusiveRight&&Pb(j.to,h.to))&&k.push({from:h.to,to:j.to}),e.splice.apply(e,k),i+=k.length-1}}return e}function Fc(a,b){var c,d=Je&&a.markedSpans;if(d)for(var e,f=0;f<d.length;++f)e=d[f],e.marker.collapsed&&(null==e.from||e.from<b)&&(null==e.to||e.to>b)&&(!c||c.width<e.marker.width)&&(c=e.marker);return c}function Gc(a){return Fc(a,-1)}function Hc(a){return Fc(a,a.text.length+1)}function Ic(a,b){for(var c;c=Gc(b);)b=gd(a,c.find().from.line);return b}function Jc(a,b){var c=Je&&b.markedSpans;if(c)for(var d,e=0;e<c.length;++e)if(d=c[e],d.marker.collapsed){if(null==d.from)return!0;if(0==d.from&&d.marker.inclusiveLeft&&Kc(a,b,d))return!0}}function Kc(a,b,c){if(null==c.to){var d=c.marker.find().to,e=gd(a,d.line);return Kc(a,e,xc(e.markedSpans,c.marker))}if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var f,g=0;g<b.markedSpans.length;++g)if(f=b.markedSpans[g],f.marker.collapsed&&f.from==c.to&&(f.marker.inclusiveLeft||c.marker.inclusiveRight)&&Kc(a,b,f))return!0}function Lc(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Mc(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Nc(a){return function(){var b=!this.cm.curOp;b&&$(this.cm);try{var c=a.apply(this,arguments)}finally{b&&_(this.cm)}return c}}function Oc(a){return null!=a.height?a.height:(a.node.parentNode&&1==a.node.parentNode.nodeType||Zd(a.cm.display.measure,Xd("div",[a.node],null,"position: relative")),a.height=a.node.offsetHeight)}function Pc(a,b,c,d){var e=new Ze(a,c,d);return e.noHScroll&&(a.display.alignWidgets=!0),gc(a,b,function(b){if((b.widgets||(b.widgets=[])).push(e),e.line=b,!Jc(a.doc,b)||e.showIfHidden){var c=md(a,b)<a.display.scroller.scrollTop;jd(b,b.height+Oc(e)),c&&ec(a,0,e.height)}return!0}),e}function Qc(a,b,c){var d={text:a};return Mc(d,b),d.height=c?c(d):1,d}function Rc(a,b,c,d){a.text=b,a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null),null!=a.order&&(a.order=null),Lc(a),Mc(a,c);var e=d?d(a):1;e!=a.height&&jd(a,e),Id(a,"change")}function Sc(a){a.parent=null,Lc(a)}function Tc(a,b,c,d,e){var f=c.flattenSpans;null==f&&(f=a.options.flattenSpans);var g="",h=null,i=new sc(b,a.options.tabSize);for(""==b&&c.blankLine&&c.blankLine(d);!i.eol();){var j=c.token(i,d);i.pos>5e3&&(f=!1,i.pos=Math.min(b.length,i.start+5e4),j=null);var k=i.current();i.start=i.pos,f&&h==j?g+=k:(g&&e(g,h),g=k,h=j)}g&&e(g,h)}function Uc(a,b,c){var d=[a.state.modeGen];Tc(a,b.text,a.doc.mode,c,function(a,b){d.push(a,b)});for(var e=0;e<a.state.overlays.length;++e){var f=a.state.overlays[e],g=1;Tc(a,b.text,f.mode,!0,function(a,b){for(var c=g,e=a.length;e;){var h=d[g],i=h.length;e>=i?e-=i:(d.splice(g,1,h.slice(0,e),d[g+1],h.slice(e)),e=0),g+=2}if(b)if(f.opaque)d.splice(c,g-c,a,b),g=c+2;else for(;g>c;c+=2){var h=d[c+1];d[c+1]=h?h+" "+b:b}})}return d}function Vc(a,b){return b.styles&&b.styles[0]==a.state.modeGen||(b.styles=Uc(a,b,b.stateAfter=J(a,kd(b)))),b.styles}function Wc(a,b,c){var d=a.doc.mode,e=new sc(b.text,a.options.tabSize);for(""==b.text&&d.blankLine&&d.blankLine(c);!e.eol()&&e.pos<=5e3;)d.token(e,c),e.start=e.pos}function Xc(a){return a?$e[a]||($e[a]="cm-"+a.replace(/ +/g," cm-")):null}function Yc(a,b,c){for(var d,e,f,g=b,h=!0;d=Gc(g);)h=!1,g=gd(a.doc,d.find().from.line),e||(e=g);var i={pre:Xd("pre"),col:0,pos:0,display:!c,measure:null,addedOne:!1,cm:a};g.textClass&&(i.pre.className=g.textClass);do{i.measure=g==b&&c,i.pos=0,i.addToken=i.measure?$c:Zc,c&&f&&g!=b&&!i.addedOne&&(c[0]=i.pre.appendChild(be(a.display.measure)),i.addedOne=!0);var j=ad(g,i,Vc(a,g));f=g==e,j&&(g=gd(a.doc,j.to.line),h=!1)}while(j);c&&!i.addedOne&&(c[0]=i.pre.appendChild(h?Xd("span",""):be(a.display.measure))),i.pre.firstChild||Jc(a.doc,b)||i.pre.appendChild(document.createTextNode(""));var k;if(c&&me&&(k=nd(g))){var l=k.length-1;k[l].from==k[l].to&&--l;var m=k[l],n=k[l-1];if(m.from+1==m.to&&n&&m.level<n.level){var o=c[i.pos-1];o&&o.parentNode.insertBefore(o.measureRight=be(a.display.measure),o.nextSibling)}}return i.pre}function Zc(a,b,c,d,e){if(b){if(_e.test(b))for(var f=document.createDocumentFragment(),g=0;;){_e.lastIndex=g;var h=_e.exec(b),i=h?h.index-g:b.length-g;if(i&&(f.appendChild(document.createTextNode(b.slice(g,g+i))),a.col+=i),!h)break;if(g+=i+1,"	"==h[0]){var j=a.cm.options.tabSize,k=j-a.col%j;f.appendChild(Xd("span",Nd(k),"cm-tab")),a.col+=k}else{var l=Xd("span","","cm-invalidchar");l.title="\\u"+h[0].charCodeAt(0).toString(16),f.appendChild(l),a.col+=1}}else{a.col+=b.length;var f=document.createTextNode(b)}if(c||d||e||a.measure){var m=c||"";return d&&(m+=d),e&&(m+=e),a.pre.appendChild(Xd("span",[f],m))}a.pre.appendChild(f)}}function $c(a,b,c,d,e){for(var f=a.cm.options.lineWrapping,g=0;g<b.length;++g){var h=b.charAt(g),i=0==g;h>=""&&"">h&&g<b.length-1?(h=b.slice(g,g+2),++g):g&&f&&nf.test(b.slice(g-1,g+1))&&a.pre.appendChild(Xd("wbr"));var j=a.measure[a.pos]=Zc(a,h,c,i&&d,g==b.length-1&&e);me&&f&&" "==h&&g&&!/\s/.test(b.charAt(g-1))&&g<b.length-1&&!/\s/.test(b.charAt(g+1))&&(j.style.whiteSpace="normal"),a.pos+=h.length}b.length&&(a.addedOne=!0)}function _c(a,b,c){c&&(a.display||(c=c.cloneNode(!0)),a.pre.appendChild(c),a.measure&&b&&(a.measure[a.pos]=c,a.addedOne=!0)),a.pos+=b}function ad(a,b,c){var d=a.markedSpans;if(d)for(var e,f,g,h,i,j=a.text,k=j.length,l=0,m=1,n="",o=0;;){if(o==l){f=g=h="",i=null,o=1/0;for(var p=null,q=0;q<d.length;++q){var r=d[q],s=r.marker;r.from<=l&&(null==r.to||r.to>l)?(null!=r.to&&o>r.to&&(o=r.to,g=""),s.className&&(f+=" "+s.className),s.startStyle&&r.from==l&&(h+=" "+s.startStyle),s.endStyle&&r.to==o&&(g+=" "+s.endStyle),s.collapsed&&(!i||i.marker.width<s.width)&&(i=r)):r.from>l&&o>r.from&&(o=r.from),"bookmark"==s.type&&r.from==l&&s.replacedWith&&(p=s.replacedWith)}if(i&&(i.from||0)==l&&(_c(b,(null==i.to?k:i.to)-l,null!=i.from&&i.marker.replacedWith),null==i.to))return i.marker.find();p&&!i&&_c(b,0,p)}if(l>=k)break;for(var t=Math.min(k,o);;){if(n){var u=l+n.length;if(!i){var v=u>t?n.slice(0,t-l):n;b.addToken(b,v,e?e+f:f,h,l+v.length==o?g:"")}if(u>=t){n=n.slice(t-l),l=t;break}l=u,h=""}n=c[m++],e=Xc(c[m++])}}else for(var m=1;m<c.length;m+=2)b.addToken(b,c[m],Xc(c[m+1]))}function bd(a,b,c,d,e){function f(a){return c?c[a]:null}var g=b.from,h=b.to,i=b.text,j=gd(a,g.line),k=gd(a,h.line),l=Od(i),m=f(i.length-1),n=h.line-g.line;if(0==g.ch&&0==h.ch&&""==l){for(var o=0,p=i.length-1,q=[];p>o;++o)q.push(Qc(i[o],f(o),e));Rc(k,k.text,m,e),n&&a.remove(g.line,n),q.length&&a.insert(g.line,q)}else if(j==k)if(1==i.length)Rc(j,j.text.slice(0,g.ch)+l+j.text.slice(h.ch),m,e);else{for(var q=[],o=1,p=i.length-1;p>o;++o)q.push(Qc(i[o],f(o),e));q.push(Qc(l+j.text.slice(h.ch),m,e)),Rc(j,j.text.slice(0,g.ch)+i[0],f(0),e),a.insert(g.line+1,q)}else if(1==i.length)Rc(j,j.text.slice(0,g.ch)+i[0]+k.text.slice(h.ch),f(0),e),a.remove(g.line+1,n);else{Rc(j,j.text.slice(0,g.ch)+i[0],f(0),e),Rc(k,l+k.text.slice(h.ch),m,e);for(var o=1,p=i.length-1,q=[];p>o;++o)q.push(Qc(i[o],f(o),e));n>1&&a.remove(g.line+1,n-1),a.insert(g.line+1,q)}Id(a,"change",a,b),Yb(a,d.anchor,d.head,null,!0)}function cd(a){this.lines=a,this.parent=null;for(var b=0,c=a.length,d=0;c>b;++b)a[b].parent=this,d+=a[b].height;this.height=d}function dd(a){this.children=a;for(var b=0,c=0,d=0,e=a.length;e>d;++d){var f=a[d];b+=f.chunkSize(),c+=f.height,f.parent=this}this.size=b,this.height=c,this.parent=null}function ed(a,b,c){function d(a,e,f){if(a.linked)for(var g=0;g<a.linked.length;++g){var h=a.linked[g];if(h.doc!=e){var i=f&&h.sharedHist;(!c||i)&&(b(h.doc,i),d(h.doc,a,i))}}}d(a,null,!0)}function fd(a,b){if(b.cm)throw new Error("This document is already in use.");a.doc=b,b.cm=a,g(a),d(a),a.options.lineWrapping||m(a),a.options.mode=b.modeOption,db(a)}function gd(a,b){for(b-=a.first;!a.lines;)for(var c=0;;++c){var d=a.children[c],e=d.chunkSize();if(e>b){a=d;break}b-=e}return a.lines[b]}function hd(a,b,c){var d=[],e=b.line;return a.iter(b.line,c.line+1,function(a){var f=a.text;e==c.line&&(f=f.slice(0,c.ch)),e==b.line&&(f=f.slice(b.ch)),d.push(f),++e}),d}function id(a,b,c){var d=[];return a.iter(b,c,function(a){d.push(a.text)}),d}function jd(a,b){for(var c=b-a.height,d=a;d;d=d.parent)d.height+=c}function kd(a){if(null==a.parent)return null;for(var b=a.parent,c=Qd(b.lines,a),d=b.parent;d;b=d,d=d.parent)for(var e=0;d.children[e]!=b;++e)c+=d.children[e].chunkSize();return c+b.first}function ld(a,b){var c=a.first;a:do{for(var d=0,e=a.children.length;e>d;++d){var f=a.children[d],g=f.height;if(g>b){a=f;continue a}b-=g,c+=f.chunkSize()}return c}while(!a.lines);for(var d=0,e=a.lines.length;e>d;++d){var h=a.lines[d],i=h.height;if(i>b)break;b-=i}return c+d}function md(a,b){b=Ic(a.doc,b);for(var c=0,d=b.parent,e=0;e<d.lines.length;++e){var f=d.lines[e];if(f==b)break;c+=f.height}for(var g=d.parent;g;d=g,g=d.parent)for(var e=0;e<g.children.length;++e){var h=g.children[e];if(h==d)break;c+=h.height}return c}function nd(a){var b=a.order;return null==b&&(b=a.order=uf(a.text)),b}function od(){return{done:[],undone:[],undoDepth:1/0,lastTime:0,lastOp:null,lastOrigin:null,dirtyCounter:0}}function pd(a,b,c,d){var e=b["spans_"+a.id],f=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((e||(e=b["spans_"+a.id]={}))[f]=c.markedSpans),++f})}function qd(a,b){var c={from:b.from,to:Db(b),text:hd(a,b.from,b.to)};return pd(a,c,b.from.line,b.to.line+1),ed(a,function(a){pd(a,c,b.from.line,b.to.line+1)},!0),c}function rd(a,b,c,d){var e=a.history;e.undone.length=0;var f=+new Date,g=Od(e.done);if(g&&(e.lastOp==d||e.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&e.lastTime>f-600||"*"==b.origin.charAt(0)))){var h=Od(g.changes);Pb(b.from,b.to)&&Pb(b.from,h.to)?h.to=Db(b):g.changes.push(qd(a,b)),g.anchorAfter=c.anchor,g.headAfter=c.head}else{for(g={changes:[qd(a,b)],anchorBefore:a.sel.anchor,headBefore:a.sel.head,anchorAfter:c.anchor,headAfter:c.head},e.done.push(g);e.done.length>e.undoDepth;)e.done.shift();e.dirtyCounter<0?e.dirtyCounter=0/0:e.dirtyCounter++}e.lastTime=f,e.lastOp=d,e.lastOrigin=b.origin}function sd(a){if(!a)return null;for(var b,c=0;c<a.length;++c)a[c].marker.explicitlyCleared?b||(b=a.slice(0,c)):b&&b.push(a[c]);return b?b.length?b:null:a}function td(a,b){var c=b["spans_"+a.id];
if(!c)return null;for(var d=0,e=[];d<b.text.length;++d)e.push(sd(c[d]));return e}function ud(a,b){for(var c=0,d=[];c<a.length;++c){var e=a[c],f=e.changes,g=[];d.push({changes:g,anchorBefore:e.anchorBefore,headBefore:e.headBefore,anchorAfter:e.anchorAfter,headAfter:e.headAfter});for(var h=0;h<f.length;++h){var i,j=f[h];if(g.push({from:j.from,to:j.to,text:j.text}),b)for(var k in j)(i=k.match(/^spans_(\d+)$/))&&Qd(b,Number(i[1]))>-1&&(Od(g)[k]=j[k],delete j[k])}}return d}function vd(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function wd(a,b,c,d){for(var e=0;e<a.length;++e){for(var f=a[e],g=!0,h=0;h<f.changes.length;++h){var i=f.changes[h];if(f.copied||(i.from=Rb(i.from),i.to=Rb(i.to)),c<i.from.line)i.from.line+=d,i.to.line+=d;else if(b<=i.to.line){g=!1;break}}f.copied||(f.anchorBefore=Rb(f.anchorBefore),f.headBefore=Rb(f.headBefore),f.anchorAfter=Rb(f.anchorAfter),f.readAfter=Rb(f.headAfter),f.copied=!0),g?(vd(f.anchorBefore),vd(f.headBefore),vd(f.anchorAfter),vd(f.headAfter)):(a.splice(0,e+1),e=0)}}function xd(a,b){var c=b.from.line,d=b.to.line,e=b.text.length-(d-c)-1;wd(a.done,c,d,e),wd(a.undone,c,d,e)}function yd(){Cd(this)}function zd(a){return a.stop||(a.stop=yd),a}function Ad(a){a.preventDefault?a.preventDefault():a.returnValue=!1}function Bd(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function Cd(a){Ad(a),Bd(a)}function Dd(a){return a.target||a.srcElement}function Ed(a){var b=a.which;return null==b&&(1&a.button?b=1:2&a.button?b=3:4&a.button&&(b=2)),Ae&&a.ctrlKey&&1==b&&(b=3),b}function Fd(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,c);else{var d=a._handlers||(a._handlers={}),e=d[b]||(d[b]=[]);e.push(c)}}function Gd(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else{var d=a._handlers&&a._handlers[b];if(!d)return;for(var e=0;e<d.length;++e)if(d[e]==c){d.splice(e,1);break}}}function Hd(a,b){var c=a._handlers&&a._handlers[b];if(c)for(var d=Array.prototype.slice.call(arguments,2),e=0;e<c.length;++e)c[e].apply(null,d)}function Id(a,b){function c(a){return function(){a.apply(null,e)}}var d=a._handlers&&a._handlers[b];if(d){var e=Array.prototype.slice.call(arguments,2);ef||(++ff,ef=[],setTimeout(Jd,0));for(var f=0;f<d.length;++f)ef.push(c(d[f]))}}function Jd(){--ff;var a=ef;ef=null;for(var b=0;b<a.length;++b)a[b]()}function Kd(a,b){var c=a._handlers&&a._handlers[b];return c&&c.length>0}function Ld(){this.id=null}function Md(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));for(var f=d||0,g=e||0;b>f;++f)"	"==a.charAt(f)?g+=c-g%c:++g;return g}function Nd(a){for(;jf.length<=a;)jf.push(Od(jf)+" ");return jf[a]}function Od(a){return a[a.length-1]}function Pd(a){ye?(a.selectionStart=0,a.selectionEnd=a.value.length):a.select()}function Qd(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;++c)if(a[c]==b)return c;return-1}function Rd(a,b){function c(){}c.prototype=a;var d=new c;return b&&Sd(b,d),d}function Sd(a,b){b||(b={});for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function Td(a){for(var b=[],c=0;a>c;++c)b.push(void 0);return b}function Ud(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function Vd(a){return/\w/.test(a)||a>""&&(a.toUpperCase()!=a.toLowerCase()||kf.test(a))}function Wd(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function Xd(a,b,c,d){var e=document.createElement(a);if(c&&(e.className=c),d&&(e.style.cssText=d),"string"==typeof b)$d(e,b);else if(b)for(var f=0;f<b.length;++f)e.appendChild(b[f]);return e}function Yd(a){if(me)for(;a.firstChild;)a.removeChild(a.firstChild);else a.innerHTML="";return a}function Zd(a,b){return Yd(a).appendChild(b)}function $d(a,b){oe?(a.innerHTML="",a.appendChild(document.createTextNode(b))):a.textContent=b}function _d(a){return a.getBoundingClientRect()}function ae(a){if(null!=of)return of;var b=Xd("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return Zd(a,b),b.offsetWidth&&(of=b.offsetHeight-b.clientHeight),of||0}function be(a){if(null==pf){var b=Xd("span","");Zd(a,Xd("span",[b,document.createTextNode("x")])),0!=a.firstChild.offsetHeight&&(pf=b.offsetWidth<=1&&b.offsetHeight>2&&!ne)}return pf?Xd("span",""):Xd("span","",null,"display: inline-block; width: 1px; margin-right: -1px")}function ce(a,b,c,d){if(!a)return d(b,c,"ltr");for(var e=0;e<a.length;++e){var f=a[e];(f.from<c&&f.to>b||b==c&&f.to==b)&&d(Math.max(f.from,b),Math.min(f.to,c),1==f.level?"rtl":"ltr")}}function de(a){return a.level%2?a.to:a.from}function ee(a){return a.level%2?a.from:a.to}function fe(a){var b=nd(a);return b?de(b[0]):0}function ge(a){var b=nd(a);return b?ee(Od(b)):a.text.length}function he(a,b){var c=gd(a.doc,b),d=Ic(a.doc,c);d!=c&&(b=kd(d));var e=nd(d),f=e?e[0].level%2?ge(d):fe(d):0;return Ob(b,f)}function ie(a,b){for(var c,d;c=Hc(d=gd(a.doc,b));)b=c.find().to.line;var e=nd(d),f=e?e[0].level%2?fe(d):ge(d):d.text.length;return Ob(b,f)}function je(a,b,c,d){var e=nd(a);if(!e)return ke(a,b,c,d);for(var f=d?function(b,c){do b+=c;while(b>0&&lf.test(a.text.charAt(b)));return b}:function(a,b){return a+b},g=e[0].level,h=0;h<e.length;++h){var i=e[h],j=i.level%2==g;if(i.from<b&&i.to>b||j&&(i.from==b||i.to==b))break}for(var k=f(b,i.level%2?-c:c);null!=k;)if(i.level%2==g){if(!(k<i.from||k>i.to))break;i=e[h+=c],k=i&&(c>0==i.level%2?f(i.to,-1):f(i.from,1))}else if(k==de(i))i=e[--h],k=i&&ee(i);else{if(k!=ee(i))break;i=e[++h],k=i&&de(i)}return 0>k||k>a.text.length?null:k}function ke(a,b,c,d){var e=b+c;if(d)for(;e>0&&lf.test(a.text.charAt(e));)e+=c;return 0>e||e>a.text.length?null:e}var le=/gecko\/\d/i.test(navigator.userAgent),me=/MSIE \d/.test(navigator.userAgent),ne=me&&(null==document.documentMode||document.documentMode<8),oe=me&&(null==document.documentMode||document.documentMode<9),pe=/WebKit\//.test(navigator.userAgent),qe=pe&&/Qt\/\d+\.\d+/.test(navigator.userAgent),re=/Chrome\//.test(navigator.userAgent),se=/Opera\//.test(navigator.userAgent),te=/Apple Computer/.test(navigator.vendor),ue=/KHTML\//.test(navigator.userAgent),ve=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),we=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),xe=/PhantomJS/.test(navigator.userAgent),ye=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),ze=ye||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Ae=ye||/Mac/.test(navigator.platform),Be=/windows/i.test(navigator.platform),Ce=se&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);Ce&&(Ce=Number(Ce[1]));var De,Ee,Fe,Ge=Ae&&(qe||se&&(null==Ce||12.11>Ce)),He=le||me&&!oe,Ie=!1,Je=!1,Ke=0,Le=0,Me=null;me?Me=-.53:le?Me=15:re?Me=-.7:te&&(Me=-1/3);var Ne,Oe,Pe=null;a.Pos=Ob,a.prototype={focus:function(){window.focus(),ib(this),Ab(this),fb(this)},setOption:function(a,b){var c=this.options,d=c[a];(c[a]!=b||"mode"==a)&&(c[a]=b,Qe.hasOwnProperty(a)&&ab(this,Qe[a])(this,b,d))},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a){this.state.keyMaps.push(a)},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(("string"==typeof a?b[c].name:b[c])==a)return b.splice(c,1),!0},addOverlay:ab(null,function(b,c){var d=b.token?b:a.getMode(this.options,b);if(d.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:d,modeSpec:b,opaque:c&&c.opaque}),this.state.modeGen++,db(this)}),removeOverlay:ab(null,function(a){for(var b=this.state.overlays,c=0;c<b.length;++c)if(b[c].modeSpec==a)return b.splice(c,1),this.state.modeGen++,db(this),void 0}),indentLine:ab(null,function(a,b,c){"string"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract"),Vb(this.doc,a)&&fc(this,a,b,c)}),indentSelection:ab(null,function(a){var b=this.doc.sel;if(Pb(b.from,b.to))return fc(this,b.from.line,a);for(var c=b.to.line-(b.to.ch?0:1),d=b.from.line;c>=d;++d)fc(this,d,a)}),getTokenAt:function(a){var b=this.doc;a=Tb(b,a);for(var c=J(this,a.line),d=this.doc.mode,e=gd(b,a.line),f=new sc(e.text,this.options.tabSize);f.pos<a.ch&&!f.eol();){f.start=f.pos;var g=d.token(f,c)}return{start:f.start,end:f.pos,string:f.current(),className:g||null,type:g||null,state:c}},getStateAfter:function(a){var b=this.doc;return a=Sb(b,null==a?b.first+b.size-1:a),J(this,a+1)},cursorCoords:function(a,b){var c,d=this.doc.sel;return c=null==a?d.head:"object"==typeof a?Tb(this.doc,a):a?d.from:d.to,U(this,c,b||"page")},charCoords:function(a,b){return T(this,Tb(this.doc,a),b||"page")},coordsChar:function(a){var b=_d(this.display.lineSpace),c=window.pageYOffset||(document.documentElement||document.body).scrollTop,d=window.pageXOffset||(document.documentElement||document.body).scrollLeft;return W(this,a.left-b.left-d,a.top-b.top-c)},defaultTextHeight:function(){return Y(this.display)},setGutterMarker:ab(null,function(a,b,c){return gc(this,a,function(a){var d=a.gutterMarkers||(a.gutterMarkers={});return d[b]=c,!c&&Wd(d)&&(a.gutterMarkers=null),!0})}),clearGutter:ab(null,function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,db(b,d,d+1),Wd(c.gutterMarkers)&&(c.gutterMarkers=null)),++d})}),addLineClass:ab(null,function(a,b,c){return gc(this,a,function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"wrapClass";if(a[d]){if(new RegExp("\\b"+c+"\\b").test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:ab(null,function(a,b,c){return gc(this,a,function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"wrapClass",e=a[d];if(!e)return!1;if(null==c)a[d]=null;else{var f=e.replace(new RegExp("^"+c+"\\b\\s*|\\s*\\b"+c+"\\b"),"");if(f==e)return!1;a[d]=f||null}return!0})}),addLineWidget:ab(null,function(a,b,c){return Pc(this,a,b,c)}),removeLineWidget:function(a){a.clear()},lineInfo:function(a){if("number"==typeof a){if(!Vb(this.doc,a))return null;var b=a;if(a=gd(this.doc,a),!a)return null}else{var b=kd(a);if(null==b)return null}return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(a,b,c,d,e){var f=this.display;a=U(this,Tb(this.doc,a));var g=a.bottom,h=a.left;if(b.style.position="absolute",f.sizer.appendChild(b),"over"==d)g=a.top;else if("above"==d||"near"==d){var i=Math.max(f.wrapper.clientHeight,this.doc.height),j=Math.max(f.sizer.clientWidth,f.lineSpace.clientWidth);("above"==d||a.bottom+b.offsetHeight>i)&&a.top>b.offsetHeight?g=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=i&&(g=a.bottom),h+b.offsetWidth>j&&(h=j-b.offsetWidth)}b.style.top=g+K(f)+"px",b.style.left=b.style.right="","right"==e?(h=f.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==e?h=0:"middle"==e&&(h=(f.sizer.clientWidth-b.offsetWidth)/2),b.style.left=h+"px"),c&&bc(this,h,g,h+b.offsetWidth,g+b.offsetHeight)},triggerOnKeyDown:ab(null,yb),execCommand:function(a){return Xe[a](this)},findPosH:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);for(var f=0,g=Tb(this.doc,a);b>f&&(g=hc(this.doc,g,e,c,d),!g.hitSide);++f);return g},moveH:ab(null,function(a,b){var c,d=this.doc.sel;c=d.shift||d.extend||Pb(d.from,d.to)?hc(this.doc,d.head,a,b,this.options.rtlMoveVisually):0>a?d.from:d.to,Wb(this.doc,c,c,a)}),deleteH:ab(null,function(a,b){var c=this.doc.sel;Pb(c.from,c.to)?Nb(this.doc,"",c.from,hc(this.doc,c.head,a,b,!1),"+delete"):Nb(this.doc,"",c.from,c.to,"+delete"),this.curOp.userSelChange=!0}),findPosV:function(a,b,c,d){var e=1,f=d;0>b&&(e=-1,b=-b);for(var g=0,h=Tb(this.doc,a);b>g;++g){var i=U(this,h,"div");if(null==f?f=i.left:i.left=f,h=ic(this,i,e,c),h.hitSide)break}return h},moveV:ab(null,function(a,b){var c=this.doc.sel,d=U(this,c.head,"div");null!=c.goalColumn&&(d.left=c.goalColumn);var e=ic(this,d,a,b);"page"==b&&ec(this,0,T(this,e,"div").top-d.top),Wb(this.doc,e,e,a),c.goalColumn=d.left}),toggleOverwrite:function(){(this.state.overwrite=!this.state.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite","")},scrollTo:ab(null,function(a,b){dc(this,a,b)}),getScrollInfo:function(){var a=this.display.scroller,b=gf;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-b,width:a.scrollWidth-b,clientHeight:a.clientHeight-b,clientWidth:a.clientWidth-b}},scrollIntoView:function(a){"number"==typeof a&&(a=Ob(a,0)),a&&null==a.line?bc(this,a.left,a.top,a.right,a.bottom):(a=a?Tb(this.doc,a):this.doc.sel.head,ac(this,a))},setSize:function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}null!=a&&(this.display.wrapper.style.width=c(a)),null!=b&&(this.display.wrapper.style.height=c(b)),this.refresh()},on:function(a,b){Fd(this,a,b)},off:function(a,b){Gd(this,a,b)},operation:function(a){return cb(this,a)},refresh:ab(null,function(){R(this),dc(this,this.doc.scrollLeft,this.doc.scrollTop),db(this)}),swapDoc:ab(null,function(a){var b=this.doc;return b.cm=null,fd(this,a),R(this),dc(this,a.scrollLeft,a.scrollTop),b}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};var Qe=a.optionHandlers={},Re=a.defaults={},Se=a.Init={toString:function(){return"CodeMirror.Init"}};lc("value","",function(a,b){a.setValue(b)},!0),lc("mode",null,function(a,b){a.doc.modeOption=b,d(a)},!0),lc("indentUnit",2,d,!0),lc("indentWithTabs",!1),lc("smartIndent",!0),lc("tabSize",4,function(a){d(a),R(a),db(a)},!0),lc("electricChars",!0),lc("rtlMoveVisually",!Be),lc("theme","default",function(a){i(a),j(a)},!0),lc("keyMap","default",h),lc("extraKeys",null),lc("onKeyEvent",null),lc("onDragEvent",null),lc("lineWrapping",!1,e,!0),lc("gutters",[],function(a){n(a.options),j(a)},!0),lc("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?t(a.display)+"px":"0",a.refresh()},!0),lc("lineNumbers",!1,function(a){n(a.options),j(a)},!0),lc("firstLineNumber",1,j,!0),lc("lineNumberFormatter",function(a){return a},j,!0),lc("showCursorWhenSelecting",!1,C,!0),lc("readOnly",!1,function(a,b){"nocursor"==b?(Bb(a),a.display.input.blur()):b||hb(a,!0)}),lc("dragDrop",!0),lc("cursorBlinkRate",530),lc("cursorHeight",1),lc("workTime",100),lc("workDelay",100),lc("flattenSpans",!0),lc("pollInterval",100),lc("undoDepth",40,function(a,b){a.doc.history.undoDepth=b}),lc("viewportMargin",10,function(a){a.refresh()},!0),lc("tabindex",null,function(a,b){a.display.input.tabIndex=b||""}),lc("autofocus",null);var Te=a.modes={},Ue=a.mimeModes={};a.defineMode=function(b,c){if(a.defaults.mode||"null"==b||(a.defaults.mode=b),arguments.length>2){c.dependencies=[];for(var d=2;d<arguments.length;++d)c.dependencies.push(arguments[d])}Te[b]=c},a.defineMIME=function(a,b){Ue[a]=b},a.resolveMode=function(b){if("string"==typeof b&&Ue.hasOwnProperty(b))b=Ue[b];else if("string"==typeof b&&/^[\w\-]+\/[\w\-]+\+xml$/.test(b))return a.resolveMode("application/xml");return"string"==typeof b?{name:b}:b||{name:"null"}},a.getMode=function(b,c){c=a.resolveMode(c);var d=Te[c.name];if(!d)return a.getMode(b,"text/plain");var e=d(b,c);if(Ve.hasOwnProperty(c.name)){var f=Ve[c.name];for(var g in f)f.hasOwnProperty(g)&&(e.hasOwnProperty(g)&&(e["_"+g]=e[g]),e[g]=f[g])}return e.name=c.name,e},a.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}}),a.defineMIME("text/plain","null");var Ve=a.modeExtensions={};a.extendMode=function(a,b){var c=Ve.hasOwnProperty(a)?Ve[a]:Ve[a]={};Sd(b,c)},a.defineExtension=function(b,c){a.prototype[b]=c},a.defineOption=lc;var We=[];a.defineInitHook=function(a){We.push(a)},a.copyState=mc,a.startState=nc,a.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);b=c.state,a=c.mode}return c||{mode:a,state:b}};var Xe=a.commands={selectAll:function(a){a.setSelection(Ob(a.firstLine(),0),Ob(a.lastLine()))},killLine:function(a){var b=a.getCursor(!0),c=a.getCursor(!1),d=!Pb(b,c);d||a.getLine(b.line).length!=b.ch?a.replaceRange("",b,d?c:Ob(b.line),"+delete"):a.replaceRange("",b,Ob(b.line+1,0),"+delete")},deleteLine:function(a){var b=a.getCursor().line;a.replaceRange("",Ob(b,0),Ob(b),"+delete")},undo:function(a){a.undo()},redo:function(a){a.redo()},goDocStart:function(a){a.extendSelection(Ob(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(Ob(a.lastLine()))},goLineStart:function(a){a.extendSelection(he(a,a.getCursor().line))},goLineStartSmart:function(a){var b=a.getCursor(),c=he(a,b.line),d=a.getLineHandle(c.line),e=nd(d);if(e&&0!=e[0].level)a.extendSelection(c);else{var f=Math.max(0,d.text.search(/\S/)),g=b.line==c.line&&b.ch<=f&&b.ch;a.extendSelection(Ob(c.line,g?0:f))}},goLineEnd:function(a){a.extendSelection(ie(a,a.getCursor().line))},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},delWordAfter:function(a){a.deleteH(1,"word")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("	","end","+input")},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.replaceSelection("	","end","+input")},transposeChars:function(a){var b=a.getCursor(),c=a.getLine(b.line);b.ch>0&&b.ch<c.length-1&&a.replaceRange(c.charAt(b.ch)+c.charAt(b.ch-1),Ob(b.line,b.ch-1),Ob(b.line,b.ch+1))},newlineAndIndent:function(a){ab(a,function(){a.replaceSelection("\n","end","+input"),a.indentLine(a.getCursor().line,null,!0)})()},toggleOverwrite:function(a){a.toggleOverwrite()}},Ye=a.keyMap={};Ye.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},Ye.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordBefore","Ctrl-Delete":"delWordAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},Ye.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordBefore","Ctrl-Alt-Backspace":"delWordAfter","Alt-Delete":"delWordAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]},Ye["default"]=Ae?Ye.macDefault:Ye.pcDefault,Ye.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},a.lookupKey=pc,a.isModifierKey=qc,a.keyName=rc,a.fromTextArea=function(b,c){function d(){b.value=j.getValue()}if(c||(c={}),c.value=b.value,!c.tabindex&&b.tabindex&&(c.tabindex=b.tabindex),null==c.autofocus){var e=document.body;try{e=document.activeElement}catch(f){}c.autofocus=e==b||null!=b.getAttribute("autofocus")&&e==document.body}if(b.form&&(Fd(b.form,"submit",d),!c.leaveSubmitMethodAlone)){var g=b.form,h=g.submit;try{var i=g.submit=function(){d(),g.submit=h,g.submit(),g.submit=i}}catch(f){}}b.style.display="none";var j=a(function(a){b.parentNode.insertBefore(a,b.nextSibling)},c);return j.save=d,j.getTextArea=function(){return b},j.toTextArea=function(){d(),b.parentNode.removeChild(j.getWrapperElement()),b.style.display="",b.form&&(Gd(b.form,"submit",d),"function"==typeof b.form.submit&&(b.form.submit=h))},j},sc.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(a){var b=this.string.charAt(this.pos);if("string"==typeof a)var c=b==a;else var c=b&&(a.test?a.test(b):a(b));return c?(++this.pos,b):void 0},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){var b=this.string.indexOf(a,this.pos);return b>-1?(this.pos=b,!0):void 0},backUp:function(a){this.pos-=a},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Md(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue},indentation:function(){return Md(this.string,null,this.tabSize)},match:function(a,b,c){if("string"!=typeof a){var d=this.string.slice(this.pos).match(a);return d&&d.index>0?null:(d&&b!==!1&&(this.pos+=d[0].length),d)}var e=function(a){return c?a.toLowerCase():a},f=this.string.substr(this.pos,a.length);return e(f)==e(a)?(b!==!1&&(this.pos+=a.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)}},a.StringStream=sc,a.TextMarker=tc,tc.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&$(a);for(var c=null,d=null,e=0;e<this.lines.length;++e){var f=this.lines[e],g=xc(f.markedSpans,this);null!=g.to&&(d=kd(f)),f.markedSpans=yc(f.markedSpans,g),null!=g.from?c=kd(f):this.collapsed&&!Jc(this.doc,f)&&a&&jd(f,Y(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(var e=0;e<this.lines.length;++e){var h=Ic(a.doc,this.lines[e]),i=l(a.doc,h);i>a.display.maxLineLength&&(a.display.maxLine=h,a.display.maxLineLength=i,a.display.maxLineChanged=!0)}null!=c&&a&&db(a,c,d+1),this.lines.length=0,this.explicitlyCleared=!0,this.collapsed&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&Zb(a)),b&&_(a),Id(this,"clear")}},tc.prototype.find=function(){for(var a,b,c=0;c<this.lines.length;++c){var d=this.lines[c],e=xc(d.markedSpans,this);if(null!=e.from||null!=e.to){var f=kd(d);null!=e.from&&(a=Ob(f,e.from)),null!=e.to&&(b=Ob(f,e.to))}}return"bookmark"==this.type?a:a&&{from:a,to:b}},tc.prototype.getOptions=function(a){var b=this.replacedWith;return{className:this.className,inclusiveLeft:this.inclusiveLeft,inclusiveRight:this.inclusiveRight,atomic:this.atomic,collapsed:this.collapsed,clearOnEnter:this.clearOnEnter,replacedWith:a?b&&b.cloneNode(!0):b,readOnly:this.readOnly,startStyle:this.startStyle,endStyle:this.endStyle}},tc.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=Qd(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)},tc.prototype.detachLine=function(a){if(this.lines.splice(Qd(this.lines,a),1),!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;(b.maybeHiddenMarkers||(b.maybeHiddenMarkers=[])).push(this)}},a.SharedTextMarker=vc,vc.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();Id(this,"clear")}},vc.prototype.find=function(){return this.primary.find()},vc.prototype.getOptions=function(a){var b=this.primary.getOptions(a);return b.shared=!0,b};var Ze=a.LineWidget=function(a,b,c){for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.cm=a,this.node=b};Ze.prototype.clear=Nc(function(){var a=this.line.widgets,b=kd(this.line);if(null!=b&&a){for(var c=0;c<a.length;++c)a[c]==this&&a.splice(c--,1);a.length||(this.line.widgets=null),jd(this.line,Math.max(0,this.line.height-Oc(this))),db(this.cm,b,b+1)}}),Ze.prototype.changed=Nc(function(){var a=this.height;this.height=null;var b=Oc(this)-a;if(b){jd(this.line,this.line.height+b);var c=kd(this.line);db(this.cm,c,c+1)}});var $e={},_e=/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\uFEFF]/g;cd.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;d>c;++c){var e=this.lines[c];this.height-=e.height,Sc(e),Id(e,"delete")}this.lines.splice(a,b)},collapse:function(a){a.splice.apply(a,[a.length,0].concat(this.lines))},insertInner:function(a,b,c){this.height+=c,this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(var d=0,e=b.length;e>d;++d)b[d].parent=this},iterN:function(a,b,c){for(var d=a+b;d>a;++a)if(c(this.lines[a]))return!0}},dd.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],e=d.chunkSize();if(e>a){var f=Math.min(b,e-a),g=d.height;if(d.removeInner(a,f),this.height-=g-d.height,e==f&&(this.children.splice(c--,1),d.parent=null),0==(b-=f))break;a=0}else a-=e}if(this.size-b<25){var h=[];this.collapse(h),this.children=[new cd(h)],this.children[0].parent=this}},collapse:function(a){for(var b=0,c=this.children.length;c>b;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length,this.height+=c;for(var d=0,e=this.children.length;e>d;++d){var f=this.children[d],g=f.chunkSize();if(g>=a){if(f.insertInner(a,b,c),f.lines&&f.lines.length>50){for(;f.lines.length>50;){var h=f.lines.splice(f.lines.length-25,25),i=new cd(h);f.height-=i.height,this.children.splice(d+1,0,i),i.parent=this}this.maybeSpill()}break}a-=g}},maybeSpill:function(){if(!(this.children.length<=10)){var a=this;do{var b=a.children.splice(a.children.length-5,5),c=new dd(b);if(a.parent){a.size-=c.size,a.height-=c.height;var d=Qd(a.parent.children,a);a.parent.children.splice(d+1,0,c)}else{var e=new dd(a.children);e.parent=a,a.children=[e,c],a=e}c.parent=a.parent}while(a.children.length>10);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0,e=this.children.length;e>d;++d){var f=this.children[d],g=f.chunkSize();if(g>a){var h=Math.min(b,g-a);if(f.iterN(a,h,c))return!0;if(0==(b-=h))break;a=0}else a-=g}}};var af=0,bf=a.Doc=function(a,b,c){if(!(this instanceof bf))return new bf(a,b,c);null==c&&(c=0),dd.call(this,[new cd([Qc("",null)])]),this.first=c,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.history=od(),this.frontier=c;var d=Ob(c,0);this.sel={from:d,to:d,head:d,anchor:d,shift:!1,extend:!1,goalColumn:null},this.id=++af,this.modeOption=b,"string"==typeof a&&(a=qf(a)),bd(this,{from:d,to:d,text:a},null,{head:d,anchor:d})};bf.prototype=Rd(dd.prototype,{iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0,e=b.length;e>d;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=id(this,this.first,this.first+this.size);return a===!1?b:b.join(a||"\n")},setValue:function(a){var b=Ob(this.first,0),c=this.first+this.size-1;Hb(this,{from:b,to:Ob(c,gd(this,c).text.length),text:qf(a),origin:"setValue"},{head:b,anchor:b},!0)},replaceRange:function(a,b,c,d){b=Tb(this,b),c=c?Tb(this,c):b,Nb(this,a,b,c,d)},getRange:function(a,b,c){var d=hd(this,Tb(this,a),Tb(this,b));return c===!1?d:d.join(c||"\n")},getLine:function(a){var b=this.getLineHandle(a);return b&&b.text},setLine:function(a,b){Vb(this,a)&&Nb(this,b,Ob(a,0),Tb(this,Ob(a)))},removeLine:function(a){Vb(this,a)&&Nb(this,"",Ob(a,0),Tb(this,Ob(a+1,0)))},getLineHandle:function(a){return Vb(this,a)?gd(this,a):void 0},getLineNumber:function(a){return kd(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return Tb(this,a)},getCursor:function(a){var b,c=this.sel;return b=null==a||"head"==a?c.head:"anchor"==a?c.anchor:"end"==a||a===!1?c.to:c.from,Rb(b)},somethingSelected:function(){return!Pb(this.sel.head,this.sel.anchor)},setCursor:bb(function(a,b,c){var d=Tb(this,"number"==typeof a?Ob(a,b||0):a);c?Wb(this,d):Yb(this,d,d)}),setSelection:bb(function(a,b){Yb(this,Tb(this,a),Tb(this,b||a))}),extendSelection:bb(function(a,b){Wb(this,Tb(this,a),b&&Tb(this,b))}),getSelection:function(a){return this.getRange(this.sel.from,this.sel.to,a)},replaceSelection:function(a,b,c){Hb(this,{from:this.sel.from,to:this.sel.to,text:qf(a),origin:c},b||"around")},undo:bb(function(){Jb(this,"undo")}),redo:bb(function(){Jb(this,"redo")}),setExtending:function(a){this.sel.extend=a},historySize:function(){var a=this.history;return{undo:a.done.length,redo:a.undone.length}},clearHistory:function(){this.history=od()},markClean:function(){this.history.dirtyCounter=0,this.history.lastOp=this.history.lastOrigin=null},isClean:function(){return 0==this.history.dirtyCounter},getHistory:function(){return{done:ud(this.history.done),undone:ud(this.history.undone)}},setHistory:function(a){var b=this.history=od();b.done=a.done.slice(0),b.undone=a.undone.slice(0)},markText:function(a,b,c){return uc(this,Tb(this,a),Tb(this,b),c,"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft};return a=Tb(this,a),uc(this,a,a,c,"bookmark")},findMarksAt:function(a){a=Tb(this,a);var b=[],c=gd(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var e=c[d];(null==e.from||e.from<=a.ch)&&(null==e.to||e.to>=a.ch)&&b.push(e.marker.parent||e.marker)}return b},getAllMarks:function(){var a=[];return this.iter(function(b){var c=b.markedSpans;if(c)for(var d=0;d<c.length;++d)null!=c[d].from&&a.push(c[d].marker)}),a},posFromIndex:function(a){var b,c=this.first;return this.iter(function(d){var e=d.text.length+1;return e>a?(b=a,!0):(a-=e,++c,void 0)}),Tb(this,Ob(c,b))},indexFromPos:function(a){a=Tb(this,a);var b=a.ch;return a.line<this.first||a.ch<0?0:(this.iter(this.first,a.line,function(a){b+=a.text.length+1}),b)},copy:function(a){var b=new bf(id(this,this.first,this.first+this.size),this.modeOption,this.first);return b.scrollTop=this.scrollTop,b.scrollLeft=this.scrollLeft,b.sel={from:this.sel.from,to:this.sel.to,head:this.sel.head,anchor:this.sel.anchor,shift:this.sel.shift,extend:!1,goalColumn:this.sel.goalColumn},a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory())),b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from),null!=a.to&&a.to<c&&(c=a.to);var d=new bf(id(this,b,c),a.mode||this.modeOption,b);return a.sharedHist&&(d.history=this.history),(this.linked||(this.linked=[])).push({doc:d,sharedHist:a.sharedHist}),d.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}],d},unlinkDoc:function(b){if(b instanceof a&&(b=b.doc),this.linked)for(var c=0;c<this.linked.length;++c){var d=this.linked[c];if(d.doc==b){this.linked.splice(c,1),b.unlinkDoc(this);break}}if(b.history==this.history){var e=[b.id];ed(b,function(a){e.push(a.id)},!0),b.history=od(),b.history.done=ud(this.history.done,e),b.history.undone=ud(this.history.undone,e)}},iterLinkedDocs:function(a){ed(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm
}}),bf.prototype.eachLine=bf.prototype.iter;var cf="iter insert remove copy getEditor".split(" ");for(var df in bf.prototype)bf.prototype.hasOwnProperty(df)&&Qd(cf,df)<0&&(a.prototype[df]=function(a){return function(){return a.apply(this.doc,arguments)}}(bf.prototype[df]));a.e_stop=Cd,a.e_preventDefault=Ad,a.e_stopPropagation=Bd;var ef,ff=0;a.on=Fd,a.off=Gd,a.signal=Hd;var gf=30,hf=a.Pass={toString:function(){return"CodeMirror.Pass"}};Ld.prototype={set:function(a,b){clearTimeout(this.id),this.id=setTimeout(b,a)}},a.countColumn=Md;var jf=[""],kf=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc]/,lf=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F\udc00-\udfff]/;a.replaceGetRect=function(a){_d=a};var mf=function(){if(oe)return!1;var a=Xd("div");return"draggable"in a||"dragDrop"in a}(),nf=/^$/;le?nf=/$'/:te?nf=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/:re&&(nf=/\-[^ \-\.?]|\?[^ \-\.?\]\}:;!'\"\),\/]|[\.!\"#&%\)*+,:;=>\]|\}~][\(\{\[<]|\$'/);var of,pf,qf=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;d>=b;){var e=a.indexOf("\n",b);-1==e&&(e=a.length);var f=a.slice(b,"\r"==a.charAt(e-1)?e-1:e),g=f.indexOf("\r");-1!=g?(c.push(f.slice(0,g)),b+=g+1):(c.push(f),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)};a.splitLines=qf;var rf=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},sf=function(){var a=Xd("div");return"oncopy"in a?!0:(a.setAttribute("oncopy","return;"),"function"==typeof a.oncopy)}(),tf={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};a.keyNames=tf,function(){for(var a=0;10>a;a++)tf[a+48]=String(a);for(var a=65;90>=a;a++)tf[a]=String.fromCharCode(a);for(var a=1;12>=a;a++)tf[a+111]=tf[a+63235]="F"+a}();var uf=function(){function a(a){return 255>=a?b.charAt(a):a>=1424&&1524>=a?"R":a>=1536&&1791>=a?c.charAt(a-1536):a>=1792&&2220>=a?"r":"L"}var b="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",c="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",d=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,e=/[stwN]/,f=/[LRr]/,g=/[Lb1n]/,h=/[1n]/,i="L";return function(b){if(!d.test(b))return!1;for(var c,j=b.length,k=[],l=0;j>l;++l)k.push(c=a(b.charCodeAt(l)));for(var l=0,m=i;j>l;++l){var c=k[l];"m"==c?k[l]=m:m=c}for(var l=0,n=i;j>l;++l){var c=k[l];"1"==c&&"r"==n?k[l]="n":f.test(c)&&(n=c,"r"==c&&(k[l]="R"))}for(var l=1,m=k[0];j-1>l;++l){var c=k[l];"+"==c&&"1"==m&&"1"==k[l+1]?k[l]="1":","!=c||m!=k[l+1]||"1"!=m&&"n"!=m||(k[l]=m),m=c}for(var l=0;j>l;++l){var c=k[l];if(","==c)k[l]="N";else if("%"==c){for(var o=l+1;j>o&&"%"==k[o];++o);for(var p=l&&"!"==k[l-1]||j-1>o&&"1"==k[o]?"1":"N",q=l;o>q;++q)k[q]=p;l=o-1}}for(var l=0,n=i;j>l;++l){var c=k[l];"L"==n&&"1"==c?k[l]="L":f.test(c)&&(n=c)}for(var l=0;j>l;++l)if(e.test(k[l])){for(var o=l+1;j>o&&e.test(k[o]);++o);for(var r="L"==(l?k[l-1]:i),s="L"==(j-1>o?k[o]:i),p=r||s?"L":"R",q=l;o>q;++q)k[q]=p;l=o-1}for(var t,u=[],l=0;j>l;)if(g.test(k[l])){var v=l;for(++l;j>l&&g.test(k[l]);++l);u.push({from:v,to:l,level:0})}else{var w=l,x=u.length;for(++l;j>l&&"L"!=k[l];++l);for(var q=w;l>q;)if(h.test(k[q])){q>w&&u.splice(x,0,{from:w,to:q,level:1});var y=q;for(++q;l>q&&h.test(k[q]);++q);u.splice(x,0,{from:y,to:q,level:2}),w=q}else++q;l>w&&u.splice(x,0,{from:w,to:l,level:1})}return 1==u[0].level&&(t=b.match(/^\s+/))&&(u[0].from=t[0].length,u.unshift({from:0,to:t[0].length,level:0})),1==Od(u).level&&(t=b.match(/\s+$/))&&(Od(u).to-=t[0].length,u.push({from:j-t[0].length,to:j,level:0})),u[0].level!=Od(u).level&&u.push({from:j,to:j,level:u[0].level}),u}}();a.version="3.1 +","undefined"!=typeof b&&(b.exports=a),"undefined"!=typeof window&&(window.CodeMirror=a)}()},{}],64:[function(a,b,c){!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["exports"],b):"undefined"!=typeof c?b(c):b(a.esprima={})}(this,function(a){"use strict";function b(a,b){if(!a)throw new Error("ASSERT: "+b)}function c(a,b){return mc.slice(a,b)}function d(a){return"0123456789".indexOf(a)>=0}function e(a){return"0123456789abcdefABCDEF".indexOf(a)>=0}function f(a){return"01234567".indexOf(a)>=0}function g(a){return" "===a||"	"===a||""===a||"\f"===a||""===a||a.charCodeAt(0)>=5760&&"".indexOf(a)>=0}function h(a){return"\n"===a||"\r"===a||"\u2028"===a||"\u2029"===a}function i(a){return"$"===a||"_"===a||"\\"===a||a>="a"&&"z">=a||a>="A"&&"Z">=a||a.charCodeAt(0)>=128&&lc.NonAsciiIdentifierStart.test(a)}function j(a){return"$"===a||"_"===a||"\\"===a||a>="a"&&"z">=a||a>="A"&&"Z">=a||a>="0"&&"9">=a||a.charCodeAt(0)>=128&&lc.NonAsciiIdentifierPart.test(a)}function k(a){switch(a){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0}return!1}function l(a){switch(a){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0}return!1}function m(a){return"eval"===a||"arguments"===a}function n(a){var b=!1;switch(a.length){case 2:b="if"===a||"in"===a||"do"===a;break;case 3:b="var"===a||"for"===a||"new"===a||"try"===a;break;case 4:b="this"===a||"else"===a||"case"===a||"void"===a||"with"===a;break;case 5:b="while"===a||"break"===a||"catch"===a||"throw"===a;break;case 6:b="return"===a||"typeof"===a||"delete"===a||"switch"===a;break;case 7:b="default"===a||"finally"===a;break;case 8:b="function"===a||"continue"===a||"debugger"===a;break;case 10:b="instanceof"===a}if(b)return!0;switch(a){case"const":return!0;case"yield":case"let":return!0}return nc&&l(a)?!0:k(a)}function o(){var a,b,c;for(b=!1,c=!1;rc>oc;)if(a=mc[oc],c)a=mc[oc++],h(a)&&(c=!1,"\r"===a&&"\n"===mc[oc]&&++oc,++pc,qc=oc);else if(b)h(a)?("\r"===a&&"\n"===mc[oc+1]&&++oc,++pc,++oc,qc=oc,oc>=rc&&A({},kc.UnexpectedToken,"ILLEGAL")):(a=mc[oc++],oc>=rc&&A({},kc.UnexpectedToken,"ILLEGAL"),"*"===a&&(a=mc[oc],"/"===a&&(++oc,b=!1)));else if("/"===a)if(a=mc[oc+1],"/"===a)oc+=2,c=!0;else{if("*"!==a)break;oc+=2,b=!0,oc>=rc&&A({},kc.UnexpectedToken,"ILLEGAL")}else if(g(a))++oc;else{if(!h(a))break;++oc,"\r"===a&&"\n"===mc[oc]&&++oc,++pc,qc=oc}}function p(a){var b,c,d,f=0;for(c="u"===a?4:2,b=0;c>b;++b){if(!(rc>oc&&e(mc[oc])))return"";d=mc[oc++],f=16*f+"0123456789abcdef".indexOf(d.toLowerCase())}return String.fromCharCode(f)}function q(){var a,b,c,d;if(a=mc[oc],i(a)){if(b=oc,"\\"===a){if(++oc,"u"!==mc[oc])return;if(++oc,d=oc,a=p("u")){if("\\"===a||!i(a))return;c=a}else oc=d,c="u"}else c=mc[oc++];for(;rc>oc&&(a=mc[oc],j(a));)if("\\"===a){if(++oc,"u"!==mc[oc])return;if(++oc,d=oc,a=p("u")){if("\\"===a||!j(a))return;c+=a}else oc=d,c+="u"}else c+=mc[oc++];return 1===c.length?{type:gc.Identifier,value:c,lineNumber:pc,lineStart:qc,range:[b,oc]}:n(c)?{type:gc.Keyword,value:c,lineNumber:pc,lineStart:qc,range:[b,oc]}:"null"===c?{type:gc.NullLiteral,value:c,lineNumber:pc,lineStart:qc,range:[b,oc]}:"true"===c||"false"===c?{type:gc.BooleanLiteral,value:c,lineNumber:pc,lineStart:qc,range:[b,oc]}:{type:gc.Identifier,value:c,lineNumber:pc,lineStart:qc,range:[b,oc]}}}function r(){var a,b,c,e=oc,f=mc[oc];return";"===f||"{"===f||"}"===f?(++oc,{type:gc.Punctuator,value:f,lineNumber:pc,lineStart:qc,range:[e,oc]}):","===f||"("===f||")"===f?(++oc,{type:gc.Punctuator,value:f,lineNumber:pc,lineStart:qc,range:[e,oc]}):(a=mc[oc+1],"."!==f||d(a)?(b=mc[oc+2],c=mc[oc+3],">"===f&&">"===a&&">"===b&&"="===c?(oc+=4,{type:gc.Punctuator,value:">>>=",lineNumber:pc,lineStart:qc,range:[e,oc]}):"="===f&&"="===a&&"="===b?(oc+=3,{type:gc.Punctuator,value:"===",lineNumber:pc,lineStart:qc,range:[e,oc]}):"!"===f&&"="===a&&"="===b?(oc+=3,{type:gc.Punctuator,value:"!==",lineNumber:pc,lineStart:qc,range:[e,oc]}):">"===f&&">"===a&&">"===b?(oc+=3,{type:gc.Punctuator,value:">>>",lineNumber:pc,lineStart:qc,range:[e,oc]}):"<"===f&&"<"===a&&"="===b?(oc+=3,{type:gc.Punctuator,value:"<<=",lineNumber:pc,lineStart:qc,range:[e,oc]}):">"===f&&">"===a&&"="===b?(oc+=3,{type:gc.Punctuator,value:">>=",lineNumber:pc,lineStart:qc,range:[e,oc]}):"="===a&&"<>=!+-*%&|^/".indexOf(f)>=0?(oc+=2,{type:gc.Punctuator,value:f+a,lineNumber:pc,lineStart:qc,range:[e,oc]}):f===a&&"+-<>&|".indexOf(f)>=0&&"+-<>&|".indexOf(a)>=0?(oc+=2,{type:gc.Punctuator,value:f+a,lineNumber:pc,lineStart:qc,range:[e,oc]}):"[]<>+-*%&|^!~?:=/".indexOf(f)>=0?{type:gc.Punctuator,value:mc[oc++],lineNumber:pc,lineStart:qc,range:[e,oc]}:void 0):{type:gc.Punctuator,value:mc[oc++],lineNumber:pc,lineStart:qc,range:[e,oc]})}function s(){var a,c,g;if(g=mc[oc],b(d(g)||"."===g,"Numeric literal must start with a decimal digit or a decimal point"),c=oc,a="","."!==g){if(a=mc[oc++],g=mc[oc],"0"===a){if("x"===g||"X"===g){for(a+=mc[oc++];rc>oc&&(g=mc[oc],e(g));)a+=mc[oc++];return a.length<=2&&A({},kc.UnexpectedToken,"ILLEGAL"),rc>oc&&(g=mc[oc],i(g)&&A({},kc.UnexpectedToken,"ILLEGAL")),{type:gc.NumericLiteral,value:parseInt(a,16),lineNumber:pc,lineStart:qc,range:[c,oc]}}if(f(g)){for(a+=mc[oc++];rc>oc&&(g=mc[oc],f(g));)a+=mc[oc++];return rc>oc&&(g=mc[oc],(i(g)||d(g))&&A({},kc.UnexpectedToken,"ILLEGAL")),{type:gc.NumericLiteral,value:parseInt(a,8),octal:!0,lineNumber:pc,lineStart:qc,range:[c,oc]}}d(g)&&A({},kc.UnexpectedToken,"ILLEGAL")}for(;rc>oc&&(g=mc[oc],d(g));)a+=mc[oc++]}if("."===g)for(a+=mc[oc++];rc>oc&&(g=mc[oc],d(g));)a+=mc[oc++];if("e"===g||"E"===g)if(a+=mc[oc++],g=mc[oc],("+"===g||"-"===g)&&(a+=mc[oc++]),g=mc[oc],d(g))for(a+=mc[oc++];rc>oc&&(g=mc[oc],d(g));)a+=mc[oc++];else g="character "+g,oc>=rc&&(g="<end>"),A({},kc.UnexpectedToken,"ILLEGAL");return rc>oc&&(g=mc[oc],i(g)&&A({},kc.UnexpectedToken,"ILLEGAL")),{type:gc.NumericLiteral,value:parseFloat(a),lineNumber:pc,lineStart:qc,range:[c,oc]}}function t(){var a,c,d,e,g,i,j="",k=!1;for(a=mc[oc],b("'"===a||'"'===a,"String literal must starts with a quote"),c=oc,++oc;rc>oc;){if(d=mc[oc++],d===a){a="";break}if("\\"===d)if(d=mc[oc++],h(d))++pc,"\r"===d&&"\n"===mc[oc]&&++oc;else switch(d){case"n":j+="\n";break;case"r":j+="\r";break;case"t":j+="	";break;case"u":case"x":i=oc,g=p(d),g?j+=g:(oc=i,j+=d);break;case"b":j+="\b";break;case"f":j+="\f";break;case"v":j+="";break;default:f(d)?(e="01234567".indexOf(d),0!==e&&(k=!0),rc>oc&&f(mc[oc])&&(k=!0,e=8*e+"01234567".indexOf(mc[oc++]),"0123".indexOf(d)>=0&&rc>oc&&f(mc[oc])&&(e=8*e+"01234567".indexOf(mc[oc++]))),j+=String.fromCharCode(e)):j+=d}else{if(h(d))break;j+=d}}return""!==a&&A({},kc.UnexpectedToken,"ILLEGAL"),{type:gc.StringLiteral,value:j,octal:k,lineNumber:pc,lineStart:qc,range:[c,oc]}}function u(){var a,c,d,e,f,g,i,k=!1,l=!1;for(sc=null,o(),d=oc,c=mc[oc],b("/"===c,"Regular expression literal must start with a slash"),a=mc[oc++];rc>oc;)if(c=mc[oc++],a+=c,k)"]"===c&&(k=!1);else if("\\"===c)c=mc[oc++],h(c)&&A({},kc.UnterminatedRegExp),a+=c;else{if("/"===c){l=!0;break}"["===c?k=!0:h(c)&&A({},kc.UnterminatedRegExp)}for(l||A({},kc.UnterminatedRegExp),e=a.substr(1,a.length-2),f="";rc>oc&&(c=mc[oc],j(c));)if(++oc,"\\"===c&&rc>oc)if(c=mc[oc],"u"===c)if(++oc,i=oc,c=p("u"))for(f+=c,a+="\\u";oc>i;++i)a+=mc[i];else oc=i,f+="u",a+="\\u";else a+="\\";else f+=c,a+=c;try{g=new RegExp(e,f)}catch(m){A({},kc.InvalidRegExp)}return{literal:a,value:g,range:[d,oc]}}function v(a){return a.type===gc.Identifier||a.type===gc.Keyword||a.type===gc.BooleanLiteral||a.type===gc.NullLiteral}function w(){var a,b;return o(),oc>=rc?{type:gc.EOF,lineNumber:pc,lineStart:qc,range:[oc,oc]}:(b=r(),"undefined"!=typeof b?b:(a=mc[oc],"'"===a||'"'===a?t():"."===a||d(a)?s():(b=q(),"undefined"!=typeof b?b:(A({},kc.UnexpectedToken,"ILLEGAL"),void 0))))}function x(){var a;return sc?(oc=sc.range[1],pc=sc.lineNumber,qc=sc.lineStart,a=sc,sc=null,a):(sc=null,w())}function y(){var a,b,c;return null!==sc?sc:(a=oc,b=pc,c=qc,sc=w(),oc=a,pc=b,qc=c,sc)}function z(){var a,b,c,d;return a=oc,b=pc,c=qc,o(),d=pc!==b,oc=a,pc=b,qc=c,d}function A(a,b){var c,d=Array.prototype.slice.call(arguments,2),e=b.replace(/%(\d)/g,function(a,b){return d[b]||""});throw"number"==typeof a.lineNumber?(c=new Error("Line "+a.lineNumber+": "+e),c.index=a.range[0],c.lineNumber=a.lineNumber,c.column=a.range[0]-qc+1):(c=new Error("Line "+pc+": "+e),c.index=oc,c.lineNumber=pc,c.column=oc-qc+1),c}function B(){try{A.apply(null,arguments)}catch(a){if(!uc.errors)throw a;uc.errors.push(a)}}function C(a){if(a.type===gc.EOF&&A(a,kc.UnexpectedEOS),a.type===gc.NumericLiteral&&A(a,kc.UnexpectedNumber),a.type===gc.StringLiteral&&A(a,kc.UnexpectedString),a.type===gc.Identifier&&A(a,kc.UnexpectedIdentifier),a.type===gc.Keyword){if(k(a.value))A(a,kc.UnexpectedReserved);else if(nc&&l(a.value))return B(a,kc.StrictReservedWord),void 0;A(a,kc.UnexpectedToken,a.value)}A(a,kc.UnexpectedToken,a.value)}function D(a){var b=x();(b.type!==gc.Punctuator||b.value!==a)&&C(b)}function E(a){var b=x();(b.type!==gc.Keyword||b.value!==a)&&C(b)}function F(a){var b=y();return b.type===gc.Punctuator&&b.value===a}function G(a){var b=y();return b.type===gc.Keyword&&b.value===a}function H(){var a=y(),b=a.value;return a.type!==gc.Punctuator?!1:"="===b||"*="===b||"/="===b||"%="===b||"+="===b||"-="===b||"<<="===b||">>="===b||">>>="===b||"&="===b||"^="===b||"|="===b}function I(){var a,b;if(";"===mc[oc])return x(),void 0;if(b=pc,o(),pc===b){if(F(";"))return x(),void 0;a=y(),a.type===gc.EOF||F("}")||C(a)}}function J(a){return a.type===ic.Identifier||a.type===ic.MemberExpression}function K(){var a=[];for(D("[");!F("]");)F(",")?(x(),a.push(null)):(a.push(jb()),F("]")||D(","));return D("]"),{type:ic.ArrayExpression,elements:a}}function L(a,b){var c,d;return c=nc,d=Kb(),b&&nc&&m(a[0].name)&&B(b,kc.StrictParamName),nc=c,{type:ic.FunctionExpression,id:null,params:a,defaults:[],body:d,rest:null,generator:!1,expression:!1}}function M(){var a=x();return a.type===gc.StringLiteral||a.type===gc.NumericLiteral?(nc&&a.octal&&B(a,kc.StrictOctalLiteral),Wb(a)):{type:ic.Identifier,name:a.value}}function N(){var a,b,c,d;return a=y(),a.type===gc.Identifier?(c=M(),"get"!==a.value||F(":")?"set"!==a.value||F(":")?(D(":"),{type:ic.Property,key:c,value:jb(),kind:"init"}):(b=M(),D("("),a=y(),a.type!==gc.Identifier&&C(x()),d=[nb()],D(")"),{type:ic.Property,key:b,value:L(d,a),kind:"set"}):(b=M(),D("("),D(")"),{type:ic.Property,key:b,value:L([]),kind:"get"})):a.type!==gc.EOF&&a.type!==gc.Punctuator?(b=M(),D(":"),{type:ic.Property,key:b,value:jb(),kind:"init"}):(C(a),void 0)}function O(){var a,b,c,d=[],e={},f=String;for(D("{");!F("}");)a=N(),b=a.key.type===ic.Identifier?a.key.name:f(a.key.value),c="init"===a.kind?jc.Data:"get"===a.kind?jc.Get:jc.Set,Object.prototype.hasOwnProperty.call(e,b)?(e[b]===jc.Data?nc&&c===jc.Data?B({},kc.StrictDuplicateProperty):c!==jc.Data&&B({},kc.AccessorDataProperty):c===jc.Data?B({},kc.AccessorDataProperty):e[b]&c&&B({},kc.AccessorGetSet),e[b]|=c):e[b]=c,d.push(a),F("}")||D(",");return D("}"),{type:ic.ObjectExpression,properties:d}}function P(){var a;return D("("),a=kb(),D(")"),a}function Q(){var a=y(),b=a.type;if(b===gc.Identifier)return{type:ic.Identifier,name:x().value};if(b===gc.StringLiteral||b===gc.NumericLiteral)return nc&&a.octal&&B(a,kc.StrictOctalLiteral),Wb(x());if(b===gc.Keyword){if(G("this"))return x(),{type:ic.ThisExpression};if(G("function"))return Mb()}return b===gc.BooleanLiteral?(x(),a.value="true"===a.value,Wb(a)):b===gc.NullLiteral?(x(),a.value=null,Wb(a)):F("[")?K():F("{")?O():F("(")?P():F("/")||F("/=")?Wb(u()):C(x())}function R(){var a=[];if(D("("),!F(")"))for(;rc>oc&&(a.push(jb()),!F(")"));)D(",");return D(")"),a}function S(){var a=x();return v(a)||C(a),{type:ic.Identifier,name:a.value}}function T(){return D("."),S()}function U(){var a;return D("["),a=kb(),D("]"),a}function V(){var a;return E("new"),a={type:ic.NewExpression,callee:X(),arguments:[]},F("(")&&(a.arguments=R()),a}function W(){var a;for(a=G("new")?V():Q();F(".")||F("[")||F("(");)a=F("(")?{type:ic.CallExpression,callee:a,arguments:R()}:F("[")?{type:ic.MemberExpression,computed:!0,object:a,property:U()}:{type:ic.MemberExpression,computed:!1,object:a,property:T()};return a}function X(){var a;for(a=G("new")?V():Q();F(".")||F("[");)a=F("[")?{type:ic.MemberExpression,computed:!0,object:a,property:U()}:{type:ic.MemberExpression,computed:!1,object:a,property:T()};return a}function Y(){var a,b=W();return a=y(),a.type!==gc.Punctuator?b:(!F("++")&&!F("--")||z()||(nc&&b.type===ic.Identifier&&m(b.name)&&B({},kc.StrictLHSPostfix),J(b)||A({},kc.InvalidLHSInAssignment),b={type:ic.UpdateExpression,operator:x().value,argument:b,prefix:!1}),b)}function Z(){var a,b;return a=y(),a.type!==gc.Punctuator&&a.type!==gc.Keyword?Y():F("++")||F("--")?(a=x(),b=Z(),nc&&b.type===ic.Identifier&&m(b.name)&&B({},kc.StrictLHSPrefix),J(b)||A({},kc.InvalidLHSInAssignment),b={type:ic.UpdateExpression,operator:a.value,argument:b,prefix:!0}):F("+")||F("-")||F("~")||F("!")?b={type:ic.UnaryExpression,operator:x().value,argument:Z()}:G("delete")||G("void")||G("typeof")?(b={type:ic.UnaryExpression,operator:x().value,argument:Z()},nc&&"delete"===b.operator&&b.argument.type===ic.Identifier&&B({},kc.StrictDelete),b):Y()}function $(){for(var a=Z();F("*")||F("/")||F("%");)a={type:ic.BinaryExpression,operator:x().value,left:a,right:Z()};return a}function _(){for(var a=$();F("+")||F("-");)a={type:ic.BinaryExpression,operator:x().value,left:a,right:$()};return a}function ab(){for(var a=_();F("<<")||F(">>")||F(">>>");)a={type:ic.BinaryExpression,operator:x().value,left:a,right:_()};return a}function bb(){var a,b;for(b=tc.allowIn,tc.allowIn=!0,a=ab();F("<")||F(">")||F("<=")||F(">=")||b&&G("in")||G("instanceof");)a={type:ic.BinaryExpression,operator:x().value,left:a,right:ab()};return tc.allowIn=b,a}function cb(){for(var a=bb();F("==")||F("!=")||F("===")||F("!==");)a={type:ic.BinaryExpression,operator:x().value,left:a,right:bb()};return a}function db(){for(var a=cb();F("&");)x(),a={type:ic.BinaryExpression,operator:"&",left:a,right:cb()};return a}function eb(){for(var a=db();F("^");)x(),a={type:ic.BinaryExpression,operator:"^",left:a,right:db()};return a}function fb(){for(var a=eb();F("|");)x(),a={type:ic.BinaryExpression,operator:"|",left:a,right:eb()};return a}function gb(){for(var a=fb();F("&&");)x(),a={type:ic.LogicalExpression,operator:"&&",left:a,right:fb()};return a}function hb(){for(var a=gb();F("||");)x(),a={type:ic.LogicalExpression,operator:"||",left:a,right:gb()};return a}function ib(){var a,b,c;return a=hb(),F("?")&&(x(),b=tc.allowIn,tc.allowIn=!0,c=jb(),tc.allowIn=b,D(":"),a={type:ic.ConditionalExpression,test:a,consequent:c,alternate:jb()}),a}function jb(){var a,b;return a=y(),b=ib(),H()&&(J(b)||A({},kc.InvalidLHSInAssignment),nc&&b.type===ic.Identifier&&m(b.name)&&B(a,kc.StrictLHSAssignment),b={type:ic.AssignmentExpression,operator:x().value,left:b,right:jb()}),b}function kb(){var a=jb();if(F(","))for(a={type:ic.SequenceExpression,expressions:[a]};rc>oc&&F(",");)x(),a.expressions.push(jb());return a}function lb(){for(var a,b=[];rc>oc&&!F("}")&&(a=Nb(),"undefined"!=typeof a);)b.push(a);return b}function mb(){var a;return D("{"),a=lb(),D("}"),{type:ic.BlockStatement,body:a}}function nb(){var a=x();return a.type!==gc.Identifier&&C(a),{type:ic.Identifier,name:a.value}}function ob(a){var b=nb(),c=null;return nc&&m(b.name)&&B({},kc.StrictVarName),"const"===a?(D("="),c=jb()):F("=")&&(x(),c=jb()),{type:ic.VariableDeclarator,id:b,init:c}}function pb(a){for(var b=[];rc>oc&&(b.push(ob(a)),F(","));)x();return b}function qb(){var a;return E("var"),a=pb(),I(),{type:ic.VariableDeclaration,declarations:a,kind:"var"}}function rb(a){var b;return E(a),b=pb(a),I(),{type:ic.VariableDeclaration,declarations:b,kind:a}}function sb(){return D(";"),{type:ic.EmptyStatement}}function tb(){var a=kb();return I(),{type:ic.ExpressionStatement,expression:a}}function ub(){var a,b,c;return E("if"),D("("),a=kb(),D(")"),b=Jb(),G("else")?(x(),c=Jb()):c=null,{type:ic.IfStatement,test:a,consequent:b,alternate:c}}function vb(){var a,b,c;return E("do"),c=tc.inIteration,tc.inIteration=!0,a=Jb(),tc.inIteration=c,E("while"),D("("),b=kb(),D(")"),F(";")&&x(),{type:ic.DoWhileStatement,body:a,test:b}}function wb(){var a,b,c;return E("while"),D("("),a=kb(),D(")"),c=tc.inIteration,tc.inIteration=!0,b=Jb(),tc.inIteration=c,{type:ic.WhileStatement,test:a,body:b}}function xb(){var a=x();return{type:ic.VariableDeclaration,declarations:pb(),kind:a.value}}function yb(){var a,b,c,d,e,f,g;return a=b=c=null,E("for"),D("("),F(";")?x():(G("var")||G("let")?(tc.allowIn=!1,a=xb(),tc.allowIn=!0,1===a.declarations.length&&G("in")&&(x(),d=a,e=kb(),a=null)):(tc.allowIn=!1,a=kb(),tc.allowIn=!0,G("in")&&(J(a)||A({},kc.InvalidLHSInForIn),x(),d=a,e=kb(),a=null)),"undefined"==typeof d&&D(";")),"undefined"==typeof d&&(F(";")||(b=kb()),D(";"),F(")")||(c=kb())),D(")"),g=tc.inIteration,tc.inIteration=!0,f=Jb(),tc.inIteration=g,"undefined"==typeof d?{type:ic.ForStatement,init:a,test:b,update:c,body:f}:{type:ic.ForInStatement,left:d,right:e,body:f,each:!1}}function zb(){var a,b=null;return E("continue"),";"===mc[oc]?(x(),tc.inIteration||A({},kc.IllegalContinue),{type:ic.ContinueStatement,label:null}):z()?(tc.inIteration||A({},kc.IllegalContinue),{type:ic.ContinueStatement,label:null}):(a=y(),a.type===gc.Identifier&&(b=nb(),Object.prototype.hasOwnProperty.call(tc.labelSet,b.name)||A({},kc.UnknownLabel,b.name)),I(),null!==b||tc.inIteration||A({},kc.IllegalContinue),{type:ic.ContinueStatement,label:b})}function Ab(){var a,b=null;return E("break"),";"===mc[oc]?(x(),tc.inIteration||tc.inSwitch||A({},kc.IllegalBreak),{type:ic.BreakStatement,label:null}):z()?(tc.inIteration||tc.inSwitch||A({},kc.IllegalBreak),{type:ic.BreakStatement,label:null}):(a=y(),a.type===gc.Identifier&&(b=nb(),Object.prototype.hasOwnProperty.call(tc.labelSet,b.name)||A({},kc.UnknownLabel,b.name)),I(),null!==b||tc.inIteration||tc.inSwitch||A({},kc.IllegalBreak),{type:ic.BreakStatement,label:b})}function Bb(){var a,b=null;return E("return"),tc.inFunctionBody||B({},kc.IllegalReturn)," "===mc[oc]&&i(mc[oc+1])?(b=kb(),I(),{type:ic.ReturnStatement,argument:b}):z()?{type:ic.ReturnStatement,argument:null}:(F(";")||(a=y(),F("}")||a.type===gc.EOF||(b=kb())),I(),{type:ic.ReturnStatement,argument:b})}function Cb(){var a,b;return nc&&B({},kc.StrictModeWith),E("with"),D("("),a=kb(),D(")"),b=Jb(),{type:ic.WithStatement,object:a,body:b}}function Db(){var a,b,c=[];for(G("default")?(x(),a=null):(E("case"),a=kb()),D(":");rc>oc&&!(F("}")||G("default")||G("case"))&&(b=Jb(),"undefined"!=typeof b);)c.push(b);return{type:ic.SwitchCase,test:a,consequent:c}}function Eb(){var a,b,c,d,e;if(E("switch"),D("("),a=kb(),D(")"),D("{"),F("}"))return x(),{type:ic.SwitchStatement,discriminant:a};for(b=[],d=tc.inSwitch,tc.inSwitch=!0,e=!1;rc>oc&&!F("}");)c=Db(),null===c.test&&(e&&A({},kc.MultipleDefaultsInSwitch),e=!0),b.push(c);return tc.inSwitch=d,D("}"),{type:ic.SwitchStatement,discriminant:a,cases:b}}function Fb(){var a;return E("throw"),z()&&A({},kc.NewlineAfterThrow),a=kb(),I(),{type:ic.ThrowStatement,argument:a}}function Gb(){var a;return E("catch"),D("("),F(")")||(a=kb(),nc&&a.type===ic.Identifier&&m(a.name)&&B({},kc.StrictCatchVariable)),D(")"),{type:ic.CatchClause,param:a,body:mb()}}function Hb(){var a,b=[],c=null;return E("try"),a=mb(),G("catch")&&b.push(Gb()),G("finally")&&(x(),c=mb()),0!==b.length||c||A({},kc.NoCatchOrFinally),{type:ic.TryStatement,block:a,guardedHandlers:[],handlers:b,finalizer:c}}function Ib(){return E("debugger"),I(),{type:ic.DebuggerStatement}}function Jb(){var a,b,c=y();if(c.type===gc.EOF&&C(c),c.type===gc.Punctuator)switch(c.value){case";":return sb();case"{":return mb();case"(":return tb()}if(c.type===gc.Keyword)switch(c.value){case"break":return Ab();case"continue":return zb();case"debugger":return Ib();case"do":return vb();case"for":return yb();case"function":return Lb();case"if":return ub();case"return":return Bb();case"switch":return Eb();case"throw":return Fb();case"try":return Hb();case"var":return qb();case"while":return wb();case"with":return Cb()}return a=kb(),a.type===ic.Identifier&&F(":")?(x(),Object.prototype.hasOwnProperty.call(tc.labelSet,a.name)&&A({},kc.Redeclaration,"Label",a.name),tc.labelSet[a.name]=!0,b=Jb(),delete tc.labelSet[a.name],{type:ic.LabeledStatement,label:a,body:b}):(I(),{type:ic.ExpressionStatement,expression:a})}function Kb(){var a,b,d,e,f,g,h,i,j=[];for(D("{");rc>oc&&(b=y(),b.type===gc.StringLiteral)&&(a=Nb(),j.push(a),a.expression.type===ic.Literal);)d=c(b.range[0]+1,b.range[1]-1),"use strict"===d?(nc=!0,e&&B(e,kc.StrictOctalLiteral)):!e&&b.octal&&(e=b);for(f=tc.labelSet,g=tc.inIteration,h=tc.inSwitch,i=tc.inFunctionBody,tc.labelSet={},tc.inIteration=!1,tc.inSwitch=!1,tc.inFunctionBody=!0;rc>oc&&!F("}")&&(a=Nb(),"undefined"!=typeof a);)j.push(a);return D("}"),tc.labelSet=f,tc.inIteration=g,tc.inSwitch=h,tc.inFunctionBody=i,{type:ic.BlockStatement,body:j}}function Lb(){var a,b,c,d,e,f,g,h,i,j=[];if(E("function"),d=y(),a=nb(),nc?m(d.value)&&B(d,kc.StrictFunctionName):m(d.value)?(f=d,g=kc.StrictFunctionName):l(d.value)&&(f=d,g=kc.StrictReservedWord),D("("),!F(")"))for(i={};rc>oc&&(d=y(),b=nb(),nc?(m(d.value)&&(e=d,g=kc.StrictParamName),Object.prototype.hasOwnProperty.call(i,d.value)&&(e=d,g=kc.StrictParamDupe)):f||(m(d.value)?(f=d,g=kc.StrictParamName):l(d.value)?(f=d,g=kc.StrictReservedWord):Object.prototype.hasOwnProperty.call(i,d.value)&&(f=d,g=kc.StrictParamDupe)),j.push(b),i[b.name]=!0,!F(")"));)D(",");return D(")"),h=nc,c=Kb(),nc&&f&&A(f,g),nc&&e&&B(e,g),nc=h,{type:ic.FunctionDeclaration,id:a,params:j,defaults:[],body:c,rest:null,generator:!1,expression:!1}}function Mb(){var a,b,c,d,e,f,g,h,i=null,j=[];if(E("function"),F("(")||(a=y(),i=nb(),nc?m(a.value)&&B(a,kc.StrictFunctionName):m(a.value)?(c=a,d=kc.StrictFunctionName):l(a.value)&&(c=a,d=kc.StrictReservedWord)),D("("),!F(")"))for(h={};rc>oc&&(a=y(),e=nb(),nc?(m(a.value)&&(b=a,d=kc.StrictParamName),Object.prototype.hasOwnProperty.call(h,a.value)&&(b=a,d=kc.StrictParamDupe)):c||(m(a.value)?(c=a,d=kc.StrictParamName):l(a.value)?(c=a,d=kc.StrictReservedWord):Object.prototype.hasOwnProperty.call(h,a.value)&&(c=a,d=kc.StrictParamDupe)),j.push(e),h[e.name]=!0,!F(")"));)D(",");return D(")"),g=nc,f=Kb(),nc&&c&&A(c,d),nc&&b&&B(b,d),nc=g,{type:ic.FunctionExpression,id:i,params:j,defaults:[],body:f,rest:null,generator:!1,expression:!1}}function Nb(){var a=y();if(a.type===gc.Keyword)switch(a.value){case"const":case"let":return rb(a.value);case"function":return Lb();default:return Jb()}return a.type!==gc.EOF?Jb():void 0}function Ob(){for(var a,b,d,e,f=[];rc>oc&&(b=y(),b.type===gc.StringLiteral)&&(a=Nb(),f.push(a),a.expression.type===ic.Literal);)d=c(b.range[0]+1,b.range[1]-1),"use strict"===d?(nc=!0,e&&B(e,kc.StrictOctalLiteral)):!e&&b.octal&&(e=b);for(;rc>oc&&(a=Nb(),"undefined"!=typeof a);)f.push(a);return f}function Pb(){var a;return nc=!1,a={type:ic.Program,body:Ob()}}function Qb(a,c,d,e,f){b("number"==typeof d,"Comment must have valid position"),uc.comments.length>0&&uc.comments[uc.comments.length-1].range[1]>d||uc.comments.push({type:a,value:c,range:[d,e],loc:f})}function Rb(){var a,b,c,d,e,f;for(a="",e=!1,f=!1;rc>oc;)if(b=mc[oc],f)b=mc[oc++],h(b)?(c.end={line:pc,column:oc-qc-1},f=!1,Qb("Line",a,d,oc-1,c),"\r"===b&&"\n"===mc[oc]&&++oc,++pc,qc=oc,a=""):oc>=rc?(f=!1,a+=b,c.end={line:pc,column:rc-qc},Qb("Line",a,d,rc,c)):a+=b;else if(e)h(b)?("\r"===b&&"\n"===mc[oc+1]?(++oc,a+="\r\n"):a+=b,++pc,++oc,qc=oc,oc>=rc&&A({},kc.UnexpectedToken,"ILLEGAL")):(b=mc[oc++],oc>=rc&&A({},kc.UnexpectedToken,"ILLEGAL"),a+=b,"*"===b&&(b=mc[oc],"/"===b&&(a=a.substr(0,a.length-1),e=!1,++oc,c.end={line:pc,column:oc-qc},Qb("Block",a,d,oc,c),a="")));else if("/"===b)if(b=mc[oc+1],"/"===b)c={start:{line:pc,column:oc-qc}},d=oc,oc+=2,f=!0,oc>=rc&&(c.end={line:pc,column:oc-qc},f=!1,Qb("Line",a,d,oc,c));else{if("*"!==b)break;d=oc,oc+=2,e=!0,c={start:{line:pc,column:oc-qc-2}},oc>=rc&&A({},kc.UnexpectedToken,"ILLEGAL")}else if(g(b))++oc;else{if(!h(b))break;++oc,"\r"===b&&"\n"===mc[oc]&&++oc,++pc,qc=oc}}function Sb(){var a,b,c,d=[];for(a=0;a<uc.comments.length;++a)b=uc.comments[a],c={type:b.type,value:b.value},uc.range&&(c.range=b.range),uc.loc&&(c.loc=b.loc),d.push(c);uc.comments=d}function Tb(){var a,b,d,e,f;return o(),a=oc,b={start:{line:pc,column:oc-qc}},d=uc.advance(),b.end={line:pc,column:oc-qc},d.type!==gc.EOF&&(e=[d.range[0],d.range[1]],f=c(d.range[0],d.range[1]),uc.tokens.push({type:hc[d.type],value:f,range:e,loc:b})),d}function Ub(){var a,b,c,d;return o(),a=oc,b={start:{line:pc,column:oc-qc}},c=uc.scanRegExp(),b.end={line:pc,column:oc-qc},uc.tokens.length>0&&(d=uc.tokens[uc.tokens.length-1],d.range[0]===a&&"Punctuator"===d.type&&("/"===d.value||"/="===d.value)&&uc.tokens.pop()),uc.tokens.push({type:"RegularExpression",value:c.literal,range:[a,oc],loc:b}),c}function Vb(){var a,b,c,d=[];for(a=0;a<uc.tokens.length;++a)b=uc.tokens[a],c={type:b.type,value:b.value},uc.range&&(c.range=b.range),uc.loc&&(c.loc=b.loc),d.push(c);uc.tokens=d}function Wb(a){return{type:ic.Literal,value:a.value}}function Xb(a){return{type:ic.Literal,value:a.value,raw:c(a.range[0],a.range[1])}}function Yb(){var a={};return a.range=[oc,oc],a.loc={start:{line:pc,column:oc-qc},end:{line:pc,column:oc-qc}},a.end=function(){this.range[1]=oc,this.loc.end.line=pc,this.loc.end.column=oc-qc},a.applyGroup=function(a){uc.range&&(a.groupRange=[this.range[0],this.range[1]]),uc.loc&&(a.groupLoc={start:{line:this.loc.start.line,column:this.loc.start.column},end:{line:this.loc.end.line,column:this.loc.end.column}})},a.apply=function(a){uc.range&&(a.range=[this.range[0],this.range[1]]),uc.loc&&(a.loc={start:{line:this.loc.start.line,column:this.loc.start.column},end:{line:this.loc.end.line,column:this.loc.end.column}})},a}function Zb(){var a,b;return o(),a=Yb(),D("("),b=kb(),D(")"),a.end(),a.applyGroup(b),b}function $b(){var a,b;for(o(),a=Yb(),b=G("new")?V():Q();F(".")||F("[");)F("[")?(b={type:ic.MemberExpression,computed:!0,object:b,property:U()},a.end(),a.apply(b)):(b={type:ic.MemberExpression,computed:!1,object:b,property:T()},a.end(),a.apply(b));return b}function _b(){var a,b;for(o(),a=Yb(),b=G("new")?V():Q();F(".")||F("[")||F("(");)F("(")?(b={type:ic.CallExpression,callee:b,arguments:R()},a.end(),a.apply(b)):F("[")?(b={type:ic.MemberExpression,computed:!0,object:b,property:U()},a.end(),a.apply(b)):(b={type:ic.MemberExpression,computed:!1,object:b,property:T()},a.end(),a.apply(b));return b}function ac(a){var b,c,d;b="[object Array]"===Object.prototype.toString.apply(a)?[]:{};for(c in a)a.hasOwnProperty(c)&&"groupRange"!==c&&"groupLoc"!==c&&(d=a[c],b[c]=null===d||"object"!=typeof d||d instanceof RegExp?d:ac(d));return b}function bc(a,b){return function(c){function d(a){return a.type===ic.LogicalExpression||a.type===ic.BinaryExpression}function e(c){var f,g;d(c.left)&&e(c.left),d(c.right)&&e(c.right),a&&(c.left.groupRange||c.right.groupRange?(f=c.left.groupRange?c.left.groupRange[0]:c.left.range[0],g=c.right.groupRange?c.right.groupRange[1]:c.right.range[1],c.range=[f,g]):"undefined"==typeof c.range&&(f=c.left.range[0],g=c.right.range[1],c.range=[f,g])),b&&(c.left.groupLoc||c.right.groupLoc?(f=c.left.groupLoc?c.left.groupLoc.start:c.left.loc.start,g=c.right.groupLoc?c.right.groupLoc.end:c.right.loc.end,c.loc={start:f,end:g}):"undefined"==typeof c.loc&&(c.loc={start:c.left.loc.start,end:c.right.loc.end}))
}return function(){var f,g;return o(),f=Yb(),g=c.apply(null,arguments),f.end(),a&&"undefined"==typeof g.range&&f.apply(g),b&&"undefined"==typeof g.loc&&f.apply(g),d(g)&&e(g),g}}}function cc(){var a;uc.comments&&(uc.skipComment=o,o=Rb),uc.raw&&(uc.createLiteral=Wb,Wb=Xb),(uc.range||uc.loc)&&(uc.parseGroupExpression=P,uc.parseLeftHandSideExpression=X,uc.parseLeftHandSideExpressionAllowCall=W,P=Zb,X=$b,W=_b,a=bc(uc.range,uc.loc),uc.parseAdditiveExpression=_,uc.parseAssignmentExpression=jb,uc.parseBitwiseANDExpression=db,uc.parseBitwiseORExpression=fb,uc.parseBitwiseXORExpression=eb,uc.parseBlock=mb,uc.parseFunctionSourceElements=Kb,uc.parseCatchClause=Gb,uc.parseComputedMember=U,uc.parseConditionalExpression=ib,uc.parseConstLetDeclaration=rb,uc.parseEqualityExpression=cb,uc.parseExpression=kb,uc.parseForVariableDeclaration=xb,uc.parseFunctionDeclaration=Lb,uc.parseFunctionExpression=Mb,uc.parseLogicalANDExpression=gb,uc.parseLogicalORExpression=hb,uc.parseMultiplicativeExpression=$,uc.parseNewExpression=V,uc.parseNonComputedProperty=S,uc.parseObjectProperty=N,uc.parseObjectPropertyKey=M,uc.parsePostfixExpression=Y,uc.parsePrimaryExpression=Q,uc.parseProgram=Pb,uc.parsePropertyFunction=L,uc.parseRelationalExpression=bb,uc.parseStatement=Jb,uc.parseShiftExpression=ab,uc.parseSwitchCase=Db,uc.parseUnaryExpression=Z,uc.parseVariableDeclaration=ob,uc.parseVariableIdentifier=nb,_=a(uc.parseAdditiveExpression),jb=a(uc.parseAssignmentExpression),db=a(uc.parseBitwiseANDExpression),fb=a(uc.parseBitwiseORExpression),eb=a(uc.parseBitwiseXORExpression),mb=a(uc.parseBlock),Kb=a(uc.parseFunctionSourceElements),Gb=a(uc.parseCatchClause),U=a(uc.parseComputedMember),ib=a(uc.parseConditionalExpression),rb=a(uc.parseConstLetDeclaration),cb=a(uc.parseEqualityExpression),kb=a(uc.parseExpression),xb=a(uc.parseForVariableDeclaration),Lb=a(uc.parseFunctionDeclaration),Mb=a(uc.parseFunctionExpression),X=a(X),gb=a(uc.parseLogicalANDExpression),hb=a(uc.parseLogicalORExpression),$=a(uc.parseMultiplicativeExpression),V=a(uc.parseNewExpression),S=a(uc.parseNonComputedProperty),N=a(uc.parseObjectProperty),M=a(uc.parseObjectPropertyKey),Y=a(uc.parsePostfixExpression),Q=a(uc.parsePrimaryExpression),Pb=a(uc.parseProgram),L=a(uc.parsePropertyFunction),bb=a(uc.parseRelationalExpression),Jb=a(uc.parseStatement),ab=a(uc.parseShiftExpression),Db=a(uc.parseSwitchCase),Z=a(uc.parseUnaryExpression),ob=a(uc.parseVariableDeclaration),nb=a(uc.parseVariableIdentifier)),"undefined"!=typeof uc.tokens&&(uc.advance=w,uc.scanRegExp=u,w=Tb,u=Ub)}function dc(){"function"==typeof uc.skipComment&&(o=uc.skipComment),uc.raw&&(Wb=uc.createLiteral),(uc.range||uc.loc)&&(_=uc.parseAdditiveExpression,jb=uc.parseAssignmentExpression,db=uc.parseBitwiseANDExpression,fb=uc.parseBitwiseORExpression,eb=uc.parseBitwiseXORExpression,mb=uc.parseBlock,Kb=uc.parseFunctionSourceElements,Gb=uc.parseCatchClause,U=uc.parseComputedMember,ib=uc.parseConditionalExpression,rb=uc.parseConstLetDeclaration,cb=uc.parseEqualityExpression,kb=uc.parseExpression,xb=uc.parseForVariableDeclaration,Lb=uc.parseFunctionDeclaration,Mb=uc.parseFunctionExpression,P=uc.parseGroupExpression,X=uc.parseLeftHandSideExpression,W=uc.parseLeftHandSideExpressionAllowCall,gb=uc.parseLogicalANDExpression,hb=uc.parseLogicalORExpression,$=uc.parseMultiplicativeExpression,V=uc.parseNewExpression,S=uc.parseNonComputedProperty,N=uc.parseObjectProperty,M=uc.parseObjectPropertyKey,Q=uc.parsePrimaryExpression,Y=uc.parsePostfixExpression,Pb=uc.parseProgram,L=uc.parsePropertyFunction,bb=uc.parseRelationalExpression,Jb=uc.parseStatement,ab=uc.parseShiftExpression,Db=uc.parseSwitchCase,Z=uc.parseUnaryExpression,ob=uc.parseVariableDeclaration,nb=uc.parseVariableIdentifier),"function"==typeof uc.scanRegExp&&(w=uc.advance,u=uc.scanRegExp)}function ec(a){var b,c=a.length,d=[];for(b=0;c>b;++b)d[b]=a.charAt(b);return d}function fc(a,b){var c,d;d=String,"string"==typeof a||a instanceof String||(a=d(a)),mc=a,oc=0,pc=mc.length>0?1:0,qc=0,rc=mc.length,sc=null,tc={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1},uc={},"undefined"!=typeof b&&(uc.range="boolean"==typeof b.range&&b.range,uc.loc="boolean"==typeof b.loc&&b.loc,uc.raw="boolean"==typeof b.raw&&b.raw,"boolean"==typeof b.tokens&&b.tokens&&(uc.tokens=[]),"boolean"==typeof b.comment&&b.comment&&(uc.comments=[]),"boolean"==typeof b.tolerant&&b.tolerant&&(uc.errors=[])),rc>0&&"undefined"==typeof mc[0]&&(a instanceof String&&(mc=a.valueOf()),"undefined"==typeof mc[0]&&(mc=ec(a))),cc();try{c=Pb(),"undefined"!=typeof uc.comments&&(Sb(),c.comments=uc.comments),"undefined"!=typeof uc.tokens&&(Vb(),c.tokens=uc.tokens),"undefined"!=typeof uc.errors&&(c.errors=uc.errors),(uc.range||uc.loc)&&(c.body=ac(c.body))}catch(e){throw e}finally{dc(),uc={}}return c}var gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc;gc={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8},hc={},hc[gc.BooleanLiteral]="Boolean",hc[gc.EOF]="<end>",hc[gc.Identifier]="Identifier",hc[gc.Keyword]="Keyword",hc[gc.NullLiteral]="Null",hc[gc.NumericLiteral]="Numeric",hc[gc.Punctuator]="Punctuator",hc[gc.StringLiteral]="String",ic={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},jc={Data:1,Get:2,Set:4},kc={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},lc={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")},"undefined"==typeof"esprima"[0]&&(c=function(a,b){return mc.slice(a,b).join("")}),a.version="1.0.2",a.parse=fc,a.Syntax=function(){var a,b={};"function"==typeof Object.create&&(b=Object.create(null));for(a in ic)ic.hasOwnProperty(a)&&(b[a]=ic[a]);return"function"==typeof Object.freeze&&Object.freeze(b),b}()})},{}],65:[function(a,b){function c(a){if(!a||"[object Object]"!==toString.call(a)||a.nodeType||a.setInterval)return!1;var b=hasOwnProperty.call(a,"constructor"),c=hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!c)return!1;var e;for(e in a);return void 0===e||d.call(a,e)}var d=Object.prototype.hasOwnProperty;b.exports=function e(){var a,b,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},j=2),"object"!=typeof i&&"function"!=typeof i&&(i={});k>j;j++)if(null!=(a=arguments[j]))for(b in a)d=i[b],f=a[b],i!==f&&(l&&f&&(c(f)||(g=Array.isArray(f)))?(g?(g=!1,h=d&&Array.isArray(d)?d:[]):h=d&&c(d)?d:{},i[b]=e(l,h,f)):void 0!==f&&(i[b]=f));return i}},{}],66:[function(a,b){function c(a,b,c){c=c||{};var d={};[a.prototype,c].forEach(function(a){Object.getOwnPropertyNames(a).forEach(function(b){d[b]=Object.getOwnPropertyDescriptor(a,b)})}),a.prototype=Object.create(b.prototype,d),a.super=b}b.exports=c},{}],67:[function(a,b){function c(a,b){this.options=b,this.db=a,this.persona=i(),this.options=b}var d=a("levelup"),e=a("level-js"),f=a("websocket-stream"),g=a("level-sublevel"),h=a("multilevel"),i=a("persona-id"),j=a("browser-request"),k=a("level-delete-range");b.exports=function(a){a||(a={}),a.baseURL||(a.baseURL=""),a.dbName||(a.dbName="data");var b=g(d(a.dbName,{db:e,valueEncoding:"json"}));return new c(b,a)},c.prototype.getProfile=function(a){var b=this,c={withCredentials:!0,json:!0,url:this.options.baseURL+"/_profile"};j(c,function(c,d,e){return c?a(c,{}):e.email?(b.db.put("profile",e,function(b){a(b,e)}),void 0):a(c,e)})},c.prototype.destroy=function(a,b){var c=a.prefix();k(a,{start:c,end:c+""},b)},c.prototype.remote=function(a){var b=this.options.baseURL.replace("http:","ws:")+"/"+a,c=f(b),d=h.client();return this.options.verbose&&d.on("data",function(a){console.log(a)}),c.on("error",function(a){this.options.verbose&&console.log("websocket error",a)}),c.pipe(d.createRpcStream()).pipe(c),d},c.prototype.copy=function(a,b,c){function d(a){console.log("level-user",a)}var e=a.createReadStream({valueEncoding:"binary"}),f=b.createWriteStream({valueEncoding:"binary"});this.options.verbose&&(f.on("data",d),e.on("data",d)),e.pipe(f);var g=!1;f.on("close",function(){g||(c(),g=!0)}),f.on("error",function(a){g||(c(a),g=!0)})}},{"browser-request":68,"level-delete-range":69,"level-js":73,"level-sublevel":80,levelup:93,multilevel:123,"persona-id":157,"websocket-stream":160}],68:[function(a,b){function c(a,b){if("function"!=typeof b)throw new Error("Bad callback given: "+b);if(!a)throw new Error("No options given");var g=a.onResponse;if(a="string"==typeof a?{uri:a}:JSON.parse(JSON.stringify(a)),a.onResponse=g,a.verbose&&(c.log=f()),a.url&&(a.uri=a.url,delete a.url),!a.uri&&""!==a.uri)throw new Error("options.uri is a required argument");if("string"!=typeof a.uri)throw new Error("options.uri must be a string");for(var h=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],j=0;j<h.length;j++)if(a[h[j]])throw new Error("options."+h[j]+" is not supported");if(a.callback=b,a.method=a.method||"GET",a.headers=a.headers||{},a.body=a.body||null,a.timeout=a.timeout||c.DEFAULT_TIMEOUT,a.headers.host)throw new Error("Options.headers.host is not supported");return a.json&&(a.headers.accept=a.headers.accept||"application/json","GET"!==a.method&&(a.headers["content-type"]="application/json"),"boolean"!=typeof a.json?a.body=JSON.stringify(a.json):"string"!=typeof a.body&&(a.body=JSON.stringify(a.body))),a.onResponse=a.onResponse||e,a.onResponse===!0&&(a.onResponse=b,a.callback=e),!a.headers.authorization&&a.auth&&(a.headers.authorization="Basic "+i(a.auth.username+":"+a.auth.password)),d(a)}function d(a){function b(){k=!0;var b=new Error("ETIMEDOUT");return b.code="ETIMEDOUT",b.duration=a.timeout,c.log.error("Timeout",{id:i._id,milliseconds:a.timeout}),a.callback(b,i)}function d(){if(k)return c.log.debug("Ignoring timed out state change",{state:i.readyState,id:i.id});if(c.log.debug("State change",{state:i.readyState,id:i.id,timed_out:k}),i.readyState===j.OPENED){c.log.debug("Request started",{id:i.id});for(var b in a.headers)i.setRequestHeader(b,a.headers[b])}else i.readyState===j.HEADERS_RECEIVED?e():i.readyState===j.LOADING?(e(),f()):i.readyState===j.DONE&&(e(),f(),g())}function e(){if(!p.response){if(p.response=!0,c.log.debug("Got response",{id:i.id,status:i.status}),clearTimeout(i.timeoutTimer),i.statusCode=i.status,m&&0==i.statusCode){var b=new Error("CORS request rejected: "+a.uri);return b.cors="rejected",p.loading=!0,p.end=!0,a.callback(b,i)}a.onResponse(null,i)}}function f(){p.loading||(p.loading=!0,c.log.debug("Response body loading",{id:i.id}))}function g(){if(!p.end){if(p.end=!0,c.log.debug("Request done",{id:i.id}),i.body=i.responseText,a.json)try{i.body=JSON.parse(i.responseText)}catch(b){return a.callback(b,i)}a.callback(null,i,i.body)}}var i=new j,k=!1,m=h(a.uri),n="withCredentials"in i;if(l+=1,i.seq_id=l,i.id=l+": "+a.method+" "+a.uri,i._id=i.id,m&&!n){var o=new Error("Browser does not support cross-origin request: "+a.uri);return o.cors="unsupported",a.callback(o,i)}i.timeoutTimer=setTimeout(b,a.timeout);var p={response:!1,loading:!1,end:!1};return i.onreadystatechange=d,i.open(a.method,a.uri,!0),m&&(i.withCredentials=!!a.withCredentials),i.send(a.body),i}function e(){}function f(){var a,b,c={},d=["trace","debug","info","warn","error"];for(b=0;b<d.length;b++)a=d[b],c[a]=e,"undefined"!=typeof console&&console&&console[a]&&(c[a]=g(console,a));return c}function g(a,b){function c(c,d){return"object"==typeof d&&(c+=" "+JSON.stringify(d)),a[b].call(a,c)}return c}function h(a){var b,c=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{b=location.href}catch(d){b=document.createElement("a"),b.href="",b=b.href}var e=c.exec(b.toLowerCase())||[],f=c.exec(a.toLowerCase()),g=!(!f||f[1]==e[1]&&f[2]==e[2]&&(f[3]||("http:"===f[1]?80:443))==(e[3]||("http:"===e[1]?80:443)));return g}function i(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);switch(m=n.join(""),a.length%3){case 1:m=m.slice(0,-2)+"==";break;case 2:m=m.slice(0,-1)+"="}return m}var j=XMLHttpRequest;if(!j)throw new Error("missing XMLHttpRequest");b.exports=c,c.log={trace:e,debug:e,info:e,warn:e,error:e};var k=18e4,l=0;c.withCredentials=!1,c.DEFAULT_TIMEOUT=k;var m=["get","put","post","head"];m.forEach(function(a){var b=a.toUpperCase(),d=a.toLowerCase();c[d]=function(a){"string"==typeof a?a={method:b,uri:a}:(a=JSON.parse(JSON.stringify(a)),a.method=b);var d=[a].concat(Array.prototype.slice.apply(arguments,[1]));return c.apply(this,d)}}),c.couch=function(a,b){function d(a,c,d){if(a)return b(a,c,d);if((c.statusCode<200||c.statusCode>299)&&d.error){a=new Error("CouchDB error: "+(d.error.reason||d.error.error));for(var e in d)a[e]=d[e];return b(a,c,d)}return b(a,c,d)}"string"==typeof a&&(a={uri:a}),a.json=!0,a.body&&(a.json=a.body),delete a.body,b=b||e;var f=c(a,d);return f}},{}],69:[function(a,b){function c(a,b,c){b=b||{},c=c||d;var f=a.keyStream(b);f.pipe(e(function(b,c){a.del(b,c)})).on("finish",c)}function d(){}var e=a("end-stream");b.exports=c},{"end-stream":70}],70:[function(a,b){function c(a,b){var c=0,f=!1;b=b||d;var g=e(function(b){c++,a(b,function(a){return a?g.emit("error",a):(c--,0===c&&f&&g.emit("finish"),void 0)})},function(){f=!0,0===c&&this.emit("finish")});return g}function d(){}var e=a("write-stream");b.exports=c},{"write-stream":72}],71:[function(a,b){function c(a,b){function c(b){a.push(b)}function e(){b(a),this.emit("end")}return"function"==typeof a&&(b=a,a=[]),d(c,e)}var d=a("./index");b.exports=c},{"./index":72}],72:[function(a,b){function c(a,b){function c(b){var c=a.call(g,b);return c===!1?!1:!0}function f(a){h||(h=!0,arguments.length&&g.write(a),b.call(g))}var g=new e,h=!1;return b=b||d,g.write=c,g.end=f,g.writable=!0,g}function d(){this.emit("finish")}var e=a("stream");b.exports=c,c.toArray=a("./array")},{"./array":71,stream:50}],73:[function(a,b){function c(a){if(!(this instanceof c))return new c(a);if(!a)throw new Error("constructor requires at least a location argument");this.location=a}function d(a){for(var b=new ArrayBuffer(2*a.length),c=new Uint16Array(b),d=0,e=a.length;e>d;d++)c[d]=a.charCodeAt(d);return b}b.exports=c;var e=a("idb-wrapper"),f=a("abstract-leveldown").AbstractLevelDOWN,g=a("util"),h=a("./iterator"),i=a("isbuffer");g.inherits(c,f),c.prototype._open=function(a,b){var c=this;this.idb=new e({storeName:this.location,autoIncrement:!1,keyPath:null,onStoreReady:function(){b&&b(null,c.idb)},onError:function(a){b&&b(a)}})},c.prototype._get=function(a,b,c){this.idb.get(a,function(e){return void 0===e?c(new Error("NotFound")):(b.asBuffer===!1||i(e)||(e=d(String(e))),c(null,e,a))},c)},c.prototype._del=function(a,b,c){this.idb.remove(a,c,c)},c.prototype._put=function(a,b,c,d){this.idb.put(a,b,function(){d()},d)},c.prototype.iterator=function(a){return"object"!=typeof a&&(a={}),new h(this.idb,a)},c.prototype._batch=function(a,b,c){var d,e;for(e=0;e<a.length;e++)d=a[e],"del"===d.type&&(d.type="remove");return this.idb.batch(a,function(){c()},c)},c.prototype._close=function(a){this.idb.db.close(),a()},c.prototype._approximateSize=function(){throw new Error("Not implemented")},c.prototype._isBuffer=i;c.prototype._checkKeyValue=function(a,b){return null===a||void 0===a?new Error(b+" cannot be `null` or `undefined`"):null===a||void 0===a?new Error(b+" cannot be `null` or `undefined`"):i(a)&&0===a.byteLength?new Error(b+" cannot be an empty ArrayBuffer"):""===String(a)?new Error(b+" cannot be an empty String"):0===a.length?new Error(b+" cannot be an empty Array"):void 0}},{"./iterator":74,"abstract-leveldown":77,"idb-wrapper":78,isbuffer:79,util:59}],74:[function(a,b){function c(a,b){b||(b={}),this.options=b,e.call(this,a),this._order=b.reverse?"DESC":"ASC",this._start=b.start,this._limit=b.limit,this._limit&&(this._count=0),this._end=b.end,this._done=!1}var d=a("util"),e=a("abstract-leveldown").AbstractIterator;b.exports=c,d.inherits(c,e),c.prototype.createIterator=function(){var a,b,c="undefined"!=typeof this._start&&"undefined"==typeof this._end,d="undefined"==typeof this._start&&"undefined"!=typeof this._end,e="undefined"!=typeof this._start&&"undefined"!=typeof this._end;if(c){var f=this._start;"ASC"===this._order?a=f:b=f}else if(d){var f=this._end;"DESC"===this._order?a=f:b=f}else e&&(a=this._start,b=this._end,this._start>this._end&&(a=this._end,b=this._start));(a||b)&&(this._keyRange=this.options.keyRange||this.db.makeKeyRange({lower:a,upper:b})),this.iterator=this.db.iterate(this.onItem.bind(this),{keyRange:this._keyRange,autoContinue:!1,order:this._order,onError:function(a){console.log("horrible error",a)}})},c.prototype.onItem=function(a,b){return!b&&this.callback?(this.callback(),this.callback=!1,void 0):(this._limit&&this._limit>0?this._limit>this._count&&this.callback(!1,b.key,b.value):this.callback(!1,b.key,b.value),this._limit&&this._count++,b&&b.continue(),void 0)},c.prototype._next=function(a){return a?(this._started||(this.createIterator(),this._started=!0),this.callback=a,void 0):new Error("next() requires a callback argument")}},{"abstract-leveldown":77,util:59}],75:[function(a,b){function c(a){this._db=a,this._operations=[],this._written=!1}var d=a("__browserify_process");c.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},c.prototype.put=function(a,b){this._checkWritten();var c=this._db._checkKeyValue(a,"key",this._db._isBuffer);if(c)throw c;if(c=this._db._checkKeyValue(b,"value",this._db._isBuffer))throw c;return this._db._isBuffer(a)||(a=String(a)),this._db._isBuffer(b)||(b=String(b)),this._operations.push({type:"put",key:a,value:b}),this},c.prototype.del=function(a){this._checkWritten();var b=this._db._checkKeyValue(a,"key",this._db._isBuffer);if(b)throw b;return this._db._isBuffer(a)||(a=String(a)),this._operations.push({type:"del",key:a}),this},c.prototype.clear=function(){return this._checkWritten(),this._operations=[],this},c.prototype.write=function(a,b){if(this._checkWritten(),"function"==typeof a&&(b=a),"function"!=typeof b)throw new Error("write() requires a callback argument");return"object"!=typeof a&&(a={}),this._written=!0,"function"==typeof this._db._batch?this._db._batch(this._operations,a,b):(d.nextTick(b),void 0)},b.exports=c},{__browserify_process:40}],76:[function(a,b){function c(a){this.db=a,this._ended=!1,this._nexting=!1}var d=a("__browserify_process");c.prototype.next=function(a){var b=this;if("function"!=typeof a)throw new Error("next() requires a callback argument");return b._ended?a(new Error("cannot call next() after end()")):b._nexting?a(new Error("cannot call next() before previous next() has completed")):(b._nexting=!0,"function"==typeof b._next?b._next(function(){b._nexting=!1,a.apply(null,arguments)}):(d.nextTick(function(){b._nexting=!1,a()}),void 0))},c.prototype.end=function(a){if("function"!=typeof a)throw new Error("end() requires a callback argument");return this._ended?a(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(a):(d.nextTick(a),void 0))},b.exports=c},{__browserify_process:40}],77:[function(a,b){function c(a){if(!arguments.length||void 0===a)throw new Error("constructor requires at least a location argument");if("string"!=typeof a)throw new Error("constructor requires a location string argument");this.location=a}var d=a("__browserify_process"),e=a("__browserify_Buffer"),f=a("./abstract-iterator"),g=a("./abstract-chained-batch");c.prototype.open=function(a,b){if("function"==typeof a&&(b=a),"function"!=typeof b)throw new Error("open() requires a callback argument");return"object"!=typeof a&&(a={}),"function"==typeof this._open?this._open(a,b):(d.nextTick(b),void 0)},c.prototype.close=function(a){if("function"!=typeof a)throw new Error("close() requires a callback argument");return"function"==typeof this._close?this._close(a):(d.nextTick(a),void 0)},c.prototype.get=function(a,b,c){var e=this;if("function"==typeof b&&(c=b),"function"!=typeof c)throw new Error("get() requires a callback argument");var f=e._checkKeyValue(a,"key",e._isBuffer);return f?c(f):(e._isBuffer(a)||(a=String(a)),"object"!=typeof b&&(b={}),"function"==typeof e._get?e._get(a,b,c):(d.nextTick(function(){c(new Error("NotFound"))}),void 0))},c.prototype.put=function(a,b,c,e){if("function"==typeof c&&(e=c),"function"!=typeof e)throw new Error("put() requires a callback argument");var f=this._checkKeyValue(a,"key",this._isBuffer);return f?e(f):(f=this._checkKeyValue(b,"value",this._isBuffer))?e(f):(this._isBuffer(a)||(a=String(a)),this._isBuffer(b)||d.browser||(b=String(b)),"object"!=typeof c&&(c={}),"function"==typeof this._put?this._put(a,b,c,e):(d.nextTick(e),void 0))},c.prototype.del=function(a,b,c){if("function"==typeof b&&(c=b),"function"!=typeof c)throw new Error("del() requires a callback argument");var e=this._checkKeyValue(a,"key",this._isBuffer);return e?c(e):(this._isBuffer(a)||(a=String(a)),"object"!=typeof b&&(b={}),"function"==typeof this._del?this._del(a,b,c):(d.nextTick(c),void 0))},c.prototype.batch=function(a,b,c){if(!arguments.length)return this._chainedBatch();if("function"==typeof b&&(c=b),"function"!=typeof c)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(a))return c(new Error("batch(array) requires an array argument"));"object"!=typeof b&&(b={});for(var e,f,g=0,h=a.length;h>g;g++)if(e=a[g],"object"==typeof e){if(f=this._checkKeyValue(e.type,"type",this._isBuffer))return c(f);if(f=this._checkKeyValue(e.key,"key",this._isBuffer))return c(f);if("put"==e.type&&(f=this._checkKeyValue(e.value,"value",this._isBuffer)))return c(f)}return"function"==typeof this._batch?this._batch(a,b,c):(d.nextTick(c),void 0)},c.prototype.approximateSize=function(a,b,c){if(null==a||null==b||"function"==typeof a||"function"==typeof b)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof c)throw new Error("approximateSize() requires a callback argument");return this._isBuffer(a)||(a=String(a)),this._isBuffer(b)||(b=String(b)),"function"==typeof this._approximateSize?this._approximateSize(a,b,c):(d.nextTick(function(){c(null,0)}),void 0)},c.prototype.iterator=function(a){return"object"!=typeof a&&(a={}),"function"==typeof this._iterator?this._iterator(a):new f(this)},c.prototype._chainedBatch=function(){return new g(this)},c.prototype._isBuffer=function(a){return e.isBuffer(a)},c.prototype._checkKeyValue=function(a,b){if(null===a||void 0===a)return new Error(b+" cannot be `null` or `undefined`");if(null===a||void 0===a)return new Error(b+" cannot be `null` or `undefined`");if(this._isBuffer(a)){if(0===a.length)return new Error(b+" cannot be an empty Buffer")}else if(""===String(a))return new Error(b+" cannot be an empty String")},b.exports.AbstractLevelDOWN=c,b.exports.AbstractIterator=f},{"./abstract-chained-batch":75,"./abstract-iterator":76,__browserify_Buffer:39,__browserify_process:40}],78:[function(a,b){!function(a,c,d){"function"==typeof define?define(c):"undefined"!=typeof b&&b.exports?b.exports=c():d[a]=c()}("IDBStore",function(){"use strict";var a={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:function(a){throw a},indexes:[]},b=function(b,c){for(var d in a)this[d]="undefined"!=typeof b[d]?b[d]:a[d];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10),c&&(this.onStoreReady=c),this.idb=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB,this.keyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()};b.prototype={version:"1.2.0",db:null,dbName:null,dbVersion:null,store:null,storeName:null,keyPath:null,autoIncrement:null,indexes:null,features:null,onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var a=this.features={};a.hasAutoIncrement=!window.mozIndexedDB;var b=this.idb.open(this.dbName,this.dbVersion),c=!1;b.onerror=function(a){var b=!1;"error"in a.target?b="VersionError"==a.target.error.name:"errorCode"in a.target&&(b=12==a.target.errorCode),b?this.onError(new Error("The version number provided is lower than the existing one.")):this.onError(a)}.bind(this),b.onsuccess=function(a){if(!c){if(this.db)return this.onStoreReady(),void 0;if(this.db=a.target.result,"string"==typeof this.db.version)return this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser.")),void 0;if(!this.db.objectStoreNames.contains(this.storeName))return this.onError(new Error("Something is wrong with the IndexedDB implementation in this browser. Please upgrade your browser.")),void 0;var b=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=b.objectStore(this.storeName),this.indexes.forEach(function(a){var b=a.name;if(!b)return c=!0,this.onError(new Error("Cannot create index: No index name given.")),void 0;if(this.normalizeIndexData(a),this.hasIndex(b)){var d=this.store.index(b),e=this.indexComplies(d,a);e||(c=!0,this.onError(new Error('Cannot modify index "'+b+'" for current version. Please bump version number to '+(this.dbVersion+1)+".")))}else c=!0,this.onError(new Error('Cannot create new index "'+b+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))},this),c||this.onStoreReady()}}.bind(this),b.onupgradeneeded=function(a){this.db=a.target.result,this.store=this.db.objectStoreNames.contains(this.storeName)?a.target.transaction.objectStore(this.storeName):this.db.createObjectStore(this.storeName,{keyPath:this.keyPath,autoIncrement:this.autoIncrement}),this.indexes.forEach(function(a){var b=a.name;if(b||(c=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(a),this.hasIndex(b)){var d=this.store.index(b),e=this.indexComplies(d,a);e||(this.store.deleteIndex(b),this.store.createIndex(b,a.keyPath,{unique:a.unique,multiEntry:a.multiEntry}))}else this.store.createIndex(b,a.keyPath,{unique:a.unique,multiEntry:a.multiEntry})},this)}.bind(this)},deleteDatabase:function(){this.idb.deleteDatabase&&this.idb.deleteDatabase(this.dbName)},put:function(a,b,d,e){null!==this.keyPath&&(e=d,d=b,b=a),e||(e=function(a){console.error("Could not write data.",a)}),d||(d=c);var f,g=!1,h=null,i=this.db.transaction([this.storeName],this.consts.READ_WRITE);i.oncomplete=function(){var a=g?d:e;a(h)},i.onabort=e,i.onerror=e,null!==this.keyPath?(this._addIdPropertyIfNeeded(b),f=i.objectStore(this.storeName).put(b)):f=i.objectStore(this.storeName).put(b,a),f.onsuccess=function(a){g=!0,h=a.target.result
},f.onerror=e},get:function(a,b,d){d||(d=function(a){console.error("Could not read data.",a)}),b||(b=c);var e=!1,f=null,g=this.db.transaction([this.storeName],this.consts.READ_ONLY);g.oncomplete=function(){var a=e?b:d;a(f)},g.onabort=d,g.onerror=d;var h=g.objectStore(this.storeName).get(a);h.onsuccess=function(a){e=!0,f=a.target.result},h.onerror=d},remove:function(a,b,d){d||(d=function(a){console.error("Could not remove data.",a)}),b||(b=c);var e=!1,f=null,g=this.db.transaction([this.storeName],this.consts.READ_WRITE);g.oncomplete=function(){var a=e?b:d;a(f)},g.onabort=d,g.onerror=d;var h=g.objectStore(this.storeName)["delete"](a);h.onsuccess=function(a){e=!0,f=a.target.result},h.onerror=d},batch:function(a,b,d){d||(d=function(a){console.error("Could not apply batch.",a)}),b||(b=c),"[object Array]"!=Object.prototype.toString.call(a)&&d(new Error("dataArray argument must be of type Array."));var e=this.db.transaction([this.storeName],this.consts.READ_WRITE);e.oncomplete=function(){var a=h?b:d;a(h)},e.onabort=d,e.onerror=d;var f=a.length,g=!1,h=!1,i=function(){f--,0!==f||g||(g=!0,h=!0)};a.forEach(function(a){var b=a.type,c=a.key,f=a.value,h=function(a){e.abort(),g||(g=!0,d(a,b,c))};if("remove"==b){var j=e.objectStore(this.storeName)["delete"](c);j.onsuccess=i,j.onerror=h}else if("put"==b){var k;null!==this.keyPath?(this._addIdPropertyIfNeeded(f),k=e.objectStore(this.storeName).put(f)):k=e.objectStore(this.storeName).put(f,c),k.onsuccess=i,k.onerror=h}},this)},getAll:function(a,b){b||(b=function(a){console.error("Could not read data.",a)}),a||(a=c);var d=this.db.transaction([this.storeName],this.consts.READ_ONLY),e=d.objectStore(this.storeName);e.getAll?this._getAllNative(d,e,a,b):this._getAllCursor(d,e,a,b)},_getAllNative:function(a,b,c,d){var e=!1,f=null;a.oncomplete=function(){var a=e?c:d;a(f)},a.onabort=d,a.onerror=d;var g=b.getAll();g.onsuccess=function(a){e=!0,f=a.target.result},g.onerror=d},_getAllCursor:function(a,b,c,d){var e=[],f=!1,g=null;a.oncomplete=function(){var a=f?c:d;a(g)},a.onabort=d,a.onerror=d;var h=b.openCursor();h.onsuccess=function(a){var b=a.target.result;b?(e.push(b.value),b["continue"]()):(f=!0,g=e)},h.onError=d},clear:function(a,b){b||(b=function(a){console.error("Could not clear store.",a)}),a||(a=c);var d=!1,e=null,f=this.db.transaction([this.storeName],this.consts.READ_WRITE);f.oncomplete=function(){var c=d?a:b;c(e)},f.onabort=b,f.onerror=b;var g=f.objectStore(this.storeName).clear();g.onsuccess=function(a){d=!0,e=a.target.result},g.onerror=b},_addIdPropertyIfNeeded:function(a){this.features.hasAutoIncrement||"undefined"!=typeof a[this.keyPath]||(a[this.keyPath]=this._insertIdCount++ +Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(a){return this.store.indexNames.contains(a)},normalizeIndexData:function(a){a.keyPath=a.keyPath||a.name,a.unique=!!a.unique,a.multiEntry=!!a.multiEntry},indexComplies:function(a,b){var c=["keyPath","unique","multiEntry"].every(function(c){return"multiEntry"==c&&void 0===a[c]&&b[c]===!1?!0:b[c]==a[c]});return c},iterate:function(a,b){b=e({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:function(a){console.error("Could not open cursor.",a)}},b||{});var c="desc"==b.order.toLowerCase()?"PREV":"NEXT";b.filterDuplicates&&(c+="_NO_DUPLICATE");var d=!1,f=this.db.transaction([this.storeName],this.consts[b.writeAccess?"READ_WRITE":"READ_ONLY"]),g=f.objectStore(this.storeName);b.index&&(g=g.index(b.index)),f.oncomplete=function(){return d?(b.onEnd?b.onEnd():a(null),void 0):(b.onError(null),void 0)},f.onabort=b.onError,f.onerror=b.onError;var h=g.openCursor(b.keyRange,this.consts[c]);h.onerror=b.onError,h.onsuccess=function(c){var e=c.target.result;e?(a(e.value,e,f),b.autoContinue&&e["continue"]()):d=!0}},query:function(a,b){var c=[];b=b||{},b.onEnd=function(){a(c)},this.iterate(function(a){c.push(a)},b)},count:function(a,b){b=e({index:null,keyRange:null},b||{});var c=b.onError||function(a){console.error("Could not open cursor.",a)},d=!1,f=null,g=this.db.transaction([this.storeName],this.consts.READ_ONLY);g.oncomplete=function(){var b=d?a:c;b(f)},g.onabort=c,g.onerror=c;var h=g.objectStore(this.storeName);b.index&&(h=h.index(b.index));var i=h.count(b.keyRange);i.onsuccess=function(a){d=!0,f=a.target.result},i.onError=c},makeKeyRange:function(a){var b,c="undefined"!=typeof a.lower,d="undefined"!=typeof a.upper;switch(!0){case c&&d:b=this.keyRange.bound(a.lower,a.upper,a.excludeLower,a.excludeUpper);break;case c:b=this.keyRange.lowerBound(a.lower,a.excludeLower);break;case d:b=this.keyRange.upperBound(a.upper,a.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value.')}return b}};var c=function(){},d={},e=function(a,b){var c,e;for(c in b)e=b[c],e!==d[c]&&e!==a[c]&&(a[c]=e);return a};return b.version=b.prototype.version,b},this)},{}],79:[function(a,b){function c(a){return d.isBuffer(a)||/\[object (.+Array|Array.+)\]/.test(Object.prototype.toString.call(a))}var d=a("buffer").Buffer;b.exports=c},{buffer:41}],80:[function(a,b){var c=a("__browserify_process"),d=(a("events").EventEmitter,c.nextTick,a("./sub")),e=a("level-fix-range"),f=a("level-hooks");b.exports=function(a,b){function c(b){return function(c){return c=c||{},c=e(c),c.reverse?c.start=c.start||g:c.end=c.end||g,b.call(a,c)}}if(a.sublevel)return a;b=b||{};var g=b.sep=b.sep||"";a._options=b,f(a),a.sublevels={},a.sublevel=function(b,c){return a.sublevels[b]?a.sublevels[b]:new d(a,b,c||this._options)},a.methods={},a.prefix=function(a){return""+(a||"")},a.pre=function(b,c){return c||(c=b,b={max:g}),a.hooks.pre(b,c)},a.post=function(b,c){return c||(c=b,b={max:g}),a.hooks.post(b,c)},a.readStream=a.createReadStream=c(a.createReadStream),a.keyStream=a.createKeyStream=c(a.createKeyStream),a.valuesStream=a.createValueStream=c(a.createValueStream);var h=a.batch;return a.batch=function(b,c,d){if(!Array.isArray(b))throw new Error("batch must be passed an Array");b.forEach(function(a){a.prefix&&("function"==typeof a.prefix.prefix?a.key=a.prefix.prefix(a.key):"string"==typeof a.prefix&&(a.key=a.prefix+a.key))}),h.call(a,b,c,d)},a}},{"./sub":91,__browserify_process:40,events:33,"level-fix-range":81,"level-hooks":83}],81:[function(a,b){var c=a("clone");b.exports=function(a){a=c(a);var b=a.reverse,d=a.max||a.end,e=a.min||a.start,f=[e,d];return null!=e&&null!=d&&f.sort(),b&&(f=f.reverse()),a.start=f[0],a.end=f[1],delete a.min,delete a.max,a}},{clone:82}],82:[function(a,b){function c(a){return Object.prototype.toString.call(a)}function d(a,b){function c(a,b,d,g){var l;if("object"==typeof a){if(null==a)return a;for(l in i)if(i[l]===a)return k.push({resolveTo:l,child:d,i:g}),null;if(i[b]=a,f.isArray(a)){d=[];for(l in a)d[l]=c(a[l],b+"["+l+"]",d,l)}else if(f.isDate(a))d=new Date(a.getTime());else if(f.isRegExp(a))d=new RegExp(a.source,f.getRegExpFlags(a)),a.lastIndex&&(d.lastIndex=a.lastIndex);else if(h&&e.isBuffer(a))d=new e(a.length),a.copy(d);else{d={},d.__proto__=a.__proto__;for(l in a)d[l]=c(a[l],b+"["+l+"]",d,l)}j[b]=d}else d=a;return d}"undefined"==typeof b&&(b=!0);var g,h="undefined"!=typeof e,i={},j={},k=[];if(b){var l=c(a,"*");for(g in k){var m=k[g];m&&m.child&&m.i in m.child&&(m.child[m.i]=j[m.resolveTo])}return l}var n;if("object"==typeof a){if(null==a)return a;if("Array"===a.constructor.name){n=[];for(g in a)n[g]=d(a[g],b)}else if(f.isDate(a))n=new Date(a.getTime());else if(f.isRegExp(a))n=new RegExp(a.source,f.getRegExpFlags(a)),a.lastIndex&&(n.lastIndex=a.lastIndex);else{n={},n.__proto__=a.__proto__;for(g in a)n[g]=d(a[g],b)}}else n=a;return n}var e=a("__browserify_Buffer"),f={isArray:function(a){return Array.isArray(a)||"object"==typeof a&&"[object Array]"===c(a)},isDate:function(a){return"object"==typeof a&&"[object Date]"===c(a)},isRegExp:function(a){return"object"==typeof a&&"[object RegExp]"===c(a)},getRegExpFlags:function(a){var b="";return a.global&&(b+="g"),a.ignoreCase&&(b+="i"),a.multiline&&(b+="m"),b}};"object"==typeof b&&(b.exports=d),d.clonePrototype=function(a){if(null===a)return null;var b=function(){};return b.prototype=a,new b}},{__browserify_Buffer:39}],83:[function(a,b){var c=a("string-range");b.exports=function(a){function b(a){return a&&("string"==typeof a?a:"string"==typeof a.prefix?a.prefix:"function"==typeof a.prefix?a.prefix():"")}function d(a){return a&&a._getKeyEncoding?a._getKeyEncoding(a):void 0}function e(a){return a&&a._getValueEncoding?a._getValueEncoding(a):void 0}function f(a,b){return function(){var c=a.indexOf(b);return~c?(a.splice(c,1),!0):!1}}function g(a){a&&a.type&&i.forEach(function(b){b.test(a.key)&&b.hook(a)})}function h(c,f,g,h){try{f.forEach(function o(a,c){j.forEach(function(g){if(g.test(String(a.key))){var h={add:function(a,h){if("undefined"==typeof a)return this;if(a===!1)return delete f[c];var i=b(a.prefix)||b(h)||g.prefix||"";if(a.key=i+a.key,g.test(String(a.key)))throw new Error("prehook cannot insert into own range");var j=a.keyEncoding||d(a.prefix),k=a.valueEncoding||e(a.prefix);return j&&(a.keyEncoding=j),k&&(a.valueEncoding=k),f.push(a),o(a,f.length-1),this},put:function(a,b){return"object"==typeof a&&(a.type="put"),this.add(a,b)},del:function(a,b){return"object"==typeof a&&(a.type="del"),this.add(a,b)},veto:function(){return this.add(!1)}};g.hook.call(h,a,h.add,f)}})})}catch(i){return(h||g)(i)}if(f=f.filter(function(a){return a&&a.type}),1==f.length&&!c){var n=f[0];return"put"==n.type?k.call(a,n.key,n.value,g,h):l.call(a,n.key,g,h)}return m.call(a,f,g,h)}if(!a.hooks){var i=[],j=[];a.hooks={post:function(a,b){b||(b=a,a="");var d={test:c.checker(a),hook:b};return i.push(d),f(i,d)},pre:function(a,b){b||(b=a,a="");var d={test:c.checker(a),hook:b};return j.push(d),f(j,d)},posthooks:i,prehooks:j},a.on("put",function(a,b){g({type:"put",key:a,value:b})}),a.on("del",function(a,b){g({type:"del",key:a,value:b})}),a.on("batch",function(a){a.forEach(g)});var k=a.put,l=a.del,m=a.batch;a.put=function(a,b,c,d){var e=[{key:a,value:b,type:"put"}];return h(!1,e,c,d)},a.del=function(a,b,c){var d=[{key:a,type:"del"}];return h(!1,d,b,c)},a.batch=function(a,b,c){return h(!0,a,b,c)}}}},{"string-range":84}],84:[function(a,b,c){{var d=c.range=function(a){return null==a?{}:"string"==typeof d?{min:d,max:d+""}:a},e=(c.prefix=function(a,b,d){a=c.range(a);var e={};return d=d||"",a instanceof RegExp||"function"==typeof a?(e.min=b,e.max=b+d,e.inner=function(c){var d=c.substring(b.length);return a.test?a.test(d):a(d)}):"object"==typeof a&&(e.min=b+(a.min||a.start||""),e.max=b+(a.max||a.end||d||"~"),e.reverse=!!a.reverse),e},c.checker=function(a){return a||(a={}),"string"==typeof a?function(b){return 0==b.indexOf(a)}:a instanceof RegExp?function(b){return a.test(b)}:"object"==typeof a?function(b){var c=a.min||a.start,d=a.max||a.end;return b=String(b),(!c||b>=c)&&(!d||d>=b)&&(!a.inner||(a.inner.test?a.inner.test(b):a.inner(b)))}:"function"==typeof a?a:void 0});c.satisfies=function(a,b){return e(b)(a)}}},{}],85:[function(a,b){function c(a){return null!==a&&("object"==typeof a||"function"==typeof a)}b.exports=c},{}],86:[function(a,b){function c(){for(var a={},b=0;b<arguments.length;b++){var c=arguments[b];if(e(c))for(var f=d(c),g=0;g<f.length;g++){var h=f[g];a[h]=c[h]}}return a}var d=a("object-keys"),e=a("./has-keys");b.exports=c},{"./has-keys":85,"object-keys":87}],87:[function(a,b){b.exports=Object.keys||a("./shim")},{"./shim":90}],88:[function(a,b){var c=Object.prototype.hasOwnProperty,d=Object.prototype.toString;b.exports=function(a,b,e){if("[object Function]"!==d.call(b))throw new TypeError("iterator must be a function");var f=a.length;if(f===+f)for(var g=0;f>g;g++)b.call(e,a[g],g,a);else for(var h in a)c.call(a,h)&&b.call(e,a[h],h,a)}},{}],89:[function(a,b){var c=Object.prototype,d=c.hasOwnProperty,e=c.toString,f=function(a){return a!==a},g={"boolean":1,number:1,string:1,undefined:1},h=b.exports={};h.a=h.type=function(a,b){return typeof a===b},h.defined=function(a){return void 0!==a},h.empty=function(a){var b,c=e.call(a);if("[object Array]"===c||"[object Arguments]"===c)return 0===a.length;if("[object Object]"===c){for(b in a)if(d.call(a,b))return!1;return!0}return"[object String]"===c?""===a:!1},h.equal=function(a,b){var c,d=e.call(a);if(d!==e.call(b))return!1;if("[object Object]"===d){for(c in a)if(!h.equal(a[c],b[c]))return!1;return!0}if("[object Array]"===d){if(c=a.length,c!==b.length)return!1;for(;--c;)if(!h.equal(a[c],b[c]))return!1;return!0}return"[object Function]"===d?a.prototype===b.prototype:"[object Date]"===d?a.getTime()===b.getTime():a===b},h.hosted=function(a,b){var c=typeof b[a];return"object"===c?!!b[a]:!g[c]},h.instance=h["instanceof"]=function(a,b){return a instanceof b},h["null"]=function(a){return null===a},h.undefined=function(a){return void 0===a},h.arguments=function(a){var b="[object Arguments]"===e.call(a),c=!h.array(a)&&h.arraylike(a)&&h.object(a)&&h.fn(a.callee);return b||c},h.array=function(a){return"[object Array]"===e.call(a)},h.arguments.empty=function(a){return h.arguments(a)&&0===a.length},h.array.empty=function(a){return h.array(a)&&0===a.length},h.arraylike=function(a){return!!a&&!h.boolean(a)&&d.call(a,"length")&&isFinite(a.length)&&h.number(a.length)&&a.length>=0},h.boolean=function(a){return"[object Boolean]"===e.call(a)},h["false"]=function(a){return h.boolean(a)&&(a===!1||a.valueOf()===!1)},h["true"]=function(a){return h.boolean(a)&&(a===!0||a.valueOf()===!0)},h.date=function(a){return"[object Date]"===e.call(a)},h.element=function(a){return void 0!==a&&"undefined"!=typeof HTMLElement&&a instanceof HTMLElement&&1===a.nodeType},h.error=function(a){return"[object Error]"===e.call(a)},h.fn=h["function"]=function(a){var b="undefined"!=typeof window&&a===window.alert;return b||"[object Function]"===e.call(a)},h.number=function(a){return"[object Number]"===e.call(a)},h.infinite=function(a){return 1/0===a||a===-1/0},h.decimal=function(a){return h.number(a)&&!f(a)&&!h.infinite(a)&&a%1!==0},h.divisibleBy=function(a,b){var c=h.infinite(a),d=h.infinite(b),e=h.number(a)&&!f(a)&&h.number(b)&&!f(b)&&0!==b;return c||d||e&&a%b===0},h.int=function(a){return h.number(a)&&!f(a)&&a%1===0},h.maximum=function(a,b){if(f(a))throw new TypeError("NaN is not a valid value");if(!h.arraylike(b))throw new TypeError("second argument must be array-like");for(var c=b.length;--c>=0;)if(a<b[c])return!1;return!0},h.minimum=function(a,b){if(f(a))throw new TypeError("NaN is not a valid value");if(!h.arraylike(b))throw new TypeError("second argument must be array-like");for(var c=b.length;--c>=0;)if(a>b[c])return!1;return!0},h.nan=function(a){return!h.number(a)||a!==a},h.even=function(a){return h.infinite(a)||h.number(a)&&a===a&&a%2===0},h.odd=function(a){return h.infinite(a)||h.number(a)&&a===a&&a%2!==0},h.ge=function(a,b){if(f(a)||f(b))throw new TypeError("NaN is not a valid value");return!h.infinite(a)&&!h.infinite(b)&&a>=b},h.gt=function(a,b){if(f(a)||f(b))throw new TypeError("NaN is not a valid value");return!h.infinite(a)&&!h.infinite(b)&&a>b},h.le=function(a,b){if(f(a)||f(b))throw new TypeError("NaN is not a valid value");return!h.infinite(a)&&!h.infinite(b)&&b>=a},h.lt=function(a,b){if(f(a)||f(b))throw new TypeError("NaN is not a valid value");return!h.infinite(a)&&!h.infinite(b)&&b>a},h.within=function(a,b,c){if(f(a)||f(b)||f(c))throw new TypeError("NaN is not a valid value");if(!h.number(a)||!h.number(b)||!h.number(c))throw new TypeError("all arguments must be numbers");var d=h.infinite(a)||h.infinite(b)||h.infinite(c);return d||a>=b&&c>=a},h.object=function(a){return a&&"[object Object]"===e.call(a)},h.hash=function(a){return h.object(a)&&a.constructor===Object&&!a.nodeType&&!a.setInterval},h.regexp=function(a){return"[object RegExp]"===e.call(a)},h.string=function(a){return"[object String]"===e.call(a)}},{}],90:[function(a,b){!function(){"use strict";var c,d=Object.prototype.hasOwnProperty,e=a("is"),f=a("foreach"),g=!{toString:null}.propertyIsEnumerable("toString"),h=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];c=function(a){if(!e.object(a)&&!e.array(a))throw new TypeError("Object.keys called on a non-object");var b,c=[];for(b in a)d.call(a,b)&&c.push(b);return g&&f(h,function(b){d.call(a,b)&&c.push(b)}),c},b.exports=c}()},{foreach:88,is:89}],91:[function(a,b){function c(a,b,d){if("string"==typeof d&&(console.error("db.sublevel(name, seperator<string>) is depreciated"),console.error("use db.sublevel(name, {sep: separator})) if you must"),d={sep:d}),!(this instanceof c))return new c(a,b,d);if(!a)throw new Error("must provide db");if(!b)throw new Error("must provide prefix");d=d||{},d.sep=d.sep||"",this._parent=a,this._options=d,this.options=d,this._prefix=b,this._root=e(this),a.sublevels[b]=this,this.sublevels={},this.methods={};var f=this;this.hooks={pre:function(){return f.pre.apply(f,arguments)},post:function(){return f.post.apply(f,arguments)}}}function d(a,b){["valueEncoding","encoding","keyEncoding","reverse","values","keys","limit","fillCache"].forEach(function(c){b.hasOwnProperty(c)&&(a[c]=b[c])})}function e(a){return a._parent?e(a._parent):a}var f=a("events").EventEmitter,g=a("util").inherits,h=a("string-range"),i=a("level-fix-range"),j=a("xtend");g(c,f);var k=c.prototype;k._key=function(a){var b=this._options.sep;return b+this._prefix+b+a},k._getOptsAndCb=function(a,b){return"function"==typeof a&&(b=a,a={}),{opts:j(a,this._options),cb:b}},k.sublevel=function(a,b){return this.sublevels[a]?this.sublevels[a]:new c(this,a,b||this._options)},k.put=function(a,b,c,d){var e=this._getOptsAndCb(c,d);this._root.put(this.prefix(a),b,e.opts,e.cb)},k.get=function(a,b,c){var d=this._getOptsAndCb(b,c);this._root.get(this.prefix(a),d.opts,d.cb)},k.del=function(a,b,c){var d=this._getOptsAndCb(b,c);this._root.del(this.prefix(a),d.opts,d.cb)},k.batch=function(a,b,c){if(!Array.isArray(a))throw new Error("batch must be passed an Array");var d=this;a.forEach(function(a){a.key="string"==typeof a.prefix?a.prefix+a.key:(a.prefix||d).prefix(a.key),a.prefix&&(a.prefix=null)}),this._root.batch(a,b,c)},k._getKeyEncoding=function(){return this.options.keyEncoding?this.options.keyEncoding:this._parent&&this._parent._getKeyEncoding?this.parent._getKeyEncoding():void 0},k._getValueEncoding=function(){return this.options.valueEncoding?this.options.valueEncoding:this._parent&&this._parent._getValueEncoding?this.parent._getValueEncoding():void 0},k.prefix=function(a){var b=this._options.sep;return this._parent.prefix()+b+this._prefix+b+(a||"")},k.keyStream=k.createKeyStream=function(a){return a=a||{},a.keys=!0,a.values=!1,this.createReadStream(a)},k.valueStream=k.createValueStream=function(a){return a=a||{},a.keys=!1,a.values=!0,a.keys=!1,this.createReadStream(a)},k.readStream=k.createReadStream=function(a){a=a||{};var b=e(this),c=this.prefix(),f=h.prefix(a,c);d(f,j(a,this._options));var g=b.createReadStream(f);if(f.values===!1){var i=g.emit;return g.emit=function(a,b){"data"===a?i.call(this,"data",b.substring(c.length)):i.call(this,a,b)},g}return f.keys===!1?g:g.on("data",function(a){a.key=a.key.substring(c.length)})},k.writeStream=k.createWriteStream=function(){var a=e(this),b=this.prefix(),c=a.createWriteStream.apply(a,arguments),d=c.write,f=this._options.encoding,g=this._options.valueEncoding,h=this._options.keyEncoding,i=!f&&!g&&!h;return c.write=i?function(a){return a.key=b+a.key,d.call(c,a)}:function(a){return a.key=b+a.key,f&&"undefined"==typeof a.encoding&&(a.encoding=f),g&&"undefined"==typeof a.valueEncoding&&(a.valueEncoding=g),h&&"undefined"==typeof a.keyEncoding&&(a.keyEncoding=h),d.call(c,a)},c},k.approximateSize=function(){var a=e(db);return a.approximateSize.apply(a,arguments)},k.pre=function(a,b){b||(b=a,a=null),a=h.prefix(a,this.prefix(),this._options.sep);var c=e(this._parent),d=this.prefix();return c.hooks.pre(i(a),function(a,c){b({key:a.key.substring(d.length),value:a.value,type:a.type},function(a,b){c(a,a.prefix?b:b||d)})})},k.post=function(a,b){b||(b=a,a=null);var c=e(this._parent),d=this.prefix();return a=h.prefix(a,d,this._options.sep),c.hooks.post(i(a),function(a){b({key:a.key.substring(d.length),value:a.value,type:a.type})})};b.exports=c},{events:33,"level-fix-range":81,"string-range":84,util:59,xtend:86}],92:[function(a,b){var c=a("errno").custom.createError,d=c("LevelUPError");b.exports={LevelUPError:d,InitializationError:c("InitializationError",d),OpenError:c("OpenError",d),ReadError:c("ReadError",d),WriteError:c("WriteError",d),NotFoundError:c("NotFoundError",d),EncodingError:c("EncodingError",d)}},{errno:113}],93:[function(a,b){var c=a("__browserify_process"),d=a("events").EventEmitter,e=a("util").inherits,f=a("xtend"),g=a("prr"),h=a("./errors"),i=a("./read-stream"),j=a("./write-stream"),k=a("./util"),l=k.toEncoding,m=k.toSlice,n=k.getOptions,o=k.defaultOptions,p=k.getLevelDOWN,q=function(a,b,k){function q(a,b){d.call(this),this.setMaxListeners(1/0),this.options=f(o,b),g(this,"location",a,"e")}function r(a){this.batch=a.batch(),this.ops=[]}var s,t,u="new",v=function(){return"open"==u},w=function(){return"opening"==u},x=function(a,b){return"function"==typeof b?b(a):t.emit("error",a)},y=function(a,b){return"function"==typeof a?a:b},z=["get","put","batch","del","approximateSize"].reduce(function(a,b){return a[b]=function(){var a=Array.prototype.slice.call(arguments);t.once("ready",function(){t.db[b].apply(t.db,a)})},a},{});if("function"==typeof b&&(k=b,b={}),b=n(t,b),"string"!=typeof a){if(s=new h.InitializationError("Must provide a location for the database"),k)return k(s);throw s}return e(q,d),q.prototype.open=function(a){var b=this;if(v())return a&&c.nextTick(function(){a(null,b)}),b;if(w())return a&&t.once("open",function(){a(null,b)});t.emit("opening"),u="opening",b.db=z;var d=t.options.db||p(),e=d(t.location);e.open(t.options,function(b){return b?(b=new h.OpenError(b),x(b,a)):(t.db=e,u="open",a&&a(null,t),t.emit("open"),t.emit("ready"),void 0)})},q.prototype.close=function(a){v()?(u="closing",this.db.close(function(){u="closed",t.emit("closed"),a&&a.apply(null,arguments)}),t.emit("closing"),this.db=null):"closed"==u&&a?a():"closing"==u&&a?t.once("closed",a):w()&&t.once("open",function(){t.close(a)})},q.prototype.isOpen=function(){return v()},q.prototype.isClosed=function(){return/^clos/.test(u)},q.prototype.get=function(a,b,c){var d,e,f;return c=y(b,c),"function"!=typeof c?(f=new h.ReadError("get() requires key and callback arguments"),x(f)):w()||v()?(b=n(t,b),d=m[b.keyEncoding](a),e=b.valueEncoding,b.asBuffer="utf8"!=e&&"json"!=e,this.db.get(d,b,function(b,d){if(b)return b=/notfound/i.test(b)?new h.NotFoundError("Key not found in database ["+a+"]",b):new h.ReadError(b),x(b,c);if(c){try{d=l[e](d)}catch(f){return c(new h.EncodingError(f))}c(null,d)}}),void 0):(f=new h.ReadError("Database is not open"),x(f,c))},q.prototype.put=function(a,b,c,d){var e,f,g;return d=y(c,d),null===a||void 0===a||null===b||void 0===b?(e=new h.WriteError("put() requires key and value arguments"),x(e,d)):w()||v()?(c=n(t,c),f=m[c.keyEncoding](a),g=m[c.valueEncoding](b),this.db.put(f,g,c,function(c){return c?(c=new h.WriteError(c),x(c,d)):(t.emit("put",a,b),d&&d(),void 0)}),void 0):(e=new h.WriteError("Database is not open"),x(e,d))},q.prototype.del=function(a,b,c){var d,e;return c=y(b,c),null===a||void 0===a?(d=new h.WriteError("del() requires a key argument"),x(d,c)):w()||v()?(b=n(t,b),e=m[b.keyEncoding](a),this.db.del(e,b,function(b){return b?(b=new h.WriteError(b),x(b,c)):(t.emit("del",a),c&&c(),void 0)}),void 0):(d=new h.WriteError("Database is not open"),x(d,c))},r.prototype.put=function(a,b,c){c=n(t,c),a&&(a=m[c.keyEncoding](a)),b&&(b=m[c.valueEncoding](b));try{this.batch.put(a,b)}catch(d){throw new h.WriteError(d)}return this.ops.push({type:"put",key:a,value:b}),this},r.prototype.del=function(a,b){b=n(t,b),a&&(a=m[b.keyEncoding](a));try{this.batch.del(a)}catch(c){throw new h.WriteError(c)}return this.ops.push({type:"del",key:a}),this},r.prototype.clear=function(){try{this.batch.clear()}catch(a){throw new h.WriteError(a)}return this.ops=[],this},r.prototype.write=function(a){var b=this.ops;try{this.batch.write(function(c){return c?x(new h.WriteError(c),a):(t.emit("batch",b),a&&a(),void 0)})}catch(c){throw new h.WriteError(c)}},q.prototype.batch=function(a,b,c){var d,e,f;return arguments.length?(c=y(b,c),Array.isArray(a)?w()||v()?(b=n(t,b),d=b.keyEncoding,e=b.valueEncoding,a=a.map(function(a){if(void 0===a.type||void 0===a.key)return{};var b,c=a.keyEncoding||d,f=a.valueEncoding||a.encoding||e;return"utf8"!=c&&"binary"!=c||"utf8"!=f&&"binary"!=f?(b={type:a.type,key:m[c](a.key)},void 0!==a.value&&(b.value=m[f](a.value)),b):a}),this.db.batch(a,b,function(b){return b?(b=new h.WriteError(b),x(b,c)):(t.emit("batch",a),c&&c(),void 0)}),void 0):(f=new h.WriteError("Database is not open"),x(f,c)):(f=new h.WriteError("batch() requires an array argument"),x(f,c))):new r(this.db)},q.prototype.approximateSize=function(a,b,c){var d;return null===a||void 0===a||null===b||void 0===b||"function"!=typeof c?(d=new h.ReadError("approximateSize() requires start, end and callback arguments"),x(d,c)):w()||v()?(this.db.approximateSize(a,b,function(a,b){return a?(a=new h.OpenError(a),x(a,c)):(c&&c(null,b),void 0)}),void 0):(d=new h.WriteError("Database is not open"),x(d,c))},q.prototype.readStream=q.prototype.createReadStream=function(a){return a=f(this.options,a),i.create(a,this,function(a){return t.db.iterator(a)})},q.prototype.keyStream=q.prototype.createKeyStream=function(a){return this.readStream(f(a,{keys:!0,values:!1}))},q.prototype.valueStream=q.prototype.createValueStream=function(a){return this.readStream(f(a,{keys:!1,values:!0}))},q.prototype.writeStream=q.prototype.createWriteStream=function(a){return j.create(f(a),this)},q.prototype.toString=function(){return"LevelUP"},t=new q(a,b),t.open(k),t},r=function(a){return function(b,c){p()[a](b,c||function(){})}};b.exports=q,b.exports.copy=k.copy,b.exports.destroy=r("destroy"),b.exports.repair=r("repair")},{"./errors":92,"./read-stream":95,"./util":96,"./write-stream":97,__browserify_process:40,events:33,prr:114,util:59,xtend:117}],94:[function(a,b){function c(){this.ended=this._ready=this._reading=this._destroyed=this._paused=!1}c.prototype.end=function(){this.ended=!0,this._destroyed=!1},c.prototype.ready=function(){this._ready=!0},c.prototype.destroy=function(){this._destroyed=!0},c.prototype.pause=function(){this._paused=!0},c.prototype.resume=function(){this._paused=!1},c.prototype.read=function(){this._reading=!0},c.prototype.endRead=function(){this._reading=!1},c.prototype.canPause=function(){return!this.ended&&!this._paused},c.prototype.canResume=function(){return!this.ended&&this._paused},c.prototype.canRead=function(){return!this.ended&&!this._reading&&!this._paused},c.prototype.canCleanup=function(){return!this.ended&&!this._reading},c.prototype.canEmitData=function(){return!this.ended&&!this._destroyed},c.prototype.canEnd=function(){return!this.ended},b.exports=function(){return new c}},{}],95:[function(a,b){function c(a,b,c){e.call(this),this._state=j(),this._dataEvent="data",this.readable=!0,this.writable=!1,this._db=b,a=this._options=h(m,a),this._keyEncoding=a.keyEncoding||a.encoding,this._valueEncoding=a.valueEncoding||a.encoding,"undefined"!=typeof this._options.start&&(this._options.start=l[this._keyEncoding](this._options.start)),"undefined"!=typeof this._options.end&&(this._options.end=l[this._keyEncoding](this._options.end)),"number"!=typeof this._options.limit&&(this._options.limit=-1),this._options.keyAsBuffer="utf8"!=this._keyEncoding&&"json"!=this._keyEncoding,this._options.valueAsBuffer="utf8"!=this._valueEncoding&&"json"!=this._valueEncoding,this._makeData=this._options.keys&&this._options.values?n:this._options.keys?o:this._options.values?p:q;var d=this,f=function(){d._state.canEmitData()&&(d._state.ready(),d._iterator=c(d._options),d._read())};b.isOpen()?f():b.once("ready",f)}var d=a("__browserify_Buffer"),e=a("stream").Stream,f=a("simple-bufferstream"),g=a("util").inherits,h=a("xtend"),i=a("./errors"),j=a("./read-stream-state"),k=a("./util").toEncoding,l=a("./util").toSlice,m={keys:!0,values:!0},n=function(a,b,c,d){return{key:k[b](a),value:k[d](c)}},o=function(a,b){return k[b](a)},p=function(a,b,c,d){return k[d](c)},q=function(){return null};g(c,e),c.prototype.destroy=function(){this._state.destroy(),this._state.canCleanup()&&this._cleanup()},c.prototype.pause=function(){this._state.canPause()&&(this._state.pause(),this.emit("pause"))},c.prototype.resume=function(){this._state.canResume()&&(this.emit("resume"),this._state.resume(),this._read())},c.prototype.pipe=function(a){if("function"==typeof a.add&&"fstream"==this._options.type){this._dataEvent="entry";var b=this;this.on("entry",function(c){var e=f(new d(c.value));e.path=c.key.toString(),e.type="File",e.props={type:"File",path:c.key.toString()},e.pause(),a.add(e)===!1&&b.pause()})}return e.prototype.pipe.apply(this,arguments)},c.prototype._read=function(){var a=this;this._state.canRead()&&(this._state.read(),this._iterator.next(function(b,c,d){a._onData(b,c,d)}))},c.prototype._onData=function(a,b,c){if(this._state.endRead(),a||void 0===b&&void 0===c||!this._state.canEmitData())return this._cleanup(a);this._read();try{c=this._makeData(b,this._keyEncoding,c,this._valueEncoding)}catch(d){return this.emit("error",new i.EncodingError(d))}this.emit(this._dataEvent,c)},c.prototype._cleanup=function(a){if(a&&this.emit("error",a),this._state.canEnd())if(this._state.end(),this.readable=!1,this.emit("end"),this._iterator){var b=this;this._iterator.end(function(){b._iterator=null,b.emit("close")})}else this.emit("close")},c.prototype.toString=function(){return"LevelUP.ReadStream"},b.exports.create=function(a,b,d){return new c(a,b,d)}},{"./errors":92,"./read-stream-state":94,"./util":96,__browserify_Buffer:39,"simple-bufferstream":115,stream:50,util:59,xtend:117}],96:[function(a,b){var c,d=a("__browserify_process"),e="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=a("xtend"),g=a("./errors"),h=a("bops"),i=["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le"],j={createIfMissing:!0,errorIfExists:!1,keyEncoding:"utf8",valueEncoding:"utf8",compression:!0},k=function(){var a={},b=function(a){return void 0===a||null===a||h.is(a)};return a.json=JSON.stringify,a.utf8=function(a){return b(a)?a:String(a)},i.forEach(function(c){a[c]||(a[c]=function(a){return b(a)?a:h.from(a,c)})}),a}(),l=function(){var a={};return a.json=function(a){return JSON.parse(a)},a.utf8=function(a){return a},a.binary=function(a){return a},i.forEach(function(b){a[b]||(a[b]=function(a){return h.to(a,b)})}),a}(),m=function(a,b,c){a.readStream().pipe(b.writeStream()).on("close",c?c:function(){}).on("error",c?c:function(a){throw a})},n=e.setImmediate||d.nextTick,o=function(){var a={};return i.forEach(function(b){a[b]={valueEncoding:b}}),a}(),p=function(a,b){var c="string"==typeof b;return!c&&b&&b.encoding&&!b.valueEncoding&&(b.valueEncoding=b.encoding),f(a&&a.options||{},c?o[b]||o[j.valueEncoding]:b)},q=function(){if(c)return c;var b,d=a("../package.json").devDependencies.leveldown,e="Could not locate LevelDOWN, try `npm install leveldown`";try{b=a("leveldown/package").version}catch(f){throw new g.LevelUPError(e)}if(!a("semver").satisfies(b,d))throw new g.LevelUPError("Installed version of LevelDOWN ("+b+") does not match required version ("+d+")");try{return c=a("leveldown")}catch(f){throw new g.LevelUPError(e)}};b.exports={defaultOptions:j,toSlice:k,toEncoding:l,copy:m,setImmediate:n,getOptions:p,getLevelDOWN:q}},{"../package.json":122,"./errors":92,__browserify_process:40,bops:98,leveldown:32,"leveldown/package":32,semver:32,xtend:117}],97:[function(a,b){function c(a,b){d.call(this),this._options=f(j,i(b,a)),this._db=b,this._buffer=[],this._status="init",this._end=!1,this.writable=!0,this.readable=!1;var c=this,e=function(){c.writable&&(c._status="ready",c.emit("ready"),c._process())};b.isOpen()?h(e):b.once("ready",e)}var d=a("stream").Stream,e=a("util").inherits,f=a("xtend"),g=a("concat-stream"),h=a("./util").setImmediate,i=a("./util").getOptions,j={type:"put"};
e(c,d),c.prototype.write=function(a){return this.writable?(this._buffer.push(a),"init"!=this._status&&this._processDelayed(),this._options.maxBufferLength&&this._buffer.length>this._options.maxBufferLength?(this._writeBlock=!0,!1):!0):!1},c.prototype.end=function(a){var b=this;a&&this.write(a),h(function(){b._end=!0,b._process()})},c.prototype.destroy=function(){this.writable=!1,this.end()},c.prototype.destroySoon=function(){this.end()},c.prototype.add=function(a){return a.props?(a.props.Directory?a.pipe(this._db.writeStream(this._options)):(a.props.File||a.File||"File"==a.type)&&this._write(a),!0):void 0},c.prototype._processDelayed=function(){var a=this;h(function(){a._process()})},c.prototype._process=function(){var a,b=this,c=function(a){return b.writable?("closed"!=b._status&&(b._status="ready"),a?(b.writable=!1,b.emit("error",a)):(b._process(),void 0)):void 0};return"ready"!=b._status&&b.writable?(b._buffer.length&&"closed"!=b._status&&b._processDelayed(),void 0):b._buffer.length&&b.writable?(b._status="writing",a=b._buffer,b._buffer=[],b._db.batch(a.map(function(a){return{type:a.type||b._options.type,key:a.key,value:a.value,keyEncoding:a.keyEncoding||b._options.keyEncoding,valueEncoding:a.valueEncoding||a.encoding||b._options.valueEncoding}}),c),b._writeBlock&&(b._writeBlock=!1,b.emit("drain")),void 0):(b._end&&"closed"!=b._status&&(b._status="closed",b.writable=!1,b.emit("close")),void 0)},c.prototype._write=function(a){var b=a.path||a.props.path,c=this;b&&a.pipe(g(function(a,d){return a?(c.writable=!1,c.emit("error",a)):(c._options.fstreamRoot&&b.indexOf(c._options.fstreamRoot)>-1&&(b=b.substr(c._options.fstreamRoot.length+1)),c.write({key:b,value:d}),void 0)}))},c.prototype.toString=function(){return"LevelUP.WriteStream"},b.exports.create=function(a,b){return new c(a,b)}},{"./util":96,"concat-stream":111,stream:50,util:59,xtend:117}],98:[function(a,b,c){arguments[4][8][0].apply(c,arguments)},{"./copy.js":101,"./create.js":102,"./from.js":103,"./is.js":104,"./join.js":105,"./read.js":107,"./subarray.js":108,"./to.js":109,"./write.js":110}],99:[function(a,b){b.exports=a(9)},{}],100:[function(a,b){b.exports=a(10)},{}],101:[function(a,b){function c(a,b,c,f,g){return c=arguments.length<3?0:c,f=arguments.length<4?0:f,g=arguments.length<5?a.length:g,g!==f&&0!==b.length&&0!==a.length?(g>a.length&&(g=a.length),b.length-c<g-f&&(g=b.length-c+f),a.buffer!==b.buffer?d(a,b,c,f,g):e(a,b,c,f,g)):void 0}function d(a,b,c,d,e){for(var f=e-d+c,g=c,h=d;f>g;++g,++h)b[g]=a[h]}function e(a,b,c,d,e){for(var g=e+d,h=new Uint8Array(f.call(a,d,g)),i=0;g>d;++d,++i)b[c++]=h[i]}b.exports=c;var f=[].slice},{}],102:[function(a,b){b.exports=a(12)},{}],103:[function(a,b){b.exports=a(13)},{"base64-js":99}],104:[function(a,b){b.exports=a(14)},{}],105:[function(a,b){b.exports=a(15)},{}],106:[function(a,b){b.exports=a(16)},{}],107:[function(a,b){b.exports=a(17)},{"./mapped.js":106}],108:[function(a,b){b.exports=a(18)},{}],109:[function(a,b){b.exports=a(19)},{"base64-js":99,"to-utf8":100}],110:[function(a,b){b.exports=a(20)},{"./mapped.js":106}],111:[function(a,b){function c(a){e.Stream.call(this),this.writable=!0,a&&(this.cb=a),this.body=[],this.on("error",function(a){this.cb&&this.cb(a)})}var d=a("__browserify_Buffer"),e=a("stream"),f=a("util");f.inherits(c,e.Stream),c.prototype.write=function(a){this.body.push(a)},c.prototype.destroy=function(){},c.prototype.arrayConcat=function(a){return 0===a.length?[]:1===a.length?a[0]:a.reduce(function(a,b){return a.concat(b)})},c.prototype.isArray=function(a){return Array.isArray(a)},c.prototype.getBody=function(){return 0!==this.body.length?"string"==typeof this.body[0]?this.body.join(""):this.isArray(this.body[0])?this.arrayConcat(this.body):"undefined"!=typeof d&&d.isBuffer(this.body[0])?d.concat(this.body):this.body:void 0},c.prototype.end=function(){this.cb&&this.cb(!1,this.getBody())},b.exports=function(a){return new c(a)},b.exports.ConcatStream=c},{__browserify_Buffer:39,stream:50,util:59}],112:[function(a,b){function c(a,b,c){this.name=a,this.cause="string"!=typeof b?b:c,this.message=b&&"string"!=typeof b?b.message:b}function d(a,b){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee),c.call(this,"CustomError",a,b)}function e(a,b,e){var f=function(d,e){c.call(this,b,d,e),"FilesystemError"==b&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(a.errno[this.cause.errno]?a.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee)};return f.prototype=e?new e:new d,f}d.prototype=new Error,b.exports=function(a){var b=function(b,c){return e(a,b,c)};return{CustomError:d,FilesystemError:b("FilesystemError"),createError:b}}},{}],113:[function(a,b){var c=b.exports.all=[{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];b.exports.errno={"-1":c[0],0:c[1],1:c[2],2:c[3],3:c[4],4:c[5],5:c[6],6:c[7],7:c[8],8:c[9],9:c[10],10:c[11],11:c[12],12:c[13],13:c[14],14:c[15],15:c[16],16:c[17],17:c[18],18:c[19],19:c[20],20:c[21],21:c[22],22:c[23],23:c[24],24:c[25],25:c[26],26:c[27],27:c[28],28:c[29],29:c[30],31:c[31],32:c[32],33:c[33],34:c[34],35:c[35],36:c[36],37:c[37],38:c[38],39:c[39],40:c[40],41:c[41],42:c[42],44:c[43],45:c[44],46:c[45],47:c[46],48:c[47],49:c[48],50:c[49],51:c[50],52:c[51],53:c[52],54:c[53],55:c[54],56:c[55],57:c[56],58:c[57],59:c[58]},b.exports.code={UNKNOWN:c[0],OK:c[1],EOF:c[2],EADDRINFO:c[3],EACCES:c[4],EAGAIN:c[5],EADDRINUSE:c[6],EADDRNOTAVAIL:c[7],EAFNOSUPPORT:c[8],EALREADY:c[9],EBADF:c[10],EBUSY:c[11],ECONNABORTED:c[12],ECONNREFUSED:c[13],ECONNRESET:c[14],EDESTADDRREQ:c[15],EFAULT:c[16],EHOSTUNREACH:c[17],EINTR:c[18],EINVAL:c[19],EISCONN:c[20],EMFILE:c[21],EMSGSIZE:c[22],ENETDOWN:c[23],ENETUNREACH:c[24],ENFILE:c[25],ENOBUFS:c[26],ENOMEM:c[27],ENOTDIR:c[28],EISDIR:c[29],ENONET:c[30],ENOTCONN:c[31],ENOTSOCK:c[32],ENOTSUP:c[33],ENOENT:c[34],ENOSYS:c[35],EPIPE:c[36],EPROTO:c[37],EPROTONOSUPPORT:c[38],EPROTOTYPE:c[39],ETIMEDOUT:c[40],ECHARSET:c[41],EAIFAMNOSUPPORT:c[42],EAISERVICE:c[43],EAISOCKTYPE:c[44],ESHUTDOWN:c[45],EEXIST:c[46],ESRCH:c[47],ENAMETOOLONG:c[48],EPERM:c[49],ELOOP:c[50],EXDEV:c[51],ENOTEMPTY:c[52],ENOSPC:c[53],EIO:c[54],EROFS:c[55],ENODEV:c[56],ESPIPE:c[57],ECANCELED:c[58]},b.exports.custom=a("./custom")(b.exports)},{"./custom":112}],114:[function(a,b){!function(a,c,d){"undefined"!=typeof b&&b.exports?b.exports=d():c[a]=d()}("prr",this,function(){var a="function"==typeof Object.defineProperty?function(a,b,c){return Object.defineProperty(a,b,c),a}:function(a,b,c){return a[b]=c.value,a},b=function(a,b){var c="object"==typeof b,d=!c&&"string"==typeof b,e=function(a){return c?!!b[a]:d?b.indexOf(a[0])>-1:!1};return{enumerable:e("enumerable"),configurable:e("configurable"),writable:e("writable"),value:a}},c=function(c,d,e,f){var g;if(f=b(e,f),"object"==typeof d){for(g in d)Object.hasOwnProperty.call(d,g)&&(f.value=d[g],a(c,g,f));return c}return a(c,d,f)};return c})},{}],115:[function(a,b){var c=a("__browserify_process");const d=a("stream"),e=a("util");var f=function(a){var b=this;d.Stream.call(b),b._state="ready",b._buffer=a,c.nextTick(function(){b._dump()})};e.inherits(f,d.Stream),f.prototype._dump=function(){"ready"==this._state&&(this._state="done",this.emit("data",this._buffer),this.emit("end"),this.emit("close"))},f.prototype.pause=function(){"done"!=this._state&&(this._state="paused")},f.prototype.resume=function(){"done"!=this._state&&(this._state="ready",this._dump())},f.prototype.destroy=function(){},b.exports=function(a){return new f(a)}},{__browserify_process:40,stream:50,util:59}],116:[function(a,b){b.exports=a(85)},{}],117:[function(a,b,c){arguments[4][86][0].apply(c,arguments)},{"./has-keys":116,"object-keys":118}],118:[function(a,b,c){arguments[4][87][0].apply(c,arguments)},{"./shim":121}],119:[function(a,b){b.exports=a(88)},{}],120:[function(a,b){b.exports=a(89)},{}],121:[function(a,b){b.exports=a(90)},{foreach:119,is:120}],122:[function(a,b){b.exports={name:"levelup",description:"Fast & simple storage - a Node.js-style LevelDB wrapper",contributors:[{name:"Rod Vagg",email:"r@va.gg",url:"https://github.com/rvagg"},{name:"John Chesley",email:"john@chesl.es",url:"https://github.com/chesles/"},{name:"Jake Verbaten",email:"raynos2@gmail.com",url:"https://github.com/raynos"},{name:"Dominic Tarr",email:"dominic.tarr@gmail.com",url:"https://github.com/dominictarr"},{name:"Max Ogden",email:"max@maxogden.com",url:"https://github.com/maxogden"},{name:"Lars-Magnus Skog",email:"lars.magnus.skog@gmail.com",url:"https://github.com/ralphtheninja"},{name:"David Bjrklund",email:"david.bjorklund@gmail.com",url:"https://github.com/kesla"},{name:"Julian Gruber",email:"julian@juliangruber.com",url:"https://github.com/juliangruber"},{name:"Paolo Fragomeni",email:"paolo@async.ly",url:"https://github.com/hij1nx"},{name:"Anton Whalley",email:"anton.whalley@nearform.com",url:"https://github.com/No9"},{name:"Matteo Collina",email:"matteo.collina@gmail.com",url:"https://github.com/mcollina"},{name:"Pedro Teixeira",email:"pedro.teixeira@gmail.com",url:"https://github.com/pgte"}],keywords:["leveldb","stream","database","db","store","storage","json"],version:"0.12.0",main:"lib/levelup.js",dependencies:{errno:"~0.0.3","concat-stream":"~0.1.1","simple-bufferstream":"~0.0.2",xtend:"~2.0.3",prr:"~0.0.0",semver:"~1.1.4",bops:"~0.0.6"},devDependencies:{leveldown:"~0.6.2",bustermove:"*",tap:"*",referee:"*",rimraf:"*",async:"*",fstream:"*",tar:"*",mkfiletree:"*",readfiletree:"*","slow-stream":">=0.0.4",delayed:"*",boganipsum:"*",du:"*",memdown:"*"},browser:{leveldown:!1,"leveldown/package":!1,semver:!1},repository:{type:"git",url:"https://github.com/rvagg/node-levelup.git"},scripts:{test:"tap test/*-test.js --stderr",functionaltests:"node ./test/functional/fstream-test.js && node ./test/functional/binary-data-test.js && node ./test/functional/compat-test.js",alltests:"npm test && npm run-script functionaltests"},license:"MIT",readme:"LevelUP\n=======\n\n![LevelDB Logo](https://twimg0-a.akamaihd.net/profile_images/3360574989/92fc472928b444980408147e5e5db2fa_bigger.png)\n\nFast & simple storage - a Node.js-style LevelDB wrapper\n-------------------------------------------------------\n\n[![Build Status](https://secure.travis-ci.org/rvagg/node-levelup.png)](http://travis-ci.org/rvagg/node-levelup)\n\n[![NPM](https://nodei.co/npm/levelup.png)](https://nodei.co/npm/levelup/)\n\n\n  * <a href=\"#news\">News</a>\n  * <a href=\"#intro\">Introduction</a>\n  * <a href=\"#leveldown\">Relationship to LevelDOWN</a>\n  * <a href=\"#platforms\">Tested &amp; supported platforms</a>\n  * <a href=\"#basic\">Basic usage</a>\n  * <a href=\"#api\">API</a>\n  * <a href=\"#events\">Events</a>\n  * <a href=\"#json\">JSON data</a>\n  * <a href=\"#extending\">Extending LevelUP</a>\n  * <a href=\"#multiproc\">Multi-process access</a>\n  * <a href=\"#support\">Getting support</a>\n  * <a href=\"#contributing\">Contributing</a>\n  * <a href=\"#licence\">Licence &amp; copyright</a>\n\n\n<a name=\"news\"></a>\nNews\n----\n\n * *2013-05-21* **[LevelUP v0.9 Released](http://r.va.gg/2013/05/levelup-v0.9-released.html)** &mdash; explains the main items in the [CHANGELOG](https://raw.github.com/rvagg/node-levelup/master/CHANGELOG.md) for 0.9 and who you should thank for the hard work.\n * *2013-05-20* **[LevelUP v0.9 - Some Major Changes](http://r.va.gg/2013/05/levelup-v0.9-some-major-changes.html)** &mdash; discussing why we've removed [LevelDOWN](https://github.com/rvagg/node-leveldown/) as a dependency and the growing collection of LevelDOWN-compatible back-ends for LevelUP.\n\n<a name=\"intro\"></a>\nIntroduction\n------------\n\n**[LevelDB](http://code.google.com/p/leveldb/)** is a simple key/value data store built by Google, inspired by BigTable. It's used in Google Chrome and many other products. LevelDB supports arbitrary byte arrays as both keys and values, singular *get*, *put* and *delete* operations, *batched put and delete*, bi-directional iterators and simple compression using the very fast [Snappy](http://code.google.com/p/snappy/) algorithm.\n\n**LevelUP** aims to expose the features of LevelDB in a **Node.js-friendly way**. All standard `Buffer` encoding types are supported, as is a special JSON encoding. LevelDB's iterators are exposed as a Node.js-style **readable stream** a matching **writeable stream* converts writes to *batch* operations.\n\nLevelDB stores entries **sorted lexicographically by keys**. This makes LevelUP's <a href=\"#createReadStream\"><code>ReadStream</code></a> interface is a very powerful query mechanism.\n\n**LevelUP** is an **OPEN Open Source Project**, see the <a href=\"#contributing\">Contributing</a> section to find out what this means.\n\n<a name=\"leveldown\"></a>\nRelationship to LevelDOWN\n-------------------------\n\nLevelUP is designed to be backed by **[LevelDOWN](https://github.com/rvagg/node-leveldown/)** which provides a pure C++ binding to LevelDB and can be used as a stand-along package if required.\n\n**As of version 0.9, LevelUP no longer requires LevelDOWN as a dependency so you must `npm install leveldown` when you install LevelUP.**\n\nLevelDOWN is now optional because LevelUP can be used with alternative backends, such as **[level.js](https://github.com/maxogden/level.js)** in the browser or [MemDOWN](https://github.com/rvagg/node-memdown) for a pure in-memory store.\n\nLevelUP will look for LevelDOWN and throw an error if it can't find it in its Node `require()` path. It will also tell you if the installed version of LevelDOWN is incompatible.\n\n**The [level](https://github.com/level/level) package is available as an alternative installation mechanism.** Install it instead to automatically get both LevelUP & LevelDOWN. It exposes LevelUP on its export (i.e. you can `var leveldb = require('level')`).\n\n\n<a name=\"platforms\"></a>\nTested & supported platforms\n----------------------------\n\n  * **Linux**: including ARM platforms such as Raspberry Pi *and Kindle!*\n  * **Mac OS**\n  * **Solaris**: including Joyent's SmartOS & Nodejitsu\n  * **Windows**: Node 0.10 and above only. See installation instructions for *node-gyp's* dependencies [here](https://github.com/TooTallNate/node-gyp#installation), you'll need these (free) components from Microsoft to compile and run any native Node add-on in Windows.\n\n<a name=\"basic\"></a>\nBasic usage\n-----------\n\nFirst you need to install LevelUP!\n\n```sh\n$ npm install levelup leveldown\n```\n\nOr\n\n```sh\n$ npm install level\n```\n\n*(this second option requires you to use LevelUP by calling `var levelup = require('level')`)*\n\n\nAll operations are asynchronous although they don't necessarily require a callback if you don't need to know when the operation was performed.\n\n```js\nvar levelup = require('levelup')\n\n// 1) Create our database, supply location and options.\n//    This will create or open the underlying LevelDB store.\nvar db = levelup('./mydb')\n\n// 2) put a key & value\ndb.put('name', 'LevelUP', function (err) {\n  if (err) return console.log('Ooops!', err) // some kind of I/O error\n\n  // 3) fetch by key\n  db.get('name', function (err, value) {\n    if (err) return console.log('Ooops!', err) // likely the key was not found\n\n    // ta da!\n    console.log('name=' + value)\n  })\n})\n```\n\n<a name=\"api\"></a>\n## API\n\n  * <a href=\"#ctor\"><code><b>levelup()</b></code></a>\n  * <a href=\"#open\"><code>db.<b>open()</b></code></a>\n  * <a href=\"#close\"><code>db.<b>close()</b></code></a>\n  * <a href=\"#put\"><code>db.<b>put()</b></code></a>\n  * <a href=\"#get\"><code>db.<b>get()</b></code></a>\n  * <a href=\"#del\"><code>db.<b>del()</b></code></a>\n  * <a href=\"#batch\"><code>db.<b>batch()</b></code> *(array form)*</a>\n  * <a href=\"#batch_chained\"><code>db.<b>batch()</b></code> *(chained form)*</a>\n  * <a href=\"#isOpen\"><code>db.<b>isOpen()</b></code></a>\n  * <a href=\"#isClosed\"><code>db.<b>isClosed()</b></code></a>\n  * <a href=\"#createReadStream\"><code>db.<b>createReadStream()</b></code></a>\n  * <a href=\"#createKeyStream\"><code>db.<b>createKeyStream()</b></code></a>\n  * <a href=\"#createValueStream\"><code>db.<b>createValueStream()</b></code></a>\n  * <a href=\"#createWriteStream\"><code>db.<b>createWriteStream()</b></code></a>\n\n### Special operations exposed by LevelDOWN\n\n  * <a href=\"#approximateSize\"><code>db.db.<b>approximateSize()</b></code></a>\n  * <a href=\"#getProperty\"><code>db.db.<b>getProperty()</b></code></a>\n  * <a href=\"#destroy\"><code><b>leveldown.destroy()</b></code></a>\n  * <a href=\"#repair\"><code><b>leveldown.repair()</b></code></a>\n\n\n--------------------------------------------------------\n<a name=\"ctor\"></a>\n### levelup(location[, options[, callback]])\n<code>levelup()</code> is the main entry point for creating a new LevelUP instance and opening the underlying store with LevelDB.\n\nThis function returns a new instance of LevelUP and will also initiate an <a href=\"#open\"><code>open()</code></a> operation. Opening the database is an asynchronous operation which will trigger your callback if you provide one. The callback should take the form: `function (err, db) {}` where the `db` is the LevelUP instance. If you don't provide a callback, any read & write operations are simply queued internally until the database is fully opened.\n\nThis leads to two alternative ways of managing a new LevelUP instance:\n\n```js\nlevelup(location, options, function (err, db) {\n  if (err) throw err\n  db.get('foo', function (err, value) {\n    if (err) return console.log('foo does not exist')\n    console.log('got foo =', value)\n  })\n})\n\n// vs the equivalent:\n\nvar db = levelup(location, options) // will throw if an error occurs\ndb.get('foo', function (err, value) {\n  if (err) return console.log('foo does not exist')\n  console.log('got foo =', value)\n})\n```\n\nThe `location` argument is available as a read-only property on the returned LevelUP instance.\n\n#### `options`\n\n`levelup()` takes an optional options object as its second argument; the following properties are accepted:\n\n* `'createIfMissing'` *(boolean, default: `true`)*: If `true`, will initialise an empty database at the specified location if one doesn't already exist. If `false` and a database doesn't exist you will receive an error in your `open()` callback and your database won't open.\n\n* `'errorIfExists'` *(boolean, default: `false`)*: If `true`, you will receive an error in your `open()` callback if the database exists at the specified location.\n\n* `'compression'` *(boolean, default: `true`)*: If `true`, all *compressible* data will be run through the Snappy compression algorithm before being stored. Snappy is very fast and shouldn't gain much speed by disabling so leave this on unless you have good reason to turn it off.\n\n* `'cacheSize'` *(number, default: `8 * 1024 * 1024`)*: The size (in bytes) of the in-memory [LRU](http://en.wikipedia.org/wiki/Cache_algorithms#Least_Recently_Used) cache with frequently used uncompressed block contents. \n\n* `'keyEncoding'` and `'valueEncoding'` *(string, default: `'utf8'`)*: The encoding of the keys and values passed through Node.js' `Buffer` implementation (see [Buffer#toString()](http://nodejs.org/docs/latest/api/buffer.html#buffer_buf_tostring_encoding_start_end)).\n  <p><code>'utf8'</code> is the default encoding for both keys and values so you can simply pass in strings and expect strings from your <code>get()</code> operations. You can also pass <code>Buffer</code> objects as keys and/or values and conversion will be performed.</p>\n  <p>Supported encodings are: hex, utf8, ascii, binary, base64, ucs2, utf16le.</p>\n  <p><code>'json'</code> encoding is also supported, see below.</p>\n\n* `'db'` *(object, default: LevelDOWN)*: LevelUP is backed by [LevelDOWN](https://github.com/rvagg/node-leveldown/) to provide an interface to LevelDB. You can completely replace the use of LevelDOWN by providing a \"factory\" function that will return a LevelDOWN API compatible object given a `location` argument. For further information, see [MemDOWN](https://github.com/rvagg/node-memdown/), a fully LevelDOWN API compatible replacement that uses a memory store rather than LevelDB. Also see [Abstract LevelDOWN](http://github.com/rvagg/node-abstract-leveldown), a partial implementation of the LevelDOWN API that can be used as a base prototype for a LevelDOWN substitute.\n\nAdditionally, each of the main interface methods accept an optional options object that can be used to override `'keyEncoding'` and `'valueEncoding'`.\n\n--------------------------------------------------------\n<a name=\"open\"></a>\n### db.open([callback])\n<code>open()</code> opens the underlying LevelDB store. In general **you should never need to call this method directly** as it's automatically called by <a href=\"#ctor\"><code>levelup()</code></a>.\n\nHowever, it is possible to *reopen* a database after it has been closed with <a href=\"#close\"><code>close()</code></a>, although this is not generally advised.\n\n--------------------------------------------------------\n<a name=\"close\"></a>\n### db.close([callback])\n<code>close()</code> closes the underlying LevelDB store. The callback will receive any error encountered during closing as the first argument.\n\nYou should always clean up your LevelUP instance by calling `close()` when you no longer need it to free up resources. A LevelDB store cannot be opened by multiple instances of LevelDB/LevelUP simultaneously.\n\n--------------------------------------------------------\n<a name=\"put\"></a>\n### db.put(key, value[, options][, callback])\n<code>put()</code> is the primary method for inserting data into the store. Both the `key` and `value` can be arbitrary data objects.\n\nThe callback argument is optional but if you don't provide one and an error occurs then expect the error to be thrown.\n\n#### `options`\n\nEncoding of the `key` and `value` objects will adhere to `'keyEncoding'` and `'valueEncoding'` options provided to <a href=\"#ctor\"><code>levelup()</code></a>, although you can provide alternative encoding settings in the options for `put()` (it's recommended that you stay consistent in your encoding of keys and values in a single store).\n\nIf you provide a `'sync'` value of `true` in your `options` object, LevelDB will perform a synchronous write of the data; although the operation will be asynchronous as far as Node is concerned. Normally, LevelDB passes the data to the operating system for writing and returns immediately, however a synchronous write will use `fsync()` or equivalent so your callback won't be triggered until the data is actually on disk. Synchronous filesystem writes are **significantly** slower than asynchronous writes but if you want to be absolutely sure that the data is flushed then you can use `'sync': true`.\n\n--------------------------------------------------------\n<a name=\"get\"></a>\n### db.get(key[, options][, callback])\n<code>get()</code> is the primary method for fetching data from the store. The `key` can be an arbitrary data object but if it doesn't exist in the store then the callback will receive an error as its first argument.\n\n#### `options`\n\nEncoding of the `key` object will adhere to the `'keyEncoding'` option provided to <a href=\"#ctor\"><code>levelup()</code></a>, although you can provide alternative encoding settings in the options for `get()` (it's recommended that you stay consistent in your encoding of keys and values in a single store).\n\nLevelDB will by default fill the in-memory LRU Cache with data from a call to get. Disabling this is done by setting `fillCache` to `false`. \n\n--------------------------------------------------------\n<a name=\"del\"></a>\n### db.del(key[, options][, callback])\n<code>del()</code> is the primary method for removing data from the store.\n\n#### `options`\n\nEncoding of the `key` object will adhere to the `'keyEncoding'` option provided to <a href=\"#ctor\"><code>levelup()</code></a>, although you can provide alternative encoding settings in the options for `del()` (it's recommended that you stay consistent in your encoding of keys and values in a single store).\n\nA `'sync'` option can also be passed, see <a href=\"#put\"><code>put()</code></a> for details on how this works.\n\n--------------------------------------------------------\n<a name=\"batch\"></a>\n### db.batch(array[, options][, callback]) *(array form)*\n<code>batch()</code> can be used for very fast bulk-write operations (both *put* and *delete*). The `array` argument should contain a list of operations to be executed sequentially, although as a whole they are performed as an atomic operation inside LevelDB. Each operation is contained in an object having the following properties: `type`, `key`, `value`, where the *type* is either `'put'` or `'del'`. In the case of `'del'` the `'value'` property is ignored. Any entries with a `'key'` of `null` or `undefined` will cause an error to be returned on the `callback` and any `'type': 'put'` entry with a `'value'` of `null` or `undefined` will return an error.\n\n```js\nvar ops = [\n    { type: 'del', key: 'father' }\n  , { type: 'put', key: 'name', value: 'Yuri Irsenovich Kim' }\n  , { type: 'put', key: 'dob', value: '16 February 1941' }\n  , { type: 'put', key: 'spouse', value: 'Kim Young-sook' }\n  , { type: 'put', key: 'occupation', value: 'Clown' }\n]\n\ndb.batch(ops, function (err) {\n  if (err) return console.log('Ooops!', err)\n  console.log('Great success dear leader!')\n})\n```\n\n#### `options`\n\nSee <a href=\"#put\"><code>put()</code></a> for a discussion on the `options` object. You can overwrite default `'keyEncoding'` and `'valueEncoding'` and also specify the use of `sync` filesystem operations.\n\nIn addition to encoding options for the whole batch you can also overwrite the encoding per operation, like:\n\n```js\nvar ops = [\n  {\n    type: 'put',\n    key: new Buffer([1, 2, 3]),\n    value: { some: 'json' },\n    keyEncoding: 'binary',\n    valueEncoding: 'json'\n  }\n]\n```\n\n--------------------------------------------------------\n<a name=\"batch_chained\"></a>\n### db.batch() *(chained form)*\n<code>batch()</code>, when called with no arguments will return a `Batch` object which can be used to build, and eventually commit, an atomic LevelDB batch operation. Depending on how it's used, it is possible to obtain greater performance when using the chained form of `batch()` over the array form.\n\n```js\ndb.batch()\n  .del('father')\n  .put('name', 'Yuri Irsenovich Kim')\n  .put('dob', '16 February 1941')\n  .put('spouse', 'Kim Young-sook')\n  .put('occupation', 'Clown')\n  .write(function () { console.log('Done!') })\n```\n\n<b><code>batch.put(key, value[, options])</code></b>\n\nQueue a *put* operation on the current batch, not committed until a `write()` is called on the batch.\n\nThe optional `options` argument can be used to override the default `'keyEncoding'` and/or `'valueEncoding'`.\n\n<b><code>batch.del(key[, options])</code></b>\n\nQueue a *del* operation on the current batch, not committed until a `write()` is called on the batch.\n\nThe optional `options` argument can be used to override the default `'keyEncoding'`.\n\n<b><code>batch.clear()</code></b>\n\nClear all queued operations on the current batch, any previous operations will be discarded.\n\n<b><code>batch.write([callback])</code></b>\n\nCommit the queued operations for this batch. All operations not *cleared* will be written to the database atomically, that is, they will either all succeed or fail with no partial commits. The optional `callback` will be called when the operation has completed with an *error* argument if an error has occurred.\n\n\n--------------------------------------------------------\n<a name=\"isOpen\"></a>\n### db.isOpen()\n\nA LevelUP object can be in one of the following states:\n\n  * *\"new\"*     - newly created, not opened or closed\n  * *\"opening\"* - waiting for the database to be opened\n  * *\"open\"*    - successfully opened the database, available for use\n  * *\"closing\"* - waiting for the database to be closed\n  * *\"closed\"*  - database has been successfully closed, should not be used\n\n`isOpen()` will return `true` only when the state is \"open\".\n\n--------------------------------------------------------\n<a name=\"isClosed\"></a>\n### db.isClosed()\n\n*See <a href=\"#put\"><code>isOpen()</code></a>*\n\n`isClosed()` will return `true` only when the state is \"closing\" *or* \"closed\", it can be useful for determining if read and write operations are permissible.\n\n--------------------------------------------------------\n<a name=\"createReadStream\"></a>\n### db.createReadStream([options])\n\nYou can obtain a **ReadStream** of the full database by calling the `createReadStream()` method. The resulting stream is a complete Node.js-style [Readable Stream](http://nodejs.org/docs/latest/api/stream.html#stream_readable_stream) where `'data'` events emit objects with `'key'` and `'value'` pairs.\n\n```js\ndb.createReadStream()\n  .on('data', function (data) {\n    console.log(data.key, '=', data.value)\n  })\n  .on('error', function (err) {\n    console.log('Oh my!', err)\n  })\n  .on('close', function () {\n    console.log('Stream closed')\n  })\n  .on('end', function () {\n    console.log('Stream closed')\n  })\n```\n\nThe standard `pause()`, `resume()` and `destroy()` methods are implemented on the ReadStream, as is `pipe()` (see below). `'data'`, '`error'`, `'end'` and `'close'` events are emitted.\n\nAdditionally, you can supply an options object as the first parameter to `createReadStream()` with the following options:\n\n* `'start'`: the key you wish to start the read at. By default it will start at the beginning of the store. Note that the *start* doesn't have to be an actual key that exists, LevelDB will simply find the *next* key, greater than the key you provide.\n\n* `'end'`: the key you wish to end the read on. By default it will continue until the end of the store. Again, the *end* doesn't have to be an actual key as an (inclusive) `<=`-type operation is performed to detect the end. You can also use the `destroy()` method instead of supplying an `'end'` parameter to achieve the same effect.\n\n* `'reverse'` *(boolean, default: `false`)*: a boolean, set to true if you want the stream to go in reverse order. Beware that due to the way LevelDB works, a reverse seek will be slower than a forward seek.\n\n* `'keys'` *(boolean, default: `true`)*: whether the `'data'` event should contain keys. If set to `true` and `'values'` set to `false` then `'data'` events will simply be keys, rather than objects with a `'key'` property. Used internally by the `createKeyStream()` method.\n\n* `'values'` *(boolean, default: `true`)*: whether the `'data'` event should contain values. If set to `true` and `'keys'` set to `false` then `'data'` events will simply be values, rather than objects with a `'value'` property. Used internally by the `createValueStream()` method.\n\n* `'limit'` *(number, default: `-1`)*: limit the number of results collected by this stream. This number represents a *maximum* number of results and may not be reached if you get to the end of the store or your `'end'` value first. A value of `-1` means there is no limit.\n\n* `'fillCache'` *(boolean, default: `false`)*: wheather LevelDB's LRU-cache should be filled with data read.\n\n* `'keyEncoding'` / `'valueEncoding'` *(string)*: the encoding applied to each read piece of data.\n\n--------------------------------------------------------\n<a name=\"createKeyStream\"></a>\n### db.createKeyStream([options])\n\nA **KeyStream** is a **ReadStream** where the `'data'` events are simply the keys from the database so it can be used like a traditional stream rather than an object stream.\n\nYou can obtain a KeyStream either by calling the `createKeyStream()` method on a LevelUP object or by passing passing an options object to `createReadStream()` with `keys` set to `true` and `values` set to `false`.\n\n```js\ndb.createKeyStream()\n  .on('data', function (data) {\n    console.log('key=', data)\n  })\n\n// same as:\ndb.createReadStream({ keys: true, values: false })\n  .on('data', function (data) {\n    console.log('key=', data)\n  })\n```\n\n--------------------------------------------------------\n<a name=\"createValueStream\"></a>\n### db.createValueStream([options])\n\nA **ValueStream** is a **ReadStream** where the `'data'` events are simply the values from the database so it can be used like a traditional stream rather than an object stream.\n\nYou can obtain a ValueStream either by calling the `createValueStream()` method on a LevelUP object or by passing passing an options object to `createReadStream()` with `values` set to `true` and `keys` set to `false`.\n\n```js\ndb.createValueStream()\n  .on('data', function (data) {\n    console.log('value=', data)\n  })\n\n// same as:\ndb.createReadStream({ keys: false, values: true })\n  .on('data', function (data) {\n    console.log('value=', data)\n  })\n```\n\n--------------------------------------------------------\n<a name=\"createWriteStream\"></a>\n### db.createWriteStream([options])\n\nA **WriteStream** can be obtained by calling the `createWriteStream()` method. The resulting stream is a complete Node.js-style [Writable Stream](http://nodejs.org/docs/latest/api/stream.html#stream_writable_stream) which accepts objects with `'key'` and `'value'` pairs on its `write()` method.\n\nThe WriteStream will buffer writes and submit them as a `batch()` operations where writes occur *within the same tick*.\n\n```js\nvar ws = db.createWriteStream()\n\nws.on('error', function (err) {\n  console.log('Oh my!', err)\n})\nws.on('close', function () {\n  console.log('Stream closed')\n})\n\nws.write({ key: 'name', value: 'Yuri Irsenovich Kim' })\nws.write({ key: 'dob', value: '16 February 1941' })\nws.write({ key: 'spouse', value: 'Kim Young-sook' })\nws.write({ key: 'occupation', value: 'Clown' })\nws.end()\n```\n\nThe standard `write()`, `end()`, `destroy()` and `destroySoon()` methods are implemented on the WriteStream. `'drain'`, `'error'`, `'close'` and `'pipe'` events are emitted.\n\nYou can specify encodings both for the whole stream and individual entries:\n\nTo set the encoding for the whole stream, provide an options object as the first parameter to `createWriteStream()` with `'keyEncoding'` and/or `'valueEncoding'`.\n\nTo set the encoding for an individual entry:\n\n```js\nwriteStream.write({\n  key: new Buffer([1, 2, 3]),\n  value: { some: 'json' },\n  keyEncoding: 'binary',\n  valueEncoding: 'json'\n})\n```\n\n#### write({ type: 'put' })\n\nIf individual `write()` operations are performed with a `'type'` property of `'del'`, they will be passed on as `'del'` operations to the batch.\n\n```js\nvar ws = db.createWriteStream()\n\nws.on('error', function (err) {\n  console.log('Oh my!', err)\n})\nws.on('close', function () {\n  console.log('Stream closed')\n})\n\nws.write({ type: 'del', key: 'name' })\nws.write({ type: 'del', key: 'dob' })\nws.write({ type: 'put', key: 'spouse' })\nws.write({ type: 'del', key: 'occupation' })\nws.end()\n```\n\n#### db.createWriteStream({ type: 'put' })\n\nIf the *WriteStream* is created a `'type'` option of `'del'`, all `write()` operations will be interpreted as `'del'`, unless explicitly specified as `'put'`.\n\n```js\nvar ws = db.createWriteStream({ type: 'del' })\n\nws.on('error', function (err) {\n  console.log('Oh my!', err)\n})\nws.on('close', function () {\n  console.log('Stream closed')\n})\n\nws.write({ key: 'name' })\nws.write({ key: 'dob' })\n// but it can be overridden\nws.write({ type: 'put', key: 'spouse', value: 'Ri Sol-ju' })\nws.write({ key: 'occupation' })\nws.end()\n```\n\n#### Pipes and Node Stream compatibility\n\nA ReadStream can be piped directly to a WriteStream, allowing for easy copying of an entire database. A simple `copy()` operation is included in LevelUP that performs exactly this on two open databases:\n\n```js\nfunction copy (srcdb, dstdb, callback) {\n  srcdb.createReadStream().pipe(dstdb.createWriteStream()).on('close', callback)\n}\n```\n\nThe ReadStream is also [fstream](https://github.com/isaacs/fstream)-compatible which means you should be able to pipe to and from fstreams. So you can serialize and deserialize an entire database to a directory where keys are filenames and values are their contents, or even into a *tar* file using [node-tar](https://github.com/isaacs/node-tar). See the [fstream functional test](https://github.com/rvagg/node-levelup/blob/master/test/functional/fstream-test.js) for an example. *(Note: I'm not really sure there's a great use-case for this but it's a fun example and it helps to harden the stream implementations.)*\n\nKeyStreams and ValueStreams can be treated like standard streams of raw data. If `'keyEncoding'` or `'valueEncoding'` is set to `'binary'` the `'data'` events will simply be standard Node `Buffer` objects straight out of the data store.\n\n\n--------------------------------------------------------\n<a name='approximateSize'></a>\n### db.db.approximateSize(start, end, callback)\n<code>approximateSize()</code> can used to get the approximate number of bytes of file system space used by the range `[start..end)`. The result may not include recently written data.\n\n```js\nvar db = require('level')('./huge.db')\n\ndb.db.approximateSize('a', 'c', function (err, size) {\n  if (err) return console.error('Ooops!', err)\n  console.log('Approximate size of range is %d', size)\n})\n```\n\n**Note:** `approximateSize()` is available via [LevelDOWN](https://github.com/rvagg/node-leveldown/), which by default is accessible as the `db` property of your LevelUP instance. This is a specific LevelDB operation and is not likely to be available where you replace LevelDOWN with an alternative back-end via the `'db'` option.\n\n\n--------------------------------------------------------\n<a name='getProperty'></a>\n### db.db.getProperty(property)\n<code>getProperty</code> can be used to get internal details from LevelDB. When issued with a valid property string, a readable string will be returned (this method is synchronous).\n\nCurrently, the only valid properties are:\n\n* <b><code>'leveldb.num-files-at-levelN'</code></b>: returns the number of files at level *N*, where N is an integer representing a valid level (e.g. \"0\").\n\n* <b><code>'leveldb.stats'</code></b>: returns a multi-line string describing statistics about LevelDB's internal operation.\n\n* <b><code>'leveldb.sstables'</code></b>: returns a multi-line string describing all of the *sstables* that make up contents of the current database.\n\n\n```js\nvar db = require('level')('./huge.db')\nconsole.log(db.db.getProperty('leveldb.num-files-at-level3'))\n//  '243'\n```\n\n**Note:** `getProperty()` is available via [LevelDOWN](https://github.com/rvagg/node-leveldown/), which by default is accessible as the `db` property of your LevelUP instance. This is a specific LevelDB operation and is not likely to be available where you replace LevelDOWN with an alternative back-end via the `'db'` option.\n\n\n--------------------------------------------------------\n<a name=\"destroy\"></a>\n### leveldown.destroy(location, callback)\n<code>destroy()</code> is used to completely remove an existing LevelDB database directory. You can use this function in place of a full directory *rm* if you want to be sure to only remove LevelDB-related files. If the directory only contains LevelDB files, the directory itself will be removed as well. If there are additional, non-LevelDB files in the directory, those files, and the directory, will be left alone.\n\nThe callback will be called when the destroy operation is complete, with a possible `error` argument.\n\n**Note:** `destroy()` is available via [LevelDOWN](https://github.com/rvagg/node-leveldown/) which you will have to have available to `require()`, e.g.:\n\n```js\nrequire('leveldown').destroy('./huge.db', function () { console.log('done!') })\n```\n\n--------------------------------------------------------\n<a name=\"repair\"></a>\n### leveldown.repair(location, callback)\n<code>repair()</code> can be used to attempt a restoration of a damaged LevelDB store. From the LevelDB documentation:\n\n> If a DB cannot be opened, you may attempt to call this method to resurrect as much of the contents of the database as possible. Some data may be lost, so be careful when calling this function on a database that contains important information.\n\nYou will find information on the *repair* operation in the *LOG* file inside the store directory. \n\nA `repair()` can also be used to perform a compaction of the LevelDB log into table files.\n\nThe callback will be called when the repair operation is complete, with a possible `error` argument.\n\n**Note:** `destroy()` is available via [LevelDOWN](https://github.com/rvagg/node-leveldown/) which you will have to have available to `require()`, e.g.:\n\n```js\nrequire('leveldown').repair('./huge.db', function () { console.log('done!') })\n```\n\n--------------------------------------------------------\n\n<a name=\"events\"></a>\nEvents\n------\n\nLevelUP emits events when the callbacks to the corresponding methods are called.\n\n* `db.emit('put', key, value)` emitted when a new value is `'put'`\n* `db.emit('del', key)` emitted when a value is deleted\n* `db.emit('batch', ary)` emitted when a batch operation has executed\n* `db.emit('ready')` emitted when the database has opened (`'open'` is synonym)\n* `db.emit('closed')` emitted when the database has closed\n* `db.emit('opening')` emitted when the database is opening\n* `db.emit('closing')` emitted when the database is closing\n\nIf you do not pass a callback to an async function, and there is an error, LevelUP will `emit('error', err)` instead.\n\n<a name=\"json\"></a>\nJSON data\n---------\n\nYou specify `'json'` encoding for both keys and/or values, you can then supply JavaScript objects to LevelUP and receive them from all fetch operations, including ReadStreams. LevelUP will automatically *stringify* your objects and store them as *utf8* and parse the strings back into objects before passing them back to you.\n\n<a name=\"extending\"></a>\nExtending LevelUP\n-----------------\n\nA list of <a href=\"https://github.com/rvagg/node-levelup/wiki/Modules\"><b>Node.js LevelDB modules and projects</b></a> can be found in the wiki.\n\nWhen attempting to extend the functionality of LevelUP, it is recommended that you consider using [level-hooks](https://github.com/dominictarr/level-hooks) and/or [level-sublevel](https://github.com/dominictarr/level-sublevel). **level-sublevel** is particularly helpful for keeping additional, extension-specific, data in a LevelDB store. It allows you to partition a LevelUP instance into multiple sub-instances that each correspond to discrete namespaced key ranges.\n\n<a name=\"multiproc\"></a>\nMulti-process access\n--------------------\n\nLevelDB is thread-safe but is **not** suitable for accessing with multiple processes. You should only ever have a LevelDB database open from a single Node.js process. Node.js clusters are made up of multiple processes so a LevelUP instance cannot be shared between them either.\n\nSee the <a href=\"https://github.com/rvagg/node-levelup/wiki/Modules\"><b>wiki</b></a> for some LevelUP extensions, including [multilevel](https://github.com/juliangruber/multilevel), that may help if you require a single data store to be shared across processes.\n\n<a name=\"support\"></a>\nGetting support\n---------------\n\nThere are multiple ways you can find help in using LevelDB in Node.js:\n\n * **IRC:** you'll find an active group of LevelUP users in the **##leveldb** channel on Freenode, including most of the contributors to this project.\n * **Mailing list:** there is an active [Node.js LevelDB](https://groups.google.com/forum/#!forum/node-levelup) Google Group.\n * **GitHub:** you're welcome to open an issue here on this GitHub repository if you have a question.\n\n<a name=\"contributing\"></a>\nContributing\n------------\n\nLevelUP is an **OPEN Open Source Project**. This means that:\n\n> Individuals making significant and valuable contributions are given commit-access to the project to contribute as they see fit. This project is more like an open wiki than a standard guarded open source project.\n\nSee the [CONTRIBUTING.md](https://github.com/rvagg/node-levelup/blob/master/CONTRIBUTING.md) file for more details.\n\n### Contributors\n\nLevelUP is only possible due to the excellent work of the following contributors:\n\n<table><tbody>\n<tr><th align=\"left\">Rod Vagg</th><td><a href=\"https://github.com/rvagg\">GitHub/rvagg</a></td><td><a href=\"http://twitter.com/rvagg\">Twitter/@rvagg</a></td></tr>\n<tr><th align=\"left\">John Chesley</th><td><a href=\"https://github.com/chesles/\">GitHub/chesles</a></td><td><a href=\"http://twitter.com/chesles\">Twitter/@chesles</a></td></tr>\n<tr><th align=\"left\">Jake Verbaten</th><td><a href=\"https://github.com/raynos\">GitHub/raynos</a></td><td><a href=\"http://twitter.com/raynos2\">Twitter/@raynos2</a></td></tr>\n<tr><th align=\"left\">Dominic Tarr</th><td><a href=\"https://github.com/dominictarr\">GitHub/dominictarr</a></td><td><a href=\"http://twitter.com/dominictarr\">Twitter/@dominictarr</a></td></tr>\n<tr><th align=\"left\">Max Ogden</th><td><a href=\"https://github.com/maxogden\">GitHub/maxogden</a></td><td><a href=\"http://twitter.com/maxogden\">Twitter/@maxogden</a></td></tr>\n<tr><th align=\"left\">Lars-Magnus Skog</th><td><a href=\"https://github.com/ralphtheninja\">GitHub/ralphtheninja</a></td><td><a href=\"http://twitter.com/ralphtheninja\">Twitter/@ralphtheninja</a></td></tr>\n<tr><th align=\"left\">David Bjrklund</th><td><a href=\"https://github.com/kesla\">GitHub/kesla</a></td><td><a href=\"http://twitter.com/david_bjorklund\">Twitter/@david_bjorklund</a></td></tr>\n<tr><th align=\"left\">Julian Gruber</th><td><a href=\"https://github.com/juliangruber\">GitHub/juliangruber</a></td><td><a href=\"http://twitter.com/juliangruber\">Twitter/@juliangruber</a></td></tr>\n<tr><th align=\"left\">Paolo Fragomeni</th><td><a href=\"https://github.com/hij1nx\">GitHub/hij1nx</a></td><td><a href=\"http://twitter.com/hij1nx\">Twitter/@hij1nx</a></td></tr>\n<tr><th align=\"left\">Anton Whalley</th><td><a href=\"https://github.com/No9\">GitHub/No9</a></td><td><a href=\"https://twitter.com/antonwhalley\">Twitter/@antonwhalley</a></td></tr>\n<tr><th align=\"left\">Matteo Collina</th><td><a href=\"https://github.com/mcollina\">GitHub/mcollina</a></td><td><a href=\"https://twitter.com/matteocollina\">Twitter/@matteocollina</a></td></tr>\n<tr><th align=\"left\">Pedro Teixeira</th><td><a href=\"https://github.com/pgte\">GitHub/pgte</a></td><td><a href=\"https://twitter.com/pgte\">Twitter/@pgte</a></td></tr>\n</tbody></table>\n\n### Windows\n\nA large portion of the Windows support comes from code by [Krzysztof Kowalczyk](http://blog.kowalczyk.info/) [@kjk](https://twitter.com/kjk), see his Windows LevelDB port [here](http://code.google.com/r/kkowalczyk-leveldb/). If you're using LevelUP on Windows, you should give him your thanks!\n\n\n<a name=\"licence\"></a>\nLicence &amp; copyright\n-------------------\n\nCopyright (c) 2012-2013 LevelUP contributors (listed above).\n\nLevelUP is licensed under an MIT +no-false-attribs license. All rights not explicitly granted in the MIT license are reserved. See the included LICENSE file for more details.\n\n*LevelUP builds on the excellent work of the LevelDB and Snappy teams from Google and additional contributors. LevelDB and Snappy are both issued under the [New BSD Licence](http://opensource.org/licenses/BSD-3-Clause).*\n",readmeFilename:"README.md",bugs:{url:"https://github.com/rvagg/node-levelup/issues"},_id:"levelup@0.12.0",_from:"levelup@~0.12.0"}
},{}],123:[function(a,b){var c=a("mux-demux/jsonb");b.exports={client:a("./lib/client")(c),server:a("./lib/server")(c)}},{"./lib/client":124,"./lib/server":125,"mux-demux/jsonb":130}],124:[function(a,b){var c=a("rpc-stream"),d=a("events").EventEmitter,e=(a("duplexer"),a("level-manifest")),f=(a("stream-combiner"),a("util").inherits),g=a("tmp-stream");b.exports=function(a){function b(a){if(!(this instanceof b))return new b(a);a||(a=e({methods:{}})),d.call(this),this.isClient=!0,this._isOpen=!1,this.methods=a.methods,this.mdm=null,this.client=null;this._buildAll(a,this,[],null),this.on("pipe",h)}function h(){throw new Error("The API changed. Use db.createRpcStream().")}return f(b,d),b.prototype.sublevel=function(a){if(!this.sublevels||!this.sublevels[a])throw new Error("client cannot create new sublevels");return this.sublevels[a]},b.prototype.prefix=function(a){return this._parent?this._parent.prefix()+this._sep+this._prefix+this._sep+(a||""):""+(a||"")},b.prototype.createRpcStream=function(){var b=this;b._isOpen=!0;var d=b.mdm=a({error:!0});d.on("end",function(){b._isOpen=!1,b.emit("close")});var e=b.client=c(null,!0),f=d.createStream("rpc");return f.on("error",function(){}),e.pipe(f).pipe(e),setTimeout(function(){b.emit("open")}),d},b.prototype.close=function(){this._isOpen=!1,this.mdm&&this.mdm.end()},b.prototype.destroy=function(){this.mdm&&this.mdm.close()},b.prototype.auth=function(){var a=[].slice.call(arguments),b="function"==typeof a[a.length-1]?a.pop():function(){};this.client.rpc("auth",a,b)},b.prototype.deauth=function(){var a=[].slice.call(arguments),b="function"==typeof a[a.length-1]?a.pop():function(){};this.client.rpc("deauth",a,b)},b.prototype.pipe=h,b.prototype._buildAll=function(a,c,d,f){var g=this,h=e(a);for(var i in h.methods){var j=h.methods[i],k=j.type,l=d.concat(i).join("!");if("error"==k)throw new Error(j.message||"not supported");/async|sync/.test(k)?g._asyncSync(c,i,l):g._stream(c,i,l,k)}c._sep=a._sep||"",c._prefix=a._prefix,c._parent=f;for(var l in a.sublevels){var m=a.sublevels[l];c.sublevels=c.sublevels||{},c.sublevels[l]=new b(m),g._buildAll(m,c.sublevels[l],d.concat(l),c)}},b.prototype._asyncSync=function(a,b,c){var d=this;a[b]=function(){var e=[].slice.call(arguments),f="function"==typeof e[e.length-1]?e.pop():null;return/is(Open|Closed)/.test(b)&&!f?"isOpen"==b?d._isOpen:!d._isOpen:(f||(f=function(b){b&&a.emit("error",b)}),d._queue(function(){d.client.rpc(c,e,f)}),void 0)}},b.prototype._stream=function(a,b,c,d){var e=this;a[b]=function(){var a=[].slice.call(arguments);a.unshift(c);var b=g();return e._queue(function(){var c=e.mdm,f="readable"===d?c.createReadStream(a):"writable"==d?c.createWriteStream(a):"duplex"==d?c.createStream(a):function(){throw new Error("not supported")}();f.autoDestroy=!1,b.replace(f)}),b}},b.prototype._queue=function(a){this._isOpen?a():this.once("open",a)},b}},{duplexer:126,events:33,"level-manifest":127,"rpc-stream":149,"stream-combiner":152,"tmp-stream":154,util:59}],125:[function(a,b){var c=a("rpc-stream"),d=a("level-manifest");b.exports=function(a){return function(b,e){if("string"==typeof b)throw new Error("database instance required");var f=a({error:!0});e=e||{};var g=(e.deauth||function(){},e.auth||function(){var a=[].pop.call(arguments);a(null,!0)}),h=e.access||function(){return!0},i=c(null,!0),j={};return function k(a,b){var c=d(a);for(var e in c.methods)(function(d){var e=b.concat(d).join("!"),f=c.methods[d];"async"==f.type?i.createLocalCall(e,function(b,c){h(i.sessionData,a,d,b),b.push(c),a[d].apply(a,b)}):"sync"==f.type?i.createLocalCall(e,function(b,c){h(i.sessionData,a,d,b);var e;try{e=a[d].apply(a,b)}catch(f){return c(f)}c(null,e)}):j[e]=function(b){return h(i.sessionData,a,d,b),a[d].apply(a,b)}})(e);for(var f in a.sublevels)k(a.sublevels[f],b.concat(f))}(b,[]),i.createLocalCall("auth",function(a,b){g.apply(null,a.concat(function(a,c){return a?b(a):(i.sessionData=c,b(null,c),void 0)}))}),i.createLocalCall("deauth",function(a,b){i.sessionData=null,e.deauth?e.deauth.apply(null,a):b()}),f.on("connection",function(a){if(a.on("error",function(){}),"rpc"==a.meta)return a.pipe(i).pipe(a);try{var b=j[a.meta[0]](a.meta.slice(1));b.readable&&b.pipe(a),b.writable&&a.pipe(b)}catch(c){f.emit("error",c)}}),f}}},{"level-manifest":127,"rpc-stream":149}],126:[function(a,b){function c(a,b){function c(b){function c(){return a[b].apply(a,arguments)}m[b]=c}function i(a){function c(){m.emit(a);var c=b[a];return c?c.apply(b,arguments):(b.emit(a),void 0)}m[a]=c}function j(a){function c(){var b=h.call(arguments);b.unshift(a),m.emit.apply(m,b)}b.on(a,c)}function k(){if(!n){n=!0;var a=h.call(arguments);a.unshift("end"),m.emit.apply(m,a)}}function l(a){m.emit("error",a)}var m=new d,n=!1;return e.forEach(c),f.forEach(i),g.forEach(j),b.on("end",k),a.on("drain",function(){m.emit("drain")}),a.on("error",l),b.on("error",l),m.writable=a.writable,m.readable=b.readable,m}var d=a("stream"),e=["write","end","destroy"],f=["resume","pause"],g=["data","close"],h=Array.prototype.slice;b.exports=c},{stream:50}],127:[function(a,b){var c=a("deep-extend"),d={createReadStream:{type:"readable"},readStream:{type:"readable"},createValueStream:{type:"readable"},valueStream:{type:"readable"},createKeyStream:{type:"readable"},keyStream:{type:"readable"},createWriteStream:{type:"writable"},writeStream:{type:"writable"},isOpen:{type:"sync"},isClosed:{type:"sync"},put:{type:"async"},get:{type:"async"},del:{type:"async"},batch:{type:"async"},approximateSize:{type:"async"}};b.exports=function e(a,b){var f={};if((a.methods||!b)&&(f.methods={}),b?c(f.methods,a.methods):c(c(f.methods,d),a.methods),a._sep&&(f._sep=a._sep),a._prefix&&(f._prefix=a._prefix),a.sublevels){f.sublevels={};for(var g in a.sublevels)f.sublevels[g]=e(a.sublevels[g],b)}return f}},{"deep-extend":128}],128:[function(a,b){var c=b.exports=function(){if(arguments.length<1||"object"!=typeof arguments[0])return!1;if(arguments.length<2)return arguments[0];var a,b,d,e,f=arguments[0],g=Array.prototype.slice.call(arguments,1);return g.forEach(function(g){if("object"==typeof g)for(a in g)if(void 0!==g[a]){if(d=f[a],b=g[a],b===f)continue;if("object"!=typeof b||null===b){f[a]=b;continue}if("object"!=typeof d){e=Array.isArray(b)?[]:{},f[a]=c(e,b);continue}e=Array.isArray(b)?Array.isArray(d)?d:[]:Array.isArray(d)?{}:d,f[a]=c(e,b)}}),f}},{}],129:[function(a,b){"use strict";var c=a("through"),d=a("xtend"),e=a("duplex");b.exports=function(a){function b(b,f){function g(){return Math.random().toString(16).slice(2)+Math.random().toString(16).slice(2)}function h(a){l.removeListener("end",h),l.removeListener("error",h),l.removeListener("close",h);var c=a||new Error("unexpected disconnection");for(var d in j){var e=j[d];e.destroyed=!0,b.error!==!0?e.end():(e.emit("error",c),e.destroy())}}function i(a,b,d){k++;var e=c(function(b){if(!this.writable){var c=Error("stream is not writable: "+a);return c.stream=this,m.emit("error",c)}l._data([e.id,"data",b])},function(){l._data([e.id,"end"]),!this.readable||d.allowHalfOpen||this.ended||this.emit("end")});return e.pause=function(){l._data([e.id,"pause"])},e.resume=function(){l._data([e.id,"resume"])},e.error=function(a){l._data([e.id,"error",a])},e.once("close",function(){delete j[a],k--,l._data([e.id,"close"]),0===k&&l.emit("zero")}),e.writable=d.writable,e.readable=d.readable,j[e.id=a]=e,e.meta=b,e}"function"==typeof b&&(f=b,b=null),b=b||{};var j={},k=0,l=e();l.on("_data",function(a){if(Array.isArray(a)&&"string"==typeof a[0]&&"__proto__"!==a[0]&&"string"==typeof a[1]&&"__proto__"!==a[1]){var b=a.shift(),c=a[0],e=j[b];if(e)if("pause"===c)e.paused=!0;else if("resume"===c){var f=e.paused;e.paused=!1,f&&e.emit("drain")}else if("error"===c){var g=a[1];if("string"==typeof g)e.emit("error",new Error(g));else if("string"==typeof g.message){var h=new Error(g.message);d(h,g),e.emit("error",h)}else e.emit("error",g)}else e.emit.apply(e,a);else{if("close"==c)return;if("new"!=c)return m.emit("unknown",b);l.emit("connection",i(b,a[1].meta,a[1].opts))}}}).on("_end",function(){h(),l._end()});var m=a(l,b);l!==m&&l.on("connection",function(a){m.emit("connection",a)}),m.close=function(a){return l.once("zero",function(){l._end(),a&&a()}),this},f&&m.on("connection",f),m.on("connection",function(a){1===m.listeners("connection").length&&a.error("remote end lacks connection listener "+m.listeners("connection").length)});var n=m.pipe;return m.pipe=function(a,b){return n.call(m,a,b),l.on("end",h),l.on("close",h),l.on("error",h),a},m.createStream=function(a,b){b=b||{},b.writable||b.readable||(b.readable=b.writable=!0);var c=i(g(),a,b),d={writable:b.readable,readable:b.writable};return l._data([c.id,"new",{meta:a,opts:d}]),c},m.createWriteStream=function(a){return m.createStream(a,{writable:!0,readable:!1})},m.createReadStream=function(a){return m.createStream(a,{writable:!1,readable:!0})},m}return b}},{duplex:131,through:147,xtend:148}],130:[function(a,b){function c(a){return e.json(a,d)}var d=a("json-buffer"),e=a("stream-serializer"),f=a("./inject");b.exports=f(c),b.exports.wrap=c},{"./inject":129,"json-buffer":132,"stream-serializer":146}],131:[function(a,b){var c=a("__browserify_process"),d=a("stream");b.exports=function(a,b){var e,f=new d,g=[],h=!1,i=!1;f.writable=f.readable=!0,f.paused=!1,f._paused=!1,f.buffer=g,f.on("pause",function(){f._paused=!0}).on("drain",function(){f._paused=!1}),a&&f.on("_data",a),b&&f.on("_end",b),f.once("end",function(){f.readable=!1,f.writable||c.nextTick(function(){f.destroy()})}),f.once("_end",function(){f.writable=!1,f.readable||f.destroy()}),f._data=function(a){return f.paused||g.length?g.push(a):f.emit("data",a),!(f.paused||g.length)},f._end=function(a){a&&f._data(a),e||(e=!0,f.drain())},f.write=function(a){return f.emit("_data",a),!f._paused},f.end=function(){f.writable=!1,f.ended||(f.ended=!0,f.emit("_end"))},f.drain=function(){if(g.length||e)for(;!f.paused;){if(!g.length)return e&&f.readable?(f.readable=!1,f.emit("end"),void 0):!0;f.emit("data",g.shift()),0==g.length&&f.emit("_drain")}};var j=!1;f.resume=function(){return j=!0,f.paused=!1,f.drain(),f},f.destroy=function(){i||(i=h=!0,g.length=0,f.emit("close"))};return f.pause=function(){return j=!0,f.paused=!0,f.emit("_pause"),f},f._pause=function(){return f._paused||(f._paused=!0,f.emit("pause")),this},f.paused=!0,c.nextTick(function(){j||f.resume()}),f}},{__browserify_process:40,stream:50}],132:[function(a,b,c){var d=a("bops");c.stringify=function e(a){if(a&&d.is(a))return JSON.stringify(":base64:"+d.to(a,"base64"));if(a&&a.toJSON&&(a=a.toJSON()),a&&"object"==typeof a){var b="",c=Array.isArray(a);b=c?"[":"{";var f=!0;for(var g in a){var h="function"==typeof a[g];Object.hasOwnProperty.call(a,g)&&void 0!==a[g]&&!h&&(f||(b+=","),f=!1,b+=c?e(a[g]):e(g)+":"+e(a[g]))}return b+=c?"]":"}"}return"string"==typeof a?JSON.stringify(/^:/.test(a)?":"+a:a):JSON.stringify(a)},c.parse=function(a){return JSON.parse(a,function(a,b){return"string"==typeof b?/^:base64:/.test(b)?d.from(b.substring(8),"base64"):/^:/.test(b)?b.substring(1):b:b})}},{bops:133}],133:[function(a,b,c){arguments[4][8][0].apply(c,arguments)},{"./copy.js":136,"./create.js":137,"./from.js":138,"./is.js":139,"./join.js":140,"./read.js":142,"./subarray.js":143,"./to.js":144,"./write.js":145}],134:[function(a,b){b.exports=a(9)},{}],135:[function(a,b){b.exports=a(10)},{}],136:[function(a,b){b.exports=a(11)},{}],137:[function(a,b){b.exports=a(12)},{}],138:[function(a,b){b.exports=a(13)},{"base64-js":134}],139:[function(a,b){b.exports=a(14)},{}],140:[function(a,b){b.exports=a(15)},{}],141:[function(a,b){b.exports=a(16)},{}],142:[function(a,b){b.exports=a(17)},{"./mapped.js":141}],143:[function(a,b){b.exports=a(18)},{}],144:[function(a,b){b.exports=a(19)},{"base64-js":134,"to-utf8":135}],145:[function(a,b){b.exports=a(20)},{"./mapped.js":141}],146:[function(a,b,c){var d=a("events").EventEmitter;c=b.exports=function(a){return"function"==typeof a?a:c[a]||c.json},c.json=function(a,b){function c(c){var d;try{d=b.parse(c)}catch(e){return e.line=c,a.emit("error",e)}void 0!==d&&f.call(a,d)}function e(a){var b=(g+a).split("\n");for(g=b.pop();b.length;)c(b.shift())}b=b||JSON;var f=a.write,g="";a.write=e;var h=a.end;return a.end=function(b){return b&&a.write(b),g&&c(g),h.call(a)},a.emit=function(c,e){"data"==c&&(e=b.stringify(e)+"\n"),d.prototype.emit.call(a,c,e)},a},c.raw=function(a){return a}},{events:33}],147:[function(a,b){b.exports=a(28)},{__browserify_process:40,stream:50}],148:[function(a,b){function c(a){for(var b=1;b<arguments.length;b++)for(var c=arguments[b],d=Object.keys(c),e=0;e<d.length;e++){var f=d[e];a[f]=c[f]}return a}b.exports=c},{}],149:[function(a,b){var c=a("through"),d=a("stream-serializer")();b.exports=function(a,b){function e(a){if(!(a instanceof Error))return a;var b={message:a.message};for(var c in a)b[c]=a[c];return b}function f(a){if(!a||!a.message)return a;var b=new Error(a.message);for(var c in a)b[c]=a[c];return b}function g(a){var b=[];for(var c in a)b.push(c);return b}var h={},i=1,j=a||{},k=c(function(b){b=b.slice();var c=b.pop(),d=b.pop(),g=b.pop();if(d[0]&&(d[0]=f(d[0])),null!=g){var i=function(){var a=[].slice.call(arguments);a[0]=e(a[0]),~c&&k.emit("data",[a,c])};try{j[g].call(a,d,i)}catch(l){~c&&k.emit("data",[[e(l)],c])}}else{if(!h[c])return console.error("ERROR: unknown callback id: "+c,b);var i=h[c];delete h[c],i.apply(null,d)}}),l=k.rpc=function(a,b,c){if(c&&(h[++i]=c),"string"!=typeof a)throw new Error("name *must* be string");k.emit("data",[a,b,c?i:-1]),c&&9007199254740992==i&&(i=0)};return k.createRemoteCall=function(a){return function(){var b=[].slice.call(arguments),c="function"==typeof b[b.length-1]?b.pop():null;l(a,b,c)}},k.createLocalCall=function(a,b){j[a]=b},k.wrap=function(a,b){b=b||[];var c={};return(Array.isArray(a)?a:"string"==typeof a?[a]:a=g(a)).forEach(function(a){c[a]=k.createRemoteCall(a)}),c},b?k:d(k)}},{"stream-serializer":150,through:151}],150:[function(a,b,c){var d=a("events").EventEmitter;c=b.exports=function(a){return"function"==typeof a?a:c[a]||c.json},c.json=function(a){function b(b){var c;try{c=JSON.parse(b)}catch(d){return a.emit("error",d)}void 0!==c&&e.call(a,c)}function c(a){var c=(f+a).split("\n");for(f=c.pop();c.length;)b(c.shift())}var e=a.write,f="";a.write=c;var g=a.end;return a.end=function(c){return c&&a.write(c),f&&b(f),g.call(a)},a.emit=function(b,c){"data"==b&&(c=JSON.stringify(c)+"\n"),d.prototype.emit.call(a,b,c)},a},c.raw=function(a){return a}},{events:33}],151:[function(a,b){b.exports=a(28)},{__browserify_process:40,stream:50}],152:[function(a,b){var c=a("duplexer");b.exports=function(){function a(b){b.length<2||(b[0].pipe(b[1]),a(b.slice(1)))}function b(){var a=[].slice.call(arguments);a.unshift("error"),g.emit.apply(g,a)}var d=[].slice.call(arguments),e=d[0],f=d[d.length-1],g=c(e,f);if(1==d.length)return d[0];if(!d.length)throw new Error("connect called with empty args");a(d);for(var h=1;h<d.length-1;h++)d[h].on("error",b);return g}},{duplexer:153}],153:[function(a,b){function c(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c++)b(a[c],c)}function d(a,b){function d(b){function c(){return a[b].apply(a,arguments)}n[b]=c}function j(a){function c(){n.emit(a);var c=b[a];return c?c.apply(b,arguments):(b.emit(a),void 0)}n[a]=c}function k(a){function c(){var b=i.call(arguments);b.unshift(a),n.emit.apply(n,b)}b.on(a,c)}function l(){if(!o){o=!0;var a=i.call(arguments);a.unshift("end"),n.emit.apply(n,a)}}function m(a){n.emit("error",a)}var n=new e,o=!1;return c(f,d),c(g,j),c(h,k),b.on("end",l),a.on("drain",function(){n.emit("drain")}),a.on("error",m),b.on("error",m),n.writable=a.writable,n.readable=b.readable,n}var e=a("stream"),f=["write","end","destroy"],g=["resume","pause"],h=["data","close"],i=Array.prototype.slice;b.exports=d},{stream:50}],154:[function(a,b){function c(){var a,b=!1,c=[],d=f(function(d){return b?a.write(d):(c.push(d),!1)}),h=f(),i=e(d,h);return i.replace=function(e){a=e,b=!0,i.readable=a.readable,i.writable=a.writable,a.readable&&a.pipe(h),a.writable&&d.pipe(a),e.on("error",function(a){i.emit("error",a)}),e.once("close",function(){i.emit("close")}),g(function(){for(var b=0;b<c.length;b++)a.write(c[b]);c=null})},i}var d=a("__browserify_process"),e=a("duplexer"),f=a("through"),g="undefined"!=typeof setImmediate?setImmediate:d.nextTick;b.exports=c},{__browserify_process:40,duplexer:155,through:156}],155:[function(a,b){b.exports=a(153)},{stream:50}],156:[function(a,b){b.exports=a(28)},{__browserify_process:40,stream:50}],157:[function(a,b){function c(a){var b=this;a||(a={route:"/_persona"}),"string"==typeof a&&(a={route:a}),b.routes={},"string"==typeof a.route&&(b.routes.login=a.route+"/login",b.routes.logout=a.route+"/logout"),a.login&&(b.routes.login=a.login),a.logout&&(b.routes.logout=a.logout)}var d=a("http"),e=a("inherits"),f=a("events").EventEmitter,g=a("url"),h=(a("querystring"),a("./vendor/persona.js"));b.exports=function(a){return new c(a)},e(c,f),c.prototype.set=function(a){this.id=a,a?this.emit("login",a):this.emit("logout")},c.prototype.identify=function(){this._watch(null),h.request()},c.prototype.unidentify=function(){h.logout(),this._logout()},c.prototype._watch=function(a){var b=this;h.watch({loggedInUser:a,onlogin:function(a){b._login(a)},onlogout:function(){b._logout()}})},c.prototype._login=function(a){var b=this,c=b.routes.login,e="object"==typeof c?c:g.parse(c),f=d.request({method:"POST",host:e.hostname||window.location.hostname,port:e.port||window.location.port,path:e.path});f.on("response",function(a){var c="";a.on("data",function(a){c+=a}),/^2\d\d\b/.test(a.statusCode)?a.on("end",function(){try{var a=JSON.parse(c)}catch(d){return b.emit("error",d)}if(!a||"object"!=typeof a)return b.emit("error","unexpected response "+typeof a);if(a&&a.cookie)for(var e in a.cookie)document.cookie=e+"="+a.cookie[e];a&&a.id&&(b.id=a.id,b.emit("login",a.id))}):(b.id=null,a.on("end",function(){b.emit("error",new Error("error code "+a.statusCode+": "+c))}),h.logout())}),f.end(JSON.stringify({assertion:a}))},c.prototype._logout=function(){var a=this,b=a.routes.logout;a.id=null;var c="object"==typeof b?b:g.parse(b),e=d.request({method:"POST",host:c.hostname||window.location.hostname,port:c.port||window.location.port,path:c.path});e.on("response",function(b){if(/^2\d\d\b/.test(b.statusCode))a.emit("logout");else{var c="";b.on("data",function(a){c+=a}),b.on("end",function(){a.emit("error",new Error("error code "+b.statusCode+": "+c))})}}),e.end()}},{"./vendor/persona.js":159,events:33,http:34,inherits:158,querystring:48,url:57}],158:[function(a,b){b.exports=a(38)},{}],159:[function(a,b){var c={userAgent:window.navigator.userAgent};window.navigator.id&&(c.id=window.navigator.id),function(){function a(a){if(void 0===w)w=a;else if(w!=a)throw new Error("you cannot combine the navigator.id.watch() API with navigator.id.getVerifiedEmail() or navigator.id.get()this site should instead use navigator.id.request() and navigator.id.watch()")}function b(a){document.addEventListener?document.addEventListener("DOMContentLoaded",function b(){document.removeEventListener("DOMContentLoaded",b),a()},!1):document.attachEvent&&document.readyState&&document.attachEvent("onreadystatechange",function c(){var b=document.readyState;("loaded"===b||"complete"===b||"interactive"===b)&&(document.detachEvent("onreadystatechange",c),a())})}function d(){if(y){var a=window.document;if(!a.body)return x||(b(d),x=!0),void 0;try{if(!p){var c=a.createElement("iframe");c.style.display="none",a.body.appendChild(c),c.src=r+"/communication_iframe",p=l.build({window:c.contentWindow,origin:r,scope:"mozid_ni",onReady:function(){p.call({method:"loaded",success:function(){v.ready&&v.ready()},error:function(){}})}}),p.bind("logout",function(){v.logout&&v.logout()}),p.bind("login",function(a,b){v.login&&v.login(b)}),p.bind("match",function(){v.match&&v.match()}),e(o)&&p.notify({method:"loggedInUser",params:o})}}catch(f){p=void 0}}}function e(a){return"undefined"!=typeof a}function f(a){try{console.warn(a)}catch(b){}}function g(a,b){return e(a[b])?(f(b+" has been deprecated"),!0):void 0}function h(a,b,c){if(e(a[b])&&e(a[c]))throw new Error("you cannot supply *both* "+b+" and "+c);g(a,b)&&(a[c]=a[b],delete a[b])}function i(a){if("object"==typeof a){if(a.onlogin&&"function"!=typeof a.onlogin||a.onlogout&&"function"!=typeof a.onlogout||a.onmatch&&"function"!=typeof a.onmatch||a.onready&&"function"!=typeof a.onready)throw new Error("non-function where function expected in parameters to navigator.id.watch()");if(!a.onlogin)throw new Error("'onlogin' is a required argument to navigator.id.watch()");if(!a.onlogout)throw new Error("'onlogout' is a required argument to navigator.id.watch()");v.login=a.onlogin||null,v.logout=a.onlogout||null,v.match=a.onmatch||null,v.ready=a.onready||null,h(a,"loggedInEmail","loggedInUser"),o=a.loggedInUser,d()}}function j(){var a=q;return"request"===a&&(a=v.ready?"watch_with_onready":"watch_without_onready"),a}function k(a){if(g(a,"requiredEmail"),h(a,"tosURL","termsOfService"),h(a,"privacyURL","privacyPolicy"),a.termsOfService&&!a.privacyPolicy&&f("termsOfService ignored unless privacyPolicy also defined"),a.privacyPolicy&&!a.termsOfService&&f("privacyPolicy ignored unless termsOfService also defined"),a.rp_api=j(),q=null,a.start_time=(new Date).getTime(),n)try{n.focus()}catch(b){}else{if(!m.isSupported()){var c=m.getNoSupportReason(),d="unsupported_dialog";return"LOCALSTORAGE_DISABLED"===c&&(d="cookies_disabled"),n=window.open(r+"/"+d,null,u),void 0}p&&p.notify({method:"dialog_running"}),n=WinChan.open({url:r+"/sign_in",relay_url:r+"/relay",window_features:u,window_name:"__persona_dialog",params:{method:"get",params:a}},function(b,c){if(p&&(!b&&c&&c.email&&p.notify({method:"loggedInUser",params:c.email}),p.notify({method:"dialog_complete"})),n=void 0,!b&&c&&c.assertion)try{v.login&&v.login(c.assertion)}catch(d){}"client closed window"!==b&&c||(a&&a.oncancel&&a.oncancel(),delete a.oncancel)})}}var l=function(){function a(a){return Array.isArray?Array.isArray(a):-1!=a.constructor.toString().indexOf("Array")}function b(a,b,c){for(var d=e[b][c],f=0;f<d.length;f++)d[f].win===a&&d.splice(f,1);0===e[b][c].length&&delete e[b][c]}function c(a,b,c,d){function f(b){for(var c=0;c<b.length;c++)if(b[c].win===a)return!0;return!1}var g=!1;if("*"===b){for(var h in e)if(e.hasOwnProperty(h)&&"*"!==h&&"object"==typeof e[h][c]&&(g=f(e[h][c])))break}else e["*"]&&e["*"][c]&&(g=f(e["*"][c])),!g&&e[b]&&e[b][c]&&(g=f(e[b][c]));if(g)throw"A channel is already bound to the same window which overlaps with origin '"+b+"' and has scope '"+c+"'";"object"!=typeof e[b]&&(e[b]={}),"object"!=typeof e[b][c]&&(e[b][c]=[]),e[b][c].push({win:a,handler:d})}var d=Math.floor(1000001*Math.random()),e={},f={},g=function(a){try{var b=JSON.parse(a.data);if("object"!=typeof b||null===b)throw"malformed"}catch(a){return}var c,d,g,h=a.source,i=a.origin;if("string"==typeof b.method){var j=b.method.split("::");2==j.length?(c=j[0],g=j[1]):g=b.method}if("undefined"!=typeof b.id&&(d=b.id),"string"==typeof g){var k=!1;if(e[i]&&e[i][c])for(var l=0;l<e[i][c].length;l++)if(e[i][c][l].win===h){e[i][c][l].handler(i,g,b),k=!0;break}if(!k&&e["*"]&&e["*"][c])for(var l=0;l<e["*"][c].length;l++)if(e["*"][c][l].win===h){e["*"][c][l].handler(i,g,b);break}}else"undefined"!=typeof d&&f[d]&&f[d](i,g,b)};return window.addEventListener?window.addEventListener("message",g,!1):window.attachEvent&&window.attachEvent("onmessage",g),{build:function(e){var g=function(a){if(e.debugOutput&&window.console&&window.console.log){try{"string"!=typeof a&&(a=JSON.stringify(a))}catch(b){}console.log("["+j+"] "+a)}};if(!window.postMessage)throw"jschannel cannot run this browser, no postMessage";if(!window.JSON||!window.JSON.stringify||!window.JSON.parse)throw"jschannel cannot run this browser, no JSON parsing/serialization";if("object"!=typeof e)throw"Channel build invoked without a proper object argument";if(!e.window||!e.window.postMessage)throw"Channel.build() called without a valid window argument";if(window===e.window)throw"target window is same as present window -- not allowed";var h=!1;if("string"==typeof e.origin){var i;"*"===e.origin?h=!0:null!==(i=e.origin.match(/^https?:\/\/(?:[-a-zA-Z0-9_\.])+(?::\d+)?/))&&(e.origin=i[0].toLowerCase(),h=!0)}if(!h)throw"Channel.build() called with an invalid origin";if("undefined"!=typeof e.scope){if("string"!=typeof e.scope)throw"scope, when specified, must be a string";if(e.scope.split("::").length>1)throw"scope may not contain double colons: '::'"}var j=function(){for(var a="",b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",c=0;5>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}(),k={},l={},m={},n=!1,o=[],p=function(a,b,c){var d=!1,e=!1;return{origin:b,invoke:function(b,d){if(!m[a])throw"attempting to invoke a callback of a nonexistent transaction: "+a;for(var e=!1,f=0;f<c.length;f++)if(b===c[f]){e=!0;break}if(!e)throw"request supports no such callback '"+b+"'";t({id:a,callback:b,params:d})},error:function(b,c){if(e=!0,!m[a])throw"error called for nonexistent message: "+a;delete m[a],t({id:a,error:b,message:c})},complete:function(b){if(e=!0,!m[a])throw"complete called for nonexistent message: "+a;delete m[a],t({id:a,result:b})},delayReturn:function(a){return"boolean"==typeof a&&(d=a===!0),d},completed:function(){return e}}},q=function(a,b,c){return window.setTimeout(function(){if(l[a]){var d="timeout ("+b+"ms) exceeded on method '"+c+"'";l[a].error("timeout_error",d),delete l[a],delete f[a]}},b)},r=function(b,c,d){if("function"==typeof e.gotMessageObserver)try{e.gotMessageObserver(b,d)}catch(h){g("gotMessageObserver() raised an exception: "+h.toString())}if(d.id&&c){if(k[c]){var i=p(d.id,b,d.callbacks?d.callbacks:[]);m[d.id]={};try{if(d.callbacks&&a(d.callbacks)&&d.callbacks.length>0)for(var j=0;j<d.callbacks.length;j++){for(var n=d.callbacks[j],o=d.params,q=n.split("/"),r=0;r<q.length-1;r++){var s=q[r];"object"!=typeof o[s]&&(o[s]={}),o=o[s]}o[q[q.length-1]]=function(){var a=n;return function(b){return i.invoke(a,b)}}()}var t=k[c](i,d.params);!i.delayReturn()&&!i.completed()&&i.complete(t)}catch(h){var u="runtime_error",v=null;if("string"==typeof h?v=h:"object"==typeof h&&(h&&a(h)&&2==h.length?(u=h[0],v=h[1]):"string"==typeof h.error&&(u=h.error,h.message?"string"==typeof h.message?v=h.message:h=h.message:v="")),null===v)try{v=JSON.stringify(h),"undefined"==typeof v&&(v=h.toString())}catch(w){v=h.toString()}i.error(u,v)}}}else d.id&&d.callback?l[d.id]&&l[d.id].callbacks&&l[d.id].callbacks[d.callback]?l[d.id].callbacks[d.callback](d.params):g("ignoring invalid callback, id:"+d.id+" ("+d.callback+")"):d.id?l[d.id]?(d.error?l[d.id].error(d.error,d.message):void 0!==d.result?l[d.id].success(d.result):l[d.id].success(),delete l[d.id],delete f[d.id]):g("ignoring invalid response: "+d.id):c&&k[c]&&k[c]({origin:b},d.params)};c(e.window,e.origin,"string"==typeof e.scope?e.scope:"",r);var s=function(a){return"string"==typeof e.scope&&e.scope.length&&(a=[e.scope,a].join("::")),a},t=function(a,b){if(!a)throw"postMessage called with null message";var c=n?"post  ":"queue ";if(g(c+" message: "+JSON.stringify(a)),b||n){if("function"==typeof e.postMessageObserver)try{e.postMessageObserver(e.origin,a)}catch(d){g("postMessageObserver() raised an exception: "+d.toString())}e.window.postMessage(JSON.stringify(a),e.origin)}else o.push(a)},u=function(a,b){if(g("ready msg received"),n)throw"received ready message while in ready state.  help!";for(j+="ping"===b?"-R":"-L",v.unbind("__ready"),n=!0,g("ready msg accepted."),"ping"===b&&v.notify({method:"__ready",params:"pong"});o.length;)t(o.pop());"function"==typeof e.onReady&&e.onReady(v)},v={unbind:function(a){if(k[a]){if(delete k[a])return!0;throw"can't delete method: "+a}return!1},bind:function(a,b){if(!a||"string"!=typeof a)throw"'method' argument to bind must be string";if(!b||"function"!=typeof b)throw"callback missing from bind params";if(k[a])throw"method '"+a+"' is already bound!";return k[a]=b,this},call:function(a){if(!a)throw"missing arguments to call function";if(!a.method||"string"!=typeof a.method)throw"'method' argument to call must be string";if(!a.success||"function"!=typeof a.success)throw"'success' callback missing from call";var b={},c=[],e=function(a,d){if("object"==typeof d)for(var f in d)if(d.hasOwnProperty(f)){var g=a+(a.length?"/":"")+f;"function"==typeof d[f]?(b[g]=d[f],c.push(g),delete d[f]):"object"==typeof d[f]&&e(g,d[f])}};e("",a.params);var g={id:d,method:s(a.method),params:a.params};c.length&&(g.callbacks=c),a.timeout&&q(d,a.timeout,s(a.method)),l[d]={callbacks:b,error:a.error,success:a.success},f[d]=r,d++,t(g)},notify:function(a){if(!a)throw"missing arguments to notify function";if(!a.method||"string"!=typeof a.method)throw"'method' argument to notify must be string";t({method:s(a.method),params:a.params})},destroy:function(){b(e.window,e.origin,"string"==typeof e.scope?e.scope:""),window.removeEventListener?window.removeEventListener("message",r,!1):window.detachEvent&&window.detachEvent("onmessage",r),n=!1,k={},m={},l={},e.origin=null,o=[],g("channel destroyed"),j=""}};return v.bind("__ready",u),setTimeout(function(){},0),v}}}();WinChan=function(){function a(a){/^https?:\/\//.test(a)||(a=window.location.href);var b=/^(https?:\/\/[\-_a-zA-Z\.0-9:]+)/.exec(a);return b?b[1]:a}function b(){return window.JSON&&window.JSON.stringify&&window.JSON.parse&&window.postMessage}function d(){try{var a=c.userAgent;return-1!=a.indexOf("Fennec/")||-1!=a.indexOf("Firefox/")&&-1!=a.indexOf("Android")}catch(b){}return!1}function e(){var a=-1;if("Microsoft Internet Explorer"===c.appName){var b=c.userAgent,d=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=d.exec(b)&&(a=parseFloat(RegExp.$1))}return a>=8}function f(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener&&a.removeEventListener(b,c,!1)}function g(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c,!1)}var h="__winchan_relay_frame",i="die",j=e();return b()?{open:function(b,c){function e(a){try{var b=JSON.parse(a.data);"ready"===b.a?o.postMessage(q,n):"error"===b.a?c&&(c(b.d),c=null):"response"===b.a&&(f(window,"message",e),f(window,"unload",k),k(),c&&(c(null,b.d),c=null))}catch(d){}}function k(){if(m&&document.body.removeChild(m),m=void 0,p)try{p.close()}catch(a){o.postMessage(i,n)}p=o=void 0}if(!c)throw"missing required callback argument";var l;b.url||(l="missing required 'url' parameter"),b.relay_url||(l="missing required 'relay_url' parameter"),l&&setTimeout(function(){c(l)},0),b.window_name||(b.window_name=null),(!b.window_features||d())&&(b.window_features=void 0);var m,n=a(b.url);if(n!==a(b.relay_url))return setTimeout(function(){c("invalid arguments: origin of url and relay_url must match")},0);var o;j&&(m=document.createElement("iframe"),m.setAttribute("src",b.relay_url),m.style.display="none",m.setAttribute("name",h),document.body.appendChild(m),o=m.contentWindow);var p=window.open(b.url,b.window_name,b.window_features);o||(o=p);var q=JSON.stringify({a:"request",d:b.params});return g(window,"unload",k),g(window,"message",e),{close:k,focus:function(){if(p)try{p.focus()}catch(a){}}}}}:{open:function(a,b,c,d){setTimeout(function(){d("unsupported browser")},0)}}}();var m=function(){function a(){return k}function b(){return k=g()||f()||e()||d(),!k}function d(){return window.JSON&&window.JSON.stringify&&window.JSON.parse?void 0:"JSON_NOT_SUPPORTED"}function e(){return l.postMessage?void 0:"POSTMESSAGE_NOT_SUPPORTED"}function f(){try{var a="localStorage"in l&&null!==l.localStorage;if(!a)return"LOCALSTORAGE_NOT_SUPPORTED";l.localStorage.setItem("test","true"),l.localStorage.removeItem("test")}catch(b){return"LOCALSTORAGE_DISABLED"}}function g(){return h()}function h(){var a=i(),b=a>-1&&8>a;return b?"BAD_IE_VERSION":void 0}function i(){var a=-1;if("Microsoft Internet Explorer"==m.appName){var b=m.userAgent,c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=c.exec(b)&&(a=parseFloat(RegExp.$1))}return a}function j(a,b){m=a,l=b}var k,l=window,m=c;return{setTestEnv:j,isSupported:b,getNoSupportReason:a}
}();if(c.id||(c.id={},c.id=c.mozId?c.mozId:{}),!c.id.request||c.id._shimmed){var n,o,p,q,r="https://login.persona.org",s=c.userAgent,t=-1!=s.indexOf("Fennec/")||-1!=s.indexOf("Firefox/")&&-1!=s.indexOf("Android"),u=t?void 0:"menubar=0,location=1,resizable=1,scrollbars=1,status=0,width=700,height=375",v={login:null,logout:null,match:null,ready:null},w=void 0,x=!1,y=m.isSupported();c.id={request:function(b){if(this!=c.id)throw new Error("all navigator.id calls must be made on the navigator.id object");if(!v.login)throw new Error("navigator.id.watch must be called before navigator.id.request");return b=b||{},a(!1),q="request",b.returnTo||(b.returnTo=document.location.pathname),k(b)},watch:function(b){if(this!=c.id)throw new Error("all navigator.id calls must be made on the navigator.id object");a(!1),i(b)},logout:function(a){if(this!=c.id)throw new Error("all navigator.id calls must be made on the navigator.id object");d(),p&&p.notify({method:"logout"}),"function"==typeof a&&(f("navigator.id.logout callback argument has been deprecated."),setTimeout(a,0))},get:function(b,c){var d={};c=c||{},d.privacyPolicy=c.privacyPolicy||void 0,d.termsOfService=c.termsOfService||void 0,d.privacyURL=c.privacyURL||void 0,d.tosURL=c.tosURL||void 0,d.siteName=c.siteName||void 0,d.siteLogo=c.siteLogo||void 0,q=q||"get",g(c,"silent")?b&&setTimeout(function(){b(null)},0):(a(!0),i({onlogin:function(a){b&&(b(a),b=null)},onlogout:function(){}}),d.oncancel=function(){b&&(b(null),b=null),v.login=v.logout=v.match=v.ready=null},k(d))},getVerifiedEmail:function(b){f("navigator.id.getVerifiedEmail has been deprecated"),a(!0),q="getVerifiedEmail",c.id.get(b)},_shimmed:!0}}}(),b.exports=c.id},{}],160:[function(a,b){function c(a,b){return this instanceof c?(d.Stream.call(this),this.options=b||{},this.readable=!0,this.writable=!0,this._buffer=[],"object"==typeof a?(this.ws=a,this.ws.on("message",this.onMessage.bind(this)),this.ws.on("error",this.onError.bind(this)),this.ws.on("close",this.onClose.bind(this)),this.ws.on("open",this.onOpen.bind(this)),1===this.ws.readyState&&(this._open=!0)):(this.ws=new WebSocket(a,this.options.protocol),this.ws.binaryType=this.options.binaryType||"arraybuffer",this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this),this.ws.onclose=this.onClose.bind(this),this.ws.onopen=this.onOpen.bind(this)),void 0):new c(a,b)}var d=a("stream"),e=a("util"),f=a("isbuffer");e.inherits(c,d.Stream),b.exports=c,b.exports.WebsocketStream=c,c.prototype.onMessage=function(a,b){return a.data?this.emit("data",a.data,b):(this.emit("data",a,b),void 0)},c.prototype.onError=function(a){this.emit("error",a)},c.prototype.onClose=function(){this._destroy||this.emit("end")},c.prototype.onOpen=function(){if(!this._destroy){this._open=!0;for(var a=0;a<this._buffer.length;a++)this._write(this._buffer[a]);this._buffer=void 0,this.emit("open"),this.emit("connect"),this._end&&this.ws.close()}},c.prototype.write=function(a){this._open?this._write(a):this._buffer.push(a)},c.prototype._write=function(a){"undefined"!=typeof WebSocket&&this.ws instanceof WebSocket?this.ws.send(a):this.ws.send(a,{binary:f(a)})},c.prototype.end=function(a){void 0!==a&&this.write(a),this._open&&this.ws.close(),this._end=!0},c.prototype.destroy=function(){this._destroy=!0,this.ws.close()}},{isbuffer:161,stream:50,util:59}],161:[function(a,b){b.exports=a(79)},{buffer:41}],162:[function(a,b){function c(a,b,c){c?c.image=c.image||b:c={image:b},"object"!=typeof b||b instanceof HTMLElement||(c=b),d=a,this.sizeRatio=c.sizeRatio||8,this.scale=c.scale||new a.Vector3(1,1,1),this.fallbackImage=c.fallbackImage||"skin.png",this.createCanvases(),this.charMaterial=this.getMaterial(this.skin,!1),this.charMaterialTrans=this.getMaterial(this.skin,!0),"string"==typeof c.image&&this.fetchImage(c.image),c.image instanceof HTMLElement&&this.setImage(c.image),this.mesh=this.createPlayerObject()}var d;b.exports=function(a,b,d){return new c(a,b,d)},c.prototype.createCanvases=function(){this.skinBig=document.createElement("canvas"),this.skinBigContext=this.skinBig.getContext("2d"),this.skinBig.width=64*this.sizeRatio,this.skinBig.height=32*this.sizeRatio,this.skin=document.createElement("canvas"),this.skinContext=this.skin.getContext("2d"),this.skin.width=64,this.skin.height=32},c.prototype.fetchImage=function(a){var b=this;this.image=new Image,this.image.crossOrigin="anonymous",this.image.src=a,this.image.onload=function(){b.setImage(b.image)}},c.prototype.setImage=function(a){this.image=a,this.skinContext.clearRect(0,0,64,32),this.skinContext.drawImage(a,0,0);var b=this.skinContext.getImageData(0,0,64,32),c=b.data;this.skinBigContext.clearRect(0,0,this.skinBig.width,this.skinBig.height),this.skinBigContext.save();for(var d=!0,e=[40,0],f=4*(e[0]+64*e[1]),g=function(a,b){return c[4*(a+64*b)+0]!==c[f+0]||c[4*(a+64*b)+1]!==c[f+1]||c[4*(a+64*b)+2]!==c[f+2]||c[4*(a+64*b)+3]!==c[f+3]?!0:!1},h=32;64>h;h+=1){for(var i=8;16>i;i+=1)if(g(h,i)){d=!1;break}if(!d)break}if(!d)for(var h=40;56>h;h+=1){for(var i=0;8>i;i+=1)if(g(h,i)){d=!1;break}if(!d)break}for(var h=0;64>h;h+=1)for(var i=0;32>i;i+=1)d&&(h>=32&&64>h&&i>=8&&16>i||h>=40&&56>h&&i>=0&&8>i)&&(c[4*(h+64*i)+3]=0),this.skinBigContext.fillStyle="rgba("+c[4*(h+64*i)+0]+", "+c[4*(h+64*i)+1]+", "+c[4*(h+64*i)+2]+", "+c[4*(h+64*i)+3]/255+")",this.skinBigContext.fillRect(h*this.sizeRatio,i*this.sizeRatio,this.sizeRatio,this.sizeRatio);this.skinBigContext.restore(),this.skinContext.putImageData(b,0,0),this.charMaterial.map.needsUpdate=!0,this.charMaterialTrans.map.needsUpdate=!0},c.prototype.getMaterial=function(a,b){var c=new d.Texture(a);c.magFilter=d.NearestFilter,c.minFilter=d.NearestFilter,c.format=b?d.RGBAFormat:d.RGBFormat,c.needsUpdate=!0;var e=new d.MeshBasicMaterial({map:c,transparent:b?!0:!1});return e},c.prototype.UVMap=function(a,b,c,d,e,f,g){g||(g=0);var h=a.geometry.faceVertexUvs[0][b],i=c,j=d,k=1/64,l=1/32;h[(0+g)%4].x=i*k,h[(0+g)%4].y=1-j*l,h[(1+g)%4].x=i*k,h[(1+g)%4].y=1-(j*l+f*l),h[(2+g)%4].x=i*k+e*k,h[(2+g)%4].y=1-(j*l+f*l),h[(3+g)%4].x=i*k+e*k,h[(3+g)%4].y=1-j*l},c.prototype.cubeFromPlanes=function(a,b){for(var c=new d.Object3D,e=[],f=0;6>f;f++){var g=new d.Mesh(new d.PlaneGeometry(a,a),b);g.doubleSided=!0,c.add(g),e.push(g)}return e[0].rotation.x=Math.PI/2,e[0].rotation.z=-Math.PI/2,e[0].position.x=a/2,e[1].rotation.x=Math.PI/2,e[1].rotation.z=Math.PI/2,e[1].position.x=-a/2,e[2].position.y=a/2,e[3].rotation.y=Math.PI,e[3].rotation.z=Math.PI,e[3].position.y=-a/2,e[4].rotation.x=Math.PI/2,e[4].position.z=a/2,e[5].rotation.x=-Math.PI/2,e[5].rotation.y=Math.PI,e[5].position.z=-a/2,c},c.prototype.createPlayerObject=function(){for(var a=new d.Object3D,b=this.upperbody=new d.Object3D,c=new d.CubeGeometry(4,12,4),e=0;8>e;e+=1)c.vertices[e].y-=6;var f=this.leftLeg=new d.Mesh(c,this.charMaterial);f.position.z=-2,f.position.y=-6,this.UVMap(f,0,8,20,-4,12),this.UVMap(f,1,16,20,-4,12),this.UVMap(f,2,4,16,4,4,3),this.UVMap(f,3,8,20,4,-4,1),this.UVMap(f,4,12,20,-4,12),this.UVMap(f,5,4,20,-4,12);for(var g=new d.CubeGeometry(4,12,4),e=0;8>e;e+=1)g.vertices[e].y-=6;var h=this.rightLeg=new d.Mesh(g,this.charMaterial);h.position.z=2,h.position.y=-6,this.UVMap(h,0,4,20,4,12),this.UVMap(h,1,12,20,4,12),this.UVMap(h,2,8,16,-4,4,3),this.UVMap(h,3,12,20,-4,-4,1),this.UVMap(h,4,0,20,4,12),this.UVMap(h,5,8,20,4,12);var i=new d.CubeGeometry(4,12,8),j=this.body=new d.Mesh(i,this.charMaterial);this.UVMap(j,0,20,20,8,12),this.UVMap(j,1,32,20,8,12),this.UVMap(j,2,20,16,8,4,1),this.UVMap(j,3,28,16,8,4,3),this.UVMap(j,4,16,20,4,12),this.UVMap(j,5,28,20,4,12),b.add(j);for(var k=new d.CubeGeometry(4,12,4),e=0;8>e;e+=1)k.vertices[e].y-=4;var l=this.leftArm=new d.Mesh(k,this.charMaterial);l.position.z=-6,l.position.y=4,l.rotation.x=Math.PI/32,this.UVMap(l,0,48,20,-4,12),this.UVMap(l,1,56,20,-4,12),this.UVMap(l,2,48,16,-4,4,1),this.UVMap(l,3,52,16,-4,4,3),this.UVMap(l,4,52,20,-4,12),this.UVMap(l,5,44,20,-4,12),b.add(l);for(var m=new d.CubeGeometry(4,12,4),e=0;8>e;e+=1)m.vertices[e].y-=4;var n=this.rightArm=new d.Mesh(m,this.charMaterial);n.position.z=6,n.position.y=4,n.rotation.x=-Math.PI/32,this.UVMap(n,0,44,20,4,12),this.UVMap(n,1,52,20,4,12),this.UVMap(n,2,44,16,4,4,1),this.UVMap(n,3,48,16,4,4,3),this.UVMap(n,4,40,20,4,12),this.UVMap(n,5,48,20,4,12),b.add(n);var o=new d.CubeGeometry(8,8,8),p=this.head=new d.Mesh(o,this.charMaterial);p.position.y=2,this.UVMap(p,0,8,8,8,8),this.UVMap(p,1,24,8,8,8),this.UVMap(p,2,8,0,8,8,1),this.UVMap(p,3,16,0,8,8,3),this.UVMap(p,4,0,8,8,8),this.UVMap(p,5,16,8,8,8);var q=new d.Object3D;q.rotation.y=Math.PI/2,q.add(p),a.add(q);var r=this.cubeFromPlanes(9,this.charMaterialTrans);r.position.y=2,this.UVMap(r.children[0],0,40,8,8,8),this.UVMap(r.children[1],0,56,8,8,8),this.UVMap(r.children[2],0,40,0,8,8,1),this.UVMap(r.children[3],0,48,0,8,8,3),this.UVMap(r.children[4],0,32,8,8,8),this.UVMap(r.children[5],0,48,8,8,8),a.add(r);var s=new d.Object3D,t=new d.CubeGeometry(1,6.75,6.75),u=new d.Mesh(t,this.charMaterial),v=new d.Mesh(t,this.charMaterial);u.position.y=7.625,v.position.y=7.625,u.position.z=-5.625,v.position.z=5.625,this.UVMap(u,0,25,1,6,6),this.UVMap(u,1,32,1,6,6),this.UVMap(u,2,25,0,6,1,1),this.UVMap(u,3,31,0,6,1,1),this.UVMap(u,4,24,1,1,6),this.UVMap(u,5,31,1,1,6),s.add(u),s.add(v),u.visible=v.visible=!1,a.add(s),a.position.y=8;var w=this.playerModel=new d.Object3D;w.add(f),w.add(h),w.add(b);var x=new d.Object3D;x.rotation.y=Math.PI/2,x.position.y=12,x.add(w);var y=new d.Object3D;y.rotation.y=-Math.PI/2,y.add(a),w.add(y),w.position.y=6;var z=new d.Object3D;return z.cameraInside=new d.Object3D,z.cameraOutside=new d.Object3D,z.cameraInside.position.x=0,z.cameraInside.position.y=2,z.cameraInside.position.z=0,z.head=a,a.add(z.cameraInside),z.cameraInside.add(z.cameraOutside),z.cameraOutside.position.z=100,z.add(x),z.scale=this.scale,z}},{}],163:[function(a,b){var c="/node_modules/painterly-textures",d=a("path"),e=c+"/textures";b.exports=function(a){return d.relative(a,e)+"/"}},{path:44}],164:[function(){!function(a){function b(){this._pieces=[],this._parts=[]}function c(a){this.index=0,this.dataBuffer=a,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function d(){this.bufferBuilder=new b}function e(a){var b=a.charCodeAt(0);return 2047>=b?"00":65535>=b?"000":2097151>=b?"0000":67108863>=b?"00000":"000000"}function f(a){return a.length>600?new Blob([a]).size:a.replace(/[^\u0000-\u007F]/g,e).length}function g(){this._events={}}function h(a,b){return this instanceof h?(this._dc=a,q.debug=b,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],this._setupDC(),void 0):new h(a)}function i(a,b){if(!(this instanceof i))return new i(a,b);if(g.call(this),a&&a.constructor==Object?(b=a,a=void 0):a&&(a=a.toString()),b=q.extend({debug:0,host:q.CLOUD_HOST,port:q.CLOUD_PORT,key:"peerjs",config:q.defaultConfig},b),this.options=b,"/"===b.host&&(b.host=window.location.hostname),void 0===b.secure&&b.host!==q.CLOUD_HOST&&(b.secure=q.isSecure()),b.logFunction&&q.setLogFunction(b.logFunction),q.setLogLevel(b.debug),!q.supports.audioVideo&&!q.supports.data)return this._delayedAbort("browser-incompatible","The current browser does not support WebRTC"),void 0;if(!q.validateId(a))return this._delayedAbort("invalid-id",'ID "'+a+'" is invalid'),void 0;if(!q.validateKey(b.key))return this._delayedAbort("invalid-key",'API KEY "'+b.key+'" is invalid'),void 0;if(b.secure&&"0.peerjs.com"===b.host)return this._delayedAbort("ssl-unavailable","The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS."),void 0;this.destroyed=!1,this.disconnected=!1,this.open=!1,this.connections={},this._lostMessages={};var c=this;this.socket=new l(this.options.secure,this.options.host,this.options.port,this.options.key),this.socket.on("message",function(a){c._handleMessage(a)}),this.socket.on("error",function(a){c._abort("socket-error",a)}),this.socket.on("close",function(){c.disconnected||c._abort("socket-closed","Underlying socket is already closed.")}),a?this._initialize(a):this._retrieveId()}function j(a,b,c){return this instanceof j?(g.call(this),this.options=q.extend({serialization:"binary",reliable:!1},c),this.open=!1,this.type="data",this.peer=a,this.provider=b,this.id=this.options.connectionId||j._idPrefix+q.randomToken(),this.label=this.options.label||this.id,this.metadata=this.options.metadata,this.serialization=this.options.serialization,this.reliable=this.options.reliable,this._buffer=[],this._buffering=!1,this.bufferSize=0,this._chunkedData={},this.options._payload&&(this._peerBrowser=this.options._payload.browser),r.startConnection(this,this.options._payload||{originator:!0}),void 0):new j(a,b,c)}function k(a,b,c){return this instanceof k?(g.call(this),this.options=q.extend({},c),this.open=!1,this.type="media",this.peer=a,this.provider=b,this.metadata=this.options.metadata,this.localStream=this.options._stream,this.id=this.options.connectionId||k._idPrefix+q.randomToken(),this.localStream&&r.startConnection(this,{_stream:this.localStream,originator:!0}),void 0):new k(a,b,c)}function l(a,b,c,d){if(!(this instanceof l))return new l(a,b,c,d);g.call(this),this.disconnected=!1,this._queue=[];var e=a?"https://":"http://",f=a?"wss://":"ws://";this._httpUrl=e+b+":"+c+"/"+d,this._wsUrl=f+b+":"+c+"/peerjs?key="+d}var m={};m.useBlobBuilder=function(){try{return new Blob([]),!1}catch(a){return!0}}(),m.useArrayBufferView=!m.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(a){return!0}}(),a.binaryFeatures=m,a.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder,b.prototype.append=function(a){"number"==typeof a?this._pieces.push(a):(this.flush(),this._parts.push(a))},b.prototype.flush=function(){if(this._pieces.length>0){var a=new Uint8Array(this._pieces);m.useArrayBufferView||(a=a.buffer),this._parts.push(a),this._pieces=[]}},b.prototype.getBuffer=function(){if(this.flush(),m.useBlobBuilder){for(var a=new BlobBuilder,b=0,c=this._parts.length;c>b;b++)a.append(this._parts[b]);return a.getBlob()}return new Blob(this._parts)},a.BinaryPack={unpack:function(a){var b=new c(a);return b.unpack()},pack:function(a){var b=new d;b.pack(a);var c=b.getBuffer();return c}},c.prototype.unpack=function(){var a=this.unpack_uint8();if(128>a){var b=a;return b}if(32>(224^a)){var c=(224^a)-32;return c}var d;if((d=160^a)<=15)return this.unpack_raw(d);if((d=176^a)<=15)return this.unpack_string(d);if((d=144^a)<=15)return this.unpack_array(d);if((d=128^a)<=15)return this.unpack_map(d);switch(a){case 192:return null;case 193:return void 0;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return void 0;case 213:return void 0;case 214:return void 0;case 215:return void 0;case 216:return d=this.unpack_uint16(),this.unpack_string(d);case 217:return d=this.unpack_uint32(),this.unpack_string(d);case 218:return d=this.unpack_uint16(),this.unpack_raw(d);case 219:return d=this.unpack_uint32(),this.unpack_raw(d);case 220:return d=this.unpack_uint16(),this.unpack_array(d);case 221:return d=this.unpack_uint32(),this.unpack_array(d);case 222:return d=this.unpack_uint16(),this.unpack_map(d);case 223:return d=this.unpack_uint32(),this.unpack_map(d)}},c.prototype.unpack_uint8=function(){var a=255&this.dataView[this.index];return this.index++,a},c.prototype.unpack_uint16=function(){var a=this.read(2),b=256*(255&a[0])+(255&a[1]);return this.index+=2,b},c.prototype.unpack_uint32=function(){var a=this.read(4),b=256*(256*(256*a[0]+a[1])+a[2])+a[3];return this.index+=4,b},c.prototype.unpack_uint64=function(){var a=this.read(8),b=256*(256*(256*(256*(256*(256*(256*a[0]+a[1])+a[2])+a[3])+a[4])+a[5])+a[6])+a[7];return this.index+=8,b},c.prototype.unpack_int8=function(){var a=this.unpack_uint8();return 128>a?a:a-256},c.prototype.unpack_int16=function(){var a=this.unpack_uint16();return 32768>a?a:a-65536},c.prototype.unpack_int32=function(){var a=this.unpack_uint32();return a<Math.pow(2,31)?a:a-Math.pow(2,32)},c.prototype.unpack_int64=function(){var a=this.unpack_uint64();return a<Math.pow(2,63)?a:a-Math.pow(2,64)},c.prototype.unpack_raw=function(a){if(this.length<this.index+a)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+a+" "+this.length);var b=this.dataBuffer.slice(this.index,this.index+a);return this.index+=a,b},c.prototype.unpack_string=function(a){for(var b,c,d=this.read(a),e=0,f="";a>e;)b=d[e],128>b?(f+=String.fromCharCode(b),e++):32>(192^b)?(c=(192^b)<<6|63&d[e+1],f+=String.fromCharCode(c),e+=2):(c=(15&b)<<12|(63&d[e+1])<<6|63&d[e+2],f+=String.fromCharCode(c),e+=3);return this.index+=a,f},c.prototype.unpack_array=function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=this.unpack();return b},c.prototype.unpack_map=function(a){for(var b={},c=0;a>c;c++){var d=this.unpack(),e=this.unpack();b[d]=e}return b},c.prototype.unpack_float=function(){var a=this.unpack_uint32(),b=a>>31,c=(a>>23&255)-127,d=8388607&a|8388608;return(0==b?1:-1)*d*Math.pow(2,c-23)},c.prototype.unpack_double=function(){var a=this.unpack_uint32(),b=this.unpack_uint32(),c=a>>31,d=(a>>20&2047)-1023,e=1048575&a|1048576,f=e*Math.pow(2,d-20)+b*Math.pow(2,d-52);return(0==c?1:-1)*f},c.prototype.read=function(a){var b=this.index;if(b+a<=this.length)return this.dataView.subarray(b,b+a);throw new Error("BinaryPackFailure: read index out of range")},d.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},d.prototype.pack=function(a){var b=typeof a;if("string"==b)this.pack_string(a);else if("number"==b)Math.floor(a)===a?this.pack_integer(a):this.pack_double(a);else if("boolean"==b)a===!0?this.bufferBuilder.append(195):a===!1&&this.bufferBuilder.append(194);else if("undefined"==b)this.bufferBuilder.append(192);else{if("object"!=b)throw new Error('Type "'+b+'" not yet supported');if(null===a)this.bufferBuilder.append(192);else{var c=a.constructor;if(c==Array)this.pack_array(a);else if(c==Blob||c==File)this.pack_bin(a);else if(c==ArrayBuffer)m.useArrayBufferView?this.pack_bin(new Uint8Array(a)):this.pack_bin(a);else if("BYTES_PER_ELEMENT"in a)m.useArrayBufferView?this.pack_bin(new Uint8Array(a.buffer)):this.pack_bin(a.buffer);else if(c==Object)this.pack_object(a);else if(c==Date)this.pack_string(a.toString());else{if("function"!=typeof a.toBinaryPack)throw new Error('Type "'+c.toString()+'" not yet supported');this.bufferBuilder.append(a.toBinaryPack())}}}this.bufferBuilder.flush()},d.prototype.pack_bin=function(a){var b=a.length||a.byteLength||a.size;if(15>=b)this.pack_uint8(160+b);else if(65535>=b)this.bufferBuilder.append(218),this.pack_uint16(b);else{if(!(4294967295>=b))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(b)}this.bufferBuilder.append(a)},d.prototype.pack_string=function(a){var b=f(a);if(15>=b)this.pack_uint8(176+b);else if(65535>=b)this.bufferBuilder.append(216),this.pack_uint16(b);else{if(!(4294967295>=b))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(b)}this.bufferBuilder.append(a)},d.prototype.pack_array=function(a){var b=a.length;if(15>=b)this.pack_uint8(144+b);else if(65535>=b)this.bufferBuilder.append(220),this.pack_uint16(b);else{if(!(4294967295>=b))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(b)}for(var c=0;b>c;c++)this.pack(a[c])},d.prototype.pack_integer=function(a){if(a>=-32&&127>=a)this.bufferBuilder.append(255&a);else if(a>=0&&255>=a)this.bufferBuilder.append(204),this.pack_uint8(a);else if(a>=-128&&127>=a)this.bufferBuilder.append(208),this.pack_int8(a);else if(a>=0&&65535>=a)this.bufferBuilder.append(205),this.pack_uint16(a);else if(a>=-32768&&32767>=a)this.bufferBuilder.append(209),this.pack_int16(a);else if(a>=0&&4294967295>=a)this.bufferBuilder.append(206),this.pack_uint32(a);else if(a>=-2147483648&&2147483647>=a)this.bufferBuilder.append(210),this.pack_int32(a);else if(a>=-0x8000000000000000&&0x8000000000000000>=a)this.bufferBuilder.append(211),this.pack_int64(a);else{if(!(a>=0&&0x10000000000000000>=a))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(a)}},d.prototype.pack_double=function(a){var b=0;0>a&&(b=1,a=-a);var c=Math.floor(Math.log(a)/Math.LN2),d=a/Math.pow(2,c)-1,e=Math.floor(d*Math.pow(2,52)),f=Math.pow(2,32),g=b<<31|c+1023<<20|e/f&1048575,h=e%f;this.bufferBuilder.append(203),this.pack_int32(g),this.pack_int32(h)},d.prototype.pack_object=function(a){var b=Object.keys(a),c=b.length;if(15>=c)this.pack_uint8(128+c);else if(65535>=c)this.bufferBuilder.append(222),this.pack_uint16(c);else{if(!(4294967295>=c))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(c)}for(var d in a)a.hasOwnProperty(d)&&(this.pack(d),this.pack(a[d]))},d.prototype.pack_uint8=function(a){this.bufferBuilder.append(a)},d.prototype.pack_uint16=function(a){this.bufferBuilder.append(a>>8),this.bufferBuilder.append(255&a)},d.prototype.pack_uint32=function(a){var b=4294967295&a;this.bufferBuilder.append((4278190080&b)>>>24),this.bufferBuilder.append((16711680&b)>>>16),this.bufferBuilder.append((65280&b)>>>8),this.bufferBuilder.append(255&b)},d.prototype.pack_uint64=function(a){var b=a/Math.pow(2,32),c=a%Math.pow(2,32);this.bufferBuilder.append((4278190080&b)>>>24),this.bufferBuilder.append((16711680&b)>>>16),this.bufferBuilder.append((65280&b)>>>8),this.bufferBuilder.append(255&b),this.bufferBuilder.append((4278190080&c)>>>24),this.bufferBuilder.append((16711680&c)>>>16),this.bufferBuilder.append((65280&c)>>>8),this.bufferBuilder.append(255&c)},d.prototype.pack_int8=function(a){this.bufferBuilder.append(255&a)},d.prototype.pack_int16=function(a){this.bufferBuilder.append((65280&a)>>8),this.bufferBuilder.append(255&a)},d.prototype.pack_int32=function(a){this.bufferBuilder.append(a>>>24&255),this.bufferBuilder.append((16711680&a)>>>16),this.bufferBuilder.append((65280&a)>>>8),this.bufferBuilder.append(255&a)},d.prototype.pack_int64=function(a){var b=Math.floor(a/Math.pow(2,32)),c=a%Math.pow(2,32);this.bufferBuilder.append((4278190080&b)>>>24),this.bufferBuilder.append((16711680&b)>>>16),this.bufferBuilder.append((65280&b)>>>8),this.bufferBuilder.append(255&b),this.bufferBuilder.append((4278190080&c)>>>24),this.bufferBuilder.append((16711680&c)>>>16),this.bufferBuilder.append((65280&c)>>>8),this.bufferBuilder.append(255&c)};var n=Array.isArray;g.prototype.addListener=function(a,b){if("function"!=typeof b)throw new Error("addListener only takes instances of Function");return this.emit("newListener",a,"function"==typeof b.listener?b.listener:b),this._events[a]?n(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,this},g.prototype.on=g.prototype.addListener,g.prototype.once=function(a,b){function c(){d.removeListener(a,c),b.apply(this,arguments)}if("function"!=typeof b)throw new Error(".once only takes instances of Function");var d=this;return c.listener=b,d.on(a,c),this},g.prototype.removeListener=function(a,b){if("function"!=typeof b)throw new Error("removeListener only takes instances of Function");if(!this._events[a])return this;var c=this._events[a];if(n(c)){for(var d=-1,e=0,f=c.length;f>e;e++)if(c[e]===b||c[e].listener&&c[e].listener===b){d=e;break}if(0>d)return this;c.splice(d,1),0==c.length&&delete this._events[a]}else(c===b||c.listener&&c.listener===b)&&delete this._events[a];return this},g.prototype.off=g.prototype.removeListener,g.prototype.removeAllListeners=function(a){return 0===arguments.length?(this._events={},this):(a&&this._events&&this._events[a]&&(this._events[a]=null),this)},g.prototype.listeners=function(a){return this._events[a]||(this._events[a]=[]),n(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},g.prototype.emit=function(a){var a=arguments[0],b=this._events[a];if(!b)return!1;if("function"==typeof b){switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:for(var c=arguments.length,d=new Array(c-1),e=1;c>e;e++)d[e-1]=arguments[e];b.apply(this,d)}return!0}if(n(b)){for(var c=arguments.length,d=new Array(c-1),e=1;c>e;e++)d[e-1]=arguments[e];for(var f=b.slice(),e=0,c=f.length;c>e;e++)f[e].apply(this,d);return!0}return!1},h.prototype.send=function(a){var b=q.pack(a);return b.size<this._mtu?(this._handleSend(["no",b]),void 0):(this._outgoing[this._count]={ack:0,chunks:this._chunk(b)},q.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),this._count+=1,void 0)},h.prototype._setupInterval=function(){var a=this;this._timeout=setInterval(function(){var b=a._queue.shift();if(b._multiple)for(var c=0,d=b.length;d>c;c+=1)a._intervalSend(b[c]);else a._intervalSend(b)},this._interval)},h.prototype._intervalSend=function(a){var b=this;a=q.pack(a),q.blobToBinaryString(a,function(a){b._dc.send(a)}),0===b._queue.length&&(clearTimeout(b._timeout),b._timeout=null)},h.prototype._processAcks=function(){for(var a in this._outgoing)this._outgoing.hasOwnProperty(a)&&this._sendWindowedChunks(a)},h.prototype._handleSend=function(a){for(var b=!0,c=0,d=this._queue.length;d>c;c+=1){var e=this._queue[c];e===a?b=!1:e._multiple&&-1!==e.indexOf(a)&&(b=!1)}b&&(this._queue.push(a),this._timeout||this._setupInterval())},h.prototype._setupDC=function(){var a=this;this._dc.onmessage=function(b){var c=b.data,d=c.constructor;if(d===String){var e=q.binaryStringToArrayBuffer(c);c=q.unpack(e),a._handleMessage(c)}}},h.prototype._handleMessage=function(a){var b,c=a[1],d=this._incoming[c],e=this._outgoing[c];switch(a[0]){case"no":var f=c;f&&this.onmessage(q.unpack(f));break;case"end":if(b=d,this._received[c]=a[2],!b)break;this._ack(c);break;case"ack":if(b=e){var g=a[2];b.ack=Math.max(g,b.ack),b.ack>=b.chunks.length?(q.log("Time: ",new Date-b.timer),delete this._outgoing[c]):this._processAcks()}break;case"chunk":if(b=d,!b){var h=this._received[c];if(h===!0)break;b={ack:["ack",c,0],chunks:[]},this._incoming[c]=b}var i=a[2],j=a[3];b.chunks[i]=new Uint8Array(j),i===b.ack[2]&&this._calculateNextAck(c),this._ack(c);break;default:this._handleSend(a)}},h.prototype._chunk=function(a){for(var b=[],c=a.size,d=0;c>d;){var e=Math.min(c,d+this._mtu),f=a.slice(d,e),g={payload:f};b.push(g),d=e}return q.log("Created",b.length,"chunks."),b},h.prototype._ack=function(a){var b=this._incoming[a].ack;this._received[a]===b[2]&&(this._complete(a),this._received[a]=!0),this._handleSend(b)},h.prototype._calculateNextAck=function(a){for(var b=this._incoming[a],c=b.chunks,d=0,e=c.length;e>d;d+=1)if(void 0===c[d])return b.ack[2]=d,void 0;b.ack[2]=c.length},h.prototype._sendWindowedChunks=function(a){q.log("sendWindowedChunks for: ",a);for(var b=this._outgoing[a],c=b.chunks,d=[],e=Math.min(b.ack+this._window,c.length),f=b.ack;e>f;f+=1)c[f].sent&&f!==b.ack||(c[f].sent=!0,d.push(["chunk",a,f,c[f].payload]));b.ack+this._window>=c.length&&d.push(["end",a,c.length]),d._multiple=!0,this._handleSend(d)},h.prototype._complete=function(a){q.log("Completed called for",a);var b=this,c=this._incoming[a].chunks,d=new Blob(c);q.blobToArrayBuffer(d,function(a){b.onmessage(q.unpack(a))}),delete this._incoming[a]},h.higherBandwidthSDP=function(a){var b=navigator.appVersion.match(/Chrome\/(.*?) /);if(b&&(b=parseInt(b[1].split(".").shift()),31>b)){var c=a.split("b=AS:30"),d="b=AS:102400";if(c.length>1)return c[0]+d+c[1]}return a},h.prototype.onmessage=function(){},a.Reliable=h,a.RTCSessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription,a.RTCPeerConnection=window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.RTCPeerConnection,a.RTCIceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate;var o={iceServers:[{url:"stun:stun.l.google.com:19302"}]},p=1,q={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:9e3,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(a){var b=parseInt(a,10);q.logLevel=isNaN(parseInt(a,10))?a?3:0:b,q.log=q.warn=q.error=q.noop,q.logLevel>0&&(q.error=q._printWith("ERROR")),q.logLevel>1&&(q.warn=q._printWith("WARNING")),q.logLevel>2&&(q.log=q._print)},setLogFunction:function(a){a.constructor!==Function?q.warn("The log function you passed in is not a function. Defaulting to regular logs."):q._print=a},_printWith:function(a){return function(){var b=Array.prototype.slice.call(arguments);b.unshift(a),q._print.apply(q,b)}},_print:function(){var a=!1,b=Array.prototype.slice.call(arguments);b.unshift("PeerJS: ");for(var c=0,d=b.length;d>c;c++)b[c]instanceof Error&&(b[c]="("+b[c].name+") "+b[c].message,a=!0);a?console.error.apply(console,b):console.log.apply(console,b)},defaultConfig:o,browser:function(){return window.mozRTCPeerConnection?"Firefox":window.webkitRTCPeerConnection?"Chrome":window.RTCPeerConnection?"Supported":"Unsupported"}(),supports:function(){if("undefined"==typeof a.RTCPeerConnection)return{};var b,c,d=!0,e=!0,f=!1,g=!1,h=!!window.webkitRTCPeerConnection;try{b=new a.RTCPeerConnection(o,{optional:[{RtpDataChannels:!0}]})}catch(i){d=!1,e=!1}if(d)try{c=b.createDataChannel("_PEERJSTEST")}catch(i){d=!1}if(d){try{c.binaryType="blob",f=!0}catch(i){}var j=new a.RTCPeerConnection(o,{});try{var k=j.createDataChannel("_PEERJSRELIABLETEST",{});g=k.reliable}catch(i){}j.close()}if(e&&(e=!!b.addStream),!h&&d){var l=new a.RTCPeerConnection(o,{optional:[{RtpDataChannels:!0}]});l.onnegotiationneeded=function(){h=!0,q&&q.supports&&(q.supports.onnegotiationneeded=!0)};{l.createDataChannel("_PEERJSNEGOTIATIONTEST")}setTimeout(function(){l.close()},1e3)}return b&&b.close(),{audioVideo:e,data:d,binaryBlob:f,binary:g,reliable:g,sctp:g,onnegotiationneeded:h}}(),validateId:function(a){return!a||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(a)},validateKey:function(a){return!a||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(a)},debug:!1,inherits:function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})},extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},pack:a.BinaryPack.pack,unpack:a.BinaryPack.unpack,log:function(){if(q.debug){var a=!1,b=Array.prototype.slice.call(arguments);b.unshift("PeerJS: ");for(var c=0,d=b.length;d>c;c++)b[c]instanceof Error&&(b[c]="("+b[c].name+") "+b[c].message,a=!0);a?console.error.apply(console,b):console.log.apply(console,b)}},setZeroTimeout:function(a){function b(b){d.push(b),a.postMessage(e,"*")}function c(b){b.source==a&&b.data==e&&(b.stopPropagation&&b.stopPropagation(),d.length&&d.shift()())}var d=[],e="zero-timeout-message";return a.addEventListener?a.addEventListener("message",c,!0):a.attachEvent&&a.attachEvent("onmessage",c),b}(this),chunk:function(a){for(var b=[],c=a.size,d=index=0,e=Math.ceil(c/q.chunkedMTU);c>d;){var f=Math.min(c,d+q.chunkedMTU),g=a.slice(d,f),h={__peerData:p,n:index,data:g,total:e};b.push(h),d=f,index+=1}return p+=1,b},blobToArrayBuffer:function(a,b){var c=new FileReader;c.onload=function(a){b(a.target.result)},c.readAsArrayBuffer(a)},blobToBinaryString:function(a,b){var c=new FileReader;c.onload=function(a){b(a.target.result)},c.readAsBinaryString(a)},binaryStringToArrayBuffer:function(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=255&a.charCodeAt(c);return b.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return"https:"===location.protocol}};a.util=q,q.inherits(i,g),i.prototype._retrieveId=function(){var a=this,b=new XMLHttpRequest,c=this.options.secure?"https://":"http://",d=c+this.options.host+":"+this.options.port+"/"+this.options.key+"/id",e="?ts="+(new Date).getTime()+Math.random();d+=e,b.open("get",d,!0),b.onerror=function(b){q.error("Error retrieving ID",b),a._abort("server-error","Could not get an ID from the server")
},b.onreadystatechange=function(){return 4===b.readyState?200!==b.status?(b.onerror(),void 0):(a._initialize(b.responseText),void 0):void 0},b.send(null)},i.prototype._initialize=function(a){this.id=a,this.socket.start(this.id)},i.prototype._handleMessage=function(a){var b=a.type,c=a.payload,d=a.src;switch(b){case"OPEN":this.emit("open",this.id),this.open=!0;break;case"ERROR":this._abort("server-error",c.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":q.log("Received leave message from",d),this._cleanupPeer(d);break;case"EXPIRE":this.emit("error",new Error("Could not connect to peer "+d));break;case"OFFER":var e=c.connectionId,f=this.getConnection(d,e);if(f)q.warn("Offer received for existing Connection ID:",e);else{if("media"===c.type){var f=new k(d,this,{connectionId:e,_payload:c,metadata:c.metadata});this._addConnection(d,f),this.emit("call",f)}else{if("data"!==c.type)return q.warn("Received malformed connection type:",c.type),void 0;f=new j(d,this,{connectionId:e,_payload:c,metadata:c.metadata,label:c.label,serialization:c.serialization,reliable:c.reliable}),this._addConnection(d,f),this.emit("connection",f)}for(var g=this._getMessages(e),h=0,i=g.length;i>h;h+=1)f.handleMessage(g[h])}break;default:if(!c)return q.warn("You received a malformed message from "+d+" of type "+b),void 0;var l=c.connectionId,f=this.getConnection(d,l);f&&f.pc?f.handleMessage(a):l?this._storeMessage(l,a):q.warn("You received an unrecognized message:",a)}},i.prototype._storeMessage=function(a,b){this._lostMessages[a]||(this._lostMessages[a]=[]),this._lostMessages[a].push(b)},i.prototype._getMessages=function(a){var b=this._lostMessages[a];return b?(delete this._lostMessages[a],b):[]},i.prototype.connect=function(a,b){if(this.disconnected)return q.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emit("error",new Error("Cannot connect to new Peer after disconnecting from server.")),void 0;var c=new j(a,this,b);return this._addConnection(a,c),c},i.prototype.call=function(a,b,c){if(this.disconnected)return q.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emit("error",new Error("Cannot connect to new Peer after disconnecting from server.")),void 0;if(!b)return q.error("To call a peer, you must provide a stream from your browser's `getUserMedia`."),void 0;c=c||{},c._stream=b;var d=new k(a,this,c);return this._addConnection(a,d),d},i.prototype._addConnection=function(a,b){this.connections[a]||(this.connections[a]=[]),this.connections[a].push(b)},i.prototype.getConnection=function(a,b){var c=this.connections[a];if(!c)return null;for(var d=0,e=c.length;e>d;d++)if(c[d].id===b)return c[d];return null},i.prototype._delayedAbort=function(a,b){var c=this;q.setZeroTimeout(function(){c._abort(a,b)})},i.prototype._abort=function(a,b){q.error("Aborting. Error:",b);var c=new Error(b);c.type=a,this.destroy(),this.emit("error",c)},i.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this.destroyed=!0)},i.prototype._cleanup=function(){if(this.connections)for(var a=Object.keys(this.connections),b=0,c=a.length;c>b;b++)this._cleanupPeer(a[b]);this.emit("close")},i.prototype._cleanupPeer=function(a){for(var b=this.connections[a],c=0,d=b.length;d>c;c+=1)b[c].close()},i.prototype.disconnect=function(){var a=this;q.setZeroTimeout(function(){a.disconnected||(a.disconnected=!0,a.open=!1,a.socket&&a.socket.close(),a.id=null)})},a.Peer=i,q.inherits(j,g),j._idPrefix="dc_",j.prototype.initialize=function(a){this._dc=this.dataChannel=a,this._configureDataChannel()},j.prototype._configureDataChannel=function(){var a=this;q.supports.sctp&&(this._dc.binaryType="arraybuffer"),this._dc.onopen=function(){q.log("Data channel connection success"),a.open=!0,a.emit("open")},!q.supports.sctp&&this.reliable&&(this._reliable=new h(this._dc,q.debug)),this._reliable?this._reliable.onmessage=function(b){a.emit("data",b)}:this._dc.onmessage=function(b){a._handleDataMessage(b)},this._dc.onclose=function(){q.log("DataChannel closed for:",a.peer),a.close()}},j.prototype._handleDataMessage=function(a){var b=this,c=a.data,d=c.constructor;if("binary"===this.serialization||"binary-utf8"===this.serialization){if(d===Blob)return q.blobToArrayBuffer(c,function(a){c=q.unpack(a),b.emit("data",c)}),void 0;if(d===ArrayBuffer)c=q.unpack(c);else if(d===String){var e=q.binaryStringToArrayBuffer(c);c=q.unpack(e)}}else"json"===this.serialization&&(c=JSON.parse(c));if(c.__peerData){var f=c.__peerData,g=this._chunkedData[f]||{data:[],count:0,total:c.total};return g.data[c.n]=c.data,g.count+=1,g.total===g.count&&(c=new Blob(g.data),this._handleDataMessage({data:c}),delete this._chunkedData[f]),this._chunkedData[f]=g,void 0}this.emit("data",c)},j.prototype.close=function(){this.open&&(this.open=!1,r.cleanup(this),this.emit("close"))},j.prototype.send=function(a,b){if(!this.open)return this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages.")),void 0;if(this._reliable)return this._reliable.send(a),void 0;var c=this;if("json"===this.serialization)this._bufferedSend(JSON.stringify(a));else if("binary"===this.serialization||"binary-utf8"===this.serialization){var d=q.pack(a),e=q.chunkedBrowsers[this._peerBrowser]||q.chunkedBrowsers[q.browser];if(e&&!b&&d.size>q.chunkedMTU)return this._sendChunks(d),void 0;q.supports.sctp?q.supports.binaryBlob?this._bufferedSend(d):q.blobToArrayBuffer(d,function(a){c._bufferedSend(a)}):q.blobToBinaryString(d,function(a){c._bufferedSend(a)})}else this._bufferedSend(a)},j.prototype._bufferedSend=function(a){(this._buffering||!this._trySend(a))&&(this._buffer.push(a),this.bufferSize=this._buffer.length)},j.prototype._trySend=function(a){try{this._dc.send(a)}catch(b){this._buffering=!0;var c=this;return setTimeout(function(){c._buffering=!1,c._tryBuffer()},100),!1}return!0},j.prototype._tryBuffer=function(){if(0!==this._buffer.length){var a=this._buffer[0];this._trySend(a)&&(this._buffer.shift(),this.bufferSize=this._buffer.length,this._tryBuffer())}},j.prototype._sendChunks=function(a){for(var b=q.chunk(a),c=0,d=b.length;d>c;c+=1){var a=b[c];this.send(a,!0)}},j.prototype.handleMessage=function(a){var b=a.payload;switch(a.type){case"ANSWER":this._peerBrowser=b.browser,r.handleSDP(a.type,this,b.sdp);break;case"CANDIDATE":r.handleCandidate(this,b.candidate);break;default:q.warn("Unrecognized message type:",a.type,"from peer:",this.peer)}},q.inherits(k,g),k._idPrefix="mc_",k.prototype.addStream=function(a){q.log("Receiving stream",a),this.remoteStream=a,this.emit("stream",a)},k.prototype.handleMessage=function(a){var b=a.payload;switch(a.type){case"ANSWER":r.handleSDP(a.type,this,b.sdp),this.open=!0;break;case"CANDIDATE":r.handleCandidate(this,b.candidate);break;default:q.warn("Unrecognized message type:",a.type,"from peer:",this.peer)}},k.prototype.answer=function(a){if(this.localStream)return q.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?"),void 0;this.options._payload._stream=a,this.localStream=a,r.startConnection(this,this.options._payload);for(var b=this.provider._getMessages(this.id),c=0,d=b.length;d>c;c+=1)this.handleMessage(b[c]);this.open=!0},k.prototype.close=function(){this.open&&(this.open=!1,r.cleanup(this),this.emit("close"))};var r={pcs:{data:{},media:{}},queue:[]};r._idPrefix="pc_",r.startConnection=function(a,b){var c=r._getPeerConnection(a,b);if("media"===a.type&&b._stream&&c.addStream(b._stream),a.pc=c,b.originator){if("data"===a.type){var d={};q.supports.sctp||(d={reliable:b.reliable});var e=c.createDataChannel(a.label,d);a.initialize(e)}q.supports.onnegotiationneeded||r._makeOffer(a)}else r.handleSDP("OFFER",a,b.sdp)},r._getPeerConnection=function(a,b){r.pcs[a.type]||q.error(a.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."),r.pcs[a.type][a.peer]||(r.pcs[a.type][a.peer]={});{var c;r.pcs[a.type][a.peer]}return b.pc&&(c=r.pcs[a.type][a.peer][b.pc]),c&&"stable"===c.signalingState||(c=r._startPeerConnection(a)),c},r._startPeerConnection=function(b){q.log("Creating exports.RTCPeerConnection.");var c=r._idPrefix+q.randomToken(),d={};"data"!==b.type||q.supports.sctp?"media"===b.type&&(d={optional:[{DtlsSrtpKeyAgreement:!0}]}):d={optional:[{RtpDataChannels:!0}]};var e=new a.RTCPeerConnection(b.provider.options.config,d);return r.pcs[b.type][b.peer][c]=e,r._setupListeners(b,e,c),e},r._setupListeners=function(a,b){var c=a.peer,d=a.id,e=a.provider;q.log("Listening for ICE candidates."),b.onicecandidate=function(b){b.candidate&&(q.log("Received ICE candidates for:",a.peer),e.socket.send({type:"CANDIDATE",payload:{candidate:b.candidate,type:a.type,connectionId:a.id},dst:c}))},b.oniceconnectionstatechange=function(){switch(b.iceConnectionState){case"disconnected":case"failed":q.log("iceConnectionState is disconnected, closing connections to "+c),a.close();break;case"completed":b.onicecandidate=q.noop}},b.onicechange=b.oniceconnectionstatechange,q.log("Listening for `negotiationneeded`"),b.onnegotiationneeded=function(){q.log("`negotiationneeded` triggered"),"stable"==b.signalingState?r._makeOffer(a):q.log("onnegotiationneeded triggered when not stable. Is another connection being established?")},q.log("Listening for data channel"),b.ondatachannel=function(a){q.log("Received data channel");var b=a.channel,f=e.getConnection(c,d);f.initialize(b)},q.log("Listening for remote stream"),b.onaddstream=function(a){q.log("Received remote stream");var b=a.stream;e.getConnection(c,d).addStream(b)}},r.cleanup=function(a){q.log("Cleaning up PeerConnection to "+a.peer);var b=a.pc;!b||"closed"===b.readyState&&"closed"===b.signalingState||(b.close(),a.pc=null)},r._makeOffer=function(a){var b=a.pc;b.createOffer(function(c){q.log("Created offer."),!q.supports.sctp&&"data"===a.type&&a.reliable&&(c.sdp=h.higherBandwidthSDP(c.sdp)),b.setLocalDescription(c,function(){q.log("Set localDescription: offer","for:",a.peer),a.provider.socket.send({type:"OFFER",payload:{sdp:c,type:a.type,label:a.label,connectionId:a.id,reliable:a.reliable,serialization:a.serialization,metadata:a.metadata,browser:q.browser},dst:a.peer})},function(b){a.provider.emit("error",b),q.log("Failed to setLocalDescription, ",b)})},function(b){a.provider.emit("error",b),q.log("Failed to createOffer, ",b)},a.options.constraints)},r._makeAnswer=function(a){var b=a.pc;b.createAnswer(function(c){q.log("Created answer."),!q.supports.sctp&&"data"===a.type&&a.reliable&&(c.sdp=h.higherBandwidthSDP(c.sdp)),b.setLocalDescription(c,function(){q.log("Set localDescription: answer","for:",a.peer),a.provider.socket.send({type:"ANSWER",payload:{sdp:c,type:a.type,connectionId:a.id,browser:q.browser},dst:a.peer})},function(b){a.provider.emit("error",b),q.log("Failed to setLocalDescription, ",b)})},function(b){a.provider.emit("error",b),q.log("Failed to create answer, ",b)})},r.handleSDP=function(a,b,c){c=new RTCSessionDescription(c);var d=b.pc;q.log("Setting remote description",c),d.setRemoteDescription(c,function(){q.log("Set remoteDescription:",a,"for:",b.peer),"OFFER"===a&&r._makeAnswer(b)},function(a){b.provider.emit("error",a),q.log("Failed to setRemoteDescription, ",a)})},r.handleCandidate=function(a,b){var c=b.candidate,d=b.sdpMLineIndex;a.pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:d,candidate:c})),q.log("Added ICE candidate for:",a.peer)},q.inherits(l,g),l.prototype.start=function(a){this.id=a;var b=q.randomToken();this._httpUrl+="/"+a+"/"+b,this._wsUrl+="&id="+a+"&token="+b,this._startXhrStream(),this._startWebSocket()},l.prototype._startWebSocket=function(){var a=this;this._socket||(this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(b){var c;try{c=JSON.parse(b.data)}catch(d){return q.log("Invalid server message",b.data),void 0}a.emit("message",c)},this._socket.onopen=function(){a._timeout&&(clearTimeout(a._timeout),setTimeout(function(){a._http.abort(),a._http=null},5e3)),a._sendQueuedMessages(),q.log("Socket open")})},l.prototype._startXhrStream=function(a){try{var b=this;this._http=new XMLHttpRequest,this._http._index=1,this._http._streamIndex=a||0,this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,!0),this._http.onreadystatechange=function(){2==this.readyState&&this.old&&(this.old.abort(),delete this.old),this.readyState>2&&200==this.status&&this.responseText&&b._handleStream(this)},this._http.send(null),this._setHTTPTimeout()}catch(c){q.log("XMLHttpRequest not available; defaulting to WebSockets")}},l.prototype._handleStream=function(a){var b=a.responseText.split("\n");if(a._buffer)for(;a._buffer.length>0;){var c=a._buffer.shift(),d=b[c];try{d=JSON.parse(d)}catch(e){a._buffer.shift(c);break}this.emit("message",d)}var f=b[a._index];if(f)if(a._index+=1,a._index===b.length)a._buffer||(a._buffer=[]),a._buffer.push(a._index-1);else{try{f=JSON.parse(f)}catch(e){return q.log("Invalid server message",f),void 0}this.emit("message",f)}},l.prototype._setHTTPTimeout=function(){var a=this;this._timeout=setTimeout(function(){var b=a._http;a._wsOpen()?b.abort():(a._startXhrStream(b._streamIndex+1),a._http.old=b)},25e3)},l.prototype._wsOpen=function(){return this._socket&&1==this._socket.readyState},l.prototype._sendQueuedMessages=function(){for(var a=0,b=this._queue.length;b>a;a+=1)this.send(this._queue[a])},l.prototype.send=function(a){if(!this.disconnected){if(!this.id)return this._queue.push(a),void 0;if(!a.type)return this.emit("error","Invalid message"),void 0;var b=JSON.stringify(a);if(this._wsOpen())this._socket.send(b);else{var c=new XMLHttpRequest,d=this._httpUrl+"/"+a.type.toLowerCase();c.open("post",d,!0),c.setRequestHeader("Content-Type","application/json"),c.send(b)}}},l.prototype.close=function(){!this.disconnected&&this._wsOpen()&&(this._socket.close(),this.disconnected=!0)}}(this)},{}],165:[function(a,b){function c(a,b){return this instanceof c?(d.Stream.call(this),this.options=b||{},this.readable=!0,this.writable=!0,this._buffer=[],this.rtc=a,this.rtc.addEventListener("message",this.onMessage.bind(this)),this.rtc.onerror=this.onError.bind(this),this.rtc.onclose=this.onClose.bind(this),this.rtc.onopen=this.onOpen.bind(this),"open"===this.rtc.readyState&&(this._open=!0),void 0):new c(a,b)}var d=a("stream"),e=a("util");e.inherits(c,d.Stream),b.exports=c,b.exports.RtcDataStream=c,c.prototype.onMessage=function(a,b){var c=a;c.data&&(c=c.data);var d=this.options.type;d&&c instanceof ArrayBuffer&&(c=new d(c)),this.emit("data",c,b)},c.prototype.onError=function(a){this.emit("error",a)},c.prototype.onClose=function(){this._destroy||(this.emit("end"),this.emit("close"))},c.prototype.onOpen=function(){if(!this._destroy){this._open=!0;for(var a=0;a<this._buffer.length;a++)this._write(this._buffer[a]);this._buffer=void 0,this.emit("open"),this.emit("connect"),this._end&&this.rtc.close()}},c.prototype.write=function(a){this._open?this._write(a):this._buffer.push(a)},c.prototype._write=function(a){this.rtc.send(a)},c.prototype.end=function(a){void 0!==a&&this.write(a),this._open&&this.rtc.close(),this._end=!0},c.prototype.destroy=function(){this._destroy=!0,this.rtc.close()}},{stream:50,util:59}],166:[function(a,b){function c(a,b,c){function g(){k=!0}function h(){if(k!==j){var a=f.call(arguments);a.unshift(k?"enter":"exit"),i.emit.apply(i,a)}j=k,k=!1}d=d||new b.constructor([-1/0,-1/0,-1/0],[1/0,1/0,1/0]);var i=new e,j=!1,k=!1;return c=c||"position",a.on(c,d,h).on(c,b,g),i}b.exports=c;var d,e=a("events").EventEmitter,f=[].slice},{events:33}],167:[function(a,b){function c(a){if(!(this instanceof c))return new c(a);a||(a={}),a instanceof HTMLElement&&(a={el:a}),this.opts=a,this.el=a.el||"nav","object"!=typeof this.el&&(this.el=document.querySelector(this.el)),0===this.el.getElementsByClassName("tab-inner").length&&this.createTabInner(),this.toolbarKeys=a.toolbarKeys||["1","2","3","4","5","6","7","8","9","0"],this.bindEvents()}var d=a("./lib/keymaster.js"),e=a("inherits"),f=a("events"),g=a("element-class"),h=a("./lib/keytable.js");b.exports=function(a){return new c(a)},e(c,f.EventEmitter),c.prototype.onKeyDown=function(){var a=this;d.getPressedKeyCodes().map(function(b){var c=h[b],d=a.toolbarKeys.indexOf(c);return d>-1?a.switchToolbar(d):void 0})},c.prototype.bindEvents=function(){var a=this;this.opts.noKeydown||window.addEventListener("keydown",this.onKeyDown.bind(this));var b=this.el.querySelectorAll("li");b=Array.prototype.slice.call(b),b.map(function(b){b.addEventListener("click",a.onItemClick.bind(a))})},c.prototype.onItemClick=function(a){a.preventDefault();var b=this.toolbarIndexOf(a.currentTarget);b>-1&&this.switchToolbar(b)},c.prototype.addClass=function(a,b){return a?g(a).add(b):void 0},c.prototype.removeClass=function(a,b){return a?g(a).remove(b):void 0},c.prototype.toolbarIndexOf=function(a){var b=this.el.querySelectorAll(".tab-item");b=Array.prototype.slice.call(b);var c=b.indexOf(a);return c},c.prototype.switchToolbar=function(a){this.removeClass(this.el.querySelector(".active"),"active");var b=this.el.querySelectorAll(".tab-item")[a];this.addClass(b,"active");var c=this.el.querySelector(".active .tab-label");if(c){var d=c.getAttribute("data-id");this.emit("select",d?d:c.innerText)}},c.prototype.emptyContent=function(){this.el.removeChild(this.el.getElementsByClassName("tab-inner")[0]),this.createTabInner()},c.prototype.createTabInner=function(){var a=document.createElement("ul");a.className="tab-inner",this.el.appendChild(a)},c.prototype.setContent=function(a){var b=this;return this.emptyContent(),a.map(function(a){return b.addContent(a)})},c.prototype.addContent=function(a){var b=this,c=document.createElement("li");if(c.className="tab-item",a.icon){var d=document.createElement("img");d.className="tab-icon",d.src=a.icon,c.appendChild(d)}var e=document.createElement("div");return e.className="tab-label",a.label&&(e.innerText=a.label),void 0!==a.id&&e.setAttribute("data-id",a.id),c.appendChild(e),this.el.getElementsByClassName("tab-inner")[0].appendChild(c),c.addEventListener("click",b.onItemClick.bind(b)),c}},{"./lib/keymaster.js":168,"./lib/keytable.js":169,"element-class":170,events:33,inherits:171}],168:[function(a,b){!function(a){function c(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function d(a,b){var d,e,f,h,i;if(d=a.keyCode,-1==c(v,d)&&v.push(d),(93==d||224==d)&&(d=91),d in r){r[d]=!0;for(f in t)t[f]==d&&(g[f]=!0)}else if(g.filter.call(this,a)&&d in q)for(h=0;h<q[d].length;h++)if(e=q[d][h],e.scope==b||"all"==e.scope){i=e.mods.length>0;for(f in r)(!r[f]&&c(e.mods,+f)>-1||r[f]&&-1==c(e.mods,+f))&&(i=!1);(0!=e.mods.length||r[16]||r[18]||r[17]||r[91])&&!i||e.method(a,e)===!1&&(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&(a.cancelBubble=!0))}}function e(a){var b,d=a.keyCode,e=c(v,d);if(e>=0&&v.splice(e,1),(93==d||224==d)&&(d=91),d in r){r[d]=!1;for(b in t)t[b]==d&&(g[b]=!1)}}function f(){for(p in r)r[p]=!1;for(p in t)g[p]=!1}function g(a,b,c){var d,e,f,g;for(void 0===c&&(c=b,b="all"),a=a.replace(/\s/g,""),d=a.split(","),""==d[d.length-1]&&(d[d.length-2]+=","),f=0;f<d.length;f++){if(e=[],a=d[f].split("+"),a.length>1){for(e=a.slice(0,a.length-1),g=0;g<e.length;g++)e[g]=t[e[g]];a=[a[a.length-1]]}a=a[0],a=u[a]||a.toUpperCase().charCodeAt(0),a in q||(q[a]=[]),q[a].push({shortcut:d[f],scope:b,method:c,key:d[f],mods:e})}}function h(a){if("string"==typeof a){if(1!=a.length)return!1;a=a.toUpperCase().charCodeAt(0)}return-1!=c(v,a)}function i(){return v.slice(0)}function j(a){var b=(a.target||a.srcElement).tagName;return!("INPUT"==b||"SELECT"==b||"TEXTAREA"==b)}function k(a){s=a||"all"}function l(){return s||"all"}function m(a){var b,c,d;for(b in q)for(c=q[b],d=0;d<c.length;)c[d].scope===a?c.splice(d,1):d++}function n(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})}function o(){var b=a.key;return a.key=w,b}var p,q={},r={16:!1,18:!1,17:!1,91:!1},s="all",t={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,command:91},u={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},v=[];for(p=1;20>p;p++)t["f"+p]=111+p;for(p in t)g[p]=!1;n(document,"keydown",function(a){d(a,s)}),n(document,"keyup",e),n(window,"focus",f);var w=a.key;a.key=g,a.key.setScope=k,a.key.getScope=l,a.key.deleteScope=m,a.key.filter=j,a.key.isPressed=h,a.key.getPressedKeyCodes=i,a.key.noConflict=o,"undefined"!=typeof b&&(b.exports=a.key)}(this)},{}],169:[function(a,b){b.exports={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pausebreak",20:"capslock",27:"esc",32:"spacebar",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",93:"select",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"multiply",107:"add",109:"subtract",110:"decimalpoint",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equalsign",188:"comma",189:"dash",190:"period",191:"forwardslash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebracket",222:"singlequote"}},{}],170:[function(a,b){function c(a){if(!(this instanceof c))return new c(a);a||(a={}),a instanceof HTMLElement&&(a={el:a}),this.opts=a,this.el=a.el||document.body,"object"!=typeof this.el&&(this.el=document.querySelector(this.el))}b.exports=function(a){return new c(a)},c.prototype.add=function(a){var b=this.el;if(b){if(""===b.className)return b.className=a;var c=b.className.split(" ");return c.indexOf(a)>-1?c:(c.push(a),b.className=c.join(" "),c)}},c.prototype.remove=function(a){var b=this.el;if(b&&""!==b.className){var c=b.className.split(" "),d=c.indexOf(a);return d>-1&&c.splice(d,1),b.className=c.join(" "),c}}},{}],171:[function(a,b){b.exports=a(66)},{}],172:[function(a,b){function c(a){return this instanceof c?(this.initialize(a),void 0):new c(a)}function d(a,b,c,d,e){return(a-b)*(e-d)/(c-b)+d}var e=a("events").EventEmitter,f=a("extend"),g=a("minecraft-skin"),h=a("voxel-crunch"),i=a("voxel-player"),j=a("voxel-engine"),k=a("./randomname.js");b.exports=c,c.prototype.initialize=function(a){var b=this;b.opts=a,b.playerID,b.game,b.texturePath=a.texturePath||"/textures/",b.playerTexture=a.playerTexture||"player.png",b.lerpPercent=.1,b.remoteClients={},b.connection=a.connection,f(b,new e),b.bindEvents(b.connection)},c.prototype.bindEvents=function(a){var b=this;a.on("id",function(a){b.playerID=a}),a.on("settings",function(c){c.isClient=!0,c.texturePath=b.texturePath,c.generateChunks=!1,c.controlsDisabled=!1,b.game=b.createGame(c),a.emit("created")}),a.on("chunk",function(a,c){if(void 0===a.length){var d=Math.max.apply(null,Object.keys(a).map(Number));a.length=d+1}var e=h.decode(a,c.length);c.voxels=e,b.game.showChunk(c)}),a.on("noMoreChunks",function(){var a=b.game;if(a.notCapable())try{throw"game not capable"}catch(c){b.emit("error",c)}var d=i(a),e=b.avatar=d(b.playerTexture);e.possess();var f=a.settings.avatarInitialPosition;e.position.set(f[0],f[1],f[2]),b.emit("loadComplete")}),a.on("set",function(a,c){b.game.setBlock(a,c)})},c.prototype.createGame=function(a){function b(){var a=e.game.controls.target(),b={position:a.yaw.position,rotation:{y:a.yaw.rotation.y,x:a.pitch.rotation.x}};f.emit("state",b)}function c(a){e.remoteClients[a]&&(e.game.scene.remove(e.remoteClients[a].mesh),delete e.remoteClients[a])}function d(a){Object.keys(a.positions).map(function(b){var c=a.positions[b];b===e.playerID?e.onServerUpdate(c):e.updatePlayerPosition(b,c)})}var e=this,f=e.connection;e.game=j(a),e.game.settings=a;var g=localStorage.getItem("name");return g||(g=k(),localStorage.setItem("name",g)),e.name=g,e.game.controls.on("data",function(a){var c=!1;Object.keys(a).map(function(b){a[b]>0&&(c=!0)}),c&&b()}),setTimeout(function(){f.on("update",d)},1e3),f.on("leave",c),e.game},c.prototype.onServerUpdate=function(){},c.prototype.lerpMe=function(a){var b=new this.game.THREE.Vector3;b.copy(a);var c=this.game.controls.target().yaw.position;c.copy(c.lerp(b,this.lerpPercent))},c.prototype.updatePlayerPosition=function(a,b){var c=this,e=b.position,f=c.remoteClients[a];if(!f){var h=g(c.game.THREE,c.playerTexture,{scale:new c.game.THREE.Vector3(.04,.04,.04)}),i=h.mesh;c.remoteClients[a]=h,i.children[0].position.y=10,c.game.scene.add(i)}var h=c.remoteClients[a],i=h.mesh;i.position.copy(i.position.lerp(e,c.lerpPercent)),i.children[0].rotation.y=b.rotation.y+Math.PI/2,h.head.rotation.z=d(b.rotation.x,-1.5,1.5,-.75,.75)}},{"./randomname.js":210,events:33,extend:173,"minecraft-skin":162,"voxel-crunch":174,"voxel-engine":175,"voxel-player":209}],173:[function(a,b){b.exports=a(65)},{}],174:[function(a,b,c){c.encode=function(a){for(var b=[],c=0;c<a.length;){for(var d=a[c],e=0;c<a.length&&a[c]===d;)++c,++e;for(;e>=128;)b.push(128+(127&e)),e>>>=7;b.push(e),b.push(d)}return new Uint8Array(b)},c.decode=function(a,b){b||(b=65536);for(var c=new Int8Array(b),d=0,e=0;e<a.length;){for(var f=0,g=0;e<a.length&&a[e]>=128;)f+=(127&a[e++])<<g,g+=7;if(f+=a[e++]<<g,e>=a.length||d+f>c.length)throw new Error("Chunk buffer overflow");for(var h=a[e++],i=0;f>i;++i)c[d++]=h}return c}},{}],175:[function(a,b){function c(a){if(!(this instanceof c))return new c(a);var b=this;if(a||(a={}),(!d.browser||!this.notCapable(a))&&(this.isClient=Boolean("undefined"!=typeof a.isClient?a.isClient:d.browser),"generateChunks"in a||(a.generateChunks=!0),this.generateChunks=a.generateChunks,this.setConfigurablePositions(a),this.configureChunkLoading(a),this.setDimensions(a),this.THREE=k,this.vector=u,this.glMatrix=t,this.arrayType=a.arrayType||Uint8Array,this.cubeSize=1,this.chunkSize=a.chunkSize||32,this.chunkDistance=a.chunkDistance||2,this.removeDistance=a.removeDistance||this.chunkDistance+1,this.playerHeight=a.playerHeight||1.62,this.meshType=a.meshType||"surfaceMesh",this.mesher=a.mesher||e.meshers.culled,this.materialType=a.materialType||k.MeshLambertMaterial,this.materialParams=a.materialParams||{},this.items=[],this.voxels=e(this),this.scene=new k.Scene,this.view=a.view||new j(k,{width:this.width,height:this.height}),this.view.bindToScene(this.scene),this.camera=this.view.getCamera(),a.lightsDisabled||this.addLights(this.scene),this.skyColor=a.skyColor||12571109,this.fogScale=a.fogScale||32,a.fogDisabled||(this.scene.fog=new k.Fog(this.skyColor,25e-5,this.worldWidth()*this.fogScale)),this.collideVoxels=r(this.getBlock.bind(this),1,[1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.timer=this.initializeTimer(a.tickFPS||16),this.paused=!1,this.spatial=new v,this.region=w(this.spatial,s([0,0,0],[1,1,1]),this.chunkSize),this.voxelRegion=w(this.spatial,1),this.chunkRegion=w(this.spatial,this.chunkSize),this.asyncChunkGeneration=!1,this.chunksNeedsUpdate={},this.pendingChunks=[],this.materials=h({game:this,texturePath:a.texturePath||"./textures/",materialType:a.materialType||k.MeshLambertMaterial,materialParams:a.materialParams||{},materialFlatColor:a.materialFlatColor===!0}),this.materialNames=a.materials||[["grass","dirt","grass_dirt"],"brick","dirt"],b.chunkRegion.on("change",function(){b.removeFarChunks()}),this.isClient&&this.materials.load(this.materialNames),this.generateChunks&&this.handleChunkGeneration(),this.isClient)){this.paused=!0,this.initializeRendering(a);for(var f in this.voxels.chunks)this.showChunk(this.voxels.chunks[f]);setTimeout(function(){b.asyncChunkGeneration="asyncChunkGeneration"in a?a.asyncChunkGeneration:!0},2e3),this.initializeControls(a)}}var d=a("__browserify_process"),e=a("voxel"),f=a("voxel-mesh"),g=a("voxel-raycast"),h=a("voxel-texture"),i=a("voxel-control"),j=a("voxel-view"),k=a("three"),l=a("./lib/stats"),m=a("./lib/detector"),n=a("inherits"),o=(a("path"),a("events").EventEmitter);if(d.browser)var p=a("interact");var q=a("raf"),r=a("collide-3d-tilemap"),s=a("aabb-3d"),t=a("gl-matrix"),u=t.vec3,v=a("spatial-events"),w=a("voxel-region-change"),x=a("kb-controls"),y=a("voxel-physical"),z=a("pin-it"),A=a("tic")();b.exports=c,n(c,o),c.prototype.voxelPosition=function(a){var b=Math.floor,c=a,d=[];return d[0]=b(c[0]),d[1]=b(c[1]),d[2]=b(c[2]),d},c.prototype.cameraPosition=function(){return this.view.cameraPosition()},c.prototype.cameraVector=function(){return this.view.cameraVector()},c.prototype.makePhysical=function(a,b,c){var d=this.terminalVelocity;b=b||[2/3,1.5,2/3];var e=y(a,this.potentialCollisionSet(),b,{x:d[0],y:d[1],z:d[2]});return e.blocksCreation=!!c,e},c.prototype.addItem=function(a){if(!a.tick){var b=y(a.mesh,this.potentialCollisionSet(),[a.size,a.size,a.size]);a.velocity&&(b.velocity.copy(a.velocity),b.subjectTo(this.gravity)),b.repr=function(){return"debris"},b.mesh=a.mesh,b.blocksCreation=a.blocksCreation,a=b}return this.items.push(a),a.mesh&&this.scene.add(a.mesh),this.items[this.items.length-1]},c.prototype.removeItem=function(a){var b=this.items.indexOf(a);0>b||(this.items.splice(b,1),a.mesh&&this.scene.remove(a.mesh))},c.prototype.raycast=c.prototype.raycastVoxels=function(a,b,c,d){if(!a)return this.raycastVoxels(this.cameraPosition(),this.cameraVector(),10);var e=[0,0,0],f=[0,0,0],h=a||this.cameraPosition(),i=b||this.cameraVector(),j=g(this,h,i,c||10,f,e,d||this.epilson);if(0>=j)return!1;var k=[0,0,0],l=this.voxelPosition(f);return u.add(k,l,e),{position:f,voxel:l,direction:b,value:j,normal:e,adjacent:k}},c.prototype.canCreateBlock=function(a){a=this.parseVectorArguments(arguments);for(var b=a.map(function(a){return Math.floor(a)}),c=s(b,[1,1,1]),d=0,e=this.items.length;e>d;++d){var f=this.items[d],g=f.blocksCreation&&f.aabb&&c.intersects(f.aabb());if(g)return!1}return!0},c.prototype.createBlock=function(a,b){return"string"==typeof b&&(b=this.materials.find(b)),this.canCreateBlock(a)?(this.setBlock(a,b),!0):!1},c.prototype.setBlock=function(a,b){"string"==typeof b&&(b=this.materials.find(b));var c=this.voxels.voxelAtPosition(a,b),d=this.voxels.chunkAtPosition(a),e=this.voxels.chunks[d.join("|")];e&&(this.addChunkToNextUpdate(e),this.spatial.emit("change-block",a,c,b),this.emit("setBlock",a,b,c))},c.prototype.getBlock=function(a){return a=this.parseVectorArguments(arguments),this.voxels.voxelAtPosition(a)},c.prototype.blockPosition=function(a){a=this.parseVectorArguments(arguments);var b=Math.floor(a[0]),c=Math.floor(a[1]),d=Math.floor(a[2]);return[b,c,d]},c.prototype.blocks=function(a,b,c){var d=a,e=b,f=[e[0]-d[0],e[1]-d[1],e[2]-d[2]];if(!c)var g=new this.arrayType(f[0]*f[1]*f[2]);for(var h=0,i=d[2];i<e[2];++i)for(var j=d[1];j<e[1];++j)for(var k=d[0];k<e[0];++k,++h)c?c(k,j,i,h):g[h]=this.voxels.voxelAtPosition([k,j,i]);return c?void 0:{voxels:g,dims:f}},c.prototype.createAdjacent=function(a,b){this.createBlock(a.adjacent,b)},c.prototype.appendTo=function(a){this.view.appendTo(a)},c.prototype.gravity=[0,-36e-7,0],c.prototype.friction=.3,c.prototype.epilson=1e-8,c.prototype.terminalVelocity=[.9,.1,.9],c.prototype.defaultButtons={W:"forward",A:"left",S:"backward",D:"right","<up>":"forward","<left>":"left","<down>":"backward","<right>":"right","<mouse 1>":"fire","<mouse 3>":"firealt","<space>":"jump","<shift>":"crouch","<control>":"alt"},c.prototype.parseVectorArguments=function(a){return a?a[0]instanceof Array?a[0]:[a[0],a[1],a[2]]:!1},c.prototype.setConfigurablePositions=function(a){var b=a.startingPosition;
this.startingPosition=b||[35,1024,35];var c=a.worldOrigin;this.worldOrigin=c||[0,0,0]},c.prototype.setDimensions=function(a){a.container&&(this.container=a.container),this.height=a.container&&a.container.clientHeight?a.container.clientHeight:"undefined"==typeof window?1:window.innerHeight,this.width=a.container&&a.container.clientWidth?a.container.clientWidth:"undefined"==typeof window?1:window.innerWidth},c.prototype.notCapable=function(){var a=this;return m().webgl?!1:(this.view={appendTo:function(b){b.appendChild(a.notCapableMessage())}},!0)},c.prototype.notCapableMessage=function(){var a=document.createElement("div");a.className="errorMessage";var b=document.createElement("a");return b.title="You need WebGL and Pointer Lock (Chrome 23/Firefox 14) to play this game. Click here for more information.",b.innerHTML=b.title,b.href="http://get.webgl.org",a.appendChild(b),a},c.prototype.onWindowResize=function(){var a=window.innerWidth,b=window.innerHeight;this.container&&(a=this.container.clientWidth,b=this.container.clientHeight),this.view.resizeWindow(a,b)},c.prototype.control=function(a){return this.controlling=a,this.controls.target(a)},c.prototype.potentialCollisionSet=function(){return[{collide:this.collideTerrain.bind(this)}]},c.prototype.playerPosition=function(){var a=this.controls.target(),b=a?a.avatar.position:this.camera.localToWorld(this.camera.position.clone());return[b.x,b.y,b.z]},c.prototype.playerAABB=function(a){var b=a||this.playerPosition(),c=[],d=[.5,this.playerHeight,.5],e=[.25,this.playerHeight,.25];u.subtract(c,b,e);var f=s(c,d);return f},c.prototype.collideTerrain=function(a,b,c,d){var e=this,f=["x","y","z"],g=[c.x,c.y,c.z];this.collideVoxels(b,g,function(b,h,i,j,k){return!h||Math.abs(g[b])<Math.abs(k)?void 0:(g[b]=c[f[b]]=k,a.acceleration[f[b]]=0,d[f[b]]=j,a.friction[f[(b+1)%3]]=a.friction[f[(b+2)%3]]=1===b?e.friction:1,!0)})},c.prototype.addStats=function(){stats=new l,stats.domElement.style.position="absolute",stats.domElement.style.bottom="0px",document.body.appendChild(stats.domElement)},c.prototype.addLights=function(a){var b;b=new k.AmbientLight(13421772),a.add(b);var c=new k.DirectionalLight(16777215,1);c.position.set(1,1,.5).normalize(),a.add(c)},c.prototype.configureChunkLoading=function(a){var b=this;a.generateChunks&&(this.generate=a.generate?a.generate:function(a,b,c){return 225>=a*a+b*b+c*c?1:0},this.generateVoxelChunk=a.generateVoxelChunk?a.generateVoxelChunk:function(a,c){return e.generate(a,c,b.generate,b)})},c.prototype.worldWidth=function(){return 2*this.chunkSize*this.chunkDistance},c.prototype.chunkToWorld=function(a){return[a[0]*this.chunkSize,a[1]*this.chunkSize,a[2]*this.chunkSize]},c.prototype.removeFarChunks=function(a){var b=this;a=a||this.playerPosition();var c=this.voxels.nearbyChunks(a,this.removeDistance).map(function(a){return a.join("|")});Object.keys(b.voxels.chunks).map(function(a){if(!(c.indexOf(a)>-1)){var d=b.voxels.chunks[a],e=b.voxels.meshes[a],f=b.pendingChunks.indexOf(a);if(-1!==f&&b.pendingChunks.splice(f,1),d){var g=d.position;e&&(b.scene.remove(e[b.meshType]),e[b.meshType].geometry.dispose(),delete e.data,delete e.geometry,delete e.meshed,delete e.surfaceMesh),delete b.voxels.chunks[a],b.emit("removeChunk",g)}}}),b.voxels.requestMissingChunks(a)},c.prototype.addChunkToNextUpdate=function(a){this.chunksNeedsUpdate[a.position.join("|")]=a},c.prototype.updateDirtyChunks=function(){var a=this;Object.keys(this.chunksNeedsUpdate).forEach(function(b){var c=a.chunksNeedsUpdate[b];a.emit("dirtyChunkUpdate",c),a.showChunk(c)}),this.chunksNeedsUpdate={}},c.prototype.loadPendingChunks=function(a){var b=this.pendingChunks;this.asyncChunkGeneration?(a=a||.1*b.length,a=Math.max(1,Math.min(a,b.length))):a=b.length;for(var c=0;a>c;c+=1){var d=b[c].split("|"),e=this.voxels.generateChunk(0|d[0],0|d[1],0|d[2]);this.isClient&&this.showChunk(e)}a&&b.splice(0,a)},c.prototype.getChunkAtPosition=function(a){var b=this.voxels.chunkAtPosition(a).join("|"),c=this.voxels.chunks[b];return c},c.prototype.showChunk=function(a){var b=a.position.join("|"),c=this.voxels.getBounds.apply(this.voxels,a.position),d=new k.Vector3(1,1,1),e=f(a,this.mesher,d,this.THREE);return this.voxels.chunks[b]=a,this.voxels.meshes[b]&&this.scene.remove(this.voxels.meshes[b][this.meshType]),this.voxels.meshes[b]=e,this.isClient&&("wireMesh"===this.meshType?e.createWireMesh():e.createSurfaceMesh(this.materials.material),this.materials.paint(e)),e.setPosition(c[0][0],c[0][1],c[0][2]),e.addToScene(this.scene),this.emit("renderChunk",a),e},c.prototype.addMarker=function(a){var b=new k.SphereGeometry(.1,10,10),c=new k.MeshPhongMaterial({color:16777215,shading:k.FlatShading}),d=new k.Mesh(b,c);d.position.copy(a),this.scene.add(d)},c.prototype.addAABBMarker=function(a,b){var c=new k.CubeGeometry(a.width(),a.height(),a.depth()),d=new k.MeshBasicMaterial({color:b||16777215,wireframe:!0,transparent:!0,opacity:.5,side:k.DoubleSide}),e=new k.Mesh(c,d);return e.position.set(a.x0()+a.width()/2,a.y0()+a.height()/2,a.z0()+a.depth()/2),this.scene.add(e),e},c.prototype.addVoxelMarker=function(a,b,c,d){var e=s([a,b,c],[1,1,1]);return this.addAABBMarker(e,d)},c.prototype.pin=z,c.prototype.onControlChange=function(a,b){return this.paused=!1,a||this.optout?(this.buttons.enable(),b.pipe(this.controls.createWriteRotationStream()),void 0):(this.buttons.disable(),void 0)},c.prototype.onControlOptOut=function(){this.optout=!0},c.prototype.onFire=function(a){this.emit("fire",this.controlling,a)},c.prototype.setInterval=A.interval.bind(A),c.prototype.setTimeout=A.timeout.bind(A),c.prototype.tick=function(a){for(var b=0,c=this.items.length;c>b;++b)this.items[b].tick(a);if(this.materials&&this.materials.tick(a),this.pendingChunks.length&&this.loadPendingChunks(),Object.keys(this.chunksNeedsUpdate).length>0&&this.updateDirtyChunks(),A.tick(a),this.emit("tick",a),this.controls){var d=this.playerPosition();this.spatial.emit("position",d,d)}},c.prototype.render=function(){this.view.render(this.scene)},c.prototype.initializeTimer=function(a){function b(){return d.paused?(g=Date.now(),e=0,void 0):(f=Date.now(),h=f-(g||f),g=f,e+=h,a>e||(c=e/a|0,0>=c||(c*=a,d.tick(c),e-=c,d.frameUpdated=!0)),void 0)}var c,d=this,e=0,f=0,g=null,h=0;return d.frameUpdated=!0,d.interval=setInterval(b,0),d.interval},c.prototype.initializeRendering=function(a){var b=this;a.statsDisabled||b.addStats(),window.addEventListener("resize",b.onWindowResize.bind(b),!1),q(window).on("data",function(a){b.emit("prerender",a),b.render(a),b.emit("postrender",a)}),"undefined"!=typeof stats&&b.on("postrender",function(){stats.update()})},c.prototype.initializeControls=function(a){this.keybindings=a.keybindings||this.defaultButtons,this.buttons=x(document.body,this.keybindings),this.buttons.disable(),this.optout=!1,this.interact=p(a.interactElement||this.view.element,a.interactMouseDrag),this.interact.on("attain",this.onControlChange.bind(this,!0)).on("release",this.onControlChange.bind(this,!1)).on("opt-out",this.onControlOptOut.bind(this)),this.hookupControls(this.buttons,a)},c.prototype.hookupControls=function(a,b){b=b||{},b.controls=b.controls||{},b.controls.onfire=this.onFire.bind(this),this.controls=i(a,b.controls),this.items.push(this.controls),this.controlling=null},c.prototype.handleChunkGeneration=function(){var a=this;this.voxels.on("missingChunk",function(b){a.pendingChunks.push(b.join("|"))}),this.voxels.requestMissingChunks(this.worldOrigin),this.loadPendingChunks(this.pendingChunks.length)},c.prototype.destroy=function(){clearInterval(this.timer)}},{"./lib/detector":176,"./lib/stats":177,__browserify_process:40,"aabb-3d":5,"collide-3d-tilemap":178,events:33,"gl-matrix":179,inherits:180,interact:181,"kb-controls":190,path:44,"pin-it":195,raf:196,"spatial-events":197,three:199,tic:200,voxel:265,"voxel-control":201,"voxel-mesh":202,"voxel-physical":203,"voxel-raycast":204,"voxel-region-change":205,"voxel-texture":206,"voxel-view":208}],176:[function(a,b){b.exports=function(){return{canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");return a.style.fontFamily="monospace",a.style.fontSize="13px",a.style.textAlign="center",a.style.background="#eee",a.style.color="#000",a.style.padding="1em",a.style.width="475px",a.style.margin="5em auto 0",this.webgl||(a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/">here</a>.'].join("\n")),a},addGetWebGLMessage:function(a){var b,c,d;a=a||{},b=void 0!==a.parent?a.parent:document.body,c=void 0!==a.id?a.id:"oldie",d=Detector.getWebGLErrorMessage(),d.id=c,b.appendChild(d)}}}},{}],177:[function(a,b){var c=function(){var a=Date.now(),b=a,c=0,d=1/0,e=0,f=0,g=1/0,h=0,i=0,j=0,k=document.createElement("div");k.id="stats",k.addEventListener("mousedown",function(a){a.preventDefault(),s(++j%2)},!1),k.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",k.appendChild(l);var m=document.createElement("div");m.id="fpsText",m.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="FPS",l.appendChild(m);var n=document.createElement("div");for(n.id="fpsGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(n);n.children.length<74;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#113",n.appendChild(o)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",k.appendChild(p);var q=document.createElement("div");q.id="msText",q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",q.innerHTML="MS",p.appendChild(q);var r=document.createElement("div");for(r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(r);r.children.length<74;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(o)}var s=function(a){switch(j=a){case 0:l.style.display="block",p.style.display="none";break;case 1:l.style.display="none",p.style.display="block"}},t=function(a,b){var c=a.appendChild(a.firstChild);c.style.height=b+"px"};return{REVISION:11,domElement:k,setMode:s,begin:function(){a=Date.now()},end:function(){var j=Date.now();return c=j-a,d=Math.min(d,c),e=Math.max(e,c),q.textContent=c+" MS ("+d+"-"+e+")",t(r,Math.min(30,30-c/200*30)),i++,j>b+1e3&&(f=Math.round(1e3*i/(j-b)),g=Math.min(g,f),h=Math.max(h,f),m.textContent=f+" FPS ("+g+"-"+h+")",t(n,Math.min(30,30-f/100*30)),b=j,i=0),j},update:function(){a=this.end()}}};b.exports=c},{}],178:[function(a,b){b.exports=function(a,b,c,d){function e(e,g,h){function i(i){for(var j,k,l,m=(i+1)%3,n=(i+2)%3,o=g[i]>0,p=e[o?"max":"base"][i],q=o?1:-1,r=Math.floor(p/b),s=Math.floor((p+g[i])/b)+q,t=Math.floor(e.base[m]/b),u=Math.ceil(e.max[m]/b),v=Math.floor(e.base[n]/b),w=Math.ceil(e.max[n]/b),x=!1,y=0,z=r;!x&&z!==s;++y,z+=q)if(!(z<d[i]||z>=c[i]))for(var A=t;!x&&A!==u;++A)if(!(A<d[m]||A>=c[m]))for(var B=v;B!==w;++B)if(!(B<d[n]||B>=c[n])&&(f[i]=z,f[m]=A,f[n]=B,l=a.apply(a,f),void 0!==l&&(k=q>0?z*b:(z+1)*b,j=k-p,h(i,l,f,q,j)))){x=!0;break}f[0]=f[1]=f[2]=0,f[i]=g[i],e.translate(f)}(0!==g[0]||0!==g[1]||0!==g[2])&&(i(0),i(1),i(2))}c=c||[Math.sqrt(a.length)>>0,Math.sqrt(a.length)>>0,Math.sqrt(a.length)>>0],d=d||[0,0,0],a="function"==typeof a?a:function(a,b,d){return this[a+b*c[1]+d*c[1]*c[2]]}.bind(a);var f;return f=[0,0,0],e}},{}],179:[function(a,b){b.exports=a(6)},{}],180:[function(a,b){b.exports=a(66)},{}],181:[function(a,b){function c(a,b){function c(){k.emit("opt-out"),j.destroy(),j=e(a),g()}function g(){j.on("attain",function(a){k.emit("attain",a)}),j.on("release",function(){k.emit("release")})}var j,k=new i;return j=!f.available()||b?e(a):d(a,c),k.release=function(){j.release&&j.release()},k.request=function(){j.request&&j.request()},k.destroy=function(){j.destroy&&j.destroy()},k.pointerAvailable=function(){return f.available()},k.fullscreenAvailable=function(){return h.available()},g(),k}function d(a,b){var c=f(a),d=h(a);return c.on("needs-fullscreen",function(){d.once("attain",function(){c.request()}),d.request()}),c.on("error",b),c}function e(a){var b,c=new i,d=g(a);return d.paused=!0,d.on("resume",function(){b=new j,b.readable=!0,b.initial=null}),d.on("data",function(a){return b||(b=new j,b.readable=!0,b.initial=null),b.initial?(b.paused&&(c.emit("release"),b.emit("end"),b.readable=!1,b.emit("close"),b=null),b.emit("data",a),void 0):(b.initial={x:a.dx,y:a.dy,t:a.dt},c.emit("attain",b))}),c}var f=a("pointer-lock"),g=a("drag-stream"),h=a("fullscreen"),i=a("events").EventEmitter,j=a("stream").Stream;b.exports=c},{"drag-stream":182,events:33,fullscreen:188,"pointer-lock":189,stream:50}],182:[function(a,b){function c(a){function b(a){m.paused||(m.emit("data",g(a.screenX-l.x,a.screenY-l.y,+new Date)),l.x=a.screenX,l.y=a.screenY)}function c(a){l.x=a.screenX,l.y=a.screenY,l.t=+new Date,m.resume(),m.emit("data",g(l.x,l.y,l.t))}function f(a){m.pause(),m.emit("data",g(a.screenX-l.x,a.screenY-l.y,+new Date))}function g(a,b,c){return{dx:a,dy:b,dt:c-l.t}}var h=a.ownerDocument.body,i=d(a,"mousedown"),j=d(h,"mouseup",!1),k=d(h,"mousemove",!1),l={x:0,y:0,t:0},m=e(b);return m.pause(),i.on("data",c),j.on("data",f),k.pipe(m)}b.exports=c;var d=(a("stream"),a("domnode-dom").createReadStream),e=a("through")},{"domnode-dom":183,stream:50,through:187}],183:[function(a,b){b.exports=a("./lib/index")},{"./lib/index":184}],184:[function(a,b){var c=a("./writable"),d=a("./readable"),e={};e.WriteStream=c,e.ReadStream=d,e.createAppendStream=function(a,b){return new e.WriteStream(a,e.WriteStream.APPEND,b)},e.createWriteStream=function(a,b){return new e.WriteStream(a,e.WriteStream.WRITE,b)},e.createReadStream=e.createEventStream=function(a,b,c){return c=void 0===c?!0:c,new e.ReadStream(a,b,c)},b.exports=e},{"./readable":185,"./writable":186}],185:[function(a,b){function c(a,b,c){this.el=a,this.eventType=b,this.shouldPreventDefault=c;var d=this;a&&this.eventType&&f(this.el,this.eventType,function(){return d.listen.apply(d,arguments)}),e.call(this)}function d(a){switch(a.getAttribute("type")){case"radio":return a.checked?a.value:null;case"checkbox":return a.checked}return a.value}b.exports=c;var e=a("stream").Stream,f=function(a,b,c){return a.addEventListener(b,c,!1)};"undefined"!=typeof $&&(f=function(a,b,c){return a=$(a)[b](c)}),"undefined"==typeof document||document.createElement("div").addEventListener||(f=function(a,b,c){return a.attachEvent("on"+b,c)});var g=c,h=g.prototype=Object.create(e.prototype);h.constructor=g,h.listen=function(a){this.shouldPreventDefault&&(a.preventDefault?a.preventDefault():a.returnValue=!1);var b="submit"===this.eventType||"change"===this.eventType||"keydown"===this.eventType||"keyup"===this.eventType||"input"===this.eventType;return b?"FORM"===this.el.tagName.toUpperCase()?this.handleFormSubmit(a):this.emit("data",d(this.el)):(this.emit("data",a),void 0)},h.handleFormSubmit=function(){var a=[];if(this.el.querySelectorAll)a=this.el.querySelectorAll("input,textarea,select");else{var b={INPUT:!0,TEXTAREA:!0,SELECT:!0},c=function(d){for(var e=0,f=d.childNodes.length;f>e;++e)d.childNodes[e].tagName&&(b[d.childNodes[e].tagName.toUpperCase()]?a.push(d):c(d.childNodes[e]))};c(this.el)}for(var e,f,g={},h=0,i=a.length;i>h;++h)e=a[h].getAttribute("name"),f=d(a[h]),g[e]=f;return this.emit("data",g)}},{stream:50}],186:[function(a,b){function c(a,b,c){this.el=a,this.mode=b,this.mimetype=c||"text/html",d.call(this)}b.exports=c;var d=a("stream").Stream,e=c,f=e.prototype=Object.create(d.prototype);f.constructor=e,e.APPEND=0,e.WRITE=1,f.writable=!0,f.setMimetype=function(a){this.mimetype=a},f.write=function(a){var b=this.mode===e.APPEND?this.append(a):this.insert(a);return this.emit("data",this.el.childNodes),b},f.end=function(){},f.insert=function(a){return this.el.innerHTML="",this.append(a)},f.append=function(a){for(var b=this[this.resolveMimetypeHandler()](a),c=0,d=b.length;d>c;++c)this.el.appendChild(b[c]);return!0},f.resolveMimetypeHandler=function(){var a=this.mimetype.replace(/(\/\w)/,function(a){return a.slice(1).toUpperCase()});return a=a.charAt(0).toUpperCase()+a.slice(1),"construct"+a},f.constructTextHtml=function(a){var b,c=/(tr|td|th)/.test(a)&&!/table/.test(a);return c&&(b=document.createElement("table")),b=b||document.createElement("div"),b.innerHTML=a,[].slice.call(b.childNodes)},f.constructTextPlain=function(a){var b=document.createTextNode(a);return[b]}},{stream:50}],187:[function(a,b,c){function d(a,b){function c(){for(;j.length&&!i.paused;){var a=j.shift();if(null===a)return i.emit("end");i.emit("data",a)}}function d(){i.writable=!1,b.call(i),i.readable||i.destroy()}a=a||function(a){this.emit("data",a)},b=b||function(){this.emit("end")};var g=!1,h=!1,i=new f,j=[];return i.buffer=j,i.readable=i.writable=!0,i.paused=!1,i.write=function(b){return a.call(this,b),!i.paused},i.queue=function(a){j.push(a),c()},i.on("end",function(){i.readable=!1,i.writable||e.nextTick(function(){i.destroy()})}),i.end=function(a){g||(g=!0,arguments.length&&i.write(a),d())},i.destroy=function(){h||(h=!0,g=!0,j.length=0,i.writable=i.readable=!1,i.emit("close"))},i.pause=function(){i.paused||(i.paused=!0,i.emit("pause"))},i.resume=function(){i.paused&&(i.paused=!1),c(),i.paused||i.emit("drain")},i}var e=a("__browserify_process"),f=a("stream");c=b.exports=d,d.through=d},{__browserify_process:40,stream:50}],188:[function(a,b){function c(){return!!e(document.body)}function d(a){function b(){return h()?(l.emit("attain"),void 0):l.emit("release")}function c(){l.emit("error")}function d(){return k.call(a)}function g(){(a.exitFullscreen||a.exitFullscreen||a.webkitExitFullScreen||a.webkitExitFullscreen||a.mozExitFullScreen||a.mozExitFullscreen||a.msExitFullScreen||a.msExitFullscreen||a.oExitFullScreen||a.oExitFullscreen).call(a)}function h(){return 0||j.fullScreenElement||j.fullscreenElement||j.webkitFullScreenElement||j.webkitFullscreenElement||j.mozFullScreenElement||j.mozFullscreenElement||j.msFullScreenElement||j.msFullscreenElement||j.oFullScreenElement||j.oFullscreenElement||null}for(var i=a.addEventListener||a.attachEvent,j=a.ownerDocument,k=(j.body,e(a)),l=new f,m=["","webkit","moz","ms","o"],n=0,o=m.length;o>n;++n)i.call(j,m[n]+"fullscreenchange",b),i.call(j,m[n]+"fullscreenerror",c);return l.release=g,l.request=d,l.target=h,e||setTimeout(function(){l.emit("error",new Error("fullscreen is not supported"))},0),l}function e(a){return a.requestFullscreen||a.webkitRequestFullscreen||a.webkitRequestFullScreen||a.mozRequestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||a.msRequestFullScreen||a.oRequestFullscreen||a.oRequestFullScreen}b.exports=d,d.available=c;var f=a("events").EventEmitter},{events:33}],189:[function(a,b){function c(){return!!e(document.body)}function d(a){function b(){k()||(n=+new Date,s.call(a))}function c(){w&&(u.emit("needs-fullscreen"),w=!1)}function d(){return k()?(v=new g,v.readable=!0,v.initial={x:l,y:m,t:Date.now()},u.emit("attain",v),void 0):(v&&i(),void 0)}function h(a){var b=+new Date-n;return 100>b?(w=!0,void 0):(v&&(v.emit("error",a),v=null),void 0)}function i(){u.emit("release"),v&&(v.emit("end"),v.readable=!1,v.emit("close"),v=null);var a=k();a&&(q.exitPointerLock||q.mozExitPointerLock||q.webkitExitPointerLock||q.msExitPointerLock||q.oExitPointerLock).call(q)}function j(a){l=a.pageX,m=a.pageY,v&&(t.dx=a.movementX||a.webkitMovementX||a.mozMovementX||a.msMovementX||a.oMovementX||0,t.dy=a.movementY||a.webkitMovementY||a.mozMovementY||a.msMovementY||a.oMovementY||0,t.dt=Date.now()-v.initial.t,u.emit("data",t),v.emit("data",t))}function k(){return 0||q.pointerLockElement||q.mozPointerLockElement||q.webkitPointerLockElement||q.msPointerLockElement||q.oPointerLockElement||null}var l,m,n,o=a.addEventListener||a.attachEvent,p=a.removeEventListener||a.detachEvent,q=a.ownerDocument,r=q.body,s=e(a),t={dx:0,dy:0,dt:0},u=new f,v=null,w=!1;o.call(a,"mousedown",b,!1),o.call(a,"mouseup",c,!1),o.call(r,"mousemove",j,!1);for(var x=["","webkit","moz","ms","o"],y=0,z=x.length;z>y;++y)o.call(q,x[y]+"pointerlockchange",d),o.call(q,x[y]+"pointerlockerror",h);return u.release=i,u.target=k,u.request=b,u.destroy=function(){p.call(a,"mouseup",c,!1),p.call(a,"mousedown",b,!1),p.call(a,"mousemove",j,!1)},e||setTimeout(function(){u.emit("error",new Error("pointer lock is not supported"))},0),u}function e(a){return a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock||a.msRequestPointerLock||a.oRequestPointerLock||null}b.exports=d,d.available=c;var f=a("events").EventEmitter,g=a("stream").Stream},{events:33,stream:50}],190:[function(a,b){var c=a("ever"),d=a("vkey"),e=Math.max;b.exports=function(a,b,f){function g(){for(var a in b)f[b[a]]=0,n[a]=1}function h(a){return function(){return g(),o=a,this}}function i(a){return function(b){o&&(b.preventDefault(),a(b))}}function j(a,c){return function(d){var g=a(d),h=b[g];h&&(f[h]+=c?e(n[g]--,0):-(n[g]=1),!c&&f[h]<0&&(f[h]=0))}}function k(a){return"<mouse "+a.which+">"}function l(a){return d[a.keyCode]||a.char}void 0!==b&&a.ownerDocument||(f=b,b=a,a=this.document.body);var m=c(a),n={},o=!0;f=f||{};for(var p in b){if("enabled"===b[p]||"enable"===b[p]||"disable"===b[p]||"destroy"===b[p])throw new Error(b[p]+" is reserved");f[b[p]]=0,n[p]=1}return m.on("keyup",i(j(l,!1))),m.on("keydown",i(j(l,!0))),m.on("mouseup",i(j(k,!1))),m.on("mousedown",i(j(k,!0))),f.enabled=function(){return o},f.enable=h(!0),f.disable=h(!1),f.destroy=function(){m.removeAllListeners()},f}},{ever:191,vkey:194}],191:[function(a,b){function c(a){this.element=a}function d(a){var b=Object.prototype.toString.call(a);return/\[object \S+Event\]/.test(b)}var e=a("events").EventEmitter;b.exports=function(a){return new c(a)},c.prototype=new e,c.prototype.on=function(a,b,c){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),this._events[a].push(b),this.element.addEventListener(a,b,c||!1),this},c.prototype.addListener=c.prototype.on,c.prototype.removeListener=function(a,b,c){this._events||(this._events={}),this.element.removeEventListener(a,b,c||!1);var d=this.listeners(a),e=d.indexOf(b);return e>=0&&d.splice(e,1),this},c.prototype.removeAllListeners=function(a){function b(a){for(var b=c.listeners(a),d=0;d<b.length;d++)c.removeListener(a,b[d])}var c=this;if(a)b(a);else if(c._events)for(var d in c._events)d&&b(d);return e.prototype.removeAllListeners.apply(c,arguments)};var f=a("./init.json");c.prototype.emit=function(a,b){if("object"==typeof a&&(b=a,a=b.type),!d(b)){var e=c.typeOf(a),g=b||{};void 0===g.type&&(g.type=a),b=document.createEvent(e+"s");for(var h="function"==typeof b["init"+e]?"init"+e:"initEvent",i=f[h],j={},k=[],l=0;l<i.length;l++){var m=i[l];k.push(g[m]),j[m]=!0}b[h].apply(b,k);for(var m in g)j[m]||(b[m]=g[m])}return this.element.dispatchEvent(b)},c.types=a("./types.json"),c.typeOf=function(){var a={};for(var b in c.types)for(var d=c.types[b],e=0;e<d.length;e++)a[d[e]]=b;return function(b){return a[b]||"Event"}}()},{"./init.json":192,"./types.json":193,events:33}],192:[function(a,b){b.exports={initEvent:["type","canBubble","cancelable"],initUIEvent:["type","canBubble","cancelable","view","detail"],initMouseEvent:["type","canBubble","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget"],initMutationEvent:["type","canBubble","cancelable","relatedNode","prevValue","newValue","attrName","attrChange"]}},{}],193:[function(a,b){b.exports={MouseEvent:["click","mousedown","mouseup","mouseover","mousemove","mouseout"],KeyBoardEvent:["keydown","keyup","keypress"],MutationEvent:["DOMSubtreeModified","DOMNodeInserted","DOMNodeRemoved","DOMNodeRemovedFromDocument","DOMNodeInsertedIntoDocument","DOMAttrModified","DOMCharacterDataModified"],HTMLEvent:["load","unload","abort","error","select","change","submit","reset","focus","blur","resize","scroll"],UIEvent:["DOMFocusIn","DOMFocusOut","DOMActivate"]}},{}],194:[function(a,b){var c,d="undefined"!=typeof window?window.navigator.userAgent:"",e=/OS X/.test(d),f=/Opera/.test(d),g=!/like Gecko/.test(d)&&!f,h=b.exports={0:e?"<menu>":"<UNK>",1:"<mouse 1>",2:"<mouse 2>",3:"<break>",4:"<mouse 3>",5:"<mouse 4>",6:"<mouse 5>",8:"<backspace>",9:"<tab>",12:"<clear>",13:"<enter>",16:"<shift>",17:"<control>",18:"<alt>",19:"<pause>",20:"<caps-lock>",21:"<ime-hangul>",23:"<ime-junja>",24:"<ime-final>",25:"<ime-kanji>",27:"<escape>",28:"<ime-convert>",29:"<ime-nonconvert>",30:"<ime-accept>",31:"<ime-mode-change>",27:"<escape>",32:"<space>",33:"<page-up>",34:"<page-down>",35:"<end>",36:"<home>",37:"<left>",38:"<up>",39:"<right>",40:"<down>",41:"<select>",42:"<print>",43:"<execute>",44:"<snapshot>",45:"<insert>",46:"<delete>",47:"<help>",91:"<meta>",92:"<meta>",93:e?"<meta>":"<menu>",95:"<sleep>",106:"<num-*>",107:"<num-+>",108:"<num-enter>",109:"<num-->",110:"<num-.>",111:"<num-/>",144:"<num-lock>",145:"<scroll-lock>",160:"<shift-left>",161:"<shift-right>",162:"<control-left>",163:"<control-right>",164:"<alt-left>",165:"<alt-right>",166:"<browser-back>",167:"<browser-forward>",168:"<browser-refresh>",169:"<browser-stop>",170:"<browser-search>",171:"<browser-favorites>",172:"<browser-home>",173:e&&g?"-":"<volume-mute>",174:"<volume-down>",175:"<volume-up>",176:"<next-track>",177:"<prev-track>",178:"<stop>",179:"<play-pause>",180:"<launch-mail>",181:"<launch-media-select>",182:"<launch-app 1>",183:"<launch-app 2>",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"<meta>",224:"<meta>",226:"<alt-gr>",229:"<ime-process>",231:f?"`":"<unicode>",246:"<attention>",247:"<crsel>",248:"<exsel>",249:"<erase-eof>",250:"<play>",251:"<zoom>",252:"<no-name>",253:"<pa-1>",254:"<clear>"};for(c=58;65>c;++c)h[c]=String.fromCharCode(c);for(c=48;58>c;++c)h[c]=c-48+"";for(c=65;91>c;++c)h[c]=String.fromCharCode(c);for(c=96;106>c;++c)h[c]="<num-"+(c-96)+">";for(c=112;136>c;++c)h[c]="F"+(c-111)},{}],195:[function(a,b){function c(a,b){var c=document.createElement("div"),d=document.createElement("h4"),e=document.createElement("pre");return c.style.background="white",c.style.marginBottom="4px",c.appendChild(d),c.appendChild(e),d.textContents=d.innerText=b&&b.repr?b.repr():a,e.style.padding="8px",f||(f=document.createElement("div"),f.style.position="absolute",f.style.top=f.style.right="4px",document.body.appendChild(f)),f.appendChild(c),(g[a]=g[a]||[]).push({body:e,last:-1/0,for_object:b}),g[a]}function d(a,b,c,e){if(c||(b.innerHTML=""),!(e>1))switch(e=e||0,typeof a){case"number":b.innerText+=a.toFixed(3);break;case"string":b.innerText+='"'+a+'"';break;case"undefined":case"object":if(a){for(var f in a)a.hasOwnProperty(f)&&(b.innerText+=f+":",d(a[f],b,!0,e+1),b.innerText+="\n");break}case"boolean":b.innerText+=""+a}}function e(a,b,e,f){f||Error.captureStackTrace(h);var i=f||h.stack.split("\n").slice(2)[0].replace(/^\s+at /g,""),j=g[i]||c(i,e),k=Date.now(),b=b||0;if(arguments.length<3)j=j[0];else{for(var l=0,m=j.length;m>l;++l)if(j[l].for_object===e){j=j[l];break}l===m&&g[i].push(j=c(i,e))}k-j.last>b&&(d(a,j.body),j.last=k)}b.exports=e;var f,g={},h={}},{}],196:[function(a,b){function c(a){function b(){var d=c.now(),h=d-e;e=d,g.emit("data",h),g.paused||f(b,a)}var e=c.now(),g=new d;return g.pause=function(){g.paused=!0},g.resume=function(){g.paused=!1},f(b,a),g}b.exports=c;var d=a("events").EventEmitter,e="undefined"==typeof window?this:window,f=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.msRequestAnimationFrame||e.oRequestAnimationFrame||(e.setImmediate?function(a){setImmediate(a)}:function(a){setTimeout(a,0)});c.polyfill=f,c.now=function(){return Date.now()}},{events:33}],197:[function(a,b){function c(){this.root=null,this.infinites={}}function d(a){return isFinite(a.x0())&&isFinite(a.x1())&&isFinite(a.y0())&&isFinite(a.y1())&&isFinite(a.z0())&&isFinite(a.z1())}b.exports=c;var e=[].slice,f=a("./tree"),g=a("aabb-3d"),h=c,i=h.prototype;i.size=16,i.addListener=i.addEventListener=i.on=function(a,b,c){return d(b)?((this.root=this.root||this.create_root(b)).add(a,b,c),this):((this.infinites[a]=this.infinites[a]||[]).push({bbox:b,func:c}),this)},i.once=function(a,b,c){var d=this;return d.on(a,b,function e(){c.apply(null,arguments),d.remove(a,e)}),d},i.removeListener=i.removeEventListener=i.remove=function(a,b){if(this.root&&this.root.remove(a,b),!this.infinites[a])return this;for(var c=0,d=this.infinites[a].length;d>c&&this.infinites[a][c].func!==b;++c);return c!==d&&this.infinites[a].splice(c,1),this},i.emit=function(a,b){var c=e.call(arguments,2);if("0"in b&&(b=g(b,[0,0,0])),this.root&&this.root.send(a,b,c),!this.infinites[a])return this;for(var d=this.infinites[a].slice(),f=0,h=d.length;h>f;++f)d[f].bbox.intersects(b)&&d[f].func.apply(null,c);return this},i.rootSize=function(a){i.size=a},i.create_root=function(a){function b(a,b){f.call(this,a,b,null)}var c=this,d=c.size,e=[Math.floor(a.x0()/d)*d,Math.floor(a.y0()/d)*d,Math.floor(a.z0()/d)*d],g=new a.constructor(e,[d,d,d]);return b.prototype=Object.create(f.prototype),b.prototype.constructor=b,b.prototype.grow=function(a){c.root=a},b.prototype.min_size=d,new b(d,g)}},{"./tree":198,"aabb-3d":5}],198:[function(a,b){function c(a,b,c){this.listeners={},this.size=a,this.bbox=b,this.parent=c,this.children=[]}b.exports=c;var d=a("aabb-3d"),e=c,f=e.prototype;f.add=function(a,b,c){if(!this.parent&&!this.contains(b))return this.expand(b).add(a,b,c);for(var e=0,f=this.children.length;f>e;++e)if(this.children[e].contains(b))return this.children[e].add(a,b,c);var g=this.size/2;if(g>this.min_size&&b.vec[0]<g&&b.vec[1]<g&&b.vec[2]<g&&Math.floor(b.x0()/g)===Math.floor(b.x1()/g)&&Math.floor(b.y0()/g)===Math.floor(b.y1()/g)&&Math.floor(b.z0()/g)===Math.floor(b.z1()/g)){var h=new this.constructor(g,d([Math.floor(b.x0()/g)*g,Math.floor(b.y0()/g)*g,Math.floor(b.z0()/g)*g],[g,g,g]),this);return this.children.push(h),h.add(a,b,c)}(this.listeners[a]=this.listeners[a]||[]).push({bbox:b,func:c})},f.contains=function(a){return a.x0()>=this.bbox.x0()&&a.y0()>=this.bbox.y0()&&a.z0()>=this.bbox.z0()&&a.x1()<=this.bbox.x1()&&a.y1()<=this.bbox.y1()&&a.z1()<=this.bbox.z1()},f.expand=function(a){var b=this.size,c=2*b,e=(this.bbox.expand(a),Math.floor(a.x0()/b)),f=Math.floor(a.y0()/b),g=Math.floor(a.z0()/b),h=Math.floor(this.bbox.x0()/b),i=Math.floor(this.bbox.y0()/b),j=Math.floor(this.bbox.z0()/b),k=[e-h>=0?h:h-1,f-i>=0?i:i-1,g-j>=0?j:j-1].map(function(a){return a*b}),l=d(k,[c,c,c]),m=new this.constructor(c,l),n=this;return this.parent=m,this.grow(this.parent),m.children.push(n),m},f.remove=function(a,b){var c=this.listeners[a];if(c){for(var d=0,e=c.length;e>d&&c[d].func!==b;++d);d!==e&&c.splice(d,1)}for(var d=0,e=this.children.length;e>d;++d)this.children[d].remove(a,b)},f.send=function(a,b,c){for(var d=0,e=this.children.length;e>d;++d)b.intersects(this.children[d].bbox)&&this.children[d].send(a,b,c);var f=this.listeners[a];if(f)for(var d=0,e=f.length;e>d;++d)f[d].bbox.intersects(b)&&f[d].func.apply(null,c)}},{"aabb-3d":5}],199:[function(a,b,c){var d=a("__browserify_process"),e=e||{},f=f||{};void 0===e.performance&&(e.performance={}),void 0===e.performance.now&&(e.performance.now=function(){var a=d.hrtime();
return 1e3*(a[0]+a[1]/1e9)});var g=g||{REVISION:"56"};f.console=f.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},f.Int32Array=f.Int32Array||Array,f.Float32Array=f.Float32Array||Array,String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},g.extend=function(a,b){if(Object.keys)for(var c=Object.keys(b),d=0,e=c.length;e>d;d++){var f=c[d];Object.defineProperty(a,f,Object.getOwnPropertyDescriptor(b,f))}else{var g={}.hasOwnProperty;for(var f in b)g.call(b,f)&&(a[f]=b[f])}return a},function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!e.requestAnimationFrame;++c)e.requestAnimationFrame=e[b[c]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[b[c]+"CancelAnimationFrame"]||e[b[c]+"CancelRequestAnimationFrame"];void 0===e.requestAnimationFrame&&(e.requestAnimationFrame=function(b){var c=Date.now(),d=Math.max(0,16-(c-a)),f=e.setTimeout(function(){b(c+d)},d);return a=c+d,f}),e.cancelAnimationFrame=e.cancelAnimationFrame||function(a){e.clearTimeout(a)}}(),g.CullFaceNone=0,g.CullFaceBack=1,g.CullFaceFront=2,g.CullFaceFrontBack=3,g.FrontFaceDirectionCW=0,g.FrontFaceDirectionCCW=1,g.BasicShadowMap=0,g.PCFShadowMap=1,g.PCFSoftShadowMap=2,g.FrontSide=0,g.BackSide=1,g.DoubleSide=2,g.NoShading=0,g.FlatShading=1,g.SmoothShading=2,g.NoColors=0,g.FaceColors=1,g.VertexColors=2,g.NoBlending=0,g.NormalBlending=1,g.AdditiveBlending=2,g.SubtractiveBlending=3,g.MultiplyBlending=4,g.CustomBlending=5,g.AddEquation=100,g.SubtractEquation=101,g.ReverseSubtractEquation=102,g.ZeroFactor=200,g.OneFactor=201,g.SrcColorFactor=202,g.OneMinusSrcColorFactor=203,g.SrcAlphaFactor=204,g.OneMinusSrcAlphaFactor=205,g.DstAlphaFactor=206,g.OneMinusDstAlphaFactor=207,g.DstColorFactor=208,g.OneMinusDstColorFactor=209,g.SrcAlphaSaturateFactor=210,g.MultiplyOperation=0,g.MixOperation=1,g.AddOperation=2,g.UVMapping=function(){},g.CubeReflectionMapping=function(){},g.CubeRefractionMapping=function(){},g.SphericalReflectionMapping=function(){},g.SphericalRefractionMapping=function(){},g.RepeatWrapping=1e3,g.ClampToEdgeWrapping=1001,g.MirroredRepeatWrapping=1002,g.NearestFilter=1003,g.NearestMipMapNearestFilter=1004,g.NearestMipMapLinearFilter=1005,g.LinearFilter=1006,g.LinearMipMapNearestFilter=1007,g.LinearMipMapLinearFilter=1008,g.UnsignedByteType=1009,g.ByteType=1010,g.ShortType=1011,g.UnsignedShortType=1012,g.IntType=1013,g.UnsignedIntType=1014,g.FloatType=1015,g.UnsignedShort4444Type=1016,g.UnsignedShort5551Type=1017,g.UnsignedShort565Type=1018,g.AlphaFormat=1019,g.RGBFormat=1020,g.RGBAFormat=1021,g.LuminanceFormat=1022,g.LuminanceAlphaFormat=1023,g.RGB_S3TC_DXT1_Format=2001,g.RGBA_S3TC_DXT1_Format=2002,g.RGBA_S3TC_DXT3_Format=2003,g.RGBA_S3TC_DXT5_Format=2004,g.Color=function(a){return void 0!==a&&this.set(a),this},g.extend(g.Color.prototype,{r:1,g:1,b:1,set:function(a){switch(typeof a){case"number":this.setHex(a);break;case"string":this.setStyle(a)}},setHex:function(a){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,this},setRGB:function(a,b,c){return this.r=a,this.g=b,this.b=c,this},setHSV:function(a,b,c){return console.log("DEPRECATED: Color's .setHSV() will be removed. Use .setHSL( h, s, l ) instead."),this.setHSL(a,b*c/((a=(2-b)*c)<1?a:2-a),a/2)},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+6*(b-a)*(2/3-c):a},e=.5>=c?c*(1+b):c+b-c*b,f=2*c-e;this.r=d(f,e,a+1/3),this.g=d(f,e,a),this.b=d(f,e,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(a)){var b=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(a);return this.r=Math.min(255,parseInt(b[1],10))/255,this.g=Math.min(255,parseInt(b[2],10))/255,this.b=Math.min(255,parseInt(b[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(a)){var b=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(a);return this.r=Math.min(100,parseInt(b[1],10))/100,this.g=Math.min(100,parseInt(b[2],10))/100,this.b=Math.min(100,parseInt(b[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(a)){var b=/^\#([0-9a-f]{6})$/i.exec(a);return this.setHex(parseInt(b[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a)){var b=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a);return this.setHex(parseInt(b[1]+b[1]+b[2]+b[2]+b[3]+b[3],16)),this}return/^(\w+)$/i.test(a)?(this.setHex(g.ColorKeywords[a]),this):void 0},copy:function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this},copyGammaToLinear:function(a){return this.r=a.r*a.r,this.g=a.g*a.g,this.b=a.b*a.b,this},copyLinearToGamma:function(a){return this.r=Math.sqrt(a.r),this.g=Math.sqrt(a.g),this.b=Math.sqrt(a.b),this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;return this.r=a*a,this.g=b*b,this.b=c*c,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var a={h:0,s:0,l:0};return function(){var b,c,d=this.r,e=this.g,f=this.b,g=Math.max(d,e,f),h=Math.min(d,e,f),i=(h+g)/2;if(h===g)b=0,c=0;else{var j=g-h;switch(c=.5>=i?j/(g+h):j/(2-g-h),g){case d:b=(e-f)/j+(f>e?6:0);break;case e:b=(f-d)/j+2;break;case f:b=(d-e)/j+4}b/=6}return a.h=b,a.s=c,a.l=i,a}}(),getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();return d.h+=a,d.s+=b,d.l+=c,this.setHSL(d.h,d.s,d.l),this},add:function(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this},addColors:function(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this},addScalar:function(a){return this.r+=a,this.g+=a,this.b+=a,this},multiply:function(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this},multiplyScalar:function(a){return this.r*=a,this.g*=a,this.b*=a,this},lerp:function(a,b){return this.r+=(a.r-this.r)*b,this.g+=(a.g-this.g)*b,this.b+=(a.b-this.b)*b,this},clone:function(){return(new g.Color).setRGB(this.r,this.g,this.b)}}),g.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},g.Quaternion=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=void 0!==d?d:1},g.extend(g.Quaternion.prototype,{set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this},setFromEuler:function(a,b){var c=Math.cos(a.x/2),d=Math.cos(a.y/2),e=Math.cos(a.z/2),f=Math.sin(a.x/2),g=Math.sin(a.y/2),h=Math.sin(a.z/2);return void 0===b||"XYZ"===b?(this.x=f*d*e+c*g*h,this.y=c*g*e-f*d*h,this.z=c*d*h+f*g*e,this.w=c*d*e-f*g*h):"YXZ"===b?(this.x=f*d*e+c*g*h,this.y=c*g*e-f*d*h,this.z=c*d*h-f*g*e,this.w=c*d*e+f*g*h):"ZXY"===b?(this.x=f*d*e-c*g*h,this.y=c*g*e+f*d*h,this.z=c*d*h+f*g*e,this.w=c*d*e-f*g*h):"ZYX"===b?(this.x=f*d*e-c*g*h,this.y=c*g*e+f*d*h,this.z=c*d*h-f*g*e,this.w=c*d*e+f*g*h):"YZX"===b?(this.x=f*d*e+c*g*h,this.y=c*g*e+f*d*h,this.z=c*d*h-f*g*e,this.w=c*d*e-f*g*h):"XZY"===b&&(this.x=f*d*e-c*g*h,this.y=c*g*e-f*d*h,this.z=c*d*h+f*g*e,this.w=c*d*e+f*g*h),this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this.x=a.x*d,this.y=a.y*d,this.z=a.z*d,this.w=Math.cos(c),this},setFromRotationMatrix:function(a){var b,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],i=c[9],j=c[2],k=c[6],l=c[10],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this.w=.25/b,this.x=(k-i)*b,this.y=(f-j)*b,this.z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this.w=(k-i)/b,this.x=.25*b,this.y=(e+g)/b,this.z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this.w=(f-j)/b,this.x=(e+g)/b,this.y=.25*b,this.z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this.w=(g-e)/b,this.x=(f+j)/b,this.y=(i+k)/b,this.z=.25*b),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=this.length();return 0===a?(this.x=0,this.y=0,this.z=0,this.w=1):(a=1/a,this.x=this.x*a,this.y=this.y*a,this.z=this.z*a,this.w=this.w*a),this},multiply:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a.x,d=a.y,e=a.z,f=a.w,g=b.x,h=b.y,i=b.z,j=b.w;return this.x=c*j+f*g+d*i-e*h,this.y=d*j+f*h+e*g-c*i,this.z=e*j+f*i+c*h-d*g,this.w=f*j-c*g-d*h-e*i,this},multiplyVector3:function(a){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),a.applyQuaternion(this)},slerp:function(a,b){var c=this.x,d=this.y,e=this.z,f=this.w,g=f*a.w+c*a.x+d*a.y+e*a.z;if(0>g?(this.w=-a.w,this.x=-a.x,this.y=-a.y,this.z=-a.z,g=-g):this.copy(a),g>=1)return this.w=f,this.x=c,this.y=d,this.z=e,this;var h=Math.acos(g),i=Math.sqrt(1-g*g);if(Math.abs(i)<.001)return this.w=.5*(f+this.w),this.x=.5*(c+this.x),this.y=.5*(d+this.y),this.z=.5*(e+this.z),this;var j=Math.sin((1-b)*h)/i,k=Math.sin(b*h)/i;return this.w=f*j+this.w*k,this.x=c*j+this.x*k,this.y=d*j+this.y*k,this.z=e*j+this.z*k,this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},clone:function(){return new g.Quaternion(this.x,this.y,this.z,this.w)}}),g.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)},g.Vector2=function(a,b){this.x=a||0,this.y=b||0},g.extend(g.Vector2.prototype,{set:function(a,b){return this.x=a,this.y=b,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this},add:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this)},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScalar:function(a){return this.x+=a,this.y+=a,this},sub:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this},divideScalar:function(a){return 0!==a?(this.x/=a,this.y/=a):this.set(0,0),this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this},equals:function(a){return a.x===this.x&&a.y===this.y},toArray:function(){return[this.x,this.y]},clone:function(){return new g.Vector2(this.x,this.y)}}),g.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},g.extend(g.Vector3.prototype,{set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},sub:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b)):(this.x*=a.x,this.y*=a.y,this.z*=a.z,this)},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this},applyEuler:function(){var a=new g.Quaternion;return function(b,c){var d=a.setFromEuler(b,c);return this.applyQuaternion(d),this}}(),applyAxisAngle:function(){var a=new g.Quaternion;return function(b,c){var d=a.setFromAxisAngle(b,c);return this.applyQuaternion(d),this}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize(),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){return 0!==a?(this.x/=a,this.y/=a,this.z/=a):(this.x=0,this.y=0,this.z=0),this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},cross:function(a,b){if(void 0!==b)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;return this.x=d*a.z-e*a.y,this.y=e*a.x-c*a.z,this.z=c*a.y-d*a.x,this},crossVectors:function(a,b){return this.x=a.y*b.z-a.z*b.y,this.y=a.z*b.x-a.x*b.z,this.z=a.x*b.y-a.y*b.x,this},projectOnVector:function(){var a=new g.Vector3;return function(b){a.copy(b).normalize();var c=this.dot(a);return this.copy(a).multiplyScalar(c)}}(),projectOnPlane:function(){var a=new g.Vector3;return function(b){return a.copy(this).projectOnVector(b),this.sub(a)}}(),reflect:function(){var a=new g.Vector3;return function(b){return a.copy(this).projectOnVector(b).multiplyScalar(2),this.subVectors(a,this)}}(),angleTo:function(a){var b=this.dot(a)/(this.length()*a.length());return Math.acos(g.Math.clamp(b,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},getPositionFromMatrix:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},setEulerFromRotationMatrix:function(a,b){function c(a){return Math.min(Math.max(a,-1),1)}var d=a.elements,e=d[0],f=d[4],g=d[8],h=d[1],i=d[5],j=d[9],k=d[2],l=d[6],m=d[10];return void 0===b||"XYZ"===b?(this.y=Math.asin(c(g)),Math.abs(g)<.99999?(this.x=Math.atan2(-j,m),this.z=Math.atan2(-f,e)):(this.x=Math.atan2(l,i),this.z=0)):"YXZ"===b?(this.x=Math.asin(-c(j)),Math.abs(j)<.99999?(this.y=Math.atan2(g,m),this.z=Math.atan2(h,i)):(this.y=Math.atan2(-k,e),this.z=0)):"ZXY"===b?(this.x=Math.asin(c(l)),Math.abs(l)<.99999?(this.y=Math.atan2(-k,m),this.z=Math.atan2(-f,i)):(this.y=0,this.z=Math.atan2(h,e))):"ZYX"===b?(this.y=Math.asin(-c(k)),Math.abs(k)<.99999?(this.x=Math.atan2(l,m),this.z=Math.atan2(h,e)):(this.x=0,this.z=Math.atan2(-f,i))):"YZX"===b?(this.z=Math.asin(c(h)),Math.abs(h)<.99999?(this.x=Math.atan2(-j,i),this.y=Math.atan2(-k,e)):(this.x=0,this.y=Math.atan2(g,m))):"XZY"===b&&(this.z=Math.asin(-c(f)),Math.abs(f)<.99999?(this.x=Math.atan2(l,i),this.y=Math.atan2(g,e)):(this.x=Math.atan2(-j,m),this.y=0)),this},setEulerFromQuaternion:function(a,b){function c(a){return Math.min(Math.max(a,-1),1)}var d=a.x*a.x,e=a.y*a.y,f=a.z*a.z,g=a.w*a.w;return void 0===b||"XYZ"===b?(this.x=Math.atan2(2*(a.x*a.w-a.y*a.z),g-d-e+f),this.y=Math.asin(c(2*(a.x*a.z+a.y*a.w))),this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),g+d-e-f)):"YXZ"===b?(this.x=Math.asin(c(2*(a.x*a.w-a.y*a.z))),this.y=Math.atan2(2*(a.x*a.z+a.y*a.w),g-d-e+f),this.z=Math.atan2(2*(a.x*a.y+a.z*a.w),g-d+e-f)):"ZXY"===b?(this.x=Math.asin(c(2*(a.x*a.w+a.y*a.z))),this.y=Math.atan2(2*(a.y*a.w-a.z*a.x),g-d-e+f),this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),g-d+e-f)):"ZYX"===b?(this.x=Math.atan2(2*(a.x*a.w+a.z*a.y),g-d-e+f),this.y=Math.asin(c(2*(a.y*a.w-a.x*a.z))),this.z=Math.atan2(2*(a.x*a.y+a.z*a.w),g+d-e-f)):"YZX"===b?(this.x=Math.atan2(2*(a.x*a.w-a.z*a.y),g-d+e-f),this.y=Math.atan2(2*(a.y*a.w-a.x*a.z),g+d-e-f),this.z=Math.asin(c(2*(a.x*a.y+a.z*a.w)))):"XZY"===b&&(this.x=Math.atan2(2*(a.x*a.w+a.y*a.z),g-d+e-f),this.y=Math.atan2(2*(a.x*a.z+a.y*a.w),g+d-e-f),this.z=Math.asin(c(2*(a.z*a.w-a.x*a.y)))),this},getScaleFromMatrix:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this.x=b,this.y=c,this.z=d,this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new g.Vector3(this.x,this.y,this.z)}}),g.Vector4=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=void 0!==d?d:1},g.extend(g.Vector4.prototype,{set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setW:function(a){return this.w=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=void 0!==a.w?a.w:1,this},add:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},sub:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w,f=a.elements;return this.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,this.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,this.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,this.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,this},divideScalar:function(a){return 0!==a?(this.x/=a,this.y/=a,this.z/=a,this.w/=a):(this.x=0,this.y=0,this.z=0,this.w=1),this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);return 1e-4>b?(this.x=1,this.y=0,this.z=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b),this},setAxisAngleFromRotationMatrix:function(a){var b,c,d,e,f=.01,g=.1,h=a.elements,i=h[0],j=h[4],k=h[8],l=h[1],m=h[5],n=h[9],o=h[2],p=h[6],q=h[10];if(Math.abs(j-l)<f&&Math.abs(k-o)<f&&Math.abs(n-p)<f){if(Math.abs(j+l)<g&&Math.abs(k+o)<g&&Math.abs(n+p)<g&&Math.abs(i+m+q-3)<g)return this.set(1,0,0,0),this;b=Math.PI;var r=(i+1)/2,s=(m+1)/2,t=(q+1)/2,u=(j+l)/4,v=(k+o)/4,w=(n+p)/4;return r>s&&r>t?f>r?(c=0,d=.707106781,e=.707106781):(c=Math.sqrt(r),d=u/c,e=v/c):s>t?f>s?(c=.707106781,d=0,e=.707106781):(d=Math.sqrt(s),c=u/d,e=w/d):f>t?(c=.707106781,d=.707106781,e=0):(e=Math.sqrt(t),c=v/e,d=w/e),this.set(c,d,e,b),this}var x=Math.sqrt((p-n)*(p-n)+(k-o)*(k-o)+(l-j)*(l-j));return Math.abs(x)<.001&&(x=1),this.x=(p-n)/x,this.y=(k-o)/x,this.z=(l-j)/x,this.w=Math.acos((i+m+q-1)/2),this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this.w>a.w&&(this.w=a.w),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this.w<a.w&&(this.w=a.w),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new g.Vector4(this.x,this.y,this.z,this.w)}}),g.Box2=function(a,b){this.min=void 0!==a?a:new g.Vector2(1/0,1/0),this.max=void 0!==b?b:new g.Vector2(-1/0,-1/0)},g.extend(g.Box2.prototype,{set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromPoints:function(a){if(a.length>0){var b=a[0];this.min.copy(b),this.max.copy(b);for(var c=1,d=a.length;d>c;c++)b=a[c],b.x<this.min.x?this.min.x=b.x:b.x>this.max.x&&(this.max.x=b.x),b.y<this.min.y?this.min.y=b.y:b.y>this.max.y&&(this.max.y=b.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var a=new g.Vector2;return function(b,c){var d=a.copy(c).multiplyScalar(.5);return this.min.copy(b).sub(d),this.max.copy(b).add(d),this}}(),copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){var b=a||new g.Vector2;return b.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){var b=a||new g.Vector2;return b.subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a){return new g.Vector2((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){var c=b||new g.Vector2;return c.copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new g.Vector2;return function(b){var c=a.copy(b).clamp(this.min,this.max);return c.sub(b).length()}}(),intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new g.Box2).copy(this)}}),g.Box3=function(a,b){this.min=void 0!==a?a:new g.Vector3(1/0,1/0,1/0),this.max=void 0!==b?b:new g.Vector3(-1/0,-1/0,-1/0)},g.extend(g.Box3.prototype,{set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromPoints:function(a){if(a.length>0){var b=a[0];this.min.copy(b),this.max.copy(b);for(var c=1,d=a.length;d>c;c++)b=a[c],b.x<this.min.x?this.min.x=b.x:b.x>this.max.x&&(this.max.x=b.x),b.y<this.min.y?this.min.y=b.y:b.y>this.max.y&&(this.max.y=b.y),b.z<this.min.z?this.min.z=b.z:b.z>this.max.z&&(this.max.z=b.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var a=new g.Vector3;return function(b,c){var d=a.copy(c).multiplyScalar(.5);return this.min.copy(b).sub(d),this.max.copy(b).add(d),this}}(),copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){var b=a||new g.Vector3;return b.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){var b=a||new g.Vector3;return b.subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a){return new g.Vector3((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},clampPoint:function(a,b){var c=b||new g.Vector3;return c.copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new g.Vector3;return function(b){var c=a.copy(b).clamp(this.min,this.max);return c.sub(b).length()}}(),getBoundingSphere:function(){var a=new g.Vector3;return function(b){var c=b||new g.Sphere;return c.center=this.center(),c.radius=.5*this.size(a).length(),c}}(),intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},applyMatrix4:function(){var a=[new g.Vector3,new g.Vector3,new g.Vector3,new g.Vector3,new g.Vector3,new g.Vector3,new g.Vector3,new g.Vector3];return function(b){return a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b),a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b),a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b),a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b),a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b),a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b),a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b),a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b),this.makeEmpty(),this.setFromPoints(a),this
}}(),translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new g.Box3).copy(this)}}),g.Matrix3=function(a,b,c,d,e,f,g,h,i){this.elements=new Float32Array(9),this.set(void 0!==a?a:1,b||0,c||0,d||0,void 0!==e?e:1,f||0,g||0,h||0,void 0!==i?i:1)},g.extend(g.Matrix3.prototype,{set:function(a,b,c,d,e,f,g,h,i){var j=this.elements;return j[0]=a,j[3]=b,j[6]=c,j[1]=d,j[4]=e,j[7]=f,j[2]=g,j[5]=h,j[8]=i,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(a){var b=a.elements;return this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]),this},multiplyVector3:function(a){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)},multiplyVector3Array:function(){var a=new g.Vector3;return function(b){for(var c=0,d=b.length;d>c;c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h},getInverse:function(a,b){var c=a.elements,d=this.elements;d[0]=c[10]*c[5]-c[6]*c[9],d[1]=-c[10]*c[1]+c[2]*c[9],d[2]=c[6]*c[1]-c[2]*c[5],d[3]=-c[10]*c[4]+c[6]*c[8],d[4]=c[10]*c[0]-c[2]*c[8],d[5]=-c[6]*c[0]+c[2]*c[4],d[6]=c[9]*c[4]-c[5]*c[8],d[7]=-c[9]*c[0]+c[1]*c[8],d[8]=c[5]*c[0]-c[1]*c[4];var e=c[0]*d[0]+c[1]*d[3]+c[2]*d[6];if(0===e){var f="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(f);return console.warn(f),this.identity(),this}return this.multiplyScalar(1/e),this},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this},getNormalMatrix:function(a){return this.getInverse(a).transpose(),this},transposeIntoArray:function(a){var b=this.elements;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this},clone:function(){var a=this.elements;return new g.Matrix3(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8])}}),g.Matrix4=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements=new Float32Array(16);q[0]=void 0!==a?a:1,q[4]=b||0,q[8]=c||0,q[12]=d||0,q[1]=e||0,q[5]=void 0!==f?f:1,q[9]=g||0,q[13]=h||0,q[2]=i||0,q[6]=j||0,q[10]=void 0!==k?k:1,q[14]=l||0,q[3]=m||0,q[7]=n||0,q[11]=o||0,q[15]=void 0!==p?p:1},g.extend(g.Matrix4.prototype,{set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){var b=a.elements;return this.set(b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15]),this},setRotationFromEuler:function(a,b){var c=this.elements,d=a.x,e=a.y,f=a.z,g=Math.cos(d),h=Math.sin(d),i=Math.cos(e),j=Math.sin(e),k=Math.cos(f),l=Math.sin(f);if(void 0===b||"XYZ"===b){var m=g*k,n=g*l,o=h*k,p=h*l;c[0]=i*k,c[4]=-i*l,c[8]=j,c[1]=n+o*j,c[5]=m-p*j,c[9]=-h*i,c[2]=p-m*j,c[6]=o+n*j,c[10]=g*i}else if("YXZ"===b){var q=i*k,r=i*l,s=j*k,t=j*l;c[0]=q+t*h,c[4]=s*h-r,c[8]=g*j,c[1]=g*l,c[5]=g*k,c[9]=-h,c[2]=r*h-s,c[6]=t+q*h,c[10]=g*i}else if("ZXY"===b){var q=i*k,r=i*l,s=j*k,t=j*l;c[0]=q-t*h,c[4]=-g*l,c[8]=s+r*h,c[1]=r+s*h,c[5]=g*k,c[9]=t-q*h,c[2]=-g*j,c[6]=h,c[10]=g*i}else if("ZYX"===b){var m=g*k,n=g*l,o=h*k,p=h*l;c[0]=i*k,c[4]=o*j-n,c[8]=m*j+p,c[1]=i*l,c[5]=p*j+m,c[9]=n*j-o,c[2]=-j,c[6]=h*i,c[10]=g*i}else if("YZX"===b){var u=g*i,v=g*j,w=h*i,x=h*j;c[0]=i*k,c[4]=x-u*l,c[8]=w*l+v,c[1]=l,c[5]=g*k,c[9]=-h*k,c[2]=-j*k,c[6]=v*l+w,c[10]=u-x*l}else if("XZY"===b){var u=g*i,v=g*j,w=h*i,x=h*j;c[0]=i*k,c[4]=-l,c[8]=j*k,c[1]=u*l+x,c[5]=g*k,c[9]=v*l-w,c[2]=w*l-v,c[6]=h*k,c[10]=x*l+u}return this},setRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),this},lookAt:function(){var a=new g.Vector3,b=new g.Vector3,c=new g.Vector3;return function(d,e,f){var g=this.elements;return c.subVectors(d,e).normalize(),0===c.length()&&(c.z=1),a.crossVectors(f,c).normalize(),0===a.length()&&(c.x+=1e-4,a.crossVectors(f,c).normalize()),b.crossVectors(c,a),g[0]=a.x,g[4]=b.x,g[8]=c.x,g[1]=a.y,g[5]=b.y,g[9]=c.y,g[2]=a.z,g[6]=b.z,g[10]=c.z,this}}(),multiply:function(a,b){return void 0!==b?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiplyMatrices(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},multiplyVector3:function(a){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),a.applyProjection(this)},multiplyVector4:function(a){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},multiplyVector3Array:function(){var a=new g.Vector3;return function(b){for(var c=0,d=b.length;d>c;c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyProjection(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),rotateAxis:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return a.x=c*b[0]+d*b[4]+e*b[8],a.y=c*b[1]+d*b[5]+e*b[9],a.z=c*b[2]+d*b[6]+e*b[10],a.normalize(),a},crossVector:function(a){var b=this.elements,c=new g.Vector4;return c.x=b[0]*a.x+b[4]*a.y+b[8]*a.z+b[12]*a.w,c.y=b[1]*a.x+b[5]*a.y+b[9]*a.z+b[13]*a.w,c.z=b[2]*a.x+b[6]*a.y+b[10]*a.z+b[14]*a.w,c.w=a.w?b[3]*a.x+b[7]*a.y+b[11]*a.z+b[15]*a.w:1,c},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14],n=a[3],o=a[7],p=a[11],q=a[15];return n*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+o*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+p*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+q*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},flattenToArray:function(a){var b=this.elements;return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},getPosition:function(){var a=new g.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=d[0]*c[0]+d[1]*c[4]+d[2]*c[8]+d[3]*c[12];if(0==u){var v="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(v);return console.warn(v),this.identity(),this}return this.multiplyScalar(1/u),this},compose:function(){var a=new g.Matrix4,b=new g.Matrix4;return function(c,d,e){var f=this.elements;return a.identity(),a.setRotationFromQuaternion(d),b.makeScale(e.x,e.y,e.z),this.multiplyMatrices(a,b),f[12]=c.x,f[13]=c.y,f[14]=c.z,this}}(),decompose:function(){var a=new g.Vector3,b=new g.Vector3,c=new g.Vector3,d=new g.Matrix4;return function(e,f,h){var i=this.elements;return a.set(i[0],i[1],i[2]),b.set(i[4],i[5],i[6]),c.set(i[8],i[9],i[10]),e=e instanceof g.Vector3?e:new g.Vector3,f=f instanceof g.Quaternion?f:new g.Quaternion,h=h instanceof g.Vector3?h:new g.Vector3,h.x=a.length(),h.y=b.length(),h.z=c.length(),e.x=i[12],e.y=i[13],e.z=i[14],d.copy(this),d.elements[0]/=h.x,d.elements[1]/=h.x,d.elements[2]/=h.x,d.elements[4]/=h.y,d.elements[5]/=h.y,d.elements[6]/=h.y,d.elements[8]/=h.z,d.elements[9]/=h.z,d.elements[10]/=h.z,f.setFromRotationMatrix(d),[e,f,h]}}(),extractPosition:function(a){var b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this},extractRotation:function(){var a=new g.Vector3;return function(b){var c=this.elements,d=b.elements,e=1/a.set(d[0],d[1],d[2]).length(),f=1/a.set(d[4],d[5],d[6]).length(),g=1/a.set(d[8],d[9],d[10]).length();return c[0]=d[0]*e,c[1]=d[1]*e,c[2]=d[2]*e,c[4]=d[4]*f,c[5]=d[5]*f,c[6]=d[6]*f,c[8]=d[8]*g,c[9]=d[9]*g,c[10]=d[10]*g,this}}(),translate:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[12]=b[0]*c+b[4]*d+b[8]*e+b[12],b[13]=b[1]*c+b[5]*d+b[9]*e+b[13],b[14]=b[2]*c+b[6]*d+b[10]*e+b[14],b[15]=b[3]*c+b[7]*d+b[11]*e+b[15],this},rotateX:function(a){var b=this.elements,c=b[4],d=b[5],e=b[6],f=b[7],g=b[8],h=b[9],i=b[10],j=b[11],k=Math.cos(a),l=Math.sin(a);return b[4]=k*c+l*g,b[5]=k*d+l*h,b[6]=k*e+l*i,b[7]=k*f+l*j,b[8]=k*g-l*c,b[9]=k*h-l*d,b[10]=k*i-l*e,b[11]=k*j-l*f,this},rotateY:function(a){var b=this.elements,c=b[0],d=b[1],e=b[2],f=b[3],g=b[8],h=b[9],i=b[10],j=b[11],k=Math.cos(a),l=Math.sin(a);return b[0]=k*c-l*g,b[1]=k*d-l*h,b[2]=k*e-l*i,b[3]=k*f-l*j,b[8]=k*g+l*c,b[9]=k*h+l*d,b[10]=k*i+l*e,b[11]=k*j+l*f,this},rotateZ:function(a){var b=this.elements,c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=Math.cos(a),l=Math.sin(a);return b[0]=k*c+l*g,b[1]=k*d+l*h,b[2]=k*e+l*i,b[3]=k*f+l*j,b[4]=k*g-l*c,b[5]=k*h-l*d,b[6]=k*i-l*e,b[7]=k*j-l*f,this},rotateByAxis:function(a,b){var c=this.elements;if(1===a.x&&0===a.y&&0===a.z)return this.rotateX(b);if(0===a.x&&1===a.y&&0===a.z)return this.rotateY(b);if(0===a.x&&0===a.y&&1===a.z)return this.rotateZ(b);var d=a.x,e=a.y,f=a.z,g=Math.sqrt(d*d+e*e+f*f);d/=g,e/=g,f/=g;var h=d*d,i=e*e,j=f*f,k=Math.cos(b),l=Math.sin(b),m=1-k,n=d*e*m,o=d*f*m,p=e*f*m,q=d*l,r=e*l,s=f*l,t=h+(1-h)*k,u=n+s,v=o-r,w=n-s,x=i+(1-i)*k,y=p+q,z=o+r,A=p-q,B=j+(1-j)*k,C=c[0],D=c[1],E=c[2],F=c[3],G=c[4],H=c[5],I=c[6],J=c[7],K=c[8],L=c[9],M=c[10],N=c[11];return c[0]=t*C+u*G+v*K,c[1]=t*D+u*H+v*L,c[2]=t*E+u*I+v*M,c[3]=t*F+u*J+v*N,c[4]=w*C+x*G+y*K,c[5]=w*D+x*H+y*L,c[6]=w*E+x*I+y*M,c[7]=w*F+x*J+y*N,c[8]=z*C+A*G+B*K,c[9]=z*D+A*H+B*L,c[10]=z*E+A*I+B*M,c[11]=z*F+A*J+B*N,this},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},getMaxScaleOnAxis:function(){var a=this.elements,b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],c=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],d=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(b,Math.max(c,d)))},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},makeFrustum:function(a,b,c,d,e,f){var g=this.elements,h=2*e/(b-a),i=2*e/(d-c),j=(b+a)/(b-a),k=(d+c)/(d-c),l=-(f+e)/(f-e),m=-2*f*e/(f-e);return g[0]=h,g[4]=0,g[8]=j,g[12]=0,g[1]=0,g[5]=i,g[9]=k,g[13]=0,g[2]=0,g[6]=0,g[10]=l,g[14]=m,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this},makePerspective:function(a,b,c,d){var e=c*Math.tan(g.Math.degToRad(.5*a)),f=-e,h=f*b,i=e*b;return this.makeFrustum(h,i,f,e,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=b-a,i=c-d,j=f-e,k=(b+a)/h,l=(c+d)/i,m=(f+e)/j;return g[0]=2/h,g[4]=0,g[8]=0,g[12]=-k,g[1]=0,g[5]=2/i,g[9]=0,g[13]=-l,g[2]=0,g[6]=0,g[10]=-2/j,g[14]=-m,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this},clone:function(){var a=this.elements;return new g.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])}}),g.Ray=function(a,b){this.origin=void 0!==a?a:new g.Vector3,this.direction=void 0!==b?b:new g.Vector3},g.extend(g.Ray.prototype,{set:function(a,b){return this.origin.copy(a),this.direction.copy(b),this},copy:function(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this},at:function(a,b){var c=b||new g.Vector3;return c.copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new g.Vector3;return function(b){return this.origin.copy(this.at(b,a)),this}}(),closestPointToPoint:function(a,b){var c=b||new g.Vector3;c.subVectors(a,this.origin);var d=c.dot(this.direction);return c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(){var a=new g.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);return a.copy(this.direction).multiplyScalar(c).add(this.origin),a.distanceTo(b)}}(),isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},isIntersectionPlane:function(a){var b=a.normal.dot(this.direction);return 0!=b?!0:0==a.distanceToPoint(this.origin)?!0:!1},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?0:void 0;var c=-(this.origin.dot(a.normal)+a.constant)/b;return c},intersectPlane:function(a,b){var c=this.distanceToPlane(a);return void 0===c?void 0:this.at(c,b)},applyMatrix4:function(a){return this.direction.add(this.origin).applyMatrix4(a),this.origin.applyMatrix4(a),this.direction.sub(this.origin),this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new g.Ray).copy(this)}}),g.Sphere=function(a,b){this.center=void 0!==a?a:new g.Vector3,this.radius=void 0!==b?b:0},g.extend(g.Sphere.prototype,{set:function(a,b){return this.center.copy(a),this.radius=b,this},setFromCenterAndPoints:function(a,b){for(var c=0,d=0,e=b.length;e>d;d++){var f=a.distanceToSquared(b[d]);c=Math.max(c,f)}return this.center=a,this.radius=Math.sqrt(c),this},copy:function(a){return this.center.copy(a.center),this.radius=a.radius,this},empty:function(){return this.radius<=0},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a),d=b||new g.Vector3;return d.copy(a),c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center)),d},getBoundingBox:function(a){var b=a||new g.Box3;return b.set(this.center,this.center),b.expandByScalar(this.radius),b},applyMatrix4:function(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this},translate:function(a){return this.center.add(a),this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new g.Sphere).copy(this)}}),g.Frustum=function(a,b,c,d,e,f){this.planes=[void 0!==a?a:new g.Plane,void 0!==b?b:new g.Plane,void 0!==c?c:new g.Plane,void 0!==d?d:new g.Plane,void 0!==e?e:new g.Plane,void 0!==f?f:new g.Plane]},g.extend(g.Frustum.prototype,{set:function(a,b,c,d,e,f){var g=this.planes;return g[0].copy(a),g[1].copy(b),g[2].copy(c),g[3].copy(d),g[4].copy(e),g[5].copy(f),this},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=c[9],n=c[10],o=c[11],p=c[12],q=c[13],r=c[14],s=c[15];return b[0].setComponents(g-d,k-h,o-l,s-p).normalize(),b[1].setComponents(g+d,k+h,o+l,s+p).normalize(),b[2].setComponents(g+e,k+i,o+m,s+q).normalize(),b[3].setComponents(g-e,k-i,o-m,s-q).normalize(),b[4].setComponents(g-f,k-j,o-n,s-r).normalize(),b[5].setComponents(g+f,k+j,o+n,s+r).normalize(),this},intersectsObject:function(){var a=new g.Vector3;return function(b){var c=b.matrixWorld,d=this.planes,e=-b.geometry.boundingSphere.radius*c.getMaxScaleOnAxis();a.getPositionFromMatrix(c);for(var f=0;6>f;f++){var g=d[f].distanceToPoint(a);if(e>g)return!1}return!0}}(),intersectsSphere:function(a){for(var b=this.planes,c=a.center,d=-a.radius,e=0;6>e;e++){var f=b[e].distanceToPoint(c);if(d>f)return!1}return!0},containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(b[c].distanceToPoint(a)<0)return!1;return!0},clone:function(){return(new g.Frustum).copy(this)}}),g.Plane=function(a,b){this.normal=void 0!==a?a:new g.Vector3(1,0,0),this.constant=void 0!==b?b:0},g.extend(g.Plane.prototype,{set:function(a,b){return this.normal.copy(a),this.constant=b,this},setComponents:function(a,b,c,d){return this.normal.set(a,b,c),this.constant=d,this},setFromNormalAndCoplanarPoint:function(a,b){return this.normal.copy(a),this.constant=-b.dot(this.normal),this},setFromCoplanarPoints:function(){var a=new g.Vector3,b=new g.Vector3;return function(c,d,e){var f=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();return this.setFromNormalAndCoplanarPoint(f,c),this}}(),copy:function(a){return this.normal.copy(a.normal),this.constant=a.constant,this},normalize:function(){var a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a),d=b||new g.Vector3;return d.copy(this.normal).multiplyScalar(c)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start),c=this.distanceToPoint(a.end);return 0>b&&c>0||0>c&&b>0},intersectLine:function(){var a=new g.Vector3;return function(b,c){var d=c||new g.Vector3,e=b.delta(a),f=this.normal.dot(e);if(0==f)return 0==this.distanceToPoint(b.start)?d.copy(b.start):void 0;var h=-(b.start.dot(this.normal)+this.constant)/f;return 0>h||h>1?void 0:d.copy(e).multiplyScalar(h).add(b.start)}}(),coplanarPoint:function(a){var b=a||new g.Vector3;return b.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new g.Vector3,b=new g.Vector3;return function(c,d){d=d||(new g.Matrix3).getInverse(c).transpose();var e=a.copy(this.normal).applyMatrix3(d),f=this.coplanarPoint(b);return f.applyMatrix4(c),this.setFromNormalAndCoplanarPoint(e,f),this}}(),translate:function(a){return this.constant=this.constant-a.dot(this.normal),this},equals:function(a){return a.normal.equals(this.normal)&&a.constant==this.constant},clone:function(){return(new g.Plane).copy(this)}}),g.Math={clamp:function(a,b,c){return b>a?b:a>c?c:a},clampBottom:function(a,b){return b>a?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){return b>=a?0:a>=c?1:(a=(a-b)/(c-b),a*a*(3-2*a))},smootherstep:function(a,b,c){return b>=a?0:a>=c?1:(a=(a-b)/(c-b),a*a*a*(a*(6*a-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},sign:function(a){return 0>a?-1:a>0?1:0},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=180/Math.PI;return function(b){return b*a}}()},g.Spline=function(a){function b(a,b,c,d,e,f,g){var h=.5*(c-a),i=.5*(d-b);return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b}this.points=a;var c,d,e,f,h,i,j,k,l,m=[],n={x:0,y:0,z:0};this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}},this.getPoint=function(a){return c=(this.points.length-1)*a,d=Math.floor(c),e=c-d,m[0]=0===d?d:d-1,m[1]=d,m[2]=d>this.points.length-2?this.points.length-1:d+1,m[3]=d>this.points.length-3?this.points.length-1:d+2,i=this.points[m[0]],j=this.points[m[1]],k=this.points[m[2]],l=this.points[m[3]],f=e*e,h=e*f,n.x=b(i.x,j.x,k.x,l.x,e,f,h),n.y=b(i.y,j.y,k.y,l.y,e,f,h),n.z=b(i.z,j.z,k.z,l.z,e,f,h),n},this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;c>a;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d},this.getLength=function(a){var b,c,d,e,f=0,h=0,i=0,j=new g.Vector3,k=new g.Vector3,l=[],m=0;for(l[0]=0,a||(a=100),d=this.points.length*a,j.copy(this.points[0]),b=1;d>b;b++)c=b/d,e=this.getPoint(c),k.copy(e),m+=k.distanceTo(j),j.copy(e),f=(this.points.length-1)*c,h=Math.floor(f),h!=i&&(l[h]=m,i=h);return l[l.length]=m,{chunks:l,total:m}},this.reparametrizeByArcLength=function(a){var b,c,d,e,f,h,i,j,k=[],l=new g.Vector3,m=this.getLength();for(k.push(l.copy(this.points[0]).clone()),b=1;b<this.points.length;b++){for(h=m.chunks[b]-m.chunks[b-1],i=Math.ceil(a*h/m.total),e=(b-1)/(this.points.length-1),f=b/(this.points.length-1),c=1;i-1>c;c++)d=e+c*(1/i)*(f-e),j=this.getPoint(d),k.push(l.copy(j).clone());k.push(l.copy(this.points[b]).clone())}this.points=k}},g.Triangle=function(a,b,c){this.a=void 0!==a?a:new g.Vector3,this.b=void 0!==b?b:new g.Vector3,this.c=void 0!==c?c:new g.Vector3},g.Triangle.normal=function(){var a=new g.Vector3;return function(b,c,d,e){var f=e||new g.Vector3;f.subVectors(d,c),a.subVectors(b,c),f.cross(a);var h=f.lengthSq();return h>0?f.multiplyScalar(1/Math.sqrt(h)):f.set(0,0,0)}}(),g.Triangle.barycoordFromPoint=function(){var a=new g.Vector3,b=new g.Vector3,c=new g.Vector3;return function(d,e,f,h,i){a.subVectors(h,e),b.subVectors(f,e),c.subVectors(d,e);var j=a.dot(a),k=a.dot(b),l=a.dot(c),m=b.dot(b),n=b.dot(c),o=j*m-k*k,p=i||new g.Vector3;if(0==o)return p.set(-2,-1,-1);var q=1/o,r=(m*l-k*n)*q,s=(j*n-k*l)*q;return p.set(1-r-s,s,r)}}(),g.Triangle.containsPoint=function(){var a=new g.Vector3;return function(b,c,d,e){var f=g.Triangle.barycoordFromPoint(b,c,d,e,a);return f.x>=0&&f.y>=0&&f.x+f.y<=1}}(),g.extend(g.Triangle.prototype,{constructor:g.Triangle,set:function(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this},setFromPointsAndIndices:function(a,b,c,d){return this.a.copy(a[b]),this.b.copy(a[c]),this.c.copy(a[d]),this},copy:function(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this},area:function(){var a=new g.Vector3,b=new g.Vector3;return function(){return a.subVectors(this.c,this.b),b.subVectors(this.a,this.b),.5*a.cross(b).length()}}(),midpoint:function(a){var b=a||new g.Vector3;return b.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return g.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){var b=a||new g.Plane;return b.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return g.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return g.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},clone:function(){return(new g.Triangle).copy(this)}}),g.Vertex=function(a){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),a},g.UV=function(a,b){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new g.Vector2(a,b)},g.Clock=function(a){this.autoStart=void 0!==a?a:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},g.extend(g.Clock.prototype,{start:function(){this.startTime=void 0!==e.performance&&void 0!==e.performance.now?e.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var a=0;if(this.autoStart&&!this.running&&this.start(),this.running){var b=void 0!==e.performance&&void 0!==e.performance.now?e.performance.now():Date.now();a=.001*(b-this.oldTime),this.oldTime=b,this.elapsedTime+=a}return a}}),g.EventDispatcher=function(){var a={};this.addEventListener=function(b,c){void 0===a[b]&&(a[b]=[]),-1===a[b].indexOf(c)&&a[b].push(c)},this.removeEventListener=function(b,c){var d=a[b].indexOf(c);-1!==d&&a[b].splice(d,1)},this.dispatchEvent=function(b){var c=a[b.type];if(void 0!==c){b.target=this;for(var d=0,e=c.length;e>d;d++)c[d].call(this,b)}}},function(a){a.Raycaster=function(b,c,d,e){this.ray=new a.Ray(b,c),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=d||0,this.far=e||1/0};var b=new a.Sphere,c=new a.Ray,d=new a.Plane,e=new a.Vector3,f=new a.Vector3,g=new a.Matrix4,h=function(a,b){return a.distance-b.distance},i=function(h,i,j){if(h instanceof a.Particle){f.getPositionFromMatrix(h.matrixWorld);var k=i.ray.distanceToPoint(f);if(k>h.scale.x)return j;j.push({distance:k,point:h.position,face:null,object:h})}else if(h instanceof a.Mesh){if(f.getPositionFromMatrix(h.matrixWorld),b.set(f,h.geometry.boundingSphere.radius*h.matrixWorld.getMaxScaleOnAxis()),!i.ray.isIntersectionSphere(b))return j;var l,m,n,o,p=h.geometry,q=p.vertices,r=h.material instanceof a.MeshFaceMaterial,s=r===!0?h.material.materials:null,t=h.material.side,u=i.precision;h.matrixRotationWorld.extractRotation(h.matrixWorld),g.getInverse(h.matrixWorld),c.copy(i.ray).applyMatrix4(g);for(var v=0,w=p.faces.length;w>v;v++){var x=p.faces[v],y=r===!0?s[x.materialIndex]:h.material;if(void 0!==y){d.setFromNormalAndCoplanarPoint(x.normal,q[x.a]);var z=c.distanceToPlane(d);if(!(Math.abs(z)<u||0>z)){if(t=y.side,t!==a.DoubleSide){var A=c.direction.dot(d.normal);if(!(t===a.FrontSide?0>A:A>0))continue}if(!(z<i.near||z>i.far)){if(e=c.at(z,e),x instanceof a.Face3){if(l=q[x.a],m=q[x.b],n=q[x.c],!a.Triangle.containsPoint(e,l,m,n))continue}else{if(!(x instanceof a.Face4))throw Error("face type not supported");if(l=q[x.a],m=q[x.b],n=q[x.c],o=q[x.d],!a.Triangle.containsPoint(e,l,m,o)&&!a.Triangle.containsPoint(e,m,n,o))continue}j.push({distance:z,point:i.ray.at(z),face:x,faceIndex:v,object:h})}}}}}},j=function(a,b,c){for(var d=a.getDescendants(),e=0,f=d.length;f>e;e++)i(d[e],b,c)};a.Raycaster.prototype.precision=1e-4,a.Raycaster.prototype.set=function(a,b){this.ray.set(a,b),this.ray.direction.length()>0&&this.ray.direction.normalize()},a.Raycaster.prototype.intersectObject=function(a,b){var c=[];return b===!0&&j(a,this,c),i(a,this,c),c.sort(h),c},a.Raycaster.prototype.intersectObjects=function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)i(a[d],this,c),b===!0&&j(a[d],this,c);return c.sort(h),c}}(g),g.Object3D=function(){this.id=g.Object3DIdCount++,this.name="",this.properties={},this.parent=void 0,this.children=[],this.up=new g.Vector3(0,1,0),this.position=new g.Vector3,this.rotation=new g.Vector3,this.eulerOrder=g.Object3D.defaultEulerOrder,this.scale=new g.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new g.Matrix4,this.matrixWorld=new g.Matrix4,this.matrixRotationWorld=new g.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.quaternion=new g.Quaternion,this.useQuaternion=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this._vector=new g.Vector3},g.Object3D.prototype={constructor:g.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix),this.scale.getScaleFromMatrix(this.matrix);var b=(new g.Matrix4).extractRotation(this.matrix);this.rotation.setEulerFromRotationMatrix(b,this.eulerOrder),this.position.getPositionFromMatrix(this.matrix)},translate:function(a,b){this.matrix.rotateAxis(b),this.position.add(b.multiplyScalar(a))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(a){return a.applyMatrix4(g.Object3D.__m1.getInverse(this.matrixWorld))},lookAt:function(a){this.matrix.lookAt(a,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},add:function(a){if(a===this)return console.warn("THREE.Object3D.add: An object can't be added as a child of itself."),void 0;if(a instanceof g.Object3D){void 0!==a.parent&&a.parent.remove(a),a.parent=this,this.children.push(a);for(var b=this;void 0!==b.parent;)b=b.parent;void 0!==b&&b instanceof g.Scene&&b.__addObject(a)}},remove:function(a){var b=this.children.indexOf(a);if(-1!==b){a.parent=void 0,this.children.splice(b,1);for(var c=this;void 0!==c.parent;)c=c.parent;void 0!==c&&c instanceof g.Scene&&c.__removeObject(a)}},traverse:function(a){a(this);for(var b=0,c=this.children.length;c>b;b++)this.children[b].traverse(a)},getChildByName:function(a,b){for(var c=0,d=this.children.length;d>c;c++){var e=this.children[c];if(e.name===a)return e;if(b===!0&&(e=e.getChildByName(a,b),void 0!==e))return e}return void 0},getDescendants:function(a){void 0===a&&(a=[]),Array.prototype.push.apply(a,this.children);for(var b=0,c=this.children.length;c>b;b++)this.children[b].getDescendants(a);return a},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(1!==this.scale.x||1!==this.scale.y||1!==this.scale.z)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||a===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);
for(var b=0,c=this.children.length;c>b;b++)this.children[b].updateMatrixWorld(a)},clone:function(a){void 0===a&&(a=new g.Object3D),a.name=this.name,a.up.copy(this.up),a.position.copy(this.position),a.rotation instanceof g.Vector3&&a.rotation.copy(this.rotation),a.eulerOrder=this.eulerOrder,a.scale.copy(this.scale),a.renderDepth=this.renderDepth,a.rotationAutoUpdate=this.rotationAutoUpdate,a.matrix.copy(this.matrix),a.matrixWorld.copy(this.matrixWorld),a.matrixRotationWorld.copy(this.matrixRotationWorld),a.matrixAutoUpdate=this.matrixAutoUpdate,a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,a.quaternion.copy(this.quaternion),a.useQuaternion=this.useQuaternion,a.visible=this.visible,a.castShadow=this.castShadow,a.receiveShadow=this.receiveShadow,a.frustumCulled=this.frustumCulled;for(var b=0;b<this.children.length;b++){var c=this.children[b];a.add(c.clone())}return a}},g.Object3D.__m1=new g.Matrix4,g.Object3D.defaultEulerOrder="XYZ",g.Object3DIdCount=0,g.Projector=function(){function a(){if(k===w){var a=new g.RenderableObject;return v.push(a),w++,k++,a}return v[k++]}function b(){if(m===y){var a=new g.RenderableVertex;return x.push(a),y++,m++,a}return x[m++]}function c(){if(o===A){var a=new g.RenderableFace3;return z.push(a),A++,o++,a}return z[o++]}function d(){if(p===C){var a=new g.RenderableFace4;return B.push(a),C++,p++,a}return B[p++]}function e(){if(r===E){var a=new g.RenderableLine;return D.push(a),E++,r++,a}return D[r++]}function f(){if(t===G){var a=new g.RenderableParticle;return F.push(a),G++,t++,a}return F[t++]}function h(a,b){return b.z-a.z}function i(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;return e>=0&&f>=0&&g>=0&&h>=0?!0:0>e&&0>f||0>g&&0>h?!1:(0>e?c=Math.max(c,e/(e-f)):0>f&&(d=Math.min(d,e/(e-f))),0>g?c=Math.max(c,g/(g-h)):0>h&&(d=Math.min(d,g/(g-h))),c>d?!1:(a.lerp(b,c),b.lerp(a,1-d),!0))}var j,k,l,m,n,o,p,q,r,s,t,u,v=[],w=0,x=[],y=0,z=[],A=0,B=[],C=0,D=[],E=0,F=[],G=0,H={objects:[],sprites:[],lights:[],elements:[]},I=new g.Vector3,J=new g.Vector4,K=new g.Box3(new g.Vector3(-1,-1,-1),new g.Vector3(1,1,1)),L=new g.Box3,M=new Array(3),N=new Array(4),O=new g.Matrix4,P=new g.Matrix4,Q=new g.Matrix4,R=new g.Matrix3,S=new g.Matrix3,T=new g.Vector3,U=new g.Frustum,V=new g.Vector4,W=new g.Vector4;this.projectVector=function(a,b){return b.matrixWorldInverse.getInverse(b.matrixWorld),P.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),a.applyProjection(P)},this.unprojectVector=function(a,b){return b.projectionMatrixInverse.getInverse(b.projectionMatrix),P.multiplyMatrices(b.matrixWorld,b.projectionMatrixInverse),a.applyProjection(P)},this.pickingRay=function(a,b){a.z=-1;var c=new g.Vector3(a.x,a.y,1);return this.unprojectVector(a,b),this.unprojectVector(c,b),c.sub(a).normalize(),new g.Raycaster(a,c)};var X=function(b,c){k=0,H.objects.length=0,H.sprites.length=0,H.lights.length=0;var d=function(b){for(var c=0,e=b.children.length;e>c;c++){var f=b.children[c];f.visible!==!1&&(f instanceof g.Light?H.lights.push(f):f instanceof g.Mesh||f instanceof g.Line?(f.frustumCulled===!1||U.intersectsObject(f)===!0)&&(j=a(),j.object=f,null!==f.renderDepth?j.z=f.renderDepth:(I.getPositionFromMatrix(f.matrixWorld),I.applyProjection(P),j.z=I.z),H.objects.push(j)):f instanceof g.Sprite||f instanceof g.Particle?(j=a(),j.object=f,null!==f.renderDepth?j.z=f.renderDepth:(I.getPositionFromMatrix(f.matrixWorld),I.applyProjection(P),j.z=I.z),H.sprites.push(j)):(j=a(),j.object=f,null!==f.renderDepth?j.z=f.renderDepth:(I.getPositionFromMatrix(f.matrixWorld),I.applyProjection(P),j.z=I.z),H.objects.push(j)),d(f))}};return d(b),c===!0&&H.objects.sort(h),H};this.projectScene=function(a,j,k,v){var w,y,z,A,B,C,D,E,F,G,I,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb=!1;for(o=0,p=0,r=0,t=0,H.elements.length=0,a.updateMatrixWorld(),void 0===j.parent&&j.updateMatrixWorld(),O.copy(j.matrixWorldInverse.getInverse(j.matrixWorld)),P.multiplyMatrices(j.projectionMatrix,O),S.getInverse(O),S.transpose(),U.setFromMatrix(P),H=X(a,k),w=0,y=H.objects.length;y>w;w++)if(Z=H.objects[w].object,u=Z.matrixWorld,m=0,Z instanceof g.Mesh){for($=Z.geometry,_=$.vertices,ab=$.faces,db=$.faceVertexUvs,R.getInverse(u),R.transpose(),jb=Z.material instanceof g.MeshFaceMaterial,kb=jb===!0?Z.material:null,z=0,A=_.length;A>z;z++)l=b(),l.positionWorld.copy(_[z]).applyMatrix4(u),l.positionScreen.copy(l.positionWorld).applyMatrix4(P),l.positionScreen.x/=l.positionScreen.w,l.positionScreen.y/=l.positionScreen.w,l.positionScreen.z/=l.positionScreen.w,l.visible=!(l.positionScreen.x<-1||l.positionScreen.x>1||l.positionScreen.y<-1||l.positionScreen.y>1||l.positionScreen.z<-1||l.positionScreen.z>1);for(B=0,C=ab.length;C>B;B++){bb=ab[B];var mb=jb===!0?kb.materials[bb.materialIndex]:Z.material;if(void 0!==mb){var nb=mb.side;if(bb instanceof g.Face3){if(fb=x[bb.a],gb=x[bb.b],hb=x[bb.c],M[0]=fb.positionScreen,M[1]=gb.positionScreen,M[2]=hb.positionScreen,fb.visible!==!0&&gb.visible!==!0&&hb.visible!==!0&&!K.isIntersectionBox(L.setFromPoints(M)))continue;if(lb=(hb.positionScreen.x-fb.positionScreen.x)*(gb.positionScreen.y-fb.positionScreen.y)-(hb.positionScreen.y-fb.positionScreen.y)*(gb.positionScreen.x-fb.positionScreen.x)<0,nb!==g.DoubleSide&&lb!==(nb===g.FrontSide))continue;n=c(),n.v1.copy(fb),n.v2.copy(gb),n.v3.copy(hb)}else if(bb instanceof g.Face4){if(fb=x[bb.a],gb=x[bb.b],hb=x[bb.c],ib=x[bb.d],N[0]=fb.positionScreen,N[1]=gb.positionScreen,N[2]=hb.positionScreen,N[3]=ib.positionScreen,fb.visible!==!0&&gb.visible!==!0&&hb.visible!==!0&&ib.visible!==!0&&!K.isIntersectionBox(L.setFromPoints(N)))continue;if(lb=(ib.positionScreen.x-fb.positionScreen.x)*(gb.positionScreen.y-fb.positionScreen.y)-(ib.positionScreen.y-fb.positionScreen.y)*(gb.positionScreen.x-fb.positionScreen.x)<0||(gb.positionScreen.x-hb.positionScreen.x)*(ib.positionScreen.y-hb.positionScreen.y)-(gb.positionScreen.y-hb.positionScreen.y)*(ib.positionScreen.x-hb.positionScreen.x)<0,nb!==g.DoubleSide&&lb!==(nb===g.FrontSide))continue;n=d(),n.v1.copy(fb),n.v2.copy(gb),n.v3.copy(hb),n.v4.copy(ib)}for(n.normalModel.copy(bb.normal),lb!==!1||nb!==g.BackSide&&nb!==g.DoubleSide||n.normalModel.negate(),n.normalModel.applyMatrix3(R).normalize(),n.normalModelView.copy(n.normalModel).applyMatrix3(S),n.centroidModel.copy(bb.centroid).applyMatrix4(u),cb=bb.vertexNormals,D=0,E=cb.length;E>D;D++){var ob=n.vertexNormalsModel[D];ob.copy(cb[D]),lb!==!1||nb!==g.BackSide&&nb!==g.DoubleSide||ob.negate(),ob.applyMatrix3(R).normalize();var pb=n.vertexNormalsModelView[D];pb.copy(ob).applyMatrix3(S)}for(n.vertexNormalsLength=cb.length,F=0,G=db.length;G>F;F++)if(eb=db[F][B],void 0!==eb)for(I=0,Y=eb.length;Y>I;I++)n.uvs[F][I]=eb[I];n.color=bb.color,n.material=mb,T.copy(n.centroidModel).applyProjection(P),n.z=T.z,H.elements.push(n)}}}else if(Z instanceof g.Line){Q.multiplyMatrices(P,u),_=Z.geometry.vertices,fb=b(),fb.positionScreen.copy(_[0]).applyMatrix4(Q);var qb=Z.type===g.LinePieces?2:1;for(z=1,A=_.length;A>z;z++)fb=b(),fb.positionScreen.copy(_[z]).applyMatrix4(Q),(z+1)%qb>0||(gb=x[m-2],V.copy(fb.positionScreen),W.copy(gb.positionScreen),i(V,W)===!0&&(V.multiplyScalar(1/V.w),W.multiplyScalar(1/W.w),q=e(),q.v1.positionScreen.copy(V),q.v2.positionScreen.copy(W),q.z=Math.max(V.z,W.z),q.material=Z.material,H.elements.push(q)))}for(w=0,y=H.sprites.length;y>w;w++)Z=H.sprites[w].object,u=Z.matrixWorld,Z instanceof g.Particle&&(J.set(u.elements[12],u.elements[13],u.elements[14],1),J.applyMatrix4(P),J.z/=J.w,J.z>0&&J.z<1&&(s=f(),s.object=Z,s.x=J.x/J.w,s.y=J.y/J.w,s.z=J.z,s.rotation=Z.rotation.z,s.scale.x=Z.scale.x*Math.abs(s.x-(J.x+j.projectionMatrix.elements[0])/(J.w+j.projectionMatrix.elements[12])),s.scale.y=Z.scale.y*Math.abs(s.y-(J.y+j.projectionMatrix.elements[5])/(J.w+j.projectionMatrix.elements[13])),s.material=Z.material,H.elements.push(s)));return v===!0&&H.elements.sort(h),H}},g.Face3=function(a,b,c,d,e,f){this.a=a,this.b=b,this.c=c,this.normal=d instanceof g.Vector3?d:new g.Vector3,this.vertexNormals=d instanceof Array?d:[],this.color=e instanceof g.Color?e:new g.Color,this.vertexColors=e instanceof Array?e:[],this.vertexTangents=[],this.materialIndex=void 0!==f?f:0,this.centroid=new g.Vector3},g.Face3.prototype={constructor:g.Face3,clone:function(){var a=new g.Face3(this.a,this.b,this.c);a.normal.copy(this.normal),a.color.copy(this.color),a.centroid.copy(this.centroid),a.materialIndex=this.materialIndex;var b,c;for(b=0,c=this.vertexNormals.length;c>b;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();for(b=0,c=this.vertexColors.length;c>b;b++)a.vertexColors[b]=this.vertexColors[b].clone();for(b=0,c=this.vertexTangents.length;c>b;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}},g.Face4=function(a,b,c,d,e,f,h){this.a=a,this.b=b,this.c=c,this.d=d,this.normal=e instanceof g.Vector3?e:new g.Vector3,this.vertexNormals=e instanceof Array?e:[],this.color=f instanceof g.Color?f:new g.Color,this.vertexColors=f instanceof Array?f:[],this.vertexTangents=[],this.materialIndex=void 0!==h?h:0,this.centroid=new g.Vector3},g.Face4.prototype={constructor:g.Face4,clone:function(){var a=new g.Face4(this.a,this.b,this.c,this.d);a.normal.copy(this.normal),a.color.copy(this.color),a.centroid.copy(this.centroid),a.materialIndex=this.materialIndex;var b,c;for(b=0,c=this.vertexNormals.length;c>b;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();for(b=0,c=this.vertexColors.length;c>b;b++)a.vertexColors[b]=this.vertexColors[b].clone();for(b=0,c=this.vertexTangents.length;c>b;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}},g.Geometry=function(){g.EventDispatcher.call(this),this.id=g.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},g.Geometry.prototype={constructor:g.Geometry,applyMatrix:function(a){for(var b=(new g.Matrix3).getInverse(a).transpose(),c=0,d=this.vertices.length;d>c;c++){var e=this.vertices[c];e.applyMatrix4(a)}for(var c=0,d=this.faces.length;d>c;c++){var f=this.faces[c];f.normal.applyMatrix3(b).normalize();for(var h=0,i=f.vertexNormals.length;i>h;h++)f.vertexNormals[h].applyMatrix3(b).normalize();f.centroid.applyMatrix4(a)}},computeCentroids:function(){var a,b,c;for(a=0,b=this.faces.length;b>a;a++)c=this.faces[a],c.centroid.set(0,0,0),c instanceof g.Face3?(c.centroid.add(this.vertices[c.a]),c.centroid.add(this.vertices[c.b]),c.centroid.add(this.vertices[c.c]),c.centroid.divideScalar(3)):c instanceof g.Face4&&(c.centroid.add(this.vertices[c.a]),c.centroid.add(this.vertices[c.b]),c.centroid.add(this.vertices[c.c]),c.centroid.add(this.vertices[c.d]),c.centroid.divideScalar(4))},computeFaceNormals:function(){for(var a=new g.Vector3,b=new g.Vector3,c=0,d=this.faces.length;d>c;c++){var e=this.faces[c],f=this.vertices[e.a],h=this.vertices[e.b],i=this.vertices[e.c];a.subVectors(i,h),b.subVectors(f,h),a.cross(b),a.normalize(),e.normal.copy(a)}},computeVertexNormals:function(a){var b,c,d,e,f,h;if(void 0===this.__tmpVertices){for(this.__tmpVertices=new Array(this.vertices.length),h=this.__tmpVertices,b=0,c=this.vertices.length;c>b;b++)h[b]=new g.Vector3;for(d=0,e=this.faces.length;e>d;d++)f=this.faces[d],f instanceof g.Face3?f.vertexNormals=[new g.Vector3,new g.Vector3,new g.Vector3]:f instanceof g.Face4&&(f.vertexNormals=[new g.Vector3,new g.Vector3,new g.Vector3,new g.Vector3])}else for(h=this.__tmpVertices,b=0,c=this.vertices.length;c>b;b++)h[b].set(0,0,0);if(a){var i,j,k,l,m=new g.Vector3,n=new g.Vector3,o=new g.Vector3,p=new g.Vector3,q=new g.Vector3;for(d=0,e=this.faces.length;e>d;d++)f=this.faces[d],f instanceof g.Face3?(i=this.vertices[f.a],j=this.vertices[f.b],k=this.vertices[f.c],m.subVectors(k,j),n.subVectors(i,j),m.cross(n),h[f.a].add(m),h[f.b].add(m),h[f.c].add(m)):f instanceof g.Face4&&(i=this.vertices[f.a],j=this.vertices[f.b],k=this.vertices[f.c],l=this.vertices[f.d],o.subVectors(l,j),n.subVectors(i,j),o.cross(n),h[f.a].add(o),h[f.b].add(o),h[f.d].add(o),p.subVectors(l,k),q.subVectors(j,k),p.cross(q),h[f.b].add(p),h[f.c].add(p),h[f.d].add(p))}else for(d=0,e=this.faces.length;e>d;d++)f=this.faces[d],f instanceof g.Face3?(h[f.a].add(f.normal),h[f.b].add(f.normal),h[f.c].add(f.normal)):f instanceof g.Face4&&(h[f.a].add(f.normal),h[f.b].add(f.normal),h[f.c].add(f.normal),h[f.d].add(f.normal));for(b=0,c=this.vertices.length;c>b;b++)h[b].normalize();for(d=0,e=this.faces.length;e>d;d++)f=this.faces[d],f instanceof g.Face3?(f.vertexNormals[0].copy(h[f.a]),f.vertexNormals[1].copy(h[f.b]),f.vertexNormals[2].copy(h[f.c])):f instanceof g.Face4&&(f.vertexNormals[0].copy(h[f.a]),f.vertexNormals[1].copy(h[f.b]),f.vertexNormals[2].copy(h[f.c]),f.vertexNormals[3].copy(h[f.d]))},computeMorphNormals:function(){var a,b,c,d,e;for(c=0,d=this.faces.length;d>c;c++)for(e=this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]),a=0,b=e.vertexNormals.length;b>a;a++)e.__originalVertexNormals[a]?e.__originalVertexNormals[a].copy(e.vertexNormals[a]):e.__originalVertexNormals[a]=e.vertexNormals[a].clone();var f=new g.Geometry;for(f.faces=this.faces,a=0,b=this.morphTargets.length;b>a;a++){if(!this.morphNormals[a]){this.morphNormals[a]={},this.morphNormals[a].faceNormals=[],this.morphNormals[a].vertexNormals=[];var h,i,j=this.morphNormals[a].faceNormals,k=this.morphNormals[a].vertexNormals;for(c=0,d=this.faces.length;d>c;c++)e=this.faces[c],h=new g.Vector3,i=e instanceof g.Face3?{a:new g.Vector3,b:new g.Vector3,c:new g.Vector3}:{a:new g.Vector3,b:new g.Vector3,c:new g.Vector3,d:new g.Vector3},j.push(h),k.push(i)}var l=this.morphNormals[a];f.vertices=this.morphTargets[a].vertices,f.computeFaceNormals(),f.computeVertexNormals();var h,i;for(c=0,d=this.faces.length;d>c;c++)e=this.faces[c],h=l.faceNormals[c],i=l.vertexNormals[c],h.copy(e.normal),e instanceof g.Face3?(i.a.copy(e.vertexNormals[0]),i.b.copy(e.vertexNormals[1]),i.c.copy(e.vertexNormals[2])):(i.a.copy(e.vertexNormals[0]),i.b.copy(e.vertexNormals[1]),i.c.copy(e.vertexNormals[2]),i.d.copy(e.vertexNormals[3]))}for(c=0,d=this.faces.length;d>c;c++)e=this.faces[c],e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeTangents:function(){function a(a,b,c,d,e,f,g){k=a.vertices[b],l=a.vertices[c],m=a.vertices[d],n=j[e],o=j[f],p=j[g],q=l.x-k.x,r=m.x-k.x,s=l.y-k.y,t=m.y-k.y,u=l.z-k.z,v=m.z-k.z,w=o.x-n.x,x=p.x-n.x,y=o.y-n.y,z=p.y-n.y,A=1/(w*z-x*y),G.set((z*q-y*r)*A,(z*s-y*t)*A,(z*u-y*v)*A),H.set((w*r-x*q)*A,(w*t-x*s)*A,(w*v-x*u)*A),E[b].add(G),E[c].add(G),E[d].add(G),F[b].add(H),F[c].add(H),F[d].add(H)}var b,c,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=[],F=[],G=new g.Vector3,H=new g.Vector3,I=new g.Vector3,J=new g.Vector3,K=new g.Vector3;for(d=0,e=this.vertices.length;e>d;d++)E[d]=new g.Vector3,F[d]=new g.Vector3;for(b=0,c=this.faces.length;c>b;b++)i=this.faces[b],j=this.faceVertexUvs[0][b],i instanceof g.Face3?a(this,i.a,i.b,i.c,0,1,2):i instanceof g.Face4&&(a(this,i.a,i.b,i.d,0,1,3),a(this,i.b,i.c,i.d,1,2,3));var L=["a","b","c","d"];for(b=0,c=this.faces.length;c>b;b++)for(i=this.faces[b],f=0;f<i.vertexNormals.length;f++)K.copy(i.vertexNormals[f]),h=i[L[f]],B=E[h],I.copy(B),I.sub(K.multiplyScalar(K.dot(B))).normalize(),J.crossVectors(i.vertexNormals[f],B),C=J.dot(F[h]),D=0>C?-1:1,i.vertexTangents[f]=new g.Vector4(I.x,I.y,I.z,D);this.hasTangents=!0},computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;d>c;c++)c>0&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new g.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new g.Sphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var a,b,c,d,e,f,h,i,j,k={},l=[],m=[],n=4,o=Math.pow(10,n);for(this.__tmpVertices=void 0,c=0,d=this.vertices.length;d>c;c++)a=this.vertices[c],b=[Math.round(a.x*o),Math.round(a.y*o),Math.round(a.z*o)].join("_"),void 0===k[b]?(k[b]=c,l.push(this.vertices[c]),m[c]=l.length-1):m[c]=m[k[b]];var p=[];for(c=0,d=this.faces.length;d>c;c++)if(e=this.faces[c],e instanceof g.Face3){e.a=m[e.a],e.b=m[e.b],e.c=m[e.c],f=[e.a,e.b,e.c];for(var q=-1,r=0;3>r;r++)if(f[r]==f[(r+1)%3]){q=r,p.push(c);break}}else if(e instanceof g.Face4){e.a=m[e.a],e.b=m[e.b],e.c=m[e.c],e.d=m[e.d],f=[e.a,e.b,e.c,e.d];for(var q=-1,r=0;4>r;r++)f[r]==f[(r+1)%4]&&(q>=0&&p.push(c),q=r);if(q>=0){f.splice(q,1);var s=new g.Face3(f[0],f[1],f[2],e.normal,e.color,e.materialIndex);for(h=0,i=this.faceVertexUvs.length;i>h;h++)j=this.faceVertexUvs[h][c],j&&j.splice(q,1);e.vertexNormals&&e.vertexNormals.length>0&&(s.vertexNormals=e.vertexNormals,s.vertexNormals.splice(q,1)),e.vertexColors&&e.vertexColors.length>0&&(s.vertexColors=e.vertexColors,s.vertexColors.splice(q,1)),this.faces[c]=s}}for(c=p.length-1;c>=0;c--)for(this.faces.splice(c,1),h=0,i=this.faceVertexUvs.length;i>h;h++)this.faceVertexUvs[h].splice(c,1);var t=this.vertices.length-l.length;return this.vertices=l,t},clone:function(){for(var a=new g.Geometry,b=this.vertices,c=0,d=b.length;d>c;c++)a.vertices.push(b[c].clone());for(var e=this.faces,c=0,d=e.length;d>c;c++)a.faces.push(e[c].clone());for(var f=this.faceVertexUvs[0],c=0,d=f.length;d>c;c++){for(var h=f[c],i=[],j=0,k=h.length;k>j;j++)i.push(new g.Vector2(h[j].x,h[j].y));a.faceVertexUvs[0].push(i)}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}},g.GeometryIdCount=0,g.BufferGeometry=function(){g.EventDispatcher.call(this),this.id=g.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[]},g.BufferGeometry.prototype={constructor:g.BufferGeometry,applyMatrix:function(a){var b,c;if(this.attributes.position&&(b=this.attributes.position.array),this.attributes.normal&&(c=this.attributes.normal.array),void 0!==b&&(a.multiplyVector3Array(b),this.verticesNeedUpdate=!0),void 0!==c){var d=new g.Matrix3;d.getInverse(a).transpose(),d.multiplyVector3Array(c),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new g.Box3);var a=this.attributes.position.array;if(a){var b,c,d,e=this.boundingBox;a.length>=3&&(e.min.x=e.max.x=a[0],e.min.y=e.max.y=a[1],e.min.z=e.max.z=a[2]);for(var f=3,h=a.length;h>f;f+=3)b=a[f],c=a[f+1],d=a[f+2],b<e.min.x?e.min.x=b:b>e.max.x&&(e.max.x=b),c<e.min.y?e.min.y=c:c>e.max.y&&(e.max.y=c),d<e.min.z?e.min.z=d:d>e.max.z&&(e.max.z=d)}(void 0===a||0===a.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new g.Sphere);var a=this.attributes.position.array;if(a){for(var b,c,d,e,f=0,h=0,i=a.length;i>h;h+=3)c=a[h],d=a[h+1],e=a[h+2],b=c*c+d*d+e*e,b>f&&(f=b);this.boundingSphere.radius=Math.sqrt(f)}},computeVertexNormals:function(){if(this.attributes.position){var a,b,c,d,e=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(e),numItems:e};else for(a=0,b=this.attributes.normal.array.length;b>a;a++)this.attributes.normal.array[a]=0;var f,h,i,j,k,l,m=this.attributes.position.array,n=this.attributes.normal.array,o=new g.Vector3,p=new g.Vector3,q=new g.Vector3,r=new g.Vector3,s=new g.Vector3;if(this.attributes.index){var t=this.attributes.index.array,u=this.offsets;for(c=0,d=u.length;d>c;++c){var v=u[c].start,w=u[c].count,x=u[c].index;for(a=v,b=v+w;b>a;a+=3)f=x+t[a],h=x+t[a+1],i=x+t[a+2],j=m[3*f],k=m[3*f+1],l=m[3*f+2],o.set(j,k,l),j=m[3*h],k=m[3*h+1],l=m[3*h+2],p.set(j,k,l),j=m[3*i],k=m[3*i+1],l=m[3*i+2],q.set(j,k,l),r.subVectors(q,p),s.subVectors(o,p),r.cross(s),n[3*f]+=r.x,n[3*f+1]+=r.y,n[3*f+2]+=r.z,n[3*h]+=r.x,n[3*h+1]+=r.y,n[3*h+2]+=r.z,n[3*i]+=r.x,n[3*i+1]+=r.y,n[3*i+2]+=r.z}}else for(a=0,b=m.length;b>a;a+=9)j=m[a],k=m[a+1],l=m[a+2],o.set(j,k,l),j=m[a+3],k=m[a+4],l=m[a+5],p.set(j,k,l),j=m[a+6],k=m[a+7],l=m[a+8],q.set(j,k,l),r.subVectors(q,p),s.subVectors(o,p),r.cross(s),n[a]=r.x,n[a+1]=r.y,n[a+2]=r.z,n[a+3]=r.x,n[a+4]=r.y,n[a+5]=r.z,n[a+6]=r.x,n[a+7]=r.y,n[a+8]=r.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var a,b,c,d,e=this.attributes.normal.array,f=0,g=e.length;g>f;f+=3)a=e[f],b=e[f+1],c=e[f+2],d=1/Math.sqrt(a*a+b*b+c*c),e[f]*=d,e[f+1]*=d,e[f+2]*=d},computeTangents:function(){function a(a,b,c){n=d[3*a],o=d[3*a+1],p=d[3*a+2],q=d[3*b],r=d[3*b+1],s=d[3*b+2],t=d[3*c],u=d[3*c+1],v=d[3*c+2],w=f[2*a],x=f[2*a+1],y=f[2*b],z=f[2*b+1],A=f[2*c],B=f[2*c+1],C=q-n,D=t-n,E=r-o,F=u-o,G=s-p,H=v-p,I=y-w,J=A-w,K=z-x,L=B-x,M=1/(I*L-J*K),U.set((L*C-K*D)*M,(L*E-K*F)*M,(L*G-K*H)*M),V.set((I*D-J*C)*M,(I*F-J*E)*M,(I*H-J*G)*M),k[a].add(U),k[b].add(U),k[c].add(U),l[a].add(V),l[b].add(V),l[c].add(V)}function b(a){db.x=e[3*a],db.y=e[3*a+1],db.z=e[3*a+2],eb.copy(db),_=k[a],bb.copy(_),bb.sub(db.multiplyScalar(db.dot(_))).normalize(),cb.crossVectors(eb,_),ab=cb.dot(l[a]),$=0>ab?-1:1,j[4*a]=bb.x,j[4*a+1]=bb.y,j[4*a+2]=bb.z,j[4*a+3]=$}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()"),void 0;var c=this.attributes.index.array,d=this.attributes.position.array,e=this.attributes.normal.array,f=this.attributes.uv.array,h=d.length/3;if(void 0===this.attributes.tangent){var i=4*h;this.attributes.tangent={itemSize:4,array:new Float32Array(i),numItems:i}}for(var j=this.attributes.tangent.array,k=[],l=[],m=0;h>m;m++)k[m]=new g.Vector3,l[m]=new g.Vector3;var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U=new g.Vector3,V=new g.Vector3,W=this.offsets;for(P=0,Q=W.length;Q>P;++P){var X=W[P].start,Y=W[P].count,Z=W[P].index;for(N=X,O=X+Y;O>N;N+=3)R=Z+c[N],S=Z+c[N+1],T=Z+c[N+2],a(R,S,T)}var $,_,ab,bb=new g.Vector3,cb=new g.Vector3,db=new g.Vector3,eb=new g.Vector3;for(P=0,Q=W.length;Q>P;++P){var X=W[P].start,Y=W[P].count,Z=W[P].index;for(N=X,O=X+Y;O>N;N+=3)R=Z+c[N],S=Z+c[N+1],T=Z+c[N+2],b(R),b(S),b(T)}this.hasTangents=!0,this.tangentsNeedUpdate=!0},dispose:function(){this.dispatchEvent({type:"dispose"})}},g.Camera=function(){g.Object3D.call(this),this.matrixWorldInverse=new g.Matrix4,this.projectionMatrix=new g.Matrix4,this.projectionMatrixInverse=new g.Matrix4},g.Camera.prototype=Object.create(g.Object3D.prototype),g.Camera.prototype.lookAt=function(a){this.matrix.lookAt(this.position,a,this.up),this.rotationAutoUpdate===!0&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},g.OrthographicCamera=function(a,b,c,d,e,f){g.Camera.call(this),this.left=a,this.right=b,this.top=c,this.bottom=d,this.near=void 0!==e?e:.1,this.far=void 0!==f?f:2e3,this.updateProjectionMatrix()},g.OrthographicCamera.prototype=Object.create(g.Camera.prototype),g.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},g.PerspectiveCamera=function(a,b,c,d){g.Camera.call(this),this.fov=void 0!==a?a:50,this.aspect=void 0!==b?b:1,this.near=void 0!==c?c:.1,this.far=void 0!==d?d:2e3,this.updateProjectionMatrix()},g.PerspectiveCamera.prototype=Object.create(g.Camera.prototype),g.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24),this.fov=2*g.Math.radToDeg(Math.atan(b/(2*a))),this.updateProjectionMatrix()},g.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a,this.fullHeight=b,this.x=c,this.y=d,this.width=e,this.height=f,this.updateProjectionMatrix()},g.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var a=this.fullWidth/this.fullHeight,b=Math.tan(g.Math.degToRad(.5*this.fov))*this.near,c=-b,d=a*c,e=a*b,f=Math.abs(e-d),h=Math.abs(b-c);this.projectionMatrix.makeFrustum(d+this.x*f/this.fullWidth,d+(this.x+this.width)*f/this.fullWidth,b-(this.y+this.height)*h/this.fullHeight,b-this.y*h/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},g.Light=function(a){g.Object3D.call(this),this.color=new g.Color(a)},g.Light.prototype=Object.create(g.Object3D.prototype),g.AmbientLight=function(a){g.Light.call(this,a)},g.AmbientLight.prototype=Object.create(g.Light.prototype),g.AreaLight=function(a,b){g.Light.call(this,a),this.normal=new g.Vector3(0,-1,0),this.right=new g.Vector3(1,0,0),this.intensity=void 0!==b?b:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},g.AreaLight.prototype=Object.create(g.Light.prototype),g.DirectionalLight=function(a,b){g.Light.call(this,a),this.position=new g.Vector3(0,1,0),this.target=new g.Object3D,this.intensity=void 0!==b?b:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new g.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},g.DirectionalLight.prototype=Object.create(g.Light.prototype),g.HemisphereLight=function(a,b,c){g.Light.call(this,a),this.groundColor=new g.Color(b),this.position=new g.Vector3(0,100,0),this.intensity=void 0!==c?c:1},g.HemisphereLight.prototype=Object.create(g.Light.prototype),g.PointLight=function(a,b,c){g.Light.call(this,a),this.position=new g.Vector3(0,0,0),this.intensity=void 0!==b?b:1,this.distance=void 0!==c?c:0},g.PointLight.prototype=Object.create(g.Light.prototype),g.SpotLight=function(a,b,c,d,e){g.Light.call(this,a),this.position=new g.Vector3(0,1,0),this.target=new g.Object3D,this.intensity=void 0!==b?b:1,this.distance=void 0!==c?c:0,this.angle=void 0!==d?d:Math.PI/2,this.exponent=void 0!==e?e:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},g.SpotLight.prototype=Object.create(g.Light.prototype),g.Loader=function(a){this.showStatus=a,this.statusDomElement=a?g.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},g.Loader.prototype={constructor:g.Loader,crossOrigin:"anonymous",addStatusElement:function(){var a=document.createElement("div");return a.style.position="absolute",a.style.right="0px",a.style.top="0px",a.style.fontSize="0.8em",a.style.textAlign="left",a.style.background="rgba(0,0,0,0.25)",a.style.color="#fff",a.style.width="120px",a.style.padding="0.5em 0.5em 0.5em 0.5em",a.style.zIndex=1e3,a.innerHTML="Loading ...",a},updateProgress:function(a){var b="Loaded ";b+=a.total?(100*a.loaded/a.total).toFixed(0)+"%":(a.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=b},extractUrlBase:function(a){var b=a.split("/");return b.pop(),(b.length<1?".":b.join("/"))+"/"},initMaterials:function(a,b){for(var c=[],d=0;d<a.length;++d)c[d]=g.Loader.prototype.createMaterial(a[d],b);return c},needsTangents:function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];if(d instanceof g.ShaderMaterial)return!0}return!1},createMaterial:function(a,b){function c(a){var b=Math.log(a)/Math.LN2;return Math.floor(b)==b}function d(a){var b=Math.log(a)/Math.LN2;return Math.pow(2,Math.round(b))}function e(a,b){var e=new Image;e.onload=function(){if(c(this.width)&&c(this.height))a.image=this;else{var b=d(this.width),e=d(this.height);a.image.width=b,a.image.height=e,a.image.getContext("2d").drawImage(this,0,0,b,e)}a.needsUpdate=!0},e.crossOrigin=i.crossOrigin,e.src=b}function f(a,c,d,f,h,i,j){var k=/\.dds$/i.test(d),l=b+"/"+d;if(k){var m=g.ImageUtils.loadCompressedTexture(l);a[c]=m}else{var m=document.createElement("canvas");a[c]=new g.Texture(m)}if(a[c].sourceFile=d,f&&(a[c].repeat.set(f[0],f[1]),1!==f[0]&&(a[c].wrapS=g.RepeatWrapping),1!==f[1]&&(a[c].wrapT=g.RepeatWrapping)),h&&a[c].offset.set(h[0],h[1]),i){var n={repeat:g.RepeatWrapping,mirror:g.MirroredRepeatWrapping};void 0!==n[i[0]]&&(a[c].wrapS=n[i[0]]),void 0!==n[i[1]]&&(a[c].wrapT=n[i[1]])}j&&(a[c].anisotropy=j),k||e(a[c],l)}function h(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]}var i=this,j="MeshLambertMaterial",k={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(a.shading){var l=a.shading.toLowerCase();"phong"===l?j="MeshPhongMaterial":"basic"===l&&(j="MeshBasicMaterial")}if(void 0!==a.blending&&void 0!==g[a.blending]&&(k.blending=g[a.blending]),(void 0!==a.transparent||a.opacity<1)&&(k.transparent=a.transparent),void 0!==a.depthTest&&(k.depthTest=a.depthTest),void 0!==a.depthWrite&&(k.depthWrite=a.depthWrite),void 0!==a.visible&&(k.visible=a.visible),void 0!==a.flipSided&&(k.side=g.BackSide),void 0!==a.doubleSided&&(k.side=g.DoubleSide),void 0!==a.wireframe&&(k.wireframe=a.wireframe),void 0!==a.vertexColors&&("face"===a.vertexColors?k.vertexColors=g.FaceColors:a.vertexColors&&(k.vertexColors=g.VertexColors)),a.colorDiffuse?k.color=h(a.colorDiffuse):a.DbgColor&&(k.color=a.DbgColor),a.colorSpecular&&(k.specular=h(a.colorSpecular)),a.colorAmbient&&(k.ambient=h(a.colorAmbient)),a.transparency&&(k.opacity=a.transparency),a.specularCoef&&(k.shininess=a.specularCoef),a.mapDiffuse&&b&&f(k,"map",a.mapDiffuse,a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap,a.mapDiffuseAnisotropy),a.mapLight&&b&&f(k,"lightMap",a.mapLight,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap,a.mapLightAnisotropy),a.mapBump&&b&&f(k,"bumpMap",a.mapBump,a.mapBumpRepeat,a.mapBumpOffset,a.mapBumpWrap,a.mapBumpAnisotropy),a.mapNormal&&b&&f(k,"normalMap",a.mapNormal,a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap,a.mapNormalAnisotropy),a.mapSpecular&&b&&f(k,"specularMap",a.mapSpecular,a.mapSpecularRepeat,a.mapSpecularOffset,a.mapSpecularWrap,a.mapSpecularAnisotropy),a.mapBumpScale&&(k.bumpScale=a.mapBumpScale),a.mapNormal){var m=g.ShaderLib.normalmap,n=g.UniformsUtils.clone(m.uniforms);n.tNormal.value=k.normalMap,a.mapNormalFactor&&n.uNormalScale.value.set(a.mapNormalFactor,a.mapNormalFactor),k.map&&(n.tDiffuse.value=k.map,n.enableDiffuse.value=!0),k.specularMap&&(n.tSpecular.value=k.specularMap,n.enableSpecular.value=!0),k.lightMap&&(n.tAO.value=k.lightMap,n.enableAO.value=!0),n.uDiffuseColor.value.setHex(k.color),n.uSpecularColor.value.setHex(k.specular),n.uAmbientColor.value.setHex(k.ambient),n.uShininess.value=k.shininess,void 0!==k.opacity&&(n.uOpacity.value=k.opacity);var o={fragmentShader:m.fragmentShader,vertexShader:m.vertexShader,uniforms:n,lights:!0,fog:!0},p=new g.ShaderMaterial(o);k.transparent&&(p.transparent=!0)}else var p=new g[j](k);return void 0!==a.DbgName&&(p.name=a.DbgName),p}},g.ImageLoader=function(){g.EventDispatcher.call(this),this.crossOrigin=null},g.ImageLoader.prototype={constructor:g.ImageLoader,load:function(a,b){var c=this;void 0===b&&(b=new Image),b.addEventListener("load",function(){c.dispatchEvent({type:"load",content:b})
},!1),b.addEventListener("error",function(){c.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},!1),c.crossOrigin&&(b.crossOrigin=c.crossOrigin),b.src=a}},g.JSONLoader=function(a){g.Loader.call(this,a),this.withCredentials=!1},g.JSONLoader.prototype=Object.create(g.Loader.prototype),g.JSONLoader.prototype.load=function(a,b,c){c=c&&"string"==typeof c?c:this.extractUrlBase(a),this.onLoadStart(),this.loadAjaxJSON(this,a,b,c)},g.JSONLoader.prototype.loadAjaxJSON=function(a,b,c,d,e){var f=new XMLHttpRequest,g=0;f.onreadystatechange=function(){if(f.readyState===f.DONE)if(200===f.status||0===f.status){if(f.responseText){var h=JSON.parse(f.responseText);a.createModel(h,c,d)}else console.warn("THREE.JSONLoader: ["+b+"] seems to be unreachable or file there is empty");a.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+b+"] ["+f.status+"]");else f.readyState===f.LOADING?e&&(0===g&&(g=f.getResponseHeader("Content-Length")),e({total:g,loaded:f.responseText.length})):f.readyState===f.HEADERS_RECEIVED&&(g=f.getResponseHeader("Content-Length"))},f.open("GET",b,!0),f.withCredentials=this.withCredentials,f.send(null)},g.JSONLoader.prototype.createModel=function(a,b,c){function d(b){function c(a,b){return a&1<<b}var d,e,f,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=a.faces,H=a.vertices,I=a.normals,J=a.colors,K=0;for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&K++;for(d=0;K>d;d++)h.faceUvs[d]=[],h.faceVertexUvs[d]=[];for(i=0,j=H.length;j>i;)y=new g.Vector3,y.x=H[i++]*b,y.y=H[i++]*b,y.z=H[i++]*b,h.vertices.push(y);for(i=0,j=G.length;j>i;){if(p=G[i++],q=c(p,0),r=c(p,1),s=c(p,2),t=c(p,3),u=c(p,4),v=c(p,5),w=c(p,6),x=c(p,7),q?(z=new g.Face4,z.a=G[i++],z.b=G[i++],z.c=G[i++],z.d=G[i++],k=4):(z=new g.Face3,z.a=G[i++],z.b=G[i++],z.c=G[i++],k=3),r&&(o=G[i++],z.materialIndex=o),f=h.faces.length,s)for(d=0;K>d;d++)C=a.uvs[d],n=G[i++],E=C[2*n],F=C[2*n+1],h.faceUvs[d][f]=new g.Vector2(E,F);if(t)for(d=0;K>d;d++){for(C=a.uvs[d],D=[],e=0;k>e;e++)n=G[i++],E=C[2*n],F=C[2*n+1],D[e]=new g.Vector2(E,F);h.faceVertexUvs[d][f]=D}if(u&&(m=3*G[i++],B=new g.Vector3,B.x=I[m++],B.y=I[m++],B.z=I[m],z.normal=B),v)for(d=0;k>d;d++)m=3*G[i++],B=new g.Vector3,B.x=I[m++],B.y=I[m++],B.z=I[m],z.vertexNormals.push(B);if(w&&(l=G[i++],A=new g.Color(J[l]),z.color=A),x)for(d=0;k>d;d++)l=G[i++],A=new g.Color(J[l]),z.vertexColors.push(A);h.faces.push(z)}}function e(){var b,c,d,e,f,i,j,k,l,m;if(a.skinWeights)for(b=0,c=a.skinWeights.length;c>b;b+=2)d=a.skinWeights[b],e=a.skinWeights[b+1],f=0,i=0,h.skinWeights.push(new g.Vector4(d,e,f,i));if(a.skinIndices)for(b=0,c=a.skinIndices.length;c>b;b+=2)j=a.skinIndices[b],k=a.skinIndices[b+1],l=0,m=0,h.skinIndices.push(new g.Vector4(j,k,l,m));h.bones=a.bones,h.animation=a.animation}function f(b){if(void 0!==a.morphTargets){var c,d,e,f,i,j;for(c=0,d=a.morphTargets.length;d>c;c++)for(h.morphTargets[c]={},h.morphTargets[c].name=a.morphTargets[c].name,h.morphTargets[c].vertices=[],i=h.morphTargets[c].vertices,j=a.morphTargets[c].vertices,e=0,f=j.length;f>e;e+=3){var k=new g.Vector3;k.x=j[e]*b,k.y=j[e+1]*b,k.z=j[e+2]*b,i.push(k)}}if(void 0!==a.morphColors){var c,d,l,m,n,o,p;for(c=0,d=a.morphColors.length;d>c;c++)for(h.morphColors[c]={},h.morphColors[c].name=a.morphColors[c].name,h.morphColors[c].colors=[],n=h.morphColors[c].colors,o=a.morphColors[c].colors,l=0,m=o.length;m>l;l+=3)p=new g.Color(16755200),p.setRGB(o[l],o[l+1],o[l+2]),n.push(p)}}var h=new g.Geometry,i=void 0!==a.scale?1/a.scale:1;d(i),e(),f(i),h.computeCentroids(),h.computeFaceNormals();var j=this.initMaterials(a.materials,c);this.needsTangents(j)&&h.computeTangents(),b(h,j)},g.LoadingMonitor=function(){g.EventDispatcher.call(this);var a=this,b=0,c=0,d=function(){b++,a.dispatchEvent({type:"progress",loaded:b,total:c}),b===c&&a.dispatchEvent({type:"load"})};this.add=function(a){c++,a.addEventListener("load",d,!1)}},g.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.hierarchyHandlerMap={},this.addGeometryHandler("ascii",g.JSONLoader)},g.SceneLoader.prototype.constructor=g.SceneLoader,g.SceneLoader.prototype.load=function(a,b){var c=this,d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status||0===d.status){var e=JSON.parse(d.responseText);c.parse(e,b,a)}else console.error("THREE.SceneLoader: Couldn't load ["+a+"] ["+d.status+"]")},d.open("GET",a,!0),d.send(null)},g.SceneLoader.prototype.addGeometryHandler=function(a,b){this.geometryHandlerMap[a]={loaderClass:b}},g.SceneLoader.prototype.addHierarchyHandler=function(a,b){this.hierarchyHandlerMap[a]={loaderClass:b}},g.SceneLoader.prototype.parse=function(a,b,c){function d(a,b){return"relativeToHTML"==b?a:D+"/"+a}function e(){f(B.scene,F.objects)}function f(a,b){var c,e,h,i,j,l;for(var m in b)if(void 0===B.objects[m]){var n=b[m],r=null;if(n.type&&n.type in C.hierarchyHandlerMap){if(void 0===n.loading){var s={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,properties:1,skin:1,morph:1,mirroredLoop:1,duration:1},t={};for(var x in n)x in s||(t[x]=n[x]);p=B.materials[n.material],n.loading=!0;var y=C.hierarchyHandlerMap[n.type].loaderObject;y.options?y.load(d(n.url,F.urlBaseType),k(m,a,p,n)):y.load(d(n.url,F.urlBaseType),k(m,a,p,n),t)}}else if(void 0!==n.geometry){if(o=B.geometries[n.geometry]){var z=!1;if(p=B.materials[n.material],z=p instanceof g.ShaderMaterial,h=n.position,i=n.rotation,j=n.scale,c=n.matrix,l=n.quaternion,n.material||(p=new g.MeshFaceMaterial(B.face_materials[n.geometry])),p instanceof g.MeshFaceMaterial&&0===p.materials.length&&(p=new g.MeshFaceMaterial(B.face_materials[n.geometry])),p instanceof g.MeshFaceMaterial)for(var A=0;A<p.materials.length;A++)z=z||p.materials[A]instanceof g.ShaderMaterial;z&&o.computeTangents(),n.skin?r=new g.SkinnedMesh(o,p):n.morph?(r=new g.MorphAnimMesh(o,p),void 0!==n.duration&&(r.duration=n.duration),void 0!==n.time&&(r.time=n.time),void 0!==n.mirroredLoop&&(r.mirroredLoop=n.mirroredLoop),p.morphNormals&&o.computeMorphNormals()):r=new g.Mesh(o,p),r.name=m,c?(r.matrixAutoUpdate=!1,r.matrix.set(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15])):(r.position.set(h[0],h[1],h[2]),l?(r.quaternion.set(l[0],l[1],l[2],l[3]),r.useQuaternion=!0):r.rotation.set(i[0],i[1],i[2]),r.scale.set(j[0],j[1],j[2])),r.visible=n.visible,r.castShadow=n.castShadow,r.receiveShadow=n.receiveShadow,a.add(r),B.objects[m]=r}}else"DirectionalLight"===n.type||"PointLight"===n.type||"AmbientLight"===n.type?(v=void 0!==n.color?n.color:16777215,w=void 0!==n.intensity?n.intensity:1,"DirectionalLight"===n.type?(h=n.direction,u=new g.DirectionalLight(v,w),u.position.set(h[0],h[1],h[2]),n.target&&(E.push({object:u,targetName:n.target}),u.target=null)):"PointLight"===n.type?(h=n.position,e=n.distance,u=new g.PointLight(v,w,e),u.position.set(h[0],h[1],h[2])):"AmbientLight"===n.type&&(u=new g.AmbientLight(v)),a.add(u),u.name=m,B.lights[m]=u,B.objects[m]=u):"PerspectiveCamera"===n.type||"OrthographicCamera"===n.type?("PerspectiveCamera"===n.type?q=new g.PerspectiveCamera(n.fov,n.aspect,n.near,n.far):"OrthographicCamera"===n.type&&(q=new g.OrthographicCamera(n.left,n.right,n.top,n.bottom,n.near,n.far)),h=n.position,q.position.set(h[0],h[1],h[2]),a.add(q),q.name=m,B.cameras[m]=q,B.objects[m]=q):(h=n.position,i=n.rotation,j=n.scale,l=n.quaternion,r=new g.Object3D,r.name=m,r.position.set(h[0],h[1],h[2]),l?(r.quaternion.set(l[0],l[1],l[2],l[3]),r.useQuaternion=!0):r.rotation.set(i[0],i[1],i[2]),r.scale.set(j[0],j[1],j[2]),r.visible=void 0!==n.visible?n.visible:!1,a.add(r),B.objects[m]=r,B.empties[m]=r);if(r){if(void 0!==n.properties)for(var D in n.properties){var G=n.properties[D];r.properties[D]=G}if(void 0!==n.groups)for(var A=0;A<n.groups.length;A++){var H=n.groups[A];void 0===B.groups[H]&&(B.groups[H]=[]),B.groups[H].push(m)}void 0!==n.children&&f(r,n.children)}}}function h(a,b,c){B.geometries[c]=a,B.face_materials[c]=b,e()}function i(a,b,c,d,f){var g=f.position,h=f.rotation,i=f.quaternion,j=f.scale;a.position.set(g[0],g[1],g[2]),i?(a.quaternion.set(i[0],i[1],i[2],i[3]),a.useQuaternion=!0):a.rotation.set(h[0],h[1],h[2]),a.scale.set(j[0],j[1],j[2]),d&&a.traverse(function(a){a.material=d});var k=void 0!==f.visible?f.visible:!0;a.traverse(function(a){a.visible=k}),c.add(a),a.name=b,B.objects[b]=a,e()}function j(a){return function(b,c){h(b,c,a),x-=1,C.onLoadComplete(),m()}}function k(a,b,c,d){return function(e){var f;f=e.content?e.content:e.dae?e.scene:e,i(f,a,b,c,d),x-=1,C.onLoadComplete(),m()}}function l(a){return function(b,c){B.geometries[a]=b,B.face_materials[a]=c}}function m(){var a={totalModels:z,totalTextures:A,loadedModels:z-x,loadedTextures:A-y};C.callbackProgress(a,B),C.onLoadProgress(),0===x&&0===y&&(n(),b(B))}function n(){for(var a=0;a<E.length;a++){var b=E[a],c=B.objects[b.targetName];c?b.object.target=c:(b.object.target=new g.Object3D,B.scene.add(b.object.target)),b.object.target.properties.targetInverse=b.object}}var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=this,D=g.Loader.prototype.extractUrlBase(c),E=[],F=a;for(var G in this.geometryHandlerMap){var H=this.geometryHandlerMap[G].loaderClass;this.geometryHandlerMap[G].loaderObject=new H}for(var G in this.hierarchyHandlerMap){var H=this.hierarchyHandlerMap[G].loaderClass;this.hierarchyHandlerMap[G].loaderObject=new H}if(x=0,y=0,B={scene:new g.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},F.transform){var I=F.transform.position,J=F.transform.rotation,K=F.transform.scale;I&&B.scene.position.set(I[0],I[1],I[2]),J&&B.scene.rotation.set(J[0],J[1],J[2]),K&&B.scene.scale.set(K[0],K[1],K[2]),(I||J||K)&&(B.scene.updateMatrix(),B.scene.updateMatrixWorld())}var L,M,N=function(a){y-=a,m(),C.onLoadComplete()},O=function(a){return function(){N(a)}};for(L in F.fogs)M=F.fogs[L],"linear"===M.type?r=new g.Fog(0,M.near,M.far):"exp2"===M.type&&(r=new g.FogExp2(0,M.density)),t=M.color,r.color.setRGB(t[0],t[1],t[2]),B.fogs[L]=r;var P,Q;for(P in F.geometries)Q=F.geometries[P],Q.type in this.geometryHandlerMap&&(x+=1,C.onLoadStart());var R,S;for(R in F.objects)S=F.objects[R],S.type&&S.type in this.hierarchyHandlerMap&&(x+=1,C.onLoadStart());z=x;for(P in F.geometries)if(Q=F.geometries[P],"cube"===Q.type)o=new g.CubeGeometry(Q.width,Q.height,Q.depth,Q.widthSegments,Q.heightSegments,Q.depthSegments),B.geometries[P]=o;else if("plane"===Q.type)o=new g.PlaneGeometry(Q.width,Q.height,Q.widthSegments,Q.heightSegments),B.geometries[P]=o;else if("sphere"===Q.type)o=new g.SphereGeometry(Q.radius,Q.widthSegments,Q.heightSegments),B.geometries[P]=o;else if("cylinder"===Q.type)o=new g.CylinderGeometry(Q.topRad,Q.botRad,Q.height,Q.radSegs,Q.heightSegs),B.geometries[P]=o;else if("torus"===Q.type)o=new g.TorusGeometry(Q.radius,Q.tube,Q.segmentsR,Q.segmentsT),B.geometries[P]=o;else if("icosahedron"===Q.type)o=new g.IcosahedronGeometry(Q.radius,Q.subdivisions),B.geometries[P]=o;else if(Q.type in this.geometryHandlerMap){var T={};for(var U in Q)"type"!==U&&"url"!==U&&(T[U]=Q[U]);var V=this.geometryHandlerMap[Q.type].loaderObject;V.load(d(Q.url,F.urlBaseType),j(P),T)}else if("embedded"===Q.type){var W=F.embeds[Q.id],X="";if(W.metadata=F.metadata,W){var Y=this.geometryHandlerMap.ascii.loaderObject;Y.createModel(W,l(P),X)}}var Z,$;for(Z in F.textures)if($=F.textures[Z],$.url instanceof Array){y+=$.url.length;for(var _=0;_<$.url.length;_++)C.onLoadStart()}else y+=1,C.onLoadStart();A=y;for(Z in F.textures){if($=F.textures[Z],void 0!==$.mapping&&void 0!==g[$.mapping]&&($.mapping=new g[$.mapping]),$.url instanceof Array){for(var ab=$.url.length,bb=[],cb=0;ab>cb;cb++)bb[cb]=d($.url[cb],F.urlBaseType);var db=/\.dds$/i.test(bb[0]);s=db?g.ImageUtils.loadCompressedTextureCube(bb,$.mapping,O(ab)):g.ImageUtils.loadTextureCube(bb,$.mapping,O(ab))}else{var db=/\.dds$/i.test($.url),eb=d($.url,F.urlBaseType),fb=O(1);if(s=db?g.ImageUtils.loadCompressedTexture(eb,$.mapping,fb):g.ImageUtils.loadTexture(eb,$.mapping,fb),void 0!==g[$.minFilter]&&(s.minFilter=g[$.minFilter]),void 0!==g[$.magFilter]&&(s.magFilter=g[$.magFilter]),$.anisotropy&&(s.anisotropy=$.anisotropy),$.repeat&&(s.repeat.set($.repeat[0],$.repeat[1]),1!==$.repeat[0]&&(s.wrapS=g.RepeatWrapping),1!==$.repeat[1]&&(s.wrapT=g.RepeatWrapping)),$.offset&&s.offset.set($.offset[0],$.offset[1]),$.wrap){var gb={repeat:g.RepeatWrapping,mirror:g.MirroredRepeatWrapping};void 0!==gb[$.wrap[0]]&&(s.wrapS=gb[$.wrap[0]]),void 0!==gb[$.wrap[1]]&&(s.wrapT=gb[$.wrap[1]])}}B.textures[Z]=s}var hb,ib,jb;for(hb in F.materials){ib=F.materials[hb];for(jb in ib.parameters)if("envMap"===jb||"map"===jb||"lightMap"===jb||"bumpMap"===jb)ib.parameters[jb]=B.textures[ib.parameters[jb]];else if("shading"===jb)ib.parameters[jb]="flat"===ib.parameters[jb]?g.FlatShading:g.SmoothShading;else if("side"===jb)ib.parameters[jb]="double"==ib.parameters[jb]?g.DoubleSide:"back"==ib.parameters[jb]?g.BackSide:g.FrontSide;else if("blending"===jb)ib.parameters[jb]=ib.parameters[jb]in g?g[ib.parameters[jb]]:g.NormalBlending;else if("combine"===jb)ib.parameters[jb]=ib.parameters[jb]in g?g[ib.parameters[jb]]:g.MultiplyOperation;else if("vertexColors"===jb)"face"==ib.parameters[jb]?ib.parameters[jb]=g.FaceColors:ib.parameters[jb]&&(ib.parameters[jb]=g.VertexColors);else if("wrapRGB"===jb){var kb=ib.parameters[jb];ib.parameters[jb]=new g.Vector3(kb[0],kb[1],kb[2])}if(void 0!==ib.parameters.opacity&&ib.parameters.opacity<1&&(ib.parameters.transparent=!0),ib.parameters.normalMap){var lb=g.ShaderLib.normalmap,mb=g.UniformsUtils.clone(lb.uniforms),nb=ib.parameters.color,ob=ib.parameters.specular,pb=ib.parameters.ambient,qb=ib.parameters.shininess;mb.tNormal.value=B.textures[ib.parameters.normalMap],ib.parameters.normalScale&&mb.uNormalScale.value.set(ib.parameters.normalScale[0],ib.parameters.normalScale[1]),ib.parameters.map&&(mb.tDiffuse.value=ib.parameters.map,mb.enableDiffuse.value=!0),ib.parameters.envMap&&(mb.tCube.value=ib.parameters.envMap,mb.enableReflection.value=!0,mb.uReflectivity.value=ib.parameters.reflectivity),ib.parameters.lightMap&&(mb.tAO.value=ib.parameters.lightMap,mb.enableAO.value=!0),ib.parameters.specularMap&&(mb.tSpecular.value=B.textures[ib.parameters.specularMap],mb.enableSpecular.value=!0),ib.parameters.displacementMap&&(mb.tDisplacement.value=B.textures[ib.parameters.displacementMap],mb.enableDisplacement.value=!0,mb.uDisplacementBias.value=ib.parameters.displacementBias,mb.uDisplacementScale.value=ib.parameters.displacementScale),mb.uDiffuseColor.value.setHex(nb),mb.uSpecularColor.value.setHex(ob),mb.uAmbientColor.value.setHex(pb),mb.uShininess.value=qb,ib.parameters.opacity&&(mb.uOpacity.value=ib.parameters.opacity);var rb={fragmentShader:lb.fragmentShader,vertexShader:lb.vertexShader,uniforms:mb,lights:!0,fog:!0};p=new g.ShaderMaterial(rb)}else p=new g[ib.type](ib.parameters);B.materials[hb]=p}for(hb in F.materials)if(ib=F.materials[hb],ib.parameters.materials){for(var sb=[],cb=0;cb<ib.parameters.materials.length;cb++){var tb=ib.parameters.materials[cb];sb.push(B.materials[tb])}B.materials[hb].materials=sb}e(),B.cameras&&F.defaults.camera&&(B.currentCamera=B.cameras[F.defaults.camera]),B.fogs&&F.defaults.fog&&(B.scene.fog=B.fogs[F.defaults.fog]),C.callbackSync(B),m()},g.TextureLoader=function(){g.EventDispatcher.call(this),this.crossOrigin=null},g.TextureLoader.prototype={constructor:g.TextureLoader,load:function(a){var b=this,c=new Image;c.addEventListener("load",function(){var a=new g.Texture(c);a.needsUpdate=!0,b.dispatchEvent({type:"load",content:a})},!1),c.addEventListener("error",function(){b.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},!1),b.crossOrigin&&(c.crossOrigin=b.crossOrigin),c.src=a}},g.Material=function(){g.EventDispatcher.call(this),this.id=g.MaterialIdCount++,this.name="",this.side=g.FrontSide,this.opacity=1,this.transparent=!1,this.blending=g.NormalBlending,this.blendSrc=g.SrcAlphaFactor,this.blendDst=g.OneMinusSrcAlphaFactor,this.blendEquation=g.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=!1,this.visible=!0,this.needsUpdate=!0},g.Material.prototype.setValues=function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0!==c){if(b in this){var d=this[b];d instanceof g.Color&&c instanceof g.Color?d.copy(c):d instanceof g.Color?d.set(c):d instanceof g.Vector3&&c instanceof g.Vector3?d.copy(c):this[b]=c}}else console.warn("THREE.Material: '"+b+"' parameter is undefined.")}},g.Material.prototype.clone=function(a){return void 0===a&&(a=new g.Material),a.name=this.name,a.side=this.side,a.opacity=this.opacity,a.transparent=this.transparent,a.blending=this.blending,a.blendSrc=this.blendSrc,a.blendDst=this.blendDst,a.blendEquation=this.blendEquation,a.depthTest=this.depthTest,a.depthWrite=this.depthWrite,a.polygonOffset=this.polygonOffset,a.polygonOffsetFactor=this.polygonOffsetFactor,a.polygonOffsetUnits=this.polygonOffsetUnits,a.alphaTest=this.alphaTest,a.overdraw=this.overdraw,a.visible=this.visible,a},g.Material.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},g.MaterialIdCount=0,g.LineBasicMaterial=function(a){g.Material.call(this),this.color=new g.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(a)},g.LineBasicMaterial.prototype=Object.create(g.Material.prototype),g.LineBasicMaterial.prototype.clone=function(){var a=new g.LineBasicMaterial;return g.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.linewidth=this.linewidth,a.linecap=this.linecap,a.linejoin=this.linejoin,a.vertexColors=this.vertexColors,a.fog=this.fog,a},g.LineDashedMaterial=function(a){g.Material.call(this),this.color=new g.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(a)},g.LineDashedMaterial.prototype=Object.create(g.Material.prototype),g.LineDashedMaterial.prototype.clone=function(){var a=new g.LineDashedMaterial;return g.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.linewidth=this.linewidth,a.scale=this.scale,a.dashSize=this.dashSize,a.gapSize=this.gapSize,a.vertexColors=this.vertexColors,a.fog=this.fog,a},g.MeshBasicMaterial=function(a){g.Material.call(this),this.color=new g.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=g.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=g.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=g.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(a)},g.MeshBasicMaterial.prototype=Object.create(g.Material.prototype),g.MeshBasicMaterial.prototype.clone=function(){var a=new g.MeshBasicMaterial;return g.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.map=this.map,a.lightMap=this.lightMap,a.specularMap=this.specularMap,a.envMap=this.envMap,a.combine=this.combine,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a},g.MeshLambertMaterial=function(a){g.Material.call(this),this.color=new g.Color(16777215),this.ambient=new g.Color(16777215),this.emissive=new g.Color(0),this.wrapAround=!1,this.wrapRGB=new g.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=g.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=g.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=g.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)},g.MeshLambertMaterial.prototype=Object.create(g.Material.prototype),g.MeshLambertMaterial.prototype.clone=function(){var a=new g.MeshLambertMaterial;return g.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.ambient.copy(this.ambient),a.emissive.copy(this.emissive),a.wrapAround=this.wrapAround,a.wrapRGB.copy(this.wrapRGB),a.map=this.map,a.lightMap=this.lightMap,a.specularMap=this.specularMap,a.envMap=this.envMap,a.combine=this.combine,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},g.MeshPhongMaterial=function(a){g.Material.call(this),this.color=new g.Color(16777215),this.ambient=new g.Color(16777215),this.emissive=new g.Color(0),this.specular=new g.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new g.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new g.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=g.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=g.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=g.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)},g.MeshPhongMaterial.prototype=Object.create(g.Material.prototype),g.MeshPhongMaterial.prototype.clone=function(){var a=new g.MeshPhongMaterial;return g.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.ambient.copy(this.ambient),a.emissive.copy(this.emissive),a.specular.copy(this.specular),a.shininess=this.shininess,a.metal=this.metal,a.perPixel=this.perPixel,a.wrapAround=this.wrapAround,a.wrapRGB.copy(this.wrapRGB),a.map=this.map,a.lightMap=this.lightMap,a.bumpMap=this.bumpMap,a.bumpScale=this.bumpScale,a.normalMap=this.normalMap,a.normalScale.copy(this.normalScale),a.specularMap=this.specularMap,a.envMap=this.envMap,a.combine=this.combine,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},g.MeshDepthMaterial=function(a){g.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(a)},g.MeshDepthMaterial.prototype=Object.create(g.Material.prototype),g.MeshDepthMaterial.prototype.clone=function(){var a=new g.LineBasicMaterial;return g.Material.prototype.clone.call(this,a),a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a},g.MeshNormalMaterial=function(a){g.Material.call(this,a),this.shading=g.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(a)},g.MeshNormalMaterial.prototype=Object.create(g.Material.prototype),g.MeshNormalMaterial.prototype.clone=function(){var a=new g.MeshNormalMaterial;return g.Material.prototype.clone.call(this,a),a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a},g.MeshFaceMaterial=function(a){this.materials=a instanceof Array?a:[]},g.MeshFaceMaterial.prototype.clone=function(){return new g.MeshFaceMaterial(this.materials.slice(0))},g.ParticleBasicMaterial=function(a){g.Material.call(this),this.color=new g.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(a)},g.ParticleBasicMaterial.prototype=Object.create(g.Material.prototype),g.ParticleBasicMaterial.prototype.clone=function(){var a=new g.ParticleBasicMaterial;return g.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.map=this.map,a.size=this.size,a.sizeAttenuation=this.sizeAttenuation,a.vertexColors=this.vertexColors,a.fog=this.fog,a},g.ParticleCanvasMaterial=function(a){g.Material.call(this),this.color=new g.Color(16777215),this.program=function(){},this.setValues(a)},g.ParticleCanvasMaterial.prototype=Object.create(g.Material.prototype),g.ParticleCanvasMaterial.prototype.clone=function(){var a=new g.ParticleCanvasMaterial;return g.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.program=this.program,a},g.ShaderMaterial=function(a){g.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=g.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=g.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)},g.ShaderMaterial.prototype=Object.create(g.Material.prototype),g.ShaderMaterial.prototype.clone=function(){var a=new g.ShaderMaterial;return g.Material.prototype.clone.call(this,a),a.fragmentShader=this.fragmentShader,a.vertexShader=this.vertexShader,a.uniforms=g.UniformsUtils.clone(this.uniforms),a.attributes=this.attributes,a.defines=this.defines,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.fog=this.fog,a.lights=this.lights,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},g.SpriteMaterial=function(a){g.Material.call(this),this.color=new g.Color(16777215),this.map=new g.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=g.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new g.Vector2(0,0),this.uvScale=new g.Vector2(1,1),this.setValues(a),a=a||{},void 0===a.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===a.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===a.scaleByViewport&&(this.scaleByViewport=!this.sizeAttenuation)},g.SpriteMaterial.prototype=Object.create(g.Material.prototype),g.SpriteMaterial.prototype.clone=function(){var a=new g.SpriteMaterial;return g.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.map=this.map,a.useScreenCoordinates=this.useScreenCoordinates,a.sizeAttenuation=this.sizeAttenuation,a.scaleByViewport=this.scaleByViewport,a.alignment.copy(this.alignment),a.uvOffset.copy(this.uvOffset),a.uvScale.copy(this.uvScale),a.fog=this.fog,a},g.SpriteAlignment={},g.SpriteAlignment.topLeft=new g.Vector2(1,-1),g.SpriteAlignment.topCenter=new g.Vector2(0,-1),g.SpriteAlignment.topRight=new g.Vector2(-1,-1),g.SpriteAlignment.centerLeft=new g.Vector2(1,0),g.SpriteAlignment.center=new g.Vector2(0,0),g.SpriteAlignment.centerRight=new g.Vector2(-1,0),g.SpriteAlignment.bottomLeft=new g.Vector2(1,1),g.SpriteAlignment.bottomCenter=new g.Vector2(0,1),g.SpriteAlignment.bottomRight=new g.Vector2(-1,1),g.Texture=function(a,b,c,d,e,f,h,i,j){g.EventDispatcher.call(this),this.id=g.TextureIdCount++,this.name="",this.image=a,this.mipmaps=[],this.mapping=void 0!==b?b:new g.UVMapping,this.wrapS=void 0!==c?c:g.ClampToEdgeWrapping,this.wrapT=void 0!==d?d:g.ClampToEdgeWrapping,this.magFilter=void 0!==e?e:g.LinearFilter,this.minFilter=void 0!==f?f:g.LinearMipMapLinearFilter,this.anisotropy=void 0!==j?j:1,this.format=void 0!==h?h:g.RGBAFormat,this.type=void 0!==i?i:g.UnsignedByteType,this.offset=new g.Vector2(0,0),this.repeat=new g.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},g.Texture.prototype={constructor:g.Texture,clone:function(a){return void 0===a&&(a=new g.Texture),a.image=this.image,a.mipmaps=this.mipmaps.slice(0),a.mapping=this.mapping,a.wrapS=this.wrapS,a.wrapT=this.wrapT,a.magFilter=this.magFilter,a.minFilter=this.minFilter,a.anisotropy=this.anisotropy,a.format=this.format,a.type=this.type,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.generateMipmaps=this.generateMipmaps,a.premultiplyAlpha=this.premultiplyAlpha,a.flipY=this.flipY,a.unpackAlignment=this.unpackAlignment,a},dispose:function(){this.dispatchEvent({type:"dispose"})}},g.TextureIdCount=0,g.CompressedTexture=function(a,b,c,d,e,f,h,i,j,k,l){g.Texture.call(this,null,f,h,i,j,k,d,e,l),this.image={width:b,height:c},this.mipmaps=a,this.generateMipmaps=!1},g.CompressedTexture.prototype=Object.create(g.Texture.prototype),g.CompressedTexture.prototype.clone=function(){var a=new g.CompressedTexture;return g.Texture.prototype.clone.call(this,a),a},g.DataTexture=function(a,b,c,d,e,f,h,i,j,k,l){g.Texture.call(this,null,f,h,i,j,k,d,e,l),this.image={data:a,width:b,height:c}},g.DataTexture.prototype=Object.create(g.Texture.prototype),g.DataTexture.prototype.clone=function(){var a=new g.DataTexture;return g.Texture.prototype.clone.call(this,a),a},g.Particle=function(a){g.Object3D.call(this),this.material=a},g.Particle.prototype=Object.create(g.Object3D.prototype),g.Particle.prototype.clone=function(a){return void 0===a&&(a=new g.Particle(this.material)),g.Object3D.prototype.clone.call(this,a),a},g.ParticleSystem=function(a,b){g.Object3D.call(this),this.geometry=a,this.material=void 0!==b?b:new g.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.frustumCulled=!1},g.ParticleSystem.prototype=Object.create(g.Object3D.prototype),g.ParticleSystem.prototype.clone=function(a){return void 0===a&&(a=new g.ParticleSystem(this.geometry,this.material)),a.sortParticles=this.sortParticles,g.Object3D.prototype.clone.call(this,a),a},g.Line=function(a,b,c){g.Object3D.call(this),this.geometry=a,this.material=void 0!==b?b:new g.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==c?c:g.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},g.LineStrip=0,g.LinePieces=1,g.Line.prototype=Object.create(g.Object3D.prototype),g.Line.prototype.clone=function(a){return void 0===a&&(a=new g.Line(this.geometry,this.material,this.type)),g.Object3D.prototype.clone.call(this,a),a},g.Mesh=function(a,b){g.Object3D.call(this),this.geometry=a,this.material=void 0!==b?b:new g.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0}),void 0!==this.geometry&&(null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.updateMorphTargets())},g.Mesh.prototype=Object.create(g.Object3D.prototype),g.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;b>a;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}},g.Mesh.prototype.getMorphTargetIndexByName=function(a){return void 0!==this.morphTargetDictionary[a]?this.morphTargetDictionary[a]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0."),0)},g.Mesh.prototype.clone=function(a){return void 0===a&&(a=new g.Mesh(this.geometry,this.material)),g.Object3D.prototype.clone.call(this,a),a},g.Bone=function(a){g.Object3D.call(this),this.skin=a,this.skinMatrix=new g.Matrix4},g.Bone.prototype=Object.create(g.Object3D.prototype),g.Bone.prototype.update=function(a,b){this.matrixAutoUpdate&&(b|=this.updateMatrix()),(b||this.matrixWorldNeedsUpdate)&&(a?this.skinMatrix.multiplyMatrices(a,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,b=!0);var c,d=this.children.length;for(c=0;d>c;c++)this.children[c].update(this.skinMatrix,b)
},g.SkinnedMesh=function(a,b,c){g.Mesh.call(this,a,b),this.useVertexTexture=void 0!==c?c:!0,this.identityMatrix=new g.Matrix4,this.bones=[],this.boneMatrices=[];var d,e,f,h,i,j;if(this.geometry&&void 0!==this.geometry.bones){for(d=0;d<this.geometry.bones.length;d++)f=this.geometry.bones[d],h=f.pos,i=f.rotq,j=f.scl,e=this.addBone(),e.name=f.name,e.position.set(h[0],h[1],h[2]),e.quaternion.set(i[0],i[1],i[2],i[3]),e.useQuaternion=!0,void 0!==j?e.scale.set(j[0],j[1],j[2]):e.scale.set(1,1,1);for(d=0;d<this.bones.length;d++)f=this.geometry.bones[d],e=this.bones[d],-1===f.parent?this.add(e):this.bones[f.parent].add(e);var k=this.bones.length;if(this.useVertexTexture){var l;l=k>256?64:k>64?32:k>16?16:8,this.boneTextureWidth=l,this.boneTextureHeight=l,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new g.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,g.RGBAFormat,g.FloatType),this.boneTexture.minFilter=g.NearestFilter,this.boneTexture.magFilter=g.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*k);this.pose()}},g.SkinnedMesh.prototype=Object.create(g.Mesh.prototype),g.SkinnedMesh.prototype.addBone=function(a){return void 0===a&&(a=new g.Bone(this)),this.bones.push(a),a},g.SkinnedMesh.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d instanceof g.Bone?d.update(this.identityMatrix,!1):d.updateMatrixWorld(!0)}if(void 0==this.boneInverses){this.boneInverses=[];for(var e=0,f=this.bones.length;f>e;e++){var h=new g.Matrix4;h.getInverse(this.bones[e].skinMatrix),this.boneInverses.push(h)}}for(var e=0,f=this.bones.length;f>e;e++)g.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[e].skinMatrix,this.boneInverses[e]),g.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*e);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},g.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var a=0;a<this.geometry.skinIndices.length;a++){var b=this.geometry.skinWeights[a],c=1/b.lengthManhattan();1/0!==c?b.multiplyScalar(c):b.set(1)}},g.SkinnedMesh.prototype.clone=function(a){return void 0===a&&(a=new g.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),g.Mesh.prototype.clone.call(this,a),a},g.SkinnedMesh.offsetMatrix=new g.Matrix4,g.MorphAnimMesh=function(a,b){g.Mesh.call(this,a,b),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},g.MorphAnimMesh.prototype=Object.create(g.Mesh.prototype),g.MorphAnimMesh.prototype.setFrameRange=function(a,b){this.startKeyframe=a,this.endKeyframe=b,this.length=this.endKeyframe-this.startKeyframe+1},g.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},g.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},g.MorphAnimMesh.prototype.parseAnimations=function(){var a=this.geometry;a.animations||(a.animations={});for(var b,c=a.animations,d=/([a-z]+)(\d+)/,e=0,f=a.morphTargets.length;f>e;e++){var g=a.morphTargets[e],h=g.name.match(d);if(h&&h.length>1){{var i=h[1];h[2]}c[i]||(c[i]={start:1/0,end:-1/0});var j=c[i];e<j.start&&(j.start=e),e>j.end&&(j.end=e),b||(b=i)}}a.firstAnimation=b},g.MorphAnimMesh.prototype.setAnimationLabel=function(a,b,c){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[a]={start:b,end:c}},g.MorphAnimMesh.prototype.playAnimation=function(a,b){var c=this.geometry.animations[a];c?(this.setFrameRange(c.start,c.end),this.duration=1e3*((c.end-c.start)/b),this.time=0):console.warn("animation["+a+"] undefined")},g.MorphAnimMesh.prototype.updateAnimation=function(a){var b=this.duration/this.length;this.time+=this.direction*a,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var c=this.startKeyframe+g.Math.clamp(Math.floor(this.time/b),0,this.length-1);c!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[c]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=c);var d=this.time%b/b;this.directionBackwards&&(d=1-d),this.morphTargetInfluences[this.currentKeyframe]=d,this.morphTargetInfluences[this.lastKeyframe]=1-d},g.MorphAnimMesh.prototype.clone=function(a){return void 0===a&&(a=new g.MorphAnimMesh(this.geometry,this.material)),a.duration=this.duration,a.mirroredLoop=this.mirroredLoop,a.time=this.time,a.lastKeyframe=this.lastKeyframe,a.currentKeyframe=this.currentKeyframe,a.direction=this.direction,a.directionBackwards=this.directionBackwards,g.Mesh.prototype.clone.call(this,a),a},g.Ribbon=function(a,b){g.Object3D.call(this),this.geometry=a,this.material=b},g.Ribbon.prototype=Object.create(g.Object3D.prototype),g.Ribbon.prototype.clone=function(a){return void 0===a&&(a=new g.Ribbon(this.geometry,this.material)),g.Object3D.prototype.clone.call(this,a),a},g.LOD=function(){g.Object3D.call(this),this.LODs=[]},g.LOD.prototype=Object.create(g.Object3D.prototype),g.LOD.prototype.addLevel=function(a,b){void 0===b&&(b=0),b=Math.abs(b);for(var c=0;c<this.LODs.length&&!(b<this.LODs[c].visibleAtDistance);c++);this.LODs.splice(c,0,{visibleAtDistance:b,object3D:a}),this.add(a)},g.LOD.prototype.update=function(a){if(this.LODs.length>1){a.matrixWorldInverse.getInverse(a.matrixWorld);var b=a.matrixWorldInverse,c=-(b.elements[2]*this.matrixWorld.elements[12]+b.elements[6]*this.matrixWorld.elements[13]+b.elements[10]*this.matrixWorld.elements[14]+b.elements[14]);this.LODs[0].object3D.visible=!0;for(var d=1;d<this.LODs.length&&c>=this.LODs[d].visibleAtDistance;d++)this.LODs[d-1].object3D.visible=!1,this.LODs[d].object3D.visible=!0;for(;d<this.LODs.length;d++)this.LODs[d].object3D.visible=!1}},g.LOD.prototype.clone=function(){},g.Sprite=function(a){g.Object3D.call(this),this.material=void 0!==a?a:new g.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},g.Sprite.prototype=Object.create(g.Object3D.prototype),g.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this.scale.x||1!==this.scale.y)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},g.Sprite.prototype.clone=function(a){return void 0===a&&(a=new g.Sprite(this.material)),g.Object3D.prototype.clone.call(this,a),a},g.Scene=function(){g.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},g.Scene.prototype=Object.create(g.Object3D.prototype),g.Scene.prototype.__addObject=function(a){if(a instanceof g.Light)-1===this.__lights.indexOf(a)&&this.__lights.push(a),a.target&&void 0===a.target.parent&&this.add(a.target);else if(!(a instanceof g.Camera||a instanceof g.Bone)&&-1===this.__objects.indexOf(a)){this.__objects.push(a),this.__objectsAdded.push(a);var b=this.__objectsRemoved.indexOf(a);-1!==b&&this.__objectsRemoved.splice(b,1)}for(var c=0;c<a.children.length;c++)this.__addObject(a.children[c])},g.Scene.prototype.__removeObject=function(a){if(a instanceof g.Light){var b=this.__lights.indexOf(a);-1!==b&&this.__lights.splice(b,1)}else if(!(a instanceof g.Camera)){var b=this.__objects.indexOf(a);if(-1!==b){this.__objects.splice(b,1),this.__objectsRemoved.push(a);var c=this.__objectsAdded.indexOf(a);-1!==c&&this.__objectsAdded.splice(c,1)}}for(var d=0;d<a.children.length;d++)this.__removeObject(a.children[d])},g.Fog=function(a,b,c){this.name="",this.color=new g.Color(a),this.near=void 0!==b?b:1,this.far=void 0!==c?c:1e3},g.Fog.prototype.clone=function(){return new g.Fog(this.color.getHex(),this.near,this.far)},g.FogExp2=function(a,b){this.name="",this.color=new g.Color(a),this.density=void 0!==b?b:25e-5},g.FogExp2.prototype.clone=function(){return new g.FogExp2(this.color.getHex(),this.density)},g.CanvasRenderer=function(a){function b(a){db!==a&&(ab.globalAlpha=a,db=a)}function c(a){eb!==a&&(a===g.NormalBlending?ab.globalCompositeOperation="source-over":a===g.AdditiveBlending?ab.globalCompositeOperation="lighter":a===g.SubtractiveBlending&&(ab.globalCompositeOperation="darker"),eb=a)}function d(a){hb!==a&&(ab.lineWidth=a,hb=a)}function f(a){ib!==a&&(ab.lineCap=a,ib=a)}function h(a){jb!==a&&(ab.lineJoin=a,jb=a)}function i(a){fb!==a&&(ab.strokeStyle=a,fb=a)}function j(a){gb!==a&&(ab.fillStyle=a,gb=a)}function k(a,b){(kb!==a||lb!==b)&&(ab.setLineDash([a,b]),kb=a,lb=b)}console.log("THREE.CanvasRenderer",g.REVISION);var l=g.Math.smoothstep;a=a||{};var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z=this,$=new g.Projector,_=void 0!==a.canvas?a.canvas:document.createElement("canvas"),ab=_.getContext("2d"),bb=new g.Color(0),cb=0,db=1,eb=0,fb=null,gb=null,hb=null,ib=null,jb=null,kb=null,lb=0,mb=new g.RenderableVertex,nb=new g.RenderableVertex,ob=new g.Color,pb=new g.Color,qb=new g.Color,rb=new g.Color,sb=new g.Color,tb=new g.Color,ub=new g.Color,vb=new g.Color,wb={},xb={},yb=new g.Box2,zb=new g.Box2,Ab=new g.Box2,Bb=!1,Cb=new g.Color,Db=new g.Color,Eb=new g.Color,Fb=new g.Vector3,Gb=16;T=document.createElement("canvas"),T.width=T.height=2,U=T.getContext("2d"),U.fillStyle="rgba(0,0,0,1)",U.fillRect(0,0,2,2),V=U.getImageData(0,0,2,2),W=V.data,X=document.createElement("canvas"),X.width=X.height=Gb,Y=X.getContext("2d"),Y.translate(-Gb/2,-Gb/2),Y.scale(Gb,Gb),Gb--,void 0===ab.setLineDash&&(ab.setLineDash=void 0!==ab.mozDash?function(a){ab.mozDash=null!==a[0]?a:null}:function(){}),this.domElement=_,this.devicePixelRatio=void 0!==a.devicePixelRatio?a.devicePixelRatio:void 0!==e.devicePixelRatio?e.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(a,b){p=a*this.devicePixelRatio,q=b*this.devicePixelRatio,r=Math.floor(p/2),s=Math.floor(q/2),_.width=p,_.height=q,_.style.width=a+"px",_.style.height=b+"px",yb.set(new g.Vector2(-r,-s),new g.Vector2(r,s)),zb.set(new g.Vector2(-r,-s),new g.Vector2(r,s)),db=1,eb=0,fb=null,gb=null,hb=null,ib=null,jb=null},this.setClearColor=function(a,b){bb.copy(a),cb=void 0!==b?b:1,zb.set(new g.Vector2(-r,-s),new g.Vector2(r,s))},this.setClearColorHex=function(a,b){bb.setHex(a),cb=void 0!==b?b:1,zb.set(new g.Vector2(-r,-s),new g.Vector2(r,s))},this.getMaxAnisotropy=function(){return 0},this.clear=function(){ab.setTransform(1,0,0,-1,r,s),zb.empty()===!1&&(zb.intersect(yb),zb.expandByScalar(2),1>cb&&ab.clearRect(0|zb.min.x,0|zb.min.y,zb.max.x-zb.min.x|0,zb.max.y-zb.min.y|0),cb>0&&(c(g.NormalBlending),b(1),j("rgba("+Math.floor(255*bb.r)+","+Math.floor(255*bb.g)+","+Math.floor(255*bb.b)+","+cb+")"),ab.fillRect(0|zb.min.x,0|zb.min.y,zb.max.x-zb.min.x|0,zb.max.y-zb.min.y|0)),zb.makeEmpty())},this.render=function(a,e){function p(){Cb.setRGB(0,0,0),Db.setRGB(0,0,0),Eb.setRGB(0,0,0);for(var a=0,b=o.length;b>a;a++){var c=o[a],d=c.color;c instanceof g.AmbientLight?Cb.add(d):c instanceof g.DirectionalLight?Db.add(d):c instanceof g.PointLight&&Eb.add(d)}}function q(a,b,c){for(var d=0,e=o.length;e>d;d++){var f=o[d];if(vb.copy(f.color),f instanceof g.DirectionalLight){var h=Fb.getPositionFromMatrix(f.matrixWorld).normalize(),i=b.dot(h);if(0>=i)continue;i*=f.intensity,c.add(vb.multiplyScalar(i))}else if(f instanceof g.PointLight){var h=Fb.getPositionFromMatrix(f.matrixWorld),i=b.dot(Fb.subVectors(h,a).normalize());if(0>=i)continue;if(i*=0==f.distance?1:1-Math.min(a.distanceTo(h)/f.distance,1),0==i)continue;i*=f.intensity,c.add(vb.multiplyScalar(i))}}}function _(a,d,e){b(e.opacity),c(e.blending);var f,h,k,l,m,n,o;if(e instanceof g.ParticleBasicMaterial)if(null===e.map){if(k=d.object.scale.x,l=d.object.scale.y,k*=d.scale.x*r,l*=d.scale.y*s,Ab.min.set(a.x-k,a.y-l),Ab.max.set(a.x+k,a.y+l),yb.isIntersectionBox(Ab)===!1)return;j(e.color.getStyle()),ab.save(),ab.translate(a.x,a.y),ab.rotate(-d.rotation),ab.scale(k,l),ab.fillRect(-1,-1,2,2),ab.restore()}else{if(m=e.map.image,n=m.width>>1,o=m.height>>1,k=d.scale.x*r,l=d.scale.y*s,f=k*n,h=l*o,Ab.min.set(a.x-f,a.y-h),Ab.max.set(a.x+f,a.y+h),yb.isIntersectionBox(Ab)===!1)return;ab.save(),ab.translate(a.x,a.y),ab.rotate(-d.rotation),ab.scale(k,-l),ab.translate(-n,-o),ab.drawImage(m,0,0),ab.restore()}else if(e instanceof g.ParticleCanvasMaterial){if(f=d.scale.x*r,h=d.scale.y*s,Ab.min.set(a.x-f,a.y-h),Ab.max.set(a.x+f,a.y+h),yb.isIntersectionBox(Ab)===!1)return;i(e.color.getStyle()),j(e.color.getStyle()),ab.save(),ab.translate(a.x,a.y),ab.rotate(-d.rotation),ab.scale(f,h),e.program(ab),ab.restore()}}function bb(a,e,j,l){b(l.opacity),c(l.blending),ab.beginPath(),ab.moveTo(a.positionScreen.x,a.positionScreen.y),ab.lineTo(e.positionScreen.x,e.positionScreen.y),l instanceof g.LineBasicMaterial?(d(l.linewidth),f(l.linecap),h(l.linejoin),i(l.color.getStyle()),k(null,null),ab.stroke(),Ab.expandByScalar(2*l.linewidth)):l instanceof g.LineDashedMaterial&&(d(l.linewidth),f(l.linecap),h(l.linejoin),i(l.color.getStyle()),k(l.dashSize,l.gapSize),ab.stroke(),Ab.expandByScalar(2*l.linewidth))}function cb(a,d,f,h,i,j,k,m){if(Z.info.render.vertices+=3,Z.info.render.faces++,b(m.opacity),c(m.blending),x=a.positionScreen.x,y=a.positionScreen.y,z=d.positionScreen.x,A=d.positionScreen.y,B=f.positionScreen.x,C=f.positionScreen.y,eb(x,y,z,A,B,C),(m instanceof g.MeshLambertMaterial||m instanceof g.MeshPhongMaterial)&&null===m.map)tb.copy(m.color),ub.copy(m.emissive),m.vertexColors===g.FaceColors&&tb.multiply(k.color),Bb===!0?m.wireframe===!1&&m.shading==g.SmoothShading&&3==k.vertexNormalsLength?(pb.copy(Cb),qb.copy(Cb),rb.copy(Cb),q(k.v1.positionWorld,k.vertexNormalsModel[0],pb),q(k.v2.positionWorld,k.vertexNormalsModel[1],qb),q(k.v3.positionWorld,k.vertexNormalsModel[2],rb),pb.multiply(tb).add(ub),qb.multiply(tb).add(ub),rb.multiply(tb).add(ub),sb.addColors(qb,rb).multiplyScalar(.5),L=kb(pb,qb,rb,sb),jb(x,y,z,A,B,C,0,0,1,0,0,1,L)):(ob.copy(Cb),q(k.centroidModel,k.normalModel,ob),ob.multiply(tb).add(ub),m.wireframe===!0?gb(ob,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):hb(ob)):m.wireframe===!0?gb(m.color,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):hb(m.color);else if(m instanceof g.MeshBasicMaterial||m instanceof g.MeshLambertMaterial||m instanceof g.MeshPhongMaterial)null!==m.map?m.map.mapping instanceof g.UVMapping&&(M=k.uvs[0],ib(x,y,z,A,B,C,M[h].x,M[h].y,M[i].x,M[i].y,M[j].x,M[j].y,m.map)):null!==m.envMap?m.envMap.mapping instanceof g.SphericalReflectionMapping&&(Fb.copy(k.vertexNormalsModelView[h]),N=.5*Fb.x+.5,O=.5*Fb.y+.5,Fb.copy(k.vertexNormalsModelView[i]),P=.5*Fb.x+.5,Q=.5*Fb.y+.5,Fb.copy(k.vertexNormalsModelView[j]),R=.5*Fb.x+.5,S=.5*Fb.y+.5,ib(x,y,z,A,B,C,N,O,P,Q,R,S,m.envMap)):(ob.copy(m.color),m.vertexColors===g.FaceColors&&ob.multiply(k.color),m.wireframe===!0?gb(ob,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):hb(ob));else if(m instanceof g.MeshDepthMaterial)J=e.near,K=e.far,pb.r=pb.g=pb.b=1-l(a.positionScreen.z*a.positionScreen.w,J,K),qb.r=qb.g=qb.b=1-l(d.positionScreen.z*d.positionScreen.w,J,K),rb.r=rb.g=rb.b=1-l(f.positionScreen.z*f.positionScreen.w,J,K),sb.addColors(qb,rb).multiplyScalar(.5),L=kb(pb,qb,rb,sb),jb(x,y,z,A,B,C,0,0,1,0,0,1,L);else if(m instanceof g.MeshNormalMaterial){var n;m.shading==g.FlatShading?(n=k.normalModelView,ob.setRGB(n.x,n.y,n.z).multiplyScalar(.5).addScalar(.5),m.wireframe===!0?gb(ob,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):hb(ob)):m.shading==g.SmoothShading&&(n=k.vertexNormalsModelView[h],pb.setRGB(n.x,n.y,n.z).multiplyScalar(.5).addScalar(.5),n=k.vertexNormalsModelView[i],qb.setRGB(n.x,n.y,n.z).multiplyScalar(.5).addScalar(.5),n=k.vertexNormalsModelView[j],rb.setRGB(n.x,n.y,n.z).multiplyScalar(.5).addScalar(.5),sb.addColors(qb,rb).multiplyScalar(.5),L=kb(pb,qb,rb,sb),jb(x,y,z,A,B,C,0,0,1,0,0,1,L))}}function db(a,d,f,h,i,j,k,m){if(Z.info.render.vertices+=4,Z.info.render.faces++,b(m.opacity),c(m.blending),void 0!==m.map&&null!==m.map||void 0!==m.envMap&&null!==m.envMap)return cb(a,d,h,0,1,3,k,m),cb(i,f,j,1,2,3,k,m),void 0;if(x=a.positionScreen.x,y=a.positionScreen.y,z=d.positionScreen.x,A=d.positionScreen.y,B=f.positionScreen.x,C=f.positionScreen.y,D=h.positionScreen.x,E=h.positionScreen.y,F=i.positionScreen.x,G=i.positionScreen.y,H=j.positionScreen.x,I=j.positionScreen.y,m instanceof g.MeshLambertMaterial||m instanceof g.MeshPhongMaterial)tb.copy(m.color),ub.copy(m.emissive),m.vertexColors===g.FaceColors&&tb.multiply(k.color),Bb===!0?m.wireframe===!1&&m.shading==g.SmoothShading&&4==k.vertexNormalsLength?(pb.copy(Cb),qb.copy(Cb),rb.copy(Cb),sb.copy(Cb),q(k.v1.positionWorld,k.vertexNormalsModel[0],pb),q(k.v2.positionWorld,k.vertexNormalsModel[1],qb),q(k.v4.positionWorld,k.vertexNormalsModel[3],rb),q(k.v3.positionWorld,k.vertexNormalsModel[2],sb),pb.multiply(tb).add(ub),qb.multiply(tb).add(ub),rb.multiply(tb).add(ub),sb.multiply(tb).add(ub),L=kb(pb,qb,rb,sb),eb(x,y,z,A,D,E),jb(x,y,z,A,D,E,0,0,1,0,0,1,L),eb(F,G,B,C,H,I),jb(F,G,B,C,H,I,1,0,1,1,0,1,L)):(ob.copy(Cb),q(k.centroidModel,k.normalModel,ob),ob.multiply(tb).add(ub),fb(x,y,z,A,B,C,D,E),m.wireframe===!0?gb(ob,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):hb(ob)):(ob.addColors(tb,ub),fb(x,y,z,A,B,C,D,E),m.wireframe===!0?gb(ob,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):hb(ob));else if(m instanceof g.MeshBasicMaterial)ob.copy(m.color),m.vertexColors===g.FaceColors&&ob.multiply(k.color),fb(x,y,z,A,B,C,D,E),m.wireframe===!0?gb(ob,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):hb(ob);else if(m instanceof g.MeshNormalMaterial){var n;m.shading==g.FlatShading?(n=k.normalModelView,ob.setRGB(n.x,n.y,n.z).multiplyScalar(.5).addScalar(.5),fb(x,y,z,A,B,C,D,E),m.wireframe===!0?gb(ob,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):hb(ob)):m.shading==g.SmoothShading&&(n=k.vertexNormalsModelView[0],pb.setRGB(n.x,n.y,n.z).multiplyScalar(.5).addScalar(.5),n=k.vertexNormalsModelView[1],qb.setRGB(n.x,n.y,n.z).multiplyScalar(.5).addScalar(.5),n=k.vertexNormalsModelView[3],rb.setRGB(n.x,n.y,n.z).multiplyScalar(.5).addScalar(.5),n=k.vertexNormalsModelView[2],sb.setRGB(n.x,n.y,n.z).multiplyScalar(.5).addScalar(.5),L=kb(pb,qb,rb,sb),eb(x,y,z,A,D,E),jb(x,y,z,A,D,E,0,0,1,0,0,1,L),eb(F,G,B,C,H,I),jb(F,G,B,C,H,I,1,0,1,1,0,1,L))}else m instanceof g.MeshDepthMaterial&&(J=e.near,K=e.far,pb.r=pb.g=pb.b=1-l(a.positionScreen.z*a.positionScreen.w,J,K),qb.r=qb.g=qb.b=1-l(d.positionScreen.z*d.positionScreen.w,J,K),rb.r=rb.g=rb.b=1-l(h.positionScreen.z*h.positionScreen.w,J,K),sb.r=sb.g=sb.b=1-l(f.positionScreen.z*f.positionScreen.w,J,K),L=kb(pb,qb,rb,sb),eb(x,y,z,A,D,E),jb(x,y,z,A,D,E,0,0,1,0,0,1,L),eb(F,G,B,C,H,I),jb(F,G,B,C,H,I,1,0,1,1,0,1,L))}function eb(a,b,c,d,e,f){ab.beginPath(),ab.moveTo(a,b),ab.lineTo(c,d),ab.lineTo(e,f),ab.closePath()}function fb(a,b,c,d,e,f,g,h){ab.beginPath(),ab.moveTo(a,b),ab.lineTo(c,d),ab.lineTo(e,f),ab.lineTo(g,h),ab.closePath()}function gb(a,b,c,e){d(b),f(c),h(e),i(a.getStyle()),ab.stroke(),Ab.expandByScalar(2*b)}function hb(a){j(a.getStyle()),ab.fill()}function ib(a,b,c,d,e,f,h,i,k,l,m,n,o){if(!(o instanceof g.DataTexture||void 0===o.image||0==o.image.width)){if(o.needsUpdate===!0){var p=o.wrapS==g.RepeatWrapping,q=o.wrapT==g.RepeatWrapping;wb[o.id]=ab.createPattern(o.image,p===!0&&q===!0?"repeat":p===!0&&q===!1?"repeat-x":p===!1&&q===!0?"repeat-y":"no-repeat"),o.needsUpdate=!1}void 0===wb[o.id]?j("rgba(0,0,0,1)"):j(wb[o.id]);var r,s,t,u,v,w,x,y,z=o.offset.x/o.repeat.x,A=o.offset.y/o.repeat.y,B=o.image.width*o.repeat.x,C=o.image.height*o.repeat.y;if(h=(h+z)*B,i=(1-i+A)*C,k=(k+z)*B,l=(1-l+A)*C,m=(m+z)*B,n=(1-n+A)*C,c-=a,d-=b,e-=a,f-=b,k-=h,l-=i,m-=h,n-=i,x=k*n-m*l,0===x){if(void 0===xb[o.id]){var D=document.createElement("canvas");D.width=o.image.width,D.height=o.image.height;var E=D.getContext("2d");E.drawImage(o.image,0,0),xb[o.id]=E.getImageData(0,0,o.image.width,o.image.height).data}var F=xb[o.id],G=4*(Math.floor(h)+Math.floor(i)*o.image.width);return ob.setRGB(F[G]/255,F[G+1]/255,F[G+2]/255),hb(ob),void 0}y=1/x,r=(n*c-l*e)*y,s=(n*d-l*f)*y,t=(k*e-m*c)*y,u=(k*f-m*d)*y,v=a-r*h-t*i,w=b-s*h-u*i,ab.save(),ab.transform(r,s,t,u,v,w),ab.fill(),ab.restore()}}function jb(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p,q,r,s,t,u,v=m.width-1,w=m.height-1;g*=v,h*=w,i*=v,j*=w,k*=v,l*=w,c-=a,d-=b,e-=a,f-=b,i-=g,j-=h,k-=g,l-=h,t=i*l-k*j,u=1/t,n=(l*c-j*e)*u,o=(l*d-j*f)*u,p=(i*e-k*c)*u,q=(i*f-k*d)*u,r=a-n*g-p*h,s=b-o*g-q*h,ab.save(),ab.transform(n,o,p,q,r,s),ab.clip(),ab.drawImage(m,0,0),ab.restore()}function kb(a,b,c,d){return W[0]=255*a.r|0,W[1]=255*a.g|0,W[2]=255*a.b|0,W[4]=255*b.r|0,W[5]=255*b.g|0,W[6]=255*b.b|0,W[8]=255*c.r|0,W[9]=255*c.g|0,W[10]=255*c.b|0,W[12]=255*d.r|0,W[13]=255*d.g|0,W[14]=255*d.b|0,U.putImageData(V,0,0),Y.drawImage(T,0,0),X}function lb(a,b){var c,d=b.x-a.x,e=b.y-a.y,f=d*d+e*e;0!==f&&(c=1/Math.sqrt(f),d*=c,e*=c,b.x+=d,b.y+=e,a.x-=d,a.y-=e)}if(e instanceof g.Camera==!1)return console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera."),void 0;this.autoClear===!0&&this.clear(),ab.setTransform(1,0,0,-1,r,s),Z.info.render.vertices=0,Z.info.render.faces=0,m=$.projectScene(a,e,this.sortObjects,this.sortElements),n=m.elements,o=m.lights,Bb=o.length>0,Bb===!0&&p();for(var Gb=0,Hb=n.length;Hb>Gb;Gb++){var Ib=n[Gb],Jb=Ib.material;if(void 0!==Jb&&Jb.visible!==!1){if(Ab.makeEmpty(),Ib instanceof g.RenderableParticle)t=Ib,t.x*=r,t.y*=s,_(t,Ib,Jb);else if(Ib instanceof g.RenderableLine)t=Ib.v1,u=Ib.v2,t.positionScreen.x*=r,t.positionScreen.y*=s,u.positionScreen.x*=r,u.positionScreen.y*=s,Ab.setFromPoints([t.positionScreen,u.positionScreen]),yb.isIntersectionBox(Ab)===!0&&bb(t,u,Ib,Jb);else if(Ib instanceof g.RenderableFace3){if(t=Ib.v1,u=Ib.v2,v=Ib.v3,t.positionScreen.z<-1||t.positionScreen.z>1)continue;if(u.positionScreen.z<-1||u.positionScreen.z>1)continue;if(v.positionScreen.z<-1||v.positionScreen.z>1)continue;t.positionScreen.x*=r,t.positionScreen.y*=s,u.positionScreen.x*=r,u.positionScreen.y*=s,v.positionScreen.x*=r,v.positionScreen.y*=s,Jb.overdraw===!0&&(lb(t.positionScreen,u.positionScreen),lb(u.positionScreen,v.positionScreen),lb(v.positionScreen,t.positionScreen)),Ab.setFromPoints([t.positionScreen,u.positionScreen,v.positionScreen]),cb(t,u,v,0,1,2,Ib,Jb)}else if(Ib instanceof g.RenderableFace4){if(t=Ib.v1,u=Ib.v2,v=Ib.v3,w=Ib.v4,t.positionScreen.z<-1||t.positionScreen.z>1)continue;if(u.positionScreen.z<-1||u.positionScreen.z>1)continue;if(v.positionScreen.z<-1||v.positionScreen.z>1)continue;if(w.positionScreen.z<-1||w.positionScreen.z>1)continue;t.positionScreen.x*=r,t.positionScreen.y*=s,u.positionScreen.x*=r,u.positionScreen.y*=s,v.positionScreen.x*=r,v.positionScreen.y*=s,w.positionScreen.x*=r,w.positionScreen.y*=s,mb.positionScreen.copy(u.positionScreen),nb.positionScreen.copy(w.positionScreen),Jb.overdraw===!0&&(lb(t.positionScreen,u.positionScreen),lb(u.positionScreen,w.positionScreen),lb(w.positionScreen,t.positionScreen),lb(v.positionScreen,mb.positionScreen),lb(v.positionScreen,nb.positionScreen)),Ab.setFromPoints([t.positionScreen,u.positionScreen,v.positionScreen,w.positionScreen]),db(t,u,v,w,mb,nb,Ib,Jb,a)}zb.union(Ab)}}ab.setTransform(1,0,0,1,0,0)}},g.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;","else shadowKernel[0][0] = 0.0;","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;","else shadowKernel[0][1] = 0.0;","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;","else shadowKernel[0][2] = 0.0;","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;","else shadowKernel[1][0] = 0.0;","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;","else shadowKernel[1][1] = 0.0;","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;","else shadowKernel[1][2] = 0.0;","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;","else shadowKernel[2][0] = 0.0;","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;","else shadowKernel[2][1] = 0.0;","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;","else shadowKernel[2][2] = 0.0;","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},g.UniformsUtils={merge:function(a){var b,c,d,e={};
for(b=0;b<a.length;b++){d=this.clone(a[b]);for(c in d)e[c]=d[c]}return e},clone:function(a){var b,c,d,e={};for(b in a){e[b]={};for(c in a[b])d=a[b][c],e[b][c]=d instanceof g.Color||d instanceof g.Vector2||d instanceof g.Vector3||d instanceof g.Vector4||d instanceof g.Matrix4||d instanceof g.Texture?d.clone():d instanceof Array?d.slice():d}return e}},g.UniformsLib={common:{diffuse:{type:"c",value:new g.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new g.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new g.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new g.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new g.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new g.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},g.ShaderLib={basic:{uniforms:g.UniformsUtils.merge([g.UniformsLib.common,g.UniformsLib.fog,g.UniformsLib.shadowmap]),vertexShader:[g.ShaderChunk.map_pars_vertex,g.ShaderChunk.lightmap_pars_vertex,g.ShaderChunk.envmap_pars_vertex,g.ShaderChunk.color_pars_vertex,g.ShaderChunk.morphtarget_pars_vertex,g.ShaderChunk.skinning_pars_vertex,g.ShaderChunk.shadowmap_pars_vertex,"void main() {",g.ShaderChunk.map_vertex,g.ShaderChunk.lightmap_vertex,g.ShaderChunk.color_vertex,g.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",g.ShaderChunk.morphnormal_vertex,g.ShaderChunk.skinnormal_vertex,g.ShaderChunk.defaultnormal_vertex,"#endif",g.ShaderChunk.morphtarget_vertex,g.ShaderChunk.skinning_vertex,g.ShaderChunk.default_vertex,g.ShaderChunk.worldpos_vertex,g.ShaderChunk.envmap_vertex,g.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",g.ShaderChunk.color_pars_fragment,g.ShaderChunk.map_pars_fragment,g.ShaderChunk.lightmap_pars_fragment,g.ShaderChunk.envmap_pars_fragment,g.ShaderChunk.fog_pars_fragment,g.ShaderChunk.shadowmap_pars_fragment,g.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",g.ShaderChunk.map_fragment,g.ShaderChunk.alphatest_fragment,g.ShaderChunk.specularmap_fragment,g.ShaderChunk.lightmap_fragment,g.ShaderChunk.color_fragment,g.ShaderChunk.envmap_fragment,g.ShaderChunk.shadowmap_fragment,g.ShaderChunk.linear_to_gamma_fragment,g.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:g.UniformsUtils.merge([g.UniformsLib.common,g.UniformsLib.fog,g.UniformsLib.lights,g.UniformsLib.shadowmap,{ambient:{type:"c",value:new g.Color(16777215)},emissive:{type:"c",value:new g.Color(0)},wrapRGB:{type:"v3",value:new g.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",g.ShaderChunk.map_pars_vertex,g.ShaderChunk.lightmap_pars_vertex,g.ShaderChunk.envmap_pars_vertex,g.ShaderChunk.lights_lambert_pars_vertex,g.ShaderChunk.color_pars_vertex,g.ShaderChunk.morphtarget_pars_vertex,g.ShaderChunk.skinning_pars_vertex,g.ShaderChunk.shadowmap_pars_vertex,"void main() {",g.ShaderChunk.map_vertex,g.ShaderChunk.lightmap_vertex,g.ShaderChunk.color_vertex,g.ShaderChunk.morphnormal_vertex,g.ShaderChunk.skinbase_vertex,g.ShaderChunk.skinnormal_vertex,g.ShaderChunk.defaultnormal_vertex,g.ShaderChunk.morphtarget_vertex,g.ShaderChunk.skinning_vertex,g.ShaderChunk.default_vertex,g.ShaderChunk.worldpos_vertex,g.ShaderChunk.envmap_vertex,g.ShaderChunk.lights_lambert_vertex,g.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",g.ShaderChunk.color_pars_fragment,g.ShaderChunk.map_pars_fragment,g.ShaderChunk.lightmap_pars_fragment,g.ShaderChunk.envmap_pars_fragment,g.ShaderChunk.fog_pars_fragment,g.ShaderChunk.shadowmap_pars_fragment,g.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",g.ShaderChunk.map_fragment,g.ShaderChunk.alphatest_fragment,g.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",g.ShaderChunk.lightmap_fragment,g.ShaderChunk.color_fragment,g.ShaderChunk.envmap_fragment,g.ShaderChunk.shadowmap_fragment,g.ShaderChunk.linear_to_gamma_fragment,g.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:g.UniformsUtils.merge([g.UniformsLib.common,g.UniformsLib.bump,g.UniformsLib.normalmap,g.UniformsLib.fog,g.UniformsLib.lights,g.UniformsLib.shadowmap,{ambient:{type:"c",value:new g.Color(16777215)},emissive:{type:"c",value:new g.Color(0)},specular:{type:"c",value:new g.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new g.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",g.ShaderChunk.map_pars_vertex,g.ShaderChunk.lightmap_pars_vertex,g.ShaderChunk.envmap_pars_vertex,g.ShaderChunk.lights_phong_pars_vertex,g.ShaderChunk.color_pars_vertex,g.ShaderChunk.morphtarget_pars_vertex,g.ShaderChunk.skinning_pars_vertex,g.ShaderChunk.shadowmap_pars_vertex,"void main() {",g.ShaderChunk.map_vertex,g.ShaderChunk.lightmap_vertex,g.ShaderChunk.color_vertex,g.ShaderChunk.morphnormal_vertex,g.ShaderChunk.skinbase_vertex,g.ShaderChunk.skinnormal_vertex,g.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",g.ShaderChunk.morphtarget_vertex,g.ShaderChunk.skinning_vertex,g.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",g.ShaderChunk.worldpos_vertex,g.ShaderChunk.envmap_vertex,g.ShaderChunk.lights_phong_vertex,g.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",g.ShaderChunk.color_pars_fragment,g.ShaderChunk.map_pars_fragment,g.ShaderChunk.lightmap_pars_fragment,g.ShaderChunk.envmap_pars_fragment,g.ShaderChunk.fog_pars_fragment,g.ShaderChunk.lights_phong_pars_fragment,g.ShaderChunk.shadowmap_pars_fragment,g.ShaderChunk.bumpmap_pars_fragment,g.ShaderChunk.normalmap_pars_fragment,g.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",g.ShaderChunk.map_fragment,g.ShaderChunk.alphatest_fragment,g.ShaderChunk.specularmap_fragment,g.ShaderChunk.lights_phong_fragment,g.ShaderChunk.lightmap_fragment,g.ShaderChunk.color_fragment,g.ShaderChunk.envmap_fragment,g.ShaderChunk.shadowmap_fragment,g.ShaderChunk.linear_to_gamma_fragment,g.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:g.UniformsUtils.merge([g.UniformsLib.particle,g.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",g.ShaderChunk.color_pars_vertex,g.ShaderChunk.shadowmap_pars_vertex,"void main() {",g.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",g.ShaderChunk.worldpos_vertex,g.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",g.ShaderChunk.color_pars_fragment,g.ShaderChunk.map_particle_pars_fragment,g.ShaderChunk.fog_pars_fragment,g.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",g.ShaderChunk.map_particle_fragment,g.ShaderChunk.alphatest_fragment,g.ShaderChunk.color_fragment,g.ShaderChunk.shadowmap_fragment,g.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:g.UniformsUtils.merge([g.UniformsLib.common,g.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",g.ShaderChunk.color_pars_vertex,"void main() {",g.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",g.ShaderChunk.color_pars_fragment,g.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",g.ShaderChunk.color_fragment,g.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:g.UniformsUtils.merge([g.UniformsLib.fog,g.UniformsLib.lights,g.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new g.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new g.Color(16777215)},uSpecularColor:{type:"c",value:new g.Color(1118481)},uAmbientColor:{type:"c",value:new g.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new g.Vector2(0,0)},uRepeat:{type:"v2",value:new g.Vector2(1,1)},wrapRGB:{type:"v3",value:new g.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",g.ShaderChunk.shadowmap_pars_fragment,g.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",g.ShaderChunk.shadowmap_fragment,g.ShaderChunk.linear_to_gamma_fragment,g.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",g.ShaderChunk.skinning_pars_vertex,g.ShaderChunk.shadowmap_pars_vertex,"void main() {",g.ShaderChunk.skinbase_vertex,g.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[g.ShaderChunk.morphtarget_pars_vertex,g.ShaderChunk.skinning_pars_vertex,"void main() {",g.ShaderChunk.skinbase_vertex,g.ShaderChunk.morphtarget_vertex,g.ShaderChunk.skinning_vertex,g.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},g.WebGLRenderer=function(a){function b(a){a.__webglVertexBuffer=Ob.createBuffer(),a.__webglColorBuffer=Ob.createBuffer(),Tb.info.memory.geometries++}function c(a){a.__webglVertexBuffer=Ob.createBuffer(),a.__webglColorBuffer=Ob.createBuffer(),a.__webglLineDistanceBuffer=Ob.createBuffer(),Tb.info.memory.geometries++}function d(a){a.__webglVertexBuffer=Ob.createBuffer(),a.__webglColorBuffer=Ob.createBuffer(),a.__webglNormalBuffer=Ob.createBuffer(),Tb.info.memory.geometries++}function f(a){a.__webglVertexBuffer=Ob.createBuffer(),a.__webglNormalBuffer=Ob.createBuffer(),a.__webglTangentBuffer=Ob.createBuffer(),a.__webglColorBuffer=Ob.createBuffer(),a.__webglUVBuffer=Ob.createBuffer(),a.__webglUV2Buffer=Ob.createBuffer(),a.__webglSkinIndicesBuffer=Ob.createBuffer(),a.__webglSkinWeightsBuffer=Ob.createBuffer(),a.__webglFaceBuffer=Ob.createBuffer(),a.__webglLineBuffer=Ob.createBuffer();var b,c;if(a.numMorphTargets)for(a.__webglMorphTargetsBuffers=[],b=0,c=a.numMorphTargets;c>b;b++)a.__webglMorphTargetsBuffers.push(Ob.createBuffer());if(a.numMorphNormals)for(a.__webglMorphNormalsBuffers=[],b=0,c=a.numMorphNormals;c>b;b++)a.__webglMorphNormalsBuffers.push(Ob.createBuffer());Tb.info.memory.geometries++}function h(a){if(a.__webglCustomAttributesList)for(var b in a.__webglCustomAttributesList)Ob.deleteBuffer(a.__webglCustomAttributesList[b].buffer)}function i(a,b){var c=a.vertices.length,d=b.material;if(d.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var e in d.attributes){var f=d.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=!0;var g=1;"v2"===f.type?g=2:"v3"===f.type?g=3:"v4"===f.type?g=4:"c"===f.type&&(g=3),f.size=g,f.array=new Float32Array(c*g),f.buffer=Ob.createBuffer(),f.buffer.belongsToAttribute=e,f.needsUpdate=!0}a.__webglCustomAttributesList.push(f)}}}function j(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(3*c),a.__colorArray=new Float32Array(3*c),a.__sortArray=[],a.__webglParticleCount=c,i(a,b)}function k(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(3*c),a.__colorArray=new Float32Array(3*c),a.__lineDistanceArray=new Float32Array(1*c),a.__webglLineCount=c,i(a,b)}function l(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(3*c),a.__colorArray=new Float32Array(3*c),a.__normalArray=new Float32Array(3*c),a.__webglVertexCount=c,i(a,b)}function m(a,b){var c=b.geometry,d=a.faces3,e=a.faces4,f=3*d.length+4*e.length,g=1*d.length+2*e.length,h=3*d.length+4*e.length,i=n(b,a),j=r(i),k=p(i),l=q(i);a.__vertexArray=new Float32Array(3*f),k&&(a.__normalArray=new Float32Array(3*f)),c.hasTangents&&(a.__tangentArray=new Float32Array(4*f)),l&&(a.__colorArray=new Float32Array(3*f)),j&&((c.faceUvs.length>0||c.faceVertexUvs.length>0)&&(a.__uvArray=new Float32Array(2*f)),(c.faceUvs.length>1||c.faceVertexUvs.length>1)&&(a.__uv2Array=new Float32Array(2*f))),b.geometry.skinWeights.length&&b.geometry.skinIndices.length&&(a.__skinIndexArray=new Float32Array(4*f),a.__skinWeightArray=new Float32Array(4*f)),a.__faceArray=new Uint16Array(3*g),a.__lineArray=new Uint16Array(2*h);var m,o;if(a.numMorphTargets)for(a.__morphTargetsArrays=[],m=0,o=a.numMorphTargets;o>m;m++)a.__morphTargetsArrays.push(new Float32Array(3*f));if(a.numMorphNormals)for(a.__morphNormalsArrays=[],m=0,o=a.numMorphNormals;o>m;m++)a.__morphNormalsArrays.push(new Float32Array(3*f));if(a.__webglFaceCount=3*g,a.__webglLineCount=2*h,i.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var s in i.attributes){var t=i.attributes[s],u={};for(var v in t)u[v]=t[v];if(!u.__webglInitialized||u.createUniqueBuffers){u.__webglInitialized=!0;var w=1;"v2"===u.type?w=2:"v3"===u.type?w=3:"v4"===u.type?w=4:"c"===u.type&&(w=3),u.size=w,u.array=new Float32Array(f*w),u.buffer=Ob.createBuffer(),u.buffer.belongsToAttribute=s,t.needsUpdate=!0,u.__original=t}a.__webglCustomAttributesList.push(u)}}a.__inittedArrays=!0}function n(a,b){return a.material instanceof g.MeshFaceMaterial?a.material.materials[b.materialIndex]:a.material}function o(a){return a&&void 0!==a.shading&&a.shading===g.SmoothShading}function p(a){return a instanceof g.MeshBasicMaterial&&!a.envMap||a instanceof g.MeshDepthMaterial?!1:o(a)?g.SmoothShading:g.FlatShading}function q(a){return a.vertexColors?a.vertexColors:!1}function r(a){return a.map||a.lightMap||a.bumpMap||a.normalMap||a.specularMap||a instanceof g.ShaderMaterial?!0:!1}function s(a){var b,c,d;for(b in a.attributes)d="index"===b?Ob.ELEMENT_ARRAY_BUFFER:Ob.ARRAY_BUFFER,c=a.attributes[b],c.buffer=Ob.createBuffer(),Ob.bindBuffer(d,c.buffer),Ob.bufferData(d,c.array,Ob.STATIC_DRAW)}function t(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=a.vertices,q=p.length,r=a.colors,s=r.length,t=a.__vertexArray,u=a.__colorArray,v=a.__sortArray,w=a.verticesNeedUpdate,x=(a.elementsNeedUpdate,a.colorsNeedUpdate),y=a.__webglCustomAttributesList;if(c.sortParticles){for(wc.copy(vc),wc.multiply(c.matrixWorld),d=0;q>d;d++)f=p[d],xc.copy(f),xc.applyProjection(wc),v[d]=[xc.z,d];for(v.sort(C),d=0;q>d;d++)f=p[v[d][1]],g=3*d,t[g]=f.x,t[g+1]=f.y,t[g+2]=f.z;for(e=0;s>e;e++)g=3*e,i=r[v[e][1]],u[g]=i.r,u[g+1]=i.g,u[g+2]=i.b;if(y)for(j=0,k=y.length;k>j;j++)if(o=y[j],void 0===o.boundTo||"vertices"===o.boundTo)if(g=0,m=o.value.length,1===o.size)for(l=0;m>l;l++)h=v[l][1],o.array[l]=o.value[h];else if(2===o.size)for(l=0;m>l;l++)h=v[l][1],n=o.value[h],o.array[g]=n.x,o.array[g+1]=n.y,g+=2;else if(3===o.size)if("c"===o.type)for(l=0;m>l;l++)h=v[l][1],n=o.value[h],o.array[g]=n.r,o.array[g+1]=n.g,o.array[g+2]=n.b,g+=3;else for(l=0;m>l;l++)h=v[l][1],n=o.value[h],o.array[g]=n.x,o.array[g+1]=n.y,o.array[g+2]=n.z,g+=3;else if(4===o.size)for(l=0;m>l;l++)h=v[l][1],n=o.value[h],o.array[g]=n.x,o.array[g+1]=n.y,o.array[g+2]=n.z,o.array[g+3]=n.w,g+=4
}else{if(w)for(d=0;q>d;d++)f=p[d],g=3*d,t[g]=f.x,t[g+1]=f.y,t[g+2]=f.z;if(x)for(e=0;s>e;e++)i=r[e],g=3*e,u[g]=i.r,u[g+1]=i.g,u[g+2]=i.b;if(y)for(j=0,k=y.length;k>j;j++)if(o=y[j],o.needsUpdate&&(void 0===o.boundTo||"vertices"===o.boundTo))if(m=o.value.length,g=0,1===o.size)for(l=0;m>l;l++)o.array[l]=o.value[l];else if(2===o.size)for(l=0;m>l;l++)n=o.value[l],o.array[g]=n.x,o.array[g+1]=n.y,g+=2;else if(3===o.size)if("c"===o.type)for(l=0;m>l;l++)n=o.value[l],o.array[g]=n.r,o.array[g+1]=n.g,o.array[g+2]=n.b,g+=3;else for(l=0;m>l;l++)n=o.value[l],o.array[g]=n.x,o.array[g+1]=n.y,o.array[g+2]=n.z,g+=3;else if(4===o.size)for(l=0;m>l;l++)n=o.value[l],o.array[g]=n.x,o.array[g+1]=n.y,o.array[g+2]=n.z,o.array[g+3]=n.w,g+=4}if((w||c.sortParticles)&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglVertexBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,t,b)),(x||c.sortParticles)&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglColorBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,u,b)),y)for(j=0,k=y.length;k>j;j++)o=y[j],(o.needsUpdate||c.sortParticles)&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,o.buffer),Ob.bufferData(Ob.ARRAY_BUFFER,o.array,b))}function u(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=a.vertices,p=a.colors,q=a.lineDistances,r=o.length,s=p.length,t=q.length,u=a.__vertexArray,v=a.__colorArray,w=a.__lineDistanceArray,x=a.verticesNeedUpdate,y=a.colorsNeedUpdate,z=a.lineDistancesNeedUpdate,A=a.__webglCustomAttributesList;if(x){for(c=0;r>c;c++)f=o[c],g=3*c,u[g]=f.x,u[g+1]=f.y,u[g+2]=f.z;Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglVertexBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,u,b)}if(y){for(d=0;s>d;d++)h=p[d],g=3*d,v[g]=h.r,v[g+1]=h.g,v[g+2]=h.b;Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglColorBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,v,b)}if(z){for(e=0;t>e;e++)w[e]=q[e];Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglLineDistanceBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,w,b)}if(A)for(i=0,j=A.length;j>i;i++)if(n=A[i],n.needsUpdate&&(void 0===n.boundTo||"vertices"===n.boundTo)){if(g=0,l=n.value.length,1===n.size)for(k=0;l>k;k++)n.array[k]=n.value[k];else if(2===n.size)for(k=0;l>k;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,g+=2;else if(3===n.size)if("c"===n.type)for(k=0;l>k;k++)m=n.value[k],n.array[g]=m.r,n.array[g+1]=m.g,n.array[g+2]=m.b,g+=3;else for(k=0;l>k;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,g+=3;else if(4===n.size)for(k=0;l>k;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,n.array[g+3]=m.w,g+=4;Ob.bindBuffer(Ob.ARRAY_BUFFER,n.buffer),Ob.bufferData(Ob.ARRAY_BUFFER,n.array,b)}}function v(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=a.vertices,q=a.colors,r=a.normals,s=p.length,t=q.length,u=r.length,v=a.__vertexArray,w=a.__colorArray,x=a.__normalArray,y=a.verticesNeedUpdate,z=a.colorsNeedUpdate,A=a.normalsNeedUpdate,B=a.__webglCustomAttributesList;if(y){for(c=0;s>c;c++)f=p[c],g=3*c,v[g]=f.x,v[g+1]=f.y,v[g+2]=f.z;Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglVertexBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,v,b)}if(z){for(d=0;t>d;d++)h=q[d],g=3*d,w[g]=h.r,w[g+1]=h.g,w[g+2]=h.b;Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglColorBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,w,b)}if(A){for(e=0;u>e;e++)i=r[e],g=3*e,x[g]=i.x,x[g+1]=i.y,x[g+2]=i.z;Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglNormalBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,x,b)}if(B)for(j=0,k=B.length;k>j;j++)if(n=B[j],n.needsUpdate&&(void 0===n.boundTo||"vertices"===n.boundTo)){if(g=0,m=n.value.length,1===n.size)for(l=0;m>l;l++)n.array[l]=n.value[l];else if(2===n.size)for(l=0;m>l;l++)o=n.value[l],n.array[g]=o.x,n.array[g+1]=o.y,g+=2;else if(3===n.size)if("c"===n.type)for(l=0;m>l;l++)o=n.value[l],n.array[g]=o.r,n.array[g+1]=o.g,n.array[g+2]=o.b,g+=3;else for(l=0;m>l;l++)o=n.value[l],n.array[g]=o.x,n.array[g+1]=o.y,n.array[g+2]=o.z,g+=3;else if(4===n.size)for(l=0;m>l;l++)o=n.value[l],n.array[g]=o.x,n.array[g+1]=o.y,n.array[g+2]=o.z,n.array[g+3]=o.w,g+=4;Ob.bindBuffer(Ob.ARRAY_BUFFER,n.buffer),Ob.bufferData(Ob.ARRAY_BUFFER,n.array,b)}}function w(a,b,c,d,e){if(a.__inittedArrays){var f,h,i,j,k,l,m,n,o,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db=p(e),eb=q(e),fb=r(e),gb=db===g.SmoothShading,hb=0,ib=0,jb=0,kb=0,lb=0,mb=0,nb=0,ob=0,pb=0,qb=0,rb=0,sb=0,tb=0,ub=a.__vertexArray,vb=a.__uvArray,wb=a.__uv2Array,xb=a.__normalArray,yb=a.__tangentArray,zb=a.__colorArray,Ab=a.__skinIndexArray,Bb=a.__skinWeightArray,Cb=a.__morphTargetsArrays,Db=a.__morphNormalsArrays,Eb=a.__webglCustomAttributesList,Fb=a.__faceArray,Gb=a.__lineArray,Hb=b.geometry,Ib=Hb.verticesNeedUpdate,Jb=Hb.elementsNeedUpdate,Kb=Hb.uvsNeedUpdate,Lb=Hb.normalsNeedUpdate,Mb=Hb.tangentsNeedUpdate,Nb=Hb.colorsNeedUpdate,Pb=Hb.morphTargetsNeedUpdate,Qb=Hb.vertices,Rb=a.faces3,Sb=a.faces4,Tb=Hb.faces,Ub=Hb.faceVertexUvs[0],Vb=Hb.faceVertexUvs[1],Wb=(Hb.colors,Hb.skinIndices),Xb=Hb.skinWeights,Yb=Hb.morphTargets,Zb=Hb.morphNormals;if(Ib){for(f=0,h=Rb.length;h>f;f++)j=Tb[Rb[f]],u=Qb[j.a],v=Qb[j.b],w=Qb[j.c],ub[ib]=u.x,ub[ib+1]=u.y,ub[ib+2]=u.z,ub[ib+3]=v.x,ub[ib+4]=v.y,ub[ib+5]=v.z,ub[ib+6]=w.x,ub[ib+7]=w.y,ub[ib+8]=w.z,ib+=9;for(f=0,h=Sb.length;h>f;f++)j=Tb[Sb[f]],u=Qb[j.a],v=Qb[j.b],w=Qb[j.c],x=Qb[j.d],ub[ib]=u.x,ub[ib+1]=u.y,ub[ib+2]=u.z,ub[ib+3]=v.x,ub[ib+4]=v.y,ub[ib+5]=v.z,ub[ib+6]=w.x,ub[ib+7]=w.y,ub[ib+8]=w.z,ub[ib+9]=x.x,ub[ib+10]=x.y,ub[ib+11]=x.z,ib+=12;Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglVertexBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,ub,c)}if(Pb)for(X=0,Y=Yb.length;Y>X;X++){for(rb=0,f=0,h=Rb.length;h>f;f++)_=Rb[f],j=Tb[_],u=Yb[X].vertices[j.a],v=Yb[X].vertices[j.b],w=Yb[X].vertices[j.c],Z=Cb[X],Z[rb]=u.x,Z[rb+1]=u.y,Z[rb+2]=u.z,Z[rb+3]=v.x,Z[rb+4]=v.y,Z[rb+5]=v.z,Z[rb+6]=w.x,Z[rb+7]=w.y,Z[rb+8]=w.z,e.morphNormals&&(gb?(ab=Zb[X].vertexNormals[_],C=ab.a,D=ab.b,E=ab.c):(C=Zb[X].faceNormals[_],D=C,E=C),$=Db[X],$[rb]=C.x,$[rb+1]=C.y,$[rb+2]=C.z,$[rb+3]=D.x,$[rb+4]=D.y,$[rb+5]=D.z,$[rb+6]=E.x,$[rb+7]=E.y,$[rb+8]=E.z),rb+=9;for(f=0,h=Sb.length;h>f;f++)_=Sb[f],j=Tb[_],u=Yb[X].vertices[j.a],v=Yb[X].vertices[j.b],w=Yb[X].vertices[j.c],x=Yb[X].vertices[j.d],Z=Cb[X],Z[rb]=u.x,Z[rb+1]=u.y,Z[rb+2]=u.z,Z[rb+3]=v.x,Z[rb+4]=v.y,Z[rb+5]=v.z,Z[rb+6]=w.x,Z[rb+7]=w.y,Z[rb+8]=w.z,Z[rb+9]=x.x,Z[rb+10]=x.y,Z[rb+11]=x.z,e.morphNormals&&(gb?(ab=Zb[X].vertexNormals[_],C=ab.a,D=ab.b,E=ab.c,F=ab.d):(C=Zb[X].faceNormals[_],D=C,E=C,F=C),$=Db[X],$[rb]=C.x,$[rb+1]=C.y,$[rb+2]=C.z,$[rb+3]=D.x,$[rb+4]=D.y,$[rb+5]=D.z,$[rb+6]=E.x,$[rb+7]=E.y,$[rb+8]=E.z,$[rb+9]=F.x,$[rb+10]=F.y,$[rb+11]=F.z),rb+=12;Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglMorphTargetsBuffers[X]),Ob.bufferData(Ob.ARRAY_BUFFER,Cb[X],c),e.morphNormals&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglMorphNormalsBuffers[X]),Ob.bufferData(Ob.ARRAY_BUFFER,Db[X],c))}if(Xb.length){for(f=0,h=Rb.length;h>f;f++)j=Tb[Rb[f]],K=Xb[j.a],L=Xb[j.b],M=Xb[j.c],Bb[qb]=K.x,Bb[qb+1]=K.y,Bb[qb+2]=K.z,Bb[qb+3]=K.w,Bb[qb+4]=L.x,Bb[qb+5]=L.y,Bb[qb+6]=L.z,Bb[qb+7]=L.w,Bb[qb+8]=M.x,Bb[qb+9]=M.y,Bb[qb+10]=M.z,Bb[qb+11]=M.w,O=Wb[j.a],P=Wb[j.b],Q=Wb[j.c],Ab[qb]=O.x,Ab[qb+1]=O.y,Ab[qb+2]=O.z,Ab[qb+3]=O.w,Ab[qb+4]=P.x,Ab[qb+5]=P.y,Ab[qb+6]=P.z,Ab[qb+7]=P.w,Ab[qb+8]=Q.x,Ab[qb+9]=Q.y,Ab[qb+10]=Q.z,Ab[qb+11]=Q.w,qb+=12;for(f=0,h=Sb.length;h>f;f++)j=Tb[Sb[f]],K=Xb[j.a],L=Xb[j.b],M=Xb[j.c],N=Xb[j.d],Bb[qb]=K.x,Bb[qb+1]=K.y,Bb[qb+2]=K.z,Bb[qb+3]=K.w,Bb[qb+4]=L.x,Bb[qb+5]=L.y,Bb[qb+6]=L.z,Bb[qb+7]=L.w,Bb[qb+8]=M.x,Bb[qb+9]=M.y,Bb[qb+10]=M.z,Bb[qb+11]=M.w,Bb[qb+12]=N.x,Bb[qb+13]=N.y,Bb[qb+14]=N.z,Bb[qb+15]=N.w,O=Wb[j.a],P=Wb[j.b],Q=Wb[j.c],R=Wb[j.d],Ab[qb]=O.x,Ab[qb+1]=O.y,Ab[qb+2]=O.z,Ab[qb+3]=O.w,Ab[qb+4]=P.x,Ab[qb+5]=P.y,Ab[qb+6]=P.z,Ab[qb+7]=P.w,Ab[qb+8]=Q.x,Ab[qb+9]=Q.y,Ab[qb+10]=Q.z,Ab[qb+11]=Q.w,Ab[qb+12]=R.x,Ab[qb+13]=R.y,Ab[qb+14]=R.z,Ab[qb+15]=R.w,qb+=16;qb>0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglSkinIndicesBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,Ab,c),Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglSkinWeightsBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,Bb,c))}if(Nb&&eb){for(f=0,h=Rb.length;h>f;f++)j=Tb[Rb[f]],m=j.vertexColors,n=j.color,3===m.length&&eb===g.VertexColors?(G=m[0],H=m[1],I=m[2]):(G=n,H=n,I=n),zb[pb]=G.r,zb[pb+1]=G.g,zb[pb+2]=G.b,zb[pb+3]=H.r,zb[pb+4]=H.g,zb[pb+5]=H.b,zb[pb+6]=I.r,zb[pb+7]=I.g,zb[pb+8]=I.b,pb+=9;for(f=0,h=Sb.length;h>f;f++)j=Tb[Sb[f]],m=j.vertexColors,n=j.color,4===m.length&&eb===g.VertexColors?(G=m[0],H=m[1],I=m[2],J=m[3]):(G=n,H=n,I=n,J=n),zb[pb]=G.r,zb[pb+1]=G.g,zb[pb+2]=G.b,zb[pb+3]=H.r,zb[pb+4]=H.g,zb[pb+5]=H.b,zb[pb+6]=I.r,zb[pb+7]=I.g,zb[pb+8]=I.b,zb[pb+9]=J.r,zb[pb+10]=J.g,zb[pb+11]=J.b,pb+=12;pb>0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglColorBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,zb,c))}if(Mb&&Hb.hasTangents){for(f=0,h=Rb.length;h>f;f++)j=Tb[Rb[f]],o=j.vertexTangents,y=o[0],z=o[1],A=o[2],yb[nb]=y.x,yb[nb+1]=y.y,yb[nb+2]=y.z,yb[nb+3]=y.w,yb[nb+4]=z.x,yb[nb+5]=z.y,yb[nb+6]=z.z,yb[nb+7]=z.w,yb[nb+8]=A.x,yb[nb+9]=A.y,yb[nb+10]=A.z,yb[nb+11]=A.w,nb+=12;for(f=0,h=Sb.length;h>f;f++)j=Tb[Sb[f]],o=j.vertexTangents,y=o[0],z=o[1],A=o[2],B=o[3],yb[nb]=y.x,yb[nb+1]=y.y,yb[nb+2]=y.z,yb[nb+3]=y.w,yb[nb+4]=z.x,yb[nb+5]=z.y,yb[nb+6]=z.z,yb[nb+7]=z.w,yb[nb+8]=A.x,yb[nb+9]=A.y,yb[nb+10]=A.z,yb[nb+11]=A.w,yb[nb+12]=B.x,yb[nb+13]=B.y,yb[nb+14]=B.z,yb[nb+15]=B.w,nb+=16;Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglTangentBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,yb,c)}if(Lb&&db){for(f=0,h=Rb.length;h>f;f++)if(j=Tb[Rb[f]],k=j.vertexNormals,l=j.normal,3===k.length&&gb)for(S=0;3>S;S++)U=k[S],xb[mb]=U.x,xb[mb+1]=U.y,xb[mb+2]=U.z,mb+=3;else for(S=0;3>S;S++)xb[mb]=l.x,xb[mb+1]=l.y,xb[mb+2]=l.z,mb+=3;for(f=0,h=Sb.length;h>f;f++)if(j=Tb[Sb[f]],k=j.vertexNormals,l=j.normal,4===k.length&&gb)for(S=0;4>S;S++)U=k[S],xb[mb]=U.x,xb[mb+1]=U.y,xb[mb+2]=U.z,mb+=3;else for(S=0;4>S;S++)xb[mb]=l.x,xb[mb+1]=l.y,xb[mb+2]=l.z,mb+=3;Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglNormalBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,xb,c)}if(Kb&&Ub&&fb){for(f=0,h=Rb.length;h>f;f++)if(i=Rb[f],s=Ub[i],void 0!==s)for(S=0;3>S;S++)V=s[S],vb[jb]=V.x,vb[jb+1]=V.y,jb+=2;for(f=0,h=Sb.length;h>f;f++)if(i=Sb[f],s=Ub[i],void 0!==s)for(S=0;4>S;S++)V=s[S],vb[jb]=V.x,vb[jb+1]=V.y,jb+=2;jb>0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglUVBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,vb,c))}if(Kb&&Vb&&fb){for(f=0,h=Rb.length;h>f;f++)if(i=Rb[f],t=Vb[i],void 0!==t)for(S=0;3>S;S++)W=t[S],wb[kb]=W.x,wb[kb+1]=W.y,kb+=2;for(f=0,h=Sb.length;h>f;f++)if(i=Sb[f],t=Vb[i],void 0!==t)for(S=0;4>S;S++)W=t[S],wb[kb]=W.x,wb[kb+1]=W.y,kb+=2;kb>0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglUV2Buffer),Ob.bufferData(Ob.ARRAY_BUFFER,wb,c))}if(Jb){for(f=0,h=Rb.length;h>f;f++)Fb[lb]=hb,Fb[lb+1]=hb+1,Fb[lb+2]=hb+2,lb+=3,Gb[ob]=hb,Gb[ob+1]=hb+1,Gb[ob+2]=hb,Gb[ob+3]=hb+2,Gb[ob+4]=hb+1,Gb[ob+5]=hb+2,ob+=6,hb+=3;for(f=0,h=Sb.length;h>f;f++)Fb[lb]=hb,Fb[lb+1]=hb+1,Fb[lb+2]=hb+3,Fb[lb+3]=hb+1,Fb[lb+4]=hb+2,Fb[lb+5]=hb+3,lb+=6,Gb[ob]=hb,Gb[ob+1]=hb+1,Gb[ob+2]=hb,Gb[ob+3]=hb+3,Gb[ob+4]=hb+1,Gb[ob+5]=hb+2,Gb[ob+6]=hb+2,Gb[ob+7]=hb+3,ob+=8,hb+=4;Ob.bindBuffer(Ob.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer),Ob.bufferData(Ob.ELEMENT_ARRAY_BUFFER,Fb,c),Ob.bindBuffer(Ob.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer),Ob.bufferData(Ob.ELEMENT_ARRAY_BUFFER,Gb,c)}if(Eb)for(S=0,T=Eb.length;T>S;S++)if(cb=Eb[S],cb.__original.needsUpdate){if(sb=0,tb=0,1===cb.size){if(void 0===cb.boundTo||"vertices"===cb.boundTo){for(f=0,h=Rb.length;h>f;f++)j=Tb[Rb[f]],cb.array[sb]=cb.value[j.a],cb.array[sb+1]=cb.value[j.b],cb.array[sb+2]=cb.value[j.c],sb+=3;for(f=0,h=Sb.length;h>f;f++)j=Tb[Sb[f]],cb.array[sb]=cb.value[j.a],cb.array[sb+1]=cb.value[j.b],cb.array[sb+2]=cb.value[j.c],cb.array[sb+3]=cb.value[j.d],sb+=4}else if("faces"===cb.boundTo){for(f=0,h=Rb.length;h>f;f++)bb=cb.value[Rb[f]],cb.array[sb]=bb,cb.array[sb+1]=bb,cb.array[sb+2]=bb,sb+=3;for(f=0,h=Sb.length;h>f;f++)bb=cb.value[Sb[f]],cb.array[sb]=bb,cb.array[sb+1]=bb,cb.array[sb+2]=bb,cb.array[sb+3]=bb,sb+=4}}else if(2===cb.size){if(void 0===cb.boundTo||"vertices"===cb.boundTo){for(f=0,h=Rb.length;h>f;f++)j=Tb[Rb[f]],u=cb.value[j.a],v=cb.value[j.b],w=cb.value[j.c],cb.array[sb]=u.x,cb.array[sb+1]=u.y,cb.array[sb+2]=v.x,cb.array[sb+3]=v.y,cb.array[sb+4]=w.x,cb.array[sb+5]=w.y,sb+=6;for(f=0,h=Sb.length;h>f;f++)j=Tb[Sb[f]],u=cb.value[j.a],v=cb.value[j.b],w=cb.value[j.c],x=cb.value[j.d],cb.array[sb]=u.x,cb.array[sb+1]=u.y,cb.array[sb+2]=v.x,cb.array[sb+3]=v.y,cb.array[sb+4]=w.x,cb.array[sb+5]=w.y,cb.array[sb+6]=x.x,cb.array[sb+7]=x.y,sb+=8}else if("faces"===cb.boundTo){for(f=0,h=Rb.length;h>f;f++)bb=cb.value[Rb[f]],u=bb,v=bb,w=bb,cb.array[sb]=u.x,cb.array[sb+1]=u.y,cb.array[sb+2]=v.x,cb.array[sb+3]=v.y,cb.array[sb+4]=w.x,cb.array[sb+5]=w.y,sb+=6;for(f=0,h=Sb.length;h>f;f++)bb=cb.value[Sb[f]],u=bb,v=bb,w=bb,x=bb,cb.array[sb]=u.x,cb.array[sb+1]=u.y,cb.array[sb+2]=v.x,cb.array[sb+3]=v.y,cb.array[sb+4]=w.x,cb.array[sb+5]=w.y,cb.array[sb+6]=x.x,cb.array[sb+7]=x.y,sb+=8}}else if(3===cb.size){var $b;if($b="c"===cb.type?["r","g","b"]:["x","y","z"],void 0===cb.boundTo||"vertices"===cb.boundTo){for(f=0,h=Rb.length;h>f;f++)j=Tb[Rb[f]],u=cb.value[j.a],v=cb.value[j.b],w=cb.value[j.c],cb.array[sb]=u[$b[0]],cb.array[sb+1]=u[$b[1]],cb.array[sb+2]=u[$b[2]],cb.array[sb+3]=v[$b[0]],cb.array[sb+4]=v[$b[1]],cb.array[sb+5]=v[$b[2]],cb.array[sb+6]=w[$b[0]],cb.array[sb+7]=w[$b[1]],cb.array[sb+8]=w[$b[2]],sb+=9;for(f=0,h=Sb.length;h>f;f++)j=Tb[Sb[f]],u=cb.value[j.a],v=cb.value[j.b],w=cb.value[j.c],x=cb.value[j.d],cb.array[sb]=u[$b[0]],cb.array[sb+1]=u[$b[1]],cb.array[sb+2]=u[$b[2]],cb.array[sb+3]=v[$b[0]],cb.array[sb+4]=v[$b[1]],cb.array[sb+5]=v[$b[2]],cb.array[sb+6]=w[$b[0]],cb.array[sb+7]=w[$b[1]],cb.array[sb+8]=w[$b[2]],cb.array[sb+9]=x[$b[0]],cb.array[sb+10]=x[$b[1]],cb.array[sb+11]=x[$b[2]],sb+=12}else if("faces"===cb.boundTo){for(f=0,h=Rb.length;h>f;f++)bb=cb.value[Rb[f]],u=bb,v=bb,w=bb,cb.array[sb]=u[$b[0]],cb.array[sb+1]=u[$b[1]],cb.array[sb+2]=u[$b[2]],cb.array[sb+3]=v[$b[0]],cb.array[sb+4]=v[$b[1]],cb.array[sb+5]=v[$b[2]],cb.array[sb+6]=w[$b[0]],cb.array[sb+7]=w[$b[1]],cb.array[sb+8]=w[$b[2]],sb+=9;for(f=0,h=Sb.length;h>f;f++)bb=cb.value[Sb[f]],u=bb,v=bb,w=bb,x=bb,cb.array[sb]=u[$b[0]],cb.array[sb+1]=u[$b[1]],cb.array[sb+2]=u[$b[2]],cb.array[sb+3]=v[$b[0]],cb.array[sb+4]=v[$b[1]],cb.array[sb+5]=v[$b[2]],cb.array[sb+6]=w[$b[0]],cb.array[sb+7]=w[$b[1]],cb.array[sb+8]=w[$b[2]],cb.array[sb+9]=x[$b[0]],cb.array[sb+10]=x[$b[1]],cb.array[sb+11]=x[$b[2]],sb+=12}else if("faceVertices"===cb.boundTo){for(f=0,h=Rb.length;h>f;f++)bb=cb.value[Rb[f]],u=bb[0],v=bb[1],w=bb[2],cb.array[sb]=u[$b[0]],cb.array[sb+1]=u[$b[1]],cb.array[sb+2]=u[$b[2]],cb.array[sb+3]=v[$b[0]],cb.array[sb+4]=v[$b[1]],cb.array[sb+5]=v[$b[2]],cb.array[sb+6]=w[$b[0]],cb.array[sb+7]=w[$b[1]],cb.array[sb+8]=w[$b[2]],sb+=9;for(f=0,h=Sb.length;h>f;f++)bb=cb.value[Sb[f]],u=bb[0],v=bb[1],w=bb[2],x=bb[3],cb.array[sb]=u[$b[0]],cb.array[sb+1]=u[$b[1]],cb.array[sb+2]=u[$b[2]],cb.array[sb+3]=v[$b[0]],cb.array[sb+4]=v[$b[1]],cb.array[sb+5]=v[$b[2]],cb.array[sb+6]=w[$b[0]],cb.array[sb+7]=w[$b[1]],cb.array[sb+8]=w[$b[2]],cb.array[sb+9]=x[$b[0]],cb.array[sb+10]=x[$b[1]],cb.array[sb+11]=x[$b[2]],sb+=12}}else if(4===cb.size)if(void 0===cb.boundTo||"vertices"===cb.boundTo){for(f=0,h=Rb.length;h>f;f++)j=Tb[Rb[f]],u=cb.value[j.a],v=cb.value[j.b],w=cb.value[j.c],cb.array[sb]=u.x,cb.array[sb+1]=u.y,cb.array[sb+2]=u.z,cb.array[sb+3]=u.w,cb.array[sb+4]=v.x,cb.array[sb+5]=v.y,cb.array[sb+6]=v.z,cb.array[sb+7]=v.w,cb.array[sb+8]=w.x,cb.array[sb+9]=w.y,cb.array[sb+10]=w.z,cb.array[sb+11]=w.w,sb+=12;for(f=0,h=Sb.length;h>f;f++)j=Tb[Sb[f]],u=cb.value[j.a],v=cb.value[j.b],w=cb.value[j.c],x=cb.value[j.d],cb.array[sb]=u.x,cb.array[sb+1]=u.y,cb.array[sb+2]=u.z,cb.array[sb+3]=u.w,cb.array[sb+4]=v.x,cb.array[sb+5]=v.y,cb.array[sb+6]=v.z,cb.array[sb+7]=v.w,cb.array[sb+8]=w.x,cb.array[sb+9]=w.y,cb.array[sb+10]=w.z,cb.array[sb+11]=w.w,cb.array[sb+12]=x.x,cb.array[sb+13]=x.y,cb.array[sb+14]=x.z,cb.array[sb+15]=x.w,sb+=16}else if("faces"===cb.boundTo){for(f=0,h=Rb.length;h>f;f++)bb=cb.value[Rb[f]],u=bb,v=bb,w=bb,cb.array[sb]=u.x,cb.array[sb+1]=u.y,cb.array[sb+2]=u.z,cb.array[sb+3]=u.w,cb.array[sb+4]=v.x,cb.array[sb+5]=v.y,cb.array[sb+6]=v.z,cb.array[sb+7]=v.w,cb.array[sb+8]=w.x,cb.array[sb+9]=w.y,cb.array[sb+10]=w.z,cb.array[sb+11]=w.w,sb+=12;for(f=0,h=Sb.length;h>f;f++)bb=cb.value[Sb[f]],u=bb,v=bb,w=bb,x=bb,cb.array[sb]=u.x,cb.array[sb+1]=u.y,cb.array[sb+2]=u.z,cb.array[sb+3]=u.w,cb.array[sb+4]=v.x,cb.array[sb+5]=v.y,cb.array[sb+6]=v.z,cb.array[sb+7]=v.w,cb.array[sb+8]=w.x,cb.array[sb+9]=w.y,cb.array[sb+10]=w.z,cb.array[sb+11]=w.w,cb.array[sb+12]=x.x,cb.array[sb+13]=x.y,cb.array[sb+14]=x.z,cb.array[sb+15]=x.w,sb+=16}else if("faceVertices"===cb.boundTo){for(f=0,h=Rb.length;h>f;f++)bb=cb.value[Rb[f]],u=bb[0],v=bb[1],w=bb[2],cb.array[sb]=u.x,cb.array[sb+1]=u.y,cb.array[sb+2]=u.z,cb.array[sb+3]=u.w,cb.array[sb+4]=v.x,cb.array[sb+5]=v.y,cb.array[sb+6]=v.z,cb.array[sb+7]=v.w,cb.array[sb+8]=w.x,cb.array[sb+9]=w.y,cb.array[sb+10]=w.z,cb.array[sb+11]=w.w,sb+=12;for(f=0,h=Sb.length;h>f;f++)bb=cb.value[Sb[f]],u=bb[0],v=bb[1],w=bb[2],x=bb[3],cb.array[sb]=u.x,cb.array[sb+1]=u.y,cb.array[sb+2]=u.z,cb.array[sb+3]=u.w,cb.array[sb+4]=v.x,cb.array[sb+5]=v.y,cb.array[sb+6]=v.z,cb.array[sb+7]=v.w,cb.array[sb+8]=w.x,cb.array[sb+9]=w.y,cb.array[sb+10]=w.z,cb.array[sb+11]=w.w,cb.array[sb+12]=x.x,cb.array[sb+13]=x.y,cb.array[sb+14]=x.z,cb.array[sb+15]=x.w,sb+=16}Ob.bindBuffer(Ob.ARRAY_BUFFER,cb.buffer),Ob.bufferData(Ob.ARRAY_BUFFER,cb.array,c)}d&&(delete a.__inittedArrays,delete a.__colorArray,delete a.__normalArray,delete a.__tangentArray,delete a.__uvArray,delete a.__uv2Array,delete a.__faceArray,delete a.__vertexArray,delete a.__lineArray,delete a.__skinIndexArray,delete a.__skinWeightArray)}}function x(a,b,c){var d=a.attributes,e=d.index,f=d.position,g=d.normal,h=d.uv,i=d.color,j=d.tangent;if(a.elementsNeedUpdate&&void 0!==e&&(Ob.bindBuffer(Ob.ELEMENT_ARRAY_BUFFER,e.buffer),Ob.bufferData(Ob.ELEMENT_ARRAY_BUFFER,e.array,b)),a.verticesNeedUpdate&&void 0!==f&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,f.buffer),Ob.bufferData(Ob.ARRAY_BUFFER,f.array,b)),a.normalsNeedUpdate&&void 0!==g&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,g.buffer),Ob.bufferData(Ob.ARRAY_BUFFER,g.array,b)),a.uvsNeedUpdate&&void 0!==h&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,h.buffer),Ob.bufferData(Ob.ARRAY_BUFFER,h.array,b)),a.colorsNeedUpdate&&void 0!==i&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,i.buffer),Ob.bufferData(Ob.ARRAY_BUFFER,i.array,b)),a.tangentsNeedUpdate&&void 0!==j&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,j.buffer),Ob.bufferData(Ob.ARRAY_BUFFER,j.array,b)),c)for(var k in a.attributes)delete a.attributes[k].array}function y(a){tc[a]||(Ob.enableVertexAttribArray(a),tc[a]=!0)}function z(){for(var a in tc)tc[a]&&(Ob.disableVertexAttribArray(a),tc[a]=!1)}function A(a,b,c){var d=a.program.attributes;if(-1!==c.morphTargetBase&&d.position>=0?(Ob.bindBuffer(Ob.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[c.morphTargetBase]),y(d.position),Ob.vertexAttribPointer(d.position,3,Ob.FLOAT,!1,0,0)):d.position>=0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,b.__webglVertexBuffer),y(d.position),Ob.vertexAttribPointer(d.position,3,Ob.FLOAT,!1,0,0)),c.morphTargetForcedOrder.length)for(var e=0,f=c.morphTargetForcedOrder,g=c.morphTargetInfluences;e<a.numSupportedMorphTargets&&e<f.length;)d["morphTarget"+e]>=0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[f[e]]),y(d["morphTarget"+e]),Ob.vertexAttribPointer(d["morphTarget"+e],3,Ob.FLOAT,!1,0,0)),d["morphNormal"+e]>=0&&a.morphNormals&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,b.__webglMorphNormalsBuffers[f[e]]),y(d["morphNormal"+e]),Ob.vertexAttribPointer(d["morphNormal"+e],3,Ob.FLOAT,!1,0,0)),c.__webglMorphTargetInfluences[e]=g[f[e]],e++;else{var h,i,j=[],g=c.morphTargetInfluences,k=g.length;for(i=0;k>i;i++)h=g[i],h>0&&j.push([h,i]);j.length>a.numSupportedMorphTargets?(j.sort(C),j.length=a.numSupportedMorphTargets):j.length>a.numSupportedMorphNormals?j.sort(C):0===j.length&&j.push([0,0]);for(var l,e=0;e<a.numSupportedMorphTargets;)j[e]?(l=j[e][1],d["morphTarget"+e]>=0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[l]),y(d["morphTarget"+e]),Ob.vertexAttribPointer(d["morphTarget"+e],3,Ob.FLOAT,!1,0,0)),d["morphNormal"+e]>=0&&a.morphNormals&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,b.__webglMorphNormalsBuffers[l]),y(d["morphNormal"+e]),Ob.vertexAttribPointer(d["morphNormal"+e],3,Ob.FLOAT,!1,0,0)),c.__webglMorphTargetInfluences[e]=g[l]):c.__webglMorphTargetInfluences[e]=0,e++}null!==a.program.uniforms.morphTargetInfluences&&Ob.uniform1fv(a.program.uniforms.morphTargetInfluences,c.__webglMorphTargetInfluences)}function B(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}function C(a,b){return b[0]-a[0]}function D(a,b,c){if(a.length)for(var d=0,e=a.length;e>d;d++)Wb=null,$b=null,dc=-1,hc=-1,ic=-1,bc=-1,cc=-1,Zb=-1,Yb=-1,zc=!0,a[d].render(b,c,rc,sc),Wb=null,$b=null,dc=-1,hc=-1,ic=-1,bc=-1,cc=-1,Zb=-1,Yb=-1,zc=!0}function E(a,b,c,d,e,f,h,i){var j,k,l,m,n,o,p;b?(n=a.length-1,o=-1,p=-1):(n=0,o=a.length,p=1);for(var q=n;q!==o;q+=p)if(j=a[q],j.render){if(k=j.object,l=j.buffer,i)m=i;else{if(m=j[c],!m)continue;h&&Tb.setBlending(m.blending,m.blendEquation,m.blendSrc,m.blendDst),Tb.setDepthTest(m.depthTest),Tb.setDepthWrite(m.depthWrite),jb(m.polygonOffset,m.polygonOffsetFactor,m.polygonOffsetUnits)}Tb.setMaterialFaces(m),l instanceof g.BufferGeometry?Tb.renderBufferDirect(d,e,f,m,l,k):Tb.renderBuffer(d,e,f,m,l,k)}}function F(a,b,c,d,e,f,g){for(var h,i,j,k=0,l=a.length;l>k;k++)if(h=a[k],i=h.object,i.visible){if(g)j=g;else{if(j=h[b],!j)continue;f&&Tb.setBlending(j.blending,j.blendEquation,j.blendSrc,j.blendDst),Tb.setDepthTest(j.depthTest),Tb.setDepthWrite(j.depthWrite),jb(j.polygonOffset,j.polygonOffsetFactor,j.polygonOffsetUnits)}Tb.renderImmediateObject(c,d,e,j,i)}}function G(a){var b=a.object,c=b.material;c.transparent?(a.transparent=c,a.opaque=null):(a.opaque=c,a.transparent=null)}function H(a){var b,c,d,e=a.object,f=a.buffer;d=e.material,d instanceof g.MeshFaceMaterial?(c=f.materialIndex,b=d.materials[c],b.transparent?(a.transparent=b,a.opaque=null):(a.opaque=b,a.transparent=null)):(b=d,b&&(b.transparent?(a.transparent=b,a.opaque=null):(a.opaque=b,a.transparent=null)))}function I(a,b){var c,d,e,f,h,i,j={},k=a.morphTargets.length,l=a.morphNormals.length,m=b instanceof g.MeshFaceMaterial;for(a.geometryGroups={},c=0,d=a.faces.length;d>c;c++)e=a.faces[c],f=m?e.materialIndex:0,void 0===j[f]&&(j[f]={hash:f,counter:0}),i=j[f].hash+"_"+j[f].counter,void 0===a.geometryGroups[i]&&(a.geometryGroups[i]={faces3:[],faces4:[],materialIndex:f,vertices:0,numMorphTargets:k,numMorphNormals:l}),h=e instanceof g.Face3?3:4,a.geometryGroups[i].vertices+h>65535&&(j[f].counter+=1,i=j[f].hash+"_"+j[f].counter,void 0===a.geometryGroups[i]&&(a.geometryGroups[i]={faces3:[],faces4:[],materialIndex:f,vertices:0,numMorphTargets:k,numMorphNormals:l})),e instanceof g.Face3?a.geometryGroups[i].faces3.push(c):a.geometryGroups[i].faces4.push(c),a.geometryGroups[i].vertices+=h;a.geometryGroupsList=[];for(var n in a.geometryGroups)a.geometryGroups[n].id=_b++,a.geometryGroupsList.push(a.geometryGroups[n])}function J(a,e){var h,i,n,o;if(!a.__webglInit)if(a.__webglInit=!0,a._modelViewMatrix=new g.Matrix4,a._normalMatrix=new g.Matrix3,void 0!==a.geometry&&void 0===a.geometry.__webglInit&&(a.geometry.__webglInit=!0,a.geometry.addEventListener("dispose",Nc)),a instanceof g.Mesh)if(i=a.geometry,n=a.material,i instanceof g.Geometry){void 0===i.geometryGroups&&I(i,n);for(h in i.geometryGroups)o=i.geometryGroups[h],o.__webglVertexBuffer||(f(o),m(o,a),i.verticesNeedUpdate=!0,i.morphTargetsNeedUpdate=!0,i.elementsNeedUpdate=!0,i.uvsNeedUpdate=!0,i.normalsNeedUpdate=!0,i.tangentsNeedUpdate=!0,i.colorsNeedUpdate=!0)}else i instanceof g.BufferGeometry&&s(i);else a instanceof g.Ribbon?(i=a.geometry,i.__webglVertexBuffer||(d(i),l(i,a),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.normalsNeedUpdate=!0)):a instanceof g.Line?(i=a.geometry,i.__webglVertexBuffer||(i instanceof g.Geometry?(c(i),k(i,a),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0):i instanceof g.BufferGeometry&&s(i))):a instanceof g.ParticleSystem&&(i=a.geometry,i.__webglVertexBuffer||(i instanceof g.Geometry?(b(i),j(i,a),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0):i instanceof g.BufferGeometry&&s(i)));if(!a.__webglActive){if(a instanceof g.Mesh){if(i=a.geometry,i instanceof g.BufferGeometry)K(e.__webglObjects,i,a);else if(i instanceof g.Geometry)for(h in i.geometryGroups)o=i.geometryGroups[h],K(e.__webglObjects,o,a)}else a instanceof g.Ribbon||a instanceof g.Line||a instanceof g.ParticleSystem?(i=a.geometry,K(e.__webglObjects,i,a)):a instanceof g.ImmediateRenderObject||a.immediateRenderCallback?L(e.__webglObjectsImmediate,a):a instanceof g.Sprite?e.__webglSprites.push(a):a instanceof g.LensFlare&&e.__webglFlares.push(a);a.__webglActive=!0}}function K(a,b,c){a.push({buffer:b,object:c,opaque:null,transparent:null})}function L(a,b){a.push({object:b,opaque:null,transparent:null})}function M(a){var b,c,d,e=a.geometry;if(a instanceof g.Mesh)if(e instanceof g.BufferGeometry)(e.verticesNeedUpdate||e.elementsNeedUpdate||e.uvsNeedUpdate||e.normalsNeedUpdate||e.colorsNeedUpdate||e.tangentsNeedUpdate)&&x(e,Ob.DYNAMIC_DRAW,!e.dynamic),e.verticesNeedUpdate=!1,e.elementsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.tangentsNeedUpdate=!1;else{for(var f=0,h=e.geometryGroupsList.length;h>f;f++)b=e.geometryGroupsList[f],d=n(a,b),e.buffersNeedUpdate&&m(b,a),c=d.attributes&&N(d),(e.verticesNeedUpdate||e.morphTargetsNeedUpdate||e.elementsNeedUpdate||e.uvsNeedUpdate||e.normalsNeedUpdate||e.colorsNeedUpdate||e.tangentsNeedUpdate||c)&&w(b,a,Ob.DYNAMIC_DRAW,!e.dynamic,d);e.verticesNeedUpdate=!1,e.morphTargetsNeedUpdate=!1,e.elementsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.tangentsNeedUpdate=!1,e.buffersNeedUpdate=!1,d.attributes&&O(d)}else a instanceof g.Ribbon?(d=n(a,e),c=d.attributes&&N(d),(e.verticesNeedUpdate||e.colorsNeedUpdate||e.normalsNeedUpdate||c)&&v(e,Ob.DYNAMIC_DRAW),e.verticesNeedUpdate=!1,e.colorsNeedUpdate=!1,e.normalsNeedUpdate=!1,d.attributes&&O(d)):a instanceof g.Line?e instanceof g.BufferGeometry?((e.verticesNeedUpdate||e.colorsNeedUpdate)&&x(e,Ob.DYNAMIC_DRAW,!e.dynamic),e.verticesNeedUpdate=!1,e.colorsNeedUpdate=!1):(d=n(a,e),c=d.attributes&&N(d),(e.verticesNeedUpdate||e.colorsNeedUpdate||e.lineDistancesNeedUpdate||c)&&u(e,Ob.DYNAMIC_DRAW),e.verticesNeedUpdate=!1,e.colorsNeedUpdate=!1,e.lineDistancesNeedUpdate=!1,d.attributes&&O(d)):a instanceof g.ParticleSystem&&(e instanceof g.BufferGeometry?((e.verticesNeedUpdate||e.colorsNeedUpdate)&&x(e,Ob.DYNAMIC_DRAW,!e.dynamic),e.verticesNeedUpdate=!1,e.colorsNeedUpdate=!1):(d=n(a,e),c=d.attributes&&N(d),(e.verticesNeedUpdate||e.colorsNeedUpdate||a.sortParticles||c)&&t(e,Ob.DYNAMIC_DRAW,a),e.verticesNeedUpdate=!1,e.colorsNeedUpdate=!1,d.attributes&&O(d)))}function N(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function O(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function P(a,b){a instanceof g.Mesh||a instanceof g.ParticleSystem||a instanceof g.Ribbon||a instanceof g.Line?Q(b.__webglObjects,a):a instanceof g.Sprite?R(b.__webglSprites,a):a instanceof g.LensFlare?R(b.__webglFlares,a):(a instanceof g.ImmediateRenderObject||a.immediateRenderCallback)&&Q(b.__webglObjectsImmediate,a),a.__webglActive=!1}function Q(a,b){for(var c=a.length-1;c>=0;c--)a[c].object===b&&a.splice(c,1)}function R(a,b){for(var c=a.length-1;c>=0;c--)a[c]===b&&a.splice(c,1)}function S(a,b){a.uniforms=g.UniformsUtils.clone(b.uniforms),a.vertexShader=b.vertexShader,a.fragmentShader=b.fragmentShader}function T(a,b,c,d,e){ac=0,d.needsUpdate&&(d.program&&Uc(d),Tb.initMaterial(d,b,c,e),d.needsUpdate=!1),d.morphTargets&&(e.__webglMorphTargetInfluences||(e.__webglMorphTargetInfluences=new Float32Array(Tb.maxMorphTargets)));var f=!1,h=d.program,i=h.uniforms,j=d.uniforms;if(h!==Wb&&(Ob.useProgram(h),Wb=h,f=!0),d.id!==Yb&&(Yb=d.id,f=!0),(f||a!==$b)&&(Ob.uniformMatrix4fv(i.projectionMatrix,!1,a.projectionMatrix.elements),a!==$b&&($b=a)),d.skinning)if(Gc&&e.useVertexTexture){if(null!==i.boneTexture){var k=cb();Ob.uniform1i(i.boneTexture,k),Tb.setTexture(e.boneTexture,k)}}else null!==i.boneGlobalMatrices&&Ob.uniformMatrix4fv(i.boneGlobalMatrices,!1,e.boneMatrices);return f&&(c&&d.fog&&Y(j,c),(d instanceof g.MeshPhongMaterial||d instanceof g.MeshLambertMaterial||d.lights)&&(zc&&(hb(h,b),zc=!1),_(j,Ac)),(d instanceof g.MeshBasicMaterial||d instanceof g.MeshLambertMaterial||d instanceof g.MeshPhongMaterial)&&U(j,d),d instanceof g.LineBasicMaterial?V(j,d):d instanceof g.LineDashedMaterial?(V(j,d),W(j,d)):d instanceof g.ParticleBasicMaterial?X(j,d):d instanceof g.MeshPhongMaterial?Z(j,d):d instanceof g.MeshLambertMaterial?$(j,d):d instanceof g.MeshDepthMaterial?(j.mNear.value=a.near,j.mFar.value=a.far,j.opacity.value=d.opacity):d instanceof g.MeshNormalMaterial&&(j.opacity.value=d.opacity),e.receiveShadow&&!d._shadowPass&&ab(j,b),db(h,d.uniformsList),(d instanceof g.ShaderMaterial||d instanceof g.MeshPhongMaterial||d.envMap)&&null!==i.cameraPosition&&(xc.getPositionFromMatrix(a.matrixWorld),Ob.uniform3f(i.cameraPosition,xc.x,xc.y,xc.z)),(d instanceof g.MeshPhongMaterial||d instanceof g.MeshLambertMaterial||d instanceof g.ShaderMaterial||d.skinning)&&null!==i.viewMatrix&&Ob.uniformMatrix4fv(i.viewMatrix,!1,a.matrixWorldInverse.elements)),bb(i,e),null!==i.modelMatrix&&Ob.uniformMatrix4fv(i.modelMatrix,!1,e.matrixWorld.elements),h}function U(a,b){a.opacity.value=b.opacity,Tb.gammaInput?a.diffuse.value.copyGammaToLinear(b.color):a.diffuse.value=b.color,a.map.value=b.map,a.lightMap.value=b.lightMap,a.specularMap.value=b.specularMap,b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));var c;if(b.map?c=b.map:b.specularMap?c=b.specularMap:b.normalMap?c=b.normalMap:b.bumpMap&&(c=b.bumpMap),void 0!==c){var d=c.offset,e=c.repeat;a.offsetRepeat.value.set(d.x,d.y,e.x,e.y)}a.envMap.value=b.envMap,a.flipEnvMap.value=b.envMap instanceof g.WebGLRenderTargetCube?1:-1,a.reflectivity.value=Tb.gammaInput?b.reflectivity:b.reflectivity,a.refractionRatio.value=b.refractionRatio,a.combine.value=b.combine,a.useRefract.value=b.envMap&&b.envMap.mapping instanceof g.CubeRefractionMapping}function V(a,b){a.diffuse.value=b.color,a.opacity.value=b.opacity}function W(a,b){a.dashSize.value=b.dashSize,a.totalSize.value=b.dashSize+b.gapSize,a.scale.value=b.scale}function X(a,b){a.psColor.value=b.color,a.opacity.value=b.opacity,a.size.value=b.size,a.scale.value=Fb.height/2,a.map.value=b.map}function Y(a,b){a.fogColor.value=b.color,b instanceof g.Fog?(a.fogNear.value=b.near,a.fogFar.value=b.far):b instanceof g.FogExp2&&(a.fogDensity.value=b.density)}function Z(a,b){a.shininess.value=b.shininess,Tb.gammaInput?(a.ambient.value.copyGammaToLinear(b.ambient),a.emissive.value.copyGammaToLinear(b.emissive),a.specular.value.copyGammaToLinear(b.specular)):(a.ambient.value=b.ambient,a.emissive.value=b.emissive,a.specular.value=b.specular),b.wrapAround&&a.wrapRGB.value.copy(b.wrapRGB)}function $(a,b){Tb.gammaInput?(a.ambient.value.copyGammaToLinear(b.ambient),a.emissive.value.copyGammaToLinear(b.emissive)):(a.ambient.value=b.ambient,a.emissive.value=b.emissive),b.wrapAround&&a.wrapRGB.value.copy(b.wrapRGB)}function _(a,b){a.ambientLightColor.value=b.ambient,a.directionalLightColor.value=b.directional.colors,a.directionalLightDirection.value=b.directional.positions,a.pointLightColor.value=b.point.colors,a.pointLightPosition.value=b.point.positions,a.pointLightDistance.value=b.point.distances,a.spotLightColor.value=b.spot.colors,a.spotLightPosition.value=b.spot.positions,a.spotLightDistance.value=b.spot.distances,a.spotLightDirection.value=b.spot.directions,a.spotLightAngleCos.value=b.spot.anglesCos,a.spotLightExponent.value=b.spot.exponents,a.hemisphereLightSkyColor.value=b.hemi.skyColors,a.hemisphereLightGroundColor.value=b.hemi.groundColors,a.hemisphereLightDirection.value=b.hemi.positions}function ab(a,b){if(a.shadowMatrix)for(var c=0,d=0,e=b.length;e>d;d++){var f=b[d];f.castShadow&&(f instanceof g.SpotLight||f instanceof g.DirectionalLight&&!f.shadowCascade)&&(a.shadowMap.value[c]=f.shadowMap,a.shadowMapSize.value[c]=f.shadowMapSize,a.shadowMatrix.value[c]=f.shadowMatrix,a.shadowDarkness.value[c]=f.shadowDarkness,a.shadowBias.value[c]=f.shadowBias,c++)
}}function bb(a,b){Ob.uniformMatrix4fv(a.modelViewMatrix,!1,b._modelViewMatrix.elements),a.normalMatrix&&Ob.uniformMatrix3fv(a.normalMatrix,!1,b._normalMatrix.elements)}function cb(){var a=ac;return a>=Bc&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+Bc),ac+=1,a}function db(a,b){var c,d,e,f,h,i,j,k,l,m,n;for(l=0,m=b.length;m>l;l++)if(f=a.uniforms[b[l][1]])if(c=b[l][0],e=c.type,d=c.value,"i"===e)Ob.uniform1i(f,d);else if("f"===e)Ob.uniform1f(f,d);else if("v2"===e)Ob.uniform2f(f,d.x,d.y);else if("v3"===e)Ob.uniform3f(f,d.x,d.y,d.z);else if("v4"===e)Ob.uniform4f(f,d.x,d.y,d.z,d.w);else if("c"===e)Ob.uniform3f(f,d.r,d.g,d.b);else if("iv1"===e)Ob.uniform1iv(f,d);else if("iv"===e)Ob.uniform3iv(f,d);else if("fv1"===e)Ob.uniform1fv(f,d);else if("fv"===e)Ob.uniform3fv(f,d);else if("v2v"===e){for(void 0===c._array&&(c._array=new Float32Array(2*d.length)),j=0,k=d.length;k>j;j++)n=2*j,c._array[n]=d[j].x,c._array[n+1]=d[j].y;Ob.uniform2fv(f,c._array)}else if("v3v"===e){for(void 0===c._array&&(c._array=new Float32Array(3*d.length)),j=0,k=d.length;k>j;j++)n=3*j,c._array[n]=d[j].x,c._array[n+1]=d[j].y,c._array[n+2]=d[j].z;Ob.uniform3fv(f,c._array)}else if("v4v"===e){for(void 0===c._array&&(c._array=new Float32Array(4*d.length)),j=0,k=d.length;k>j;j++)n=4*j,c._array[n]=d[j].x,c._array[n+1]=d[j].y,c._array[n+2]=d[j].z,c._array[n+3]=d[j].w;Ob.uniform4fv(f,c._array)}else if("m4"===e)void 0===c._array&&(c._array=new Float32Array(16)),d.flattenToArray(c._array),Ob.uniformMatrix4fv(f,!1,c._array);else if("m4v"===e){for(void 0===c._array&&(c._array=new Float32Array(16*d.length)),j=0,k=d.length;k>j;j++)d[j].flattenToArrayOffset(c._array,16*j);Ob.uniformMatrix4fv(f,!1,c._array)}else if("t"===e){if(h=d,i=cb(),Ob.uniform1i(f,i),!h)continue;h.image instanceof Array&&6===h.image.length?tb(h,i):h instanceof g.WebGLRenderTargetCube?ub(h,i):Tb.setTexture(h,i)}else if("tv"===e){for(void 0===c._array&&(c._array=[]),j=0,k=c.value.length;k>j;j++)c._array[j]=cb();for(Ob.uniform1iv(f,c._array),j=0,k=c.value.length;k>j;j++)h=c.value[j],i=c._array[j],h&&Tb.setTexture(h,i)}}function eb(a,b){a._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,a.matrixWorld),a._normalMatrix.getInverse(a._modelViewMatrix),a._normalMatrix.transpose()}function fb(a,b,c,d){a[b]=c.r*c.r*d,a[b+1]=c.g*c.g*d,a[b+2]=c.b*c.b*d}function gb(a,b,c,d){a[b]=c.r*d,a[b+1]=c.g*d,a[b+2]=c.b*d}function hb(a,b){var c,d,e,f,h,i,j,k,l,m=0,n=0,o=0,p=Ac,q=p.directional.colors,r=p.directional.positions,s=p.point.colors,t=p.point.positions,u=p.point.distances,v=p.spot.colors,w=p.spot.positions,x=p.spot.distances,y=p.spot.directions,z=p.spot.anglesCos,A=p.spot.exponents,B=p.hemi.skyColors,C=p.hemi.groundColors,D=p.hemi.positions,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0;for(c=0,d=b.length;d>c;c++)if(e=b[c],!e.onlyShadow)if(f=e.color,j=e.intensity,l=e.distance,e instanceof g.AmbientLight){if(!e.visible)continue;Tb.gammaInput?(m+=f.r*f.r,n+=f.g*f.g,o+=f.b*f.b):(m+=f.r,n+=f.g,o+=f.b)}else if(e instanceof g.DirectionalLight){if(I+=1,!e.visible)continue;if(yc.getPositionFromMatrix(e.matrixWorld),xc.getPositionFromMatrix(e.target.matrixWorld),yc.sub(xc),yc.normalize(),0===yc.x&&0===yc.y&&0===yc.z)continue;M=3*E,r[M]=yc.x,r[M+1]=yc.y,r[M+2]=yc.z,Tb.gammaInput?fb(q,M,f,j*j):gb(q,M,f,j),E+=1}else if(e instanceof g.PointLight){if(J+=1,!e.visible)continue;N=3*F,Tb.gammaInput?fb(s,N,f,j*j):gb(s,N,f,j),xc.getPositionFromMatrix(e.matrixWorld),t[N]=xc.x,t[N+1]=xc.y,t[N+2]=xc.z,u[F]=l,F+=1}else if(e instanceof g.SpotLight){if(K+=1,!e.visible)continue;O=3*G,Tb.gammaInput?fb(v,O,f,j*j):gb(v,O,f,j),xc.getPositionFromMatrix(e.matrixWorld),w[O]=xc.x,w[O+1]=xc.y,w[O+2]=xc.z,x[G]=l,yc.copy(xc),xc.getPositionFromMatrix(e.target.matrixWorld),yc.sub(xc),yc.normalize(),y[O]=yc.x,y[O+1]=yc.y,y[O+2]=yc.z,z[G]=Math.cos(e.angle),A[G]=e.exponent,G+=1}else if(e instanceof g.HemisphereLight){if(L+=1,!e.visible)continue;if(yc.getPositionFromMatrix(e.matrixWorld),yc.normalize(),0===yc.x&&0===yc.y&&0===yc.z)continue;P=3*H,D[P]=yc.x,D[P+1]=yc.y,D[P+2]=yc.z,h=e.color,i=e.groundColor,Tb.gammaInput?(k=j*j,fb(B,P,h,k),fb(C,P,i,k)):(gb(B,P,h,j),gb(C,P,i,j)),H+=1}for(c=3*E,d=Math.max(q.length,3*I);d>c;c++)q[c]=0;for(c=3*F,d=Math.max(s.length,3*J);d>c;c++)s[c]=0;for(c=3*G,d=Math.max(v.length,3*K);d>c;c++)v[c]=0;for(c=3*H,d=Math.max(B.length,3*L);d>c;c++)B[c]=0;for(c=3*H,d=Math.max(C.length,3*L);d>c;c++)C[c]=0;p.directional.length=E,p.point.length=F,p.spot.length=G,p.hemi.length=H,p.ambient[0]=m,p.ambient[1]=n,p.ambient[2]=o}function ib(a){a!==mc&&(Ob.lineWidth(a),mc=a)}function jb(a,b,c){jc!==a&&(a?Ob.enable(Ob.POLYGON_OFFSET_FILL):Ob.disable(Ob.POLYGON_OFFSET_FILL),jc=a),!a||kc===b&&lc===c||(Ob.polygonOffset(b,c),kc=b,lc=c)}function kb(a){var b,c,d=[];for(var e in a)b=a[e],b!==!1&&(c="#define "+e+" "+b,d.push(c));return d.join("\n")}function lb(a,b,c,d,e,f,h){var i,j,k,l,m,n=[];a?n.push(a):(n.push(b),n.push(c));for(k in f)n.push(k),n.push(f[k]);for(i in h)n.push(i),n.push(h[i]);for(m=n.join(),i=0,j=Ub.length;j>i;i++){var o=Ub[i];if(o.code===m)return o.usedTimes++,o.program}var p="SHADOWMAP_TYPE_BASIC";h.shadowMapType===g.PCFShadowMap?p="SHADOWMAP_TYPE_PCF":h.shadowMapType===g.PCFSoftShadowMap&&(p="SHADOWMAP_TYPE_PCF_SOFT");var q=kb(f);l=Ob.createProgram();var r=["precision "+Gb+" float;",q,Fc?"#define VERTEX_TEXTURES":"",Tb.gammaInput?"#define GAMMA_INPUT":"",Tb.gammaOutput?"#define GAMMA_OUTPUT":"",Tb.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,"#define MAX_BONES "+h.maxBones,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.vertexColors?"#define USE_COLOR":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.boneTextureWidth?"#define N_BONE_PIXEL_X "+h.boneTextureWidth.toFixed(1):"",h.boneTextureHeight?"#define N_BONE_PIXEL_Y "+h.boneTextureHeight.toFixed(1):"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals?"#define USE_MORPHNORMALS":"",h.perPixel?"#define PHONG_PER_PIXEL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+p:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),s=["precision "+Gb+" float;",h.bumpMap||h.normalMap?"#extension GL_OES_standard_derivatives : enable":"",q,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",Tb.gammaInput?"#define GAMMA_INPUT":"",Tb.gammaOutput?"#define GAMMA_OUTPUT":"",Tb.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.vertexColors?"#define USE_COLOR":"",h.metal?"#define METAL":"",h.perPixel?"#define PHONG_PER_PIXEL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+p:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),t=pb("fragment",s+b),u=pb("vertex",r+c);Ob.attachShader(l,u),Ob.attachShader(l,t),Ob.linkProgram(l),Ob.getProgramParameter(l,Ob.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+Ob.getProgramParameter(l,Ob.VALIDATE_STATUS)+", gl error ["+Ob.getError()+"]"),Ob.deleteShader(t),Ob.deleteShader(u),l.uniforms={},l.attributes={};var v,w,x,y;v=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],h.useVertexTexture?v.push("boneTexture"):v.push("boneGlobalMatrices");for(w in d)v.push(w);for(mb(l,v),v=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],y=0;y<h.maxMorphTargets;y++)v.push("morphTarget"+y);for(y=0;y<h.maxMorphNormals;y++)v.push("morphNormal"+y);for(x in e)v.push(x);return nb(l,v),l.id=Vb++,Ub.push({program:l,code:m,usedTimes:1}),Tb.info.memory.programs=Ub.length,l}function mb(a,b){var c,d,e;for(c=0,d=b.length;d>c;c++)e=b[c],a.uniforms[e]=Ob.getUniformLocation(a,e)}function nb(a,b){var c,d,e;for(c=0,d=b.length;d>c;c++)e=b[c],a.attributes[e]=Ob.getAttribLocation(a,e)}function ob(a){for(var b=a.split("\n"),c=0,d=b.length;d>c;c++)b[c]=c+1+": "+b[c];return b.join("\n")}function pb(a,b){var c;return"fragment"===a?c=Ob.createShader(Ob.FRAGMENT_SHADER):"vertex"===a&&(c=Ob.createShader(Ob.VERTEX_SHADER)),Ob.shaderSource(c,b),Ob.compileShader(c),Ob.getShaderParameter(c,Ob.COMPILE_STATUS)?c:(console.error(Ob.getShaderInfoLog(c)),console.error(ob(b)),null)}function qb(a){return 0===(a&a-1)}function rb(a,b,c){c?(Ob.texParameteri(a,Ob.TEXTURE_WRAP_S,zb(b.wrapS)),Ob.texParameteri(a,Ob.TEXTURE_WRAP_T,zb(b.wrapT)),Ob.texParameteri(a,Ob.TEXTURE_MAG_FILTER,zb(b.magFilter)),Ob.texParameteri(a,Ob.TEXTURE_MIN_FILTER,zb(b.minFilter))):(Ob.texParameteri(a,Ob.TEXTURE_WRAP_S,Ob.CLAMP_TO_EDGE),Ob.texParameteri(a,Ob.TEXTURE_WRAP_T,Ob.CLAMP_TO_EDGE),Ob.texParameteri(a,Ob.TEXTURE_MAG_FILTER,yb(b.magFilter)),Ob.texParameteri(a,Ob.TEXTURE_MIN_FILTER,yb(b.minFilter))),Rb&&b.type!==g.FloatType&&(b.anisotropy>1||b.__oldAnisotropy)&&(Ob.texParameterf(a,Rb.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,Ec)),b.__oldAnisotropy=b.anisotropy)}function sb(a,b){if(a.width<=b&&a.height<=b)return a;var c=Math.max(a.width,a.height),d=Math.floor(a.width*b/c),e=Math.floor(a.height*b/c),f=document.createElement("canvas");f.width=d,f.height=e;var g=f.getContext("2d");return g.drawImage(a,0,0,a.width,a.height,0,0,d,e),f}function tb(a,b){if(6===a.image.length)if(a.needsUpdate){a.image.__webglTextureCube||(a.image.__webglTextureCube=Ob.createTexture(),Tb.info.memory.textures++),Ob.activeTexture(Ob.TEXTURE0+b),Ob.bindTexture(Ob.TEXTURE_CUBE_MAP,a.image.__webglTextureCube),Ob.pixelStorei(Ob.UNPACK_FLIP_Y_WEBGL,a.flipY);for(var c=a instanceof g.CompressedTexture,d=[],e=0;6>e;e++)d[e]=Tb.autoScaleCubemaps&&!c?sb(a.image[e],Dc):a.image[e];var f=d[0],h=qb(f.width)&&qb(f.height),i=zb(a.format),j=zb(a.type);rb(Ob.TEXTURE_CUBE_MAP,a,h);for(var e=0;6>e;e++)if(c)for(var k,l=d[e].mipmaps,m=0,n=l.length;n>m;m++)k=l[m],Ob.compressedTexImage2D(Ob.TEXTURE_CUBE_MAP_POSITIVE_X+e,m,i,k.width,k.height,0,k.data);else Ob.texImage2D(Ob.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,i,i,j,d[e]);a.generateMipmaps&&h&&Ob.generateMipmap(Ob.TEXTURE_CUBE_MAP),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()}else Ob.activeTexture(Ob.TEXTURE0+b),Ob.bindTexture(Ob.TEXTURE_CUBE_MAP,a.image.__webglTextureCube)}function ub(a,b){Ob.activeTexture(Ob.TEXTURE0+b),Ob.bindTexture(Ob.TEXTURE_CUBE_MAP,a.__webglTexture)}function vb(a,b,c){Ob.bindFramebuffer(Ob.FRAMEBUFFER,a),Ob.framebufferTexture2D(Ob.FRAMEBUFFER,Ob.COLOR_ATTACHMENT0,c,b.__webglTexture,0)}function wb(a,b){Ob.bindRenderbuffer(Ob.RENDERBUFFER,a),b.depthBuffer&&!b.stencilBuffer?(Ob.renderbufferStorage(Ob.RENDERBUFFER,Ob.DEPTH_COMPONENT16,b.width,b.height),Ob.framebufferRenderbuffer(Ob.FRAMEBUFFER,Ob.DEPTH_ATTACHMENT,Ob.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(Ob.renderbufferStorage(Ob.RENDERBUFFER,Ob.DEPTH_STENCIL,b.width,b.height),Ob.framebufferRenderbuffer(Ob.FRAMEBUFFER,Ob.DEPTH_STENCIL_ATTACHMENT,Ob.RENDERBUFFER,a)):Ob.renderbufferStorage(Ob.RENDERBUFFER,Ob.RGBA4,b.width,b.height)}function xb(a){a instanceof g.WebGLRenderTargetCube?(Ob.bindTexture(Ob.TEXTURE_CUBE_MAP,a.__webglTexture),Ob.generateMipmap(Ob.TEXTURE_CUBE_MAP),Ob.bindTexture(Ob.TEXTURE_CUBE_MAP,null)):(Ob.bindTexture(Ob.TEXTURE_2D,a.__webglTexture),Ob.generateMipmap(Ob.TEXTURE_2D),Ob.bindTexture(Ob.TEXTURE_2D,null))}function yb(a){return a===g.NearestFilter||a===g.NearestMipMapNearestFilter||a===g.NearestMipMapLinearFilter?Ob.NEAREST:Ob.LINEAR}function zb(a){if(a===g.RepeatWrapping)return Ob.REPEAT;if(a===g.ClampToEdgeWrapping)return Ob.CLAMP_TO_EDGE;if(a===g.MirroredRepeatWrapping)return Ob.MIRRORED_REPEAT;if(a===g.NearestFilter)return Ob.NEAREST;if(a===g.NearestMipMapNearestFilter)return Ob.NEAREST_MIPMAP_NEAREST;if(a===g.NearestMipMapLinearFilter)return Ob.NEAREST_MIPMAP_LINEAR;if(a===g.LinearFilter)return Ob.LINEAR;if(a===g.LinearMipMapNearestFilter)return Ob.LINEAR_MIPMAP_NEAREST;if(a===g.LinearMipMapLinearFilter)return Ob.LINEAR_MIPMAP_LINEAR;if(a===g.UnsignedByteType)return Ob.UNSIGNED_BYTE;if(a===g.UnsignedShort4444Type)return Ob.UNSIGNED_SHORT_4_4_4_4;if(a===g.UnsignedShort5551Type)return Ob.UNSIGNED_SHORT_5_5_5_1;if(a===g.UnsignedShort565Type)return Ob.UNSIGNED_SHORT_5_6_5;if(a===g.ByteType)return Ob.BYTE;if(a===g.ShortType)return Ob.SHORT;if(a===g.UnsignedShortType)return Ob.UNSIGNED_SHORT;if(a===g.IntType)return Ob.INT;if(a===g.UnsignedIntType)return Ob.UNSIGNED_INT;if(a===g.FloatType)return Ob.FLOAT;if(a===g.AlphaFormat)return Ob.ALPHA;if(a===g.RGBFormat)return Ob.RGB;if(a===g.RGBAFormat)return Ob.RGBA;if(a===g.LuminanceFormat)return Ob.LUMINANCE;if(a===g.LuminanceAlphaFormat)return Ob.LUMINANCE_ALPHA;if(a===g.AddEquation)return Ob.FUNC_ADD;if(a===g.SubtractEquation)return Ob.FUNC_SUBTRACT;if(a===g.ReverseSubtractEquation)return Ob.FUNC_REVERSE_SUBTRACT;if(a===g.ZeroFactor)return Ob.ZERO;if(a===g.OneFactor)return Ob.ONE;if(a===g.SrcColorFactor)return Ob.SRC_COLOR;if(a===g.OneMinusSrcColorFactor)return Ob.ONE_MINUS_SRC_COLOR;if(a===g.SrcAlphaFactor)return Ob.SRC_ALPHA;if(a===g.OneMinusSrcAlphaFactor)return Ob.ONE_MINUS_SRC_ALPHA;if(a===g.DstAlphaFactor)return Ob.DST_ALPHA;if(a===g.OneMinusDstAlphaFactor)return Ob.ONE_MINUS_DST_ALPHA;if(a===g.DstColorFactor)return Ob.DST_COLOR;if(a===g.OneMinusDstColorFactor)return Ob.ONE_MINUS_DST_COLOR;if(a===g.SrcAlphaSaturateFactor)return Ob.SRC_ALPHA_SATURATE;if(void 0!==Sb){if(a===g.RGB_S3TC_DXT1_Format)return Sb.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===g.RGBA_S3TC_DXT1_Format)return Sb.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===g.RGBA_S3TC_DXT3_Format)return Sb.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===g.RGBA_S3TC_DXT5_Format)return Sb.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function Ab(a){if(Gc&&a&&a.useVertexTexture)return 1024;var b=Ob.getParameter(Ob.MAX_VERTEX_UNIFORM_VECTORS),c=Math.floor((b-20)/4),d=c;return void 0!==a&&a instanceof g.SkinnedMesh&&(d=Math.min(a.bones.length,d),d<a.bones.length&&console.warn("WebGLRenderer: too many bones - "+a.bones.length+", this GPU supports just "+d+" (try OpenGL instead of ANGLE)")),d}function Bb(a){var b,c,d,e,f,h,i;for(e=f=h=i=0,b=0,c=a.length;c>b;b++)d=a[b],d.onlyShadow||(d instanceof g.DirectionalLight&&e++,d instanceof g.PointLight&&f++,d instanceof g.SpotLight&&h++,d instanceof g.HemisphereLight&&i++);return{directional:e,point:f,spot:h,hemi:i}}function Cb(a){var b,c,d,e=0;for(b=0,c=a.length;c>b;b++)d=a[b],d.castShadow&&(d instanceof g.SpotLight&&e++,d instanceof g.DirectionalLight&&!d.shadowCascade&&e++);return e}function Db(){try{if(!(Ob=Fb.getContext("experimental-webgl",{alpha:Hb,premultipliedAlpha:Ib,antialias:Jb,stencil:Kb,preserveDrawingBuffer:Lb})))throw"Error creating WebGL context."}catch(a){console.error(a)}Pb=Ob.getExtension("OES_texture_float"),Qb=Ob.getExtension("OES_standard_derivatives"),Rb=Ob.getExtension("EXT_texture_filter_anisotropic")||Ob.getExtension("MOZ_EXT_texture_filter_anisotropic")||Ob.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),Sb=Ob.getExtension("WEBGL_compressed_texture_s3tc")||Ob.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Ob.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Pb||console.log("THREE.WebGLRenderer: Float textures not supported."),Qb||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),Rb||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),Sb||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===Ob.getShaderPrecisionFormat&&(Ob.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}function Eb(){Ob.clearColor(0,0,0,1),Ob.clearDepth(1),Ob.clearStencil(0),Ob.enable(Ob.DEPTH_TEST),Ob.depthFunc(Ob.LEQUAL),Ob.frontFace(Ob.CCW),Ob.cullFace(Ob.BACK),Ob.enable(Ob.CULL_FACE),Ob.enable(Ob.BLEND),Ob.blendEquation(Ob.FUNC_ADD),Ob.blendFunc(Ob.SRC_ALPHA,Ob.ONE_MINUS_SRC_ALPHA),Ob.clearColor(Mb.r,Mb.g,Mb.b,Nb)}console.log("THREE.WebGLRenderer",g.REVISION),a=a||{};var Fb=void 0!==a.canvas?a.canvas:document.createElement("canvas"),Gb=void 0!==a.precision?a.precision:"highp",Hb=void 0!==a.alpha?a.alpha:!0,Ib=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,Jb=void 0!==a.antialias?a.antialias:!1,Kb=void 0!==a.stencil?a.stencil:!0,Lb=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,Mb=void 0!==a.clearColor?new g.Color(a.clearColor):new g.Color(0),Nb=void 0!==a.clearAlpha?a.clearAlpha:0;this.domElement=Fb,this.context=null,this.devicePixelRatio=void 0!==a.devicePixelRatio?a.devicePixelRatio:void 0!==e.devicePixelRatio?e.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=g.PCFShadowMap,this.shadowMapCullFace=g.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Ob,Pb,Qb,Rb,Sb,Tb=this,Ub=[],Vb=0,Wb=null,Xb=null,Yb=-1,Zb=null,$b=null,_b=0,ac=0,bc=-1,cc=-1,dc=-1,ec=-1,fc=-1,gc=-1,hc=-1,ic=-1,jc=null,kc=null,lc=null,mc=null,nc=0,oc=0,pc=0,qc=0,rc=0,sc=0,tc={},uc=new g.Frustum,vc=new g.Matrix4,wc=new g.Matrix4,xc=new g.Vector3,yc=new g.Vector3,zc=!0,Ac={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};Db(),Eb(),this.context=Ob;var Bc=Ob.getParameter(Ob.MAX_TEXTURE_IMAGE_UNITS),Cc=Ob.getParameter(Ob.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Dc=(Ob.getParameter(Ob.MAX_TEXTURE_SIZE),Ob.getParameter(Ob.MAX_CUBE_MAP_TEXTURE_SIZE)),Ec=Rb?Ob.getParameter(Rb.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Fc=Cc>0,Gc=Fc&&Pb,Hc=(Sb?Ob.getParameter(Ob.COMPRESSED_TEXTURE_FORMATS):[],Ob.getShaderPrecisionFormat(Ob.VERTEX_SHADER,Ob.HIGH_FLOAT)),Ic=Ob.getShaderPrecisionFormat(Ob.VERTEX_SHADER,Ob.MEDIUM_FLOAT),Jc=(Ob.getShaderPrecisionFormat(Ob.VERTEX_SHADER,Ob.LOW_FLOAT),Ob.getShaderPrecisionFormat(Ob.FRAGMENT_SHADER,Ob.HIGH_FLOAT)),Kc=Ob.getShaderPrecisionFormat(Ob.FRAGMENT_SHADER,Ob.MEDIUM_FLOAT),Lc=(Ob.getShaderPrecisionFormat(Ob.FRAGMENT_SHADER,Ob.LOW_FLOAT),Ob.getShaderPrecisionFormat(Ob.VERTEX_SHADER,Ob.HIGH_INT),Ob.getShaderPrecisionFormat(Ob.VERTEX_SHADER,Ob.MEDIUM_INT),Ob.getShaderPrecisionFormat(Ob.VERTEX_SHADER,Ob.LOW_INT),Ob.getShaderPrecisionFormat(Ob.FRAGMENT_SHADER,Ob.HIGH_INT),Ob.getShaderPrecisionFormat(Ob.FRAGMENT_SHADER,Ob.MEDIUM_INT),Ob.getShaderPrecisionFormat(Ob.FRAGMENT_SHADER,Ob.LOW_INT),Hc.precision>0&&Jc.precision>0),Mc=Ic.precision>0&&Kc.precision>0;"highp"!==Gb||Lc||(Mc?(Gb="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(Gb="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==Gb||Mc||(Gb="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Ob},this.supportsVertexTextures=function(){return Fc},this.supportsFloatTextures=function(){return Pb},this.supportsStandardDerivatives=function(){return Qb},this.supportsCompressedTextureS3TC=function(){return Sb},this.getMaxAnisotropy=function(){return Ec},this.getPrecision=function(){return Gb},this.setSize=function(a,b){Fb.width=a*this.devicePixelRatio,Fb.height=b*this.devicePixelRatio,Fb.style.width=a+"px",Fb.style.height=b+"px",this.setViewport(0,0,Fb.width,Fb.height)},this.setViewport=function(a,b,c,d){nc=void 0!==a?a:0,oc=void 0!==b?b:0,pc=void 0!==c?c:Fb.width,qc=void 0!==d?d:Fb.height,Ob.viewport(nc,oc,pc,qc)},this.setScissor=function(a,b,c,d){Ob.scissor(a,b,c,d)},this.enableScissorTest=function(a){a?Ob.enable(Ob.SCISSOR_TEST):Ob.disable(Ob.SCISSOR_TEST)},this.setClearColorHex=function(a,b){Mb.setHex(a),Nb=b,Ob.clearColor(Mb.r,Mb.g,Mb.b,Nb)},this.setClearColor=function(a,b){Mb.copy(a),Nb=b,Ob.clearColor(Mb.r,Mb.g,Mb.b,Nb)},this.getClearColor=function(){return Mb},this.getClearAlpha=function(){return Nb},this.clear=function(a,b,c){var d=0;(void 0===a||a)&&(d|=Ob.COLOR_BUFFER_BIT),(void 0===b||b)&&(d|=Ob.DEPTH_BUFFER_BIT),(void 0===c||c)&&(d|=Ob.STENCIL_BUFFER_BIT),Ob.clear(d)},this.clearTarget=function(a,b,c,d){this.setRenderTarget(a),this.clear(b,c,d)},this.addPostPlugin=function(a){a.init(this),this.renderPluginsPost.push(a)},this.addPrePlugin=function(a){a.init(this),this.renderPluginsPre.push(a)},this.updateShadowMap=function(a,b){Wb=null,dc=-1,hc=-1,ic=-1,Zb=-1,Yb=-1,zc=!0,bc=-1,cc=-1,this.shadowMapPlugin.update(a,b)};var Nc=function(a){var b=a.target;b.removeEventListener("dispose",Nc),Rc(b),Tb.info.memory.geometries--},Oc=function(a){var b=a.target;b.removeEventListener("dispose",Oc),Sc(b),Tb.info.memory.textures--},Pc=function(a){var b=a.target;b.removeEventListener("dispose",Pc),Tc(b),Tb.info.memory.textures--},Qc=function(a){var b=a.target;b.removeEventListener("dispose",Qc),Uc(b)},Rc=function(a){if(a.__webglInit=void 0,void 0!==a.__webglVertexBuffer&&Ob.deleteBuffer(a.__webglVertexBuffer),void 0!==a.__webglNormalBuffer&&Ob.deleteBuffer(a.__webglNormalBuffer),void 0!==a.__webglTangentBuffer&&Ob.deleteBuffer(a.__webglTangentBuffer),void 0!==a.__webglColorBuffer&&Ob.deleteBuffer(a.__webglColorBuffer),void 0!==a.__webglUVBuffer&&Ob.deleteBuffer(a.__webglUVBuffer),void 0!==a.__webglUV2Buffer&&Ob.deleteBuffer(a.__webglUV2Buffer),void 0!==a.__webglSkinIndicesBuffer&&Ob.deleteBuffer(a.__webglSkinIndicesBuffer),void 0!==a.__webglSkinWeightsBuffer&&Ob.deleteBuffer(a.__webglSkinWeightsBuffer),void 0!==a.__webglFaceBuffer&&Ob.deleteBuffer(a.__webglFaceBuffer),void 0!==a.__webglLineBuffer&&Ob.deleteBuffer(a.__webglLineBuffer),void 0!==a.__webglLineDistanceBuffer&&Ob.deleteBuffer(a.__webglLineDistanceBuffer),void 0!==a.geometryGroups)for(var b in a.geometryGroups){var c=a.geometryGroups[b];if(void 0!==c.numMorphTargets)for(var d=0,e=c.numMorphTargets;e>d;d++)Ob.deleteBuffer(c.__webglMorphTargetsBuffers[d]);if(void 0!==c.numMorphNormals)for(var d=0,e=c.numMorphNormals;e>d;d++)Ob.deleteBuffer(c.__webglMorphNormalsBuffers[d]);h(c)}h(a)},Sc=function(a){if(a.image&&a.image.__webglTextureCube)Ob.deleteTexture(a.image.__webglTextureCube);else{if(!a.__webglInit)return;a.__webglInit=!1,Ob.deleteTexture(a.__webglTexture)}},Tc=function(a){if(a&&a.__webglTexture)if(Ob.deleteTexture(a.__webglTexture),a instanceof g.WebGLRenderTargetCube)for(var b=0;6>b;b++)Ob.deleteFramebuffer(a.__webglFramebuffer[b]),Ob.deleteRenderbuffer(a.__webglRenderbuffer[b]);else Ob.deleteFramebuffer(a.__webglFramebuffer),Ob.deleteRenderbuffer(a.__webglRenderbuffer)},Uc=function(a){var b=a.program;if(void 0!==b){a.program=void 0;var c,d,e,f=!1;for(c=0,d=Ub.length;d>c;c++)if(e=Ub[c],e.program===b){e.usedTimes--,0===e.usedTimes&&(f=!0);break}if(f===!0){var g=[];for(c=0,d=Ub.length;d>c;c++)e=Ub[c],e.program!==b&&g.push(e);Ub=g,Ob.deleteProgram(b),Tb.info.memory.programs--}}};this.renderBufferImmediate=function(a,b,c){if(a.hasPositions&&!a.__webglVertexBuffer&&(a.__webglVertexBuffer=Ob.createBuffer()),a.hasNormals&&!a.__webglNormalBuffer&&(a.__webglNormalBuffer=Ob.createBuffer()),a.hasUvs&&!a.__webglUvBuffer&&(a.__webglUvBuffer=Ob.createBuffer()),a.hasColors&&!a.__webglColorBuffer&&(a.__webglColorBuffer=Ob.createBuffer()),a.hasPositions&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglVertexBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,a.positionArray,Ob.DYNAMIC_DRAW),Ob.enableVertexAttribArray(b.attributes.position),Ob.vertexAttribPointer(b.attributes.position,3,Ob.FLOAT,!1,0,0)),a.hasNormals){if(Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglNormalBuffer),c.shading===g.FlatShading){var d,e,f,h,i,j,k,l,m,n,o,p,q,r,s=3*a.count;for(r=0;s>r;r+=9)q=a.normalArray,h=q[r],k=q[r+1],n=q[r+2],i=q[r+3],l=q[r+4],o=q[r+5],j=q[r+6],m=q[r+7],p=q[r+8],d=(h+i+j)/3,e=(k+l+m)/3,f=(n+o+p)/3,q[r]=d,q[r+1]=e,q[r+2]=f,q[r+3]=d,q[r+4]=e,q[r+5]=f,q[r+6]=d,q[r+7]=e,q[r+8]=f}Ob.bufferData(Ob.ARRAY_BUFFER,a.normalArray,Ob.DYNAMIC_DRAW),Ob.enableVertexAttribArray(b.attributes.normal),Ob.vertexAttribPointer(b.attributes.normal,3,Ob.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglUvBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,a.uvArray,Ob.DYNAMIC_DRAW),Ob.enableVertexAttribArray(b.attributes.uv),Ob.vertexAttribPointer(b.attributes.uv,2,Ob.FLOAT,!1,0,0)),a.hasColors&&c.vertexColors!==g.NoColors&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,a.__webglColorBuffer),Ob.bufferData(Ob.ARRAY_BUFFER,a.colorArray,Ob.DYNAMIC_DRAW),Ob.enableVertexAttribArray(b.attributes.color),Ob.vertexAttribPointer(b.attributes.color,3,Ob.FLOAT,!1,0,0)),Ob.drawArrays(Ob.TRIANGLES,0,a.count),a.count=0},this.renderBufferDirect=function(a,b,c,d,e,f){if(d.visible!==!1){var h,i;h=T(a,b,c,d,f),i=h.attributes;var j=!1,k=d.wireframe?1:0,l=16777215*e.id+2*h.id+k;if(l!==Zb&&(Zb=l,j=!0),j&&z(),f instanceof g.Mesh){var m=e.attributes.index;if(m){var n=e.offsets;n.length>1&&(j=!0);for(var o=0,p=n.length;p>o;o++){var q=n[o].index;if(j){var r=e.attributes.position,s=r.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,r.buffer),y(i.position),Ob.vertexAttribPointer(i.position,s,Ob.FLOAT,!1,0,q*s*4);var t=e.attributes.normal;if(i.normal>=0&&t){var u=t.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,t.buffer),y(i.normal),Ob.vertexAttribPointer(i.normal,u,Ob.FLOAT,!1,0,q*u*4)}var v=e.attributes.uv;if(i.uv>=0&&v){var w=v.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,v.buffer),y(i.uv),Ob.vertexAttribPointer(i.uv,w,Ob.FLOAT,!1,0,q*w*4)}var x=e.attributes.color;if(i.color>=0&&x){var A=x.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,x.buffer),y(i.color),Ob.vertexAttribPointer(i.color,A,Ob.FLOAT,!1,0,q*A*4)}var B=e.attributes.tangent;if(i.tangent>=0&&B){var C=B.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,B.buffer),y(i.tangent),Ob.vertexAttribPointer(i.tangent,C,Ob.FLOAT,!1,0,q*C*4)}Ob.bindBuffer(Ob.ELEMENT_ARRAY_BUFFER,m.buffer)}Ob.drawElements(Ob.TRIANGLES,n[o].count,Ob.UNSIGNED_SHORT,2*n[o].start),Tb.info.render.calls++,Tb.info.render.vertices+=n[o].count,Tb.info.render.faces+=n[o].count/3}}else{if(j){var r=e.attributes.position,s=r.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,r.buffer),y(i.position),Ob.vertexAttribPointer(i.position,s,Ob.FLOAT,!1,0,0);var t=e.attributes.normal;if(i.normal>=0&&t){var u=t.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,t.buffer),y(i.normal),Ob.vertexAttribPointer(i.normal,u,Ob.FLOAT,!1,0,0)}var v=e.attributes.uv;if(i.uv>=0&&v){var w=v.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,v.buffer),y(i.uv),Ob.vertexAttribPointer(i.uv,w,Ob.FLOAT,!1,0,0)}var x=e.attributes.color;if(i.color>=0&&x){var A=x.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,x.buffer),y(i.color),Ob.vertexAttribPointer(i.color,A,Ob.FLOAT,!1,0,0)}var B=e.attributes.tangent;if(i.tangent>=0&&B){var C=B.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,B.buffer),y(i.tangent),Ob.vertexAttribPointer(i.tangent,C,Ob.FLOAT,!1,0,0)}}Ob.drawArrays(Ob.TRIANGLES,0,r.numItems/3),Tb.info.render.calls++,Tb.info.render.vertices+=r.numItems/3,Tb.info.render.faces+=r.numItems/3/3}}else if(f instanceof g.ParticleSystem){if(j){var r=e.attributes.position,s=r.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,r.buffer),y(i.position),Ob.vertexAttribPointer(i.position,s,Ob.FLOAT,!1,0,0);var x=e.attributes.color;if(i.color>=0&&x){var A=x.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,x.buffer),y(i.color),Ob.vertexAttribPointer(i.color,A,Ob.FLOAT,!1,0,0)}Ob.drawArrays(Ob.POINTS,0,r.numItems/3),Tb.info.render.calls++,Tb.info.render.points+=r.numItems/3}}else if(f instanceof g.Line&&j){var r=e.attributes.position,s=r.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,r.buffer),y(i.position),Ob.vertexAttribPointer(i.position,s,Ob.FLOAT,!1,0,0);var x=e.attributes.color;if(i.color>=0&&x){var A=x.itemSize;Ob.bindBuffer(Ob.ARRAY_BUFFER,x.buffer),y(i.color),Ob.vertexAttribPointer(i.color,A,Ob.FLOAT,!1,0,0)}ib(d.linewidth),Ob.drawArrays(Ob.LINE_STRIP,0,r.numItems/3),Tb.info.render.calls++,Tb.info.render.points+=r.numItems}}},this.renderBuffer=function(a,b,c,d,e,f){if(d.visible!==!1){var h,i,j,k,l,m;h=T(a,b,c,d,f),i=h.attributes;var n=!1,o=d.wireframe?1:0,p=16777215*e.id+2*h.id+o;if(p!==Zb&&(Zb=p,n=!0),n&&z(),!d.morphTargets&&i.position>=0?n&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,e.__webglVertexBuffer),y(i.position),Ob.vertexAttribPointer(i.position,3,Ob.FLOAT,!1,0,0)):f.morphTargetBase&&A(d,e,f),n){if(e.__webglCustomAttributesList)for(l=0,m=e.__webglCustomAttributesList.length;m>l;l++)k=e.__webglCustomAttributesList[l],i[k.buffer.belongsToAttribute]>=0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,k.buffer),y(i[k.buffer.belongsToAttribute]),Ob.vertexAttribPointer(i[k.buffer.belongsToAttribute],k.size,Ob.FLOAT,!1,0,0));i.color>=0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,e.__webglColorBuffer),y(i.color),Ob.vertexAttribPointer(i.color,3,Ob.FLOAT,!1,0,0)),i.normal>=0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,e.__webglNormalBuffer),y(i.normal),Ob.vertexAttribPointer(i.normal,3,Ob.FLOAT,!1,0,0)),i.tangent>=0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,e.__webglTangentBuffer),y(i.tangent),Ob.vertexAttribPointer(i.tangent,4,Ob.FLOAT,!1,0,0)),i.uv>=0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,e.__webglUVBuffer),y(i.uv),Ob.vertexAttribPointer(i.uv,2,Ob.FLOAT,!1,0,0)),i.uv2>=0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,e.__webglUV2Buffer),y(i.uv2),Ob.vertexAttribPointer(i.uv2,2,Ob.FLOAT,!1,0,0)),d.skinning&&i.skinIndex>=0&&i.skinWeight>=0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),y(i.skinIndex),Ob.vertexAttribPointer(i.skinIndex,4,Ob.FLOAT,!1,0,0),Ob.bindBuffer(Ob.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),y(i.skinWeight),Ob.vertexAttribPointer(i.skinWeight,4,Ob.FLOAT,!1,0,0)),i.lineDistance>=0&&(Ob.bindBuffer(Ob.ARRAY_BUFFER,e.__webglLineDistanceBuffer),y(i.lineDistance),Ob.vertexAttribPointer(i.lineDistance,1,Ob.FLOAT,!1,0,0))}f instanceof g.Mesh?(d.wireframe?(ib(d.wireframeLinewidth),n&&Ob.bindBuffer(Ob.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Ob.drawElements(Ob.LINES,e.__webglLineCount,Ob.UNSIGNED_SHORT,0)):(n&&Ob.bindBuffer(Ob.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Ob.drawElements(Ob.TRIANGLES,e.__webglFaceCount,Ob.UNSIGNED_SHORT,0)),Tb.info.render.calls++,Tb.info.render.vertices+=e.__webglFaceCount,Tb.info.render.faces+=e.__webglFaceCount/3):f instanceof g.Line?(j=f.type===g.LineStrip?Ob.LINE_STRIP:Ob.LINES,ib(d.linewidth),Ob.drawArrays(j,0,e.__webglLineCount),Tb.info.render.calls++):f instanceof g.ParticleSystem?(Ob.drawArrays(Ob.POINTS,0,e.__webglParticleCount),Tb.info.render.calls++,Tb.info.render.points+=e.__webglParticleCount):f instanceof g.Ribbon&&(Ob.drawArrays(Ob.TRIANGLE_STRIP,0,e.__webglVertexCount),Tb.info.render.calls++)
}},this.render=function(a,b,c,d){if(b instanceof g.Camera==!1)return console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera."),void 0;var e,f,h,i,j,k=a.__lights,l=a.fog;for(Yb=-1,zc=!0,this.autoUpdateScene&&a.updateMatrixWorld(),void 0===b.parent&&b.updateMatrixWorld(),b.matrixWorldInverse.getInverse(b.matrixWorld),vc.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),uc.setFromMatrix(vc),this.autoUpdateObjects&&this.initWebGLObjects(a),D(this.renderPluginsPre,a,b),Tb.info.render.calls=0,Tb.info.render.vertices=0,Tb.info.render.faces=0,Tb.info.render.points=0,this.setRenderTarget(c),(this.autoClear||d)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),j=a.__webglObjects,e=0,f=j.length;f>e;e++)h=j[e],i=h.object,h.render=!1,i.visible&&((i instanceof g.Mesh||i instanceof g.ParticleSystem)&&i.frustumCulled&&!uc.intersectsObject(i)||(eb(i,b),H(h),h.render=!0,this.sortObjects===!0&&(null!==i.renderDepth?h.z=i.renderDepth:(xc.getPositionFromMatrix(i.matrixWorld),xc.applyProjection(vc),h.z=xc.z),h.id=i.id)));for(this.sortObjects&&j.sort(B),j=a.__webglObjectsImmediate,e=0,f=j.length;f>e;e++)h=j[e],i=h.object,i.visible&&(eb(i,b),G(h));if(a.overrideMaterial){var m=a.overrideMaterial;this.setBlending(m.blending,m.blendEquation,m.blendSrc,m.blendDst),this.setDepthTest(m.depthTest),this.setDepthWrite(m.depthWrite),jb(m.polygonOffset,m.polygonOffsetFactor,m.polygonOffsetUnits),E(a.__webglObjects,!1,"",b,k,l,!0,m),F(a.__webglObjectsImmediate,"",b,k,l,!1,m)}else{var m=null;this.setBlending(g.NoBlending),E(a.__webglObjects,!0,"opaque",b,k,l,!1,m),F(a.__webglObjectsImmediate,"opaque",b,k,l,!1,m),E(a.__webglObjects,!1,"transparent",b,k,l,!0,m),F(a.__webglObjectsImmediate,"transparent",b,k,l,!0,m)}D(this.renderPluginsPost,a,b),c&&c.generateMipmaps&&c.minFilter!==g.NearestFilter&&c.minFilter!==g.LinearFilter&&xb(c),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(a,b,c,d,e){var f=T(a,b,c,d,e);Zb=-1,Tb.setMaterialFaces(d),e.immediateRenderCallback?e.immediateRenderCallback(f,Ob,uc):e.render(function(a){Tb.renderBufferImmediate(a,f,d)})},this.initWebGLObjects=function(a){for(a.__webglObjects||(a.__webglObjects=[],a.__webglObjectsImmediate=[],a.__webglSprites=[],a.__webglFlares=[]);a.__objectsAdded.length;)J(a.__objectsAdded[0],a),a.__objectsAdded.splice(0,1);for(;a.__objectsRemoved.length;)P(a.__objectsRemoved[0],a),a.__objectsRemoved.splice(0,1);for(var b=0,c=a.__webglObjects.length;c>b;b++)M(a.__webglObjects[b].object)},this.initMaterial=function(a,b,c,d){a.addEventListener("dispose",Qc);var e,f,h,i,j,k,l;a instanceof g.MeshDepthMaterial?l="depth":a instanceof g.MeshNormalMaterial?l="normal":a instanceof g.MeshBasicMaterial?l="basic":a instanceof g.MeshLambertMaterial?l="lambert":a instanceof g.MeshPhongMaterial?l="phong":a instanceof g.LineBasicMaterial?l="basic":a instanceof g.LineDashedMaterial?l="dashed":a instanceof g.ParticleBasicMaterial&&(l="particle_basic"),l&&S(a,g.ShaderLib[l]),i=Bb(b),k=Cb(b),j=Ab(d),h={map:!!a.map,envMap:!!a.envMap,lightMap:!!a.lightMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,specularMap:!!a.specularMap,vertexColors:a.vertexColors,fog:c,useFog:a.fog,fogExp:c instanceof g.FogExp2,sizeAttenuation:a.sizeAttenuation,skinning:a.skinning,maxBones:j,useVertexTexture:Gc&&d&&d.useVertexTexture,boneTextureWidth:d&&d.boneTextureWidth,boneTextureHeight:d&&d.boneTextureHeight,morphTargets:a.morphTargets,morphNormals:a.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:i.directional,maxPointLights:i.point,maxSpotLights:i.spot,maxHemiLights:i.hemi,maxShadows:k,shadowMapEnabled:this.shadowMapEnabled&&d.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:a.alphaTest,metal:a.metal,perPixel:a.perPixel,wrapAround:a.wrapAround,doubleSided:a.side===g.DoubleSide,flipSided:a.side===g.BackSide},a.program=lb(l,a.fragmentShader,a.vertexShader,a.uniforms,a.attributes,a.defines,h);var m=a.program.attributes;if(a.morphTargets){a.numSupportedMorphTargets=0;var n,o="morphTarget";for(f=0;f<this.maxMorphTargets;f++)n=o+f,m[n]>=0&&a.numSupportedMorphTargets++}if(a.morphNormals){a.numSupportedMorphNormals=0;var n,o="morphNormal";for(f=0;f<this.maxMorphNormals;f++)n=o+f,m[n]>=0&&a.numSupportedMorphNormals++}a.uniformsList=[];for(e in a.uniforms)a.uniformsList.push([a.uniforms[e],e])},this.setFaceCulling=function(a,b){a===g.CullFaceNone?Ob.disable(Ob.CULL_FACE):(b===g.FrontFaceDirectionCW?Ob.frontFace(Ob.CW):Ob.frontFace(Ob.CCW),a===g.CullFaceBack?Ob.cullFace(Ob.BACK):a===g.CullFaceFront?Ob.cullFace(Ob.FRONT):Ob.cullFace(Ob.FRONT_AND_BACK),Ob.enable(Ob.CULL_FACE))},this.setMaterialFaces=function(a){var b=a.side===g.DoubleSide,c=a.side===g.BackSide;bc!==b&&(b?Ob.disable(Ob.CULL_FACE):Ob.enable(Ob.CULL_FACE),bc=b),cc!==c&&(c?Ob.frontFace(Ob.CW):Ob.frontFace(Ob.CCW),cc=c)},this.setDepthTest=function(a){hc!==a&&(a?Ob.enable(Ob.DEPTH_TEST):Ob.disable(Ob.DEPTH_TEST),hc=a)},this.setDepthWrite=function(a){ic!==a&&(Ob.depthMask(a),ic=a)},this.setBlending=function(a,b,c,d){a!==dc&&(a===g.NoBlending?Ob.disable(Ob.BLEND):a===g.AdditiveBlending?(Ob.enable(Ob.BLEND),Ob.blendEquation(Ob.FUNC_ADD),Ob.blendFunc(Ob.SRC_ALPHA,Ob.ONE)):a===g.SubtractiveBlending?(Ob.enable(Ob.BLEND),Ob.blendEquation(Ob.FUNC_ADD),Ob.blendFunc(Ob.ZERO,Ob.ONE_MINUS_SRC_COLOR)):a===g.MultiplyBlending?(Ob.enable(Ob.BLEND),Ob.blendEquation(Ob.FUNC_ADD),Ob.blendFunc(Ob.ZERO,Ob.SRC_COLOR)):a===g.CustomBlending?Ob.enable(Ob.BLEND):(Ob.enable(Ob.BLEND),Ob.blendEquationSeparate(Ob.FUNC_ADD,Ob.FUNC_ADD),Ob.blendFuncSeparate(Ob.SRC_ALPHA,Ob.ONE_MINUS_SRC_ALPHA,Ob.ONE,Ob.ONE_MINUS_SRC_ALPHA)),dc=a),a===g.CustomBlending?(b!==ec&&(Ob.blendEquation(zb(b)),ec=b),(c!==fc||d!==gc)&&(Ob.blendFunc(zb(c),zb(d)),fc=c,gc=d)):(ec=null,fc=null,gc=null)},this.setTexture=function(a,b){if(a.needsUpdate){a.__webglInit||(a.__webglInit=!0,a.addEventListener("dispose",Oc),a.__webglTexture=Ob.createTexture(),Tb.info.memory.textures++),Ob.activeTexture(Ob.TEXTURE0+b),Ob.bindTexture(Ob.TEXTURE_2D,a.__webglTexture),Ob.pixelStorei(Ob.UNPACK_FLIP_Y_WEBGL,a.flipY),Ob.pixelStorei(Ob.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),Ob.pixelStorei(Ob.UNPACK_ALIGNMENT,a.unpackAlignment);var c=a.image,d=qb(c.width)&&qb(c.height),e=zb(a.format),f=zb(a.type);rb(Ob.TEXTURE_2D,a,d);var h,i=a.mipmaps;if(a instanceof g.DataTexture)if(i.length>0&&d){for(var j=0,k=i.length;k>j;j++)h=i[j],Ob.texImage2D(Ob.TEXTURE_2D,j,e,h.width,h.height,0,e,f,h.data);a.generateMipmaps=!1}else Ob.texImage2D(Ob.TEXTURE_2D,0,e,c.width,c.height,0,e,f,c.data);else if(a instanceof g.CompressedTexture)for(var j=0,k=i.length;k>j;j++)h=i[j],Ob.compressedTexImage2D(Ob.TEXTURE_2D,j,e,h.width,h.height,0,h.data);else if(i.length>0&&d){for(var j=0,k=i.length;k>j;j++)h=i[j],Ob.texImage2D(Ob.TEXTURE_2D,j,e,e,f,h);a.generateMipmaps=!1}else Ob.texImage2D(Ob.TEXTURE_2D,0,e,e,f,a.image);a.generateMipmaps&&d&&Ob.generateMipmap(Ob.TEXTURE_2D),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()}else Ob.activeTexture(Ob.TEXTURE0+b),Ob.bindTexture(Ob.TEXTURE_2D,a.__webglTexture)},this.setRenderTarget=function(a){var b=a instanceof g.WebGLRenderTargetCube;if(a&&!a.__webglFramebuffer){void 0===a.depthBuffer&&(a.depthBuffer=!0),void 0===a.stencilBuffer&&(a.stencilBuffer=!0),a.addEventListener("dispose",Pc),a.__webglTexture=Ob.createTexture(),Tb.info.memory.textures++;var c=qb(a.width)&&qb(a.height),d=zb(a.format),e=zb(a.type);if(b){a.__webglFramebuffer=[],a.__webglRenderbuffer=[],Ob.bindTexture(Ob.TEXTURE_CUBE_MAP,a.__webglTexture),rb(Ob.TEXTURE_CUBE_MAP,a,c);for(var f=0;6>f;f++)a.__webglFramebuffer[f]=Ob.createFramebuffer(),a.__webglRenderbuffer[f]=Ob.createRenderbuffer(),Ob.texImage2D(Ob.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,d,a.width,a.height,0,d,e,null),vb(a.__webglFramebuffer[f],a,Ob.TEXTURE_CUBE_MAP_POSITIVE_X+f),wb(a.__webglRenderbuffer[f],a);c&&Ob.generateMipmap(Ob.TEXTURE_CUBE_MAP)}else a.__webglFramebuffer=Ob.createFramebuffer(),a.__webglRenderbuffer=a.shareDepthFrom?a.shareDepthFrom.__webglRenderbuffer:Ob.createRenderbuffer(),Ob.bindTexture(Ob.TEXTURE_2D,a.__webglTexture),rb(Ob.TEXTURE_2D,a,c),Ob.texImage2D(Ob.TEXTURE_2D,0,d,a.width,a.height,0,d,e,null),vb(a.__webglFramebuffer,a,Ob.TEXTURE_2D),a.shareDepthFrom?a.depthBuffer&&!a.stencilBuffer?Ob.framebufferRenderbuffer(Ob.FRAMEBUFFER,Ob.DEPTH_ATTACHMENT,Ob.RENDERBUFFER,a.__webglRenderbuffer):a.depthBuffer&&a.stencilBuffer&&Ob.framebufferRenderbuffer(Ob.FRAMEBUFFER,Ob.DEPTH_STENCIL_ATTACHMENT,Ob.RENDERBUFFER,a.__webglRenderbuffer):wb(a.__webglRenderbuffer,a),c&&Ob.generateMipmap(Ob.TEXTURE_2D);b?Ob.bindTexture(Ob.TEXTURE_CUBE_MAP,null):Ob.bindTexture(Ob.TEXTURE_2D,null),Ob.bindRenderbuffer(Ob.RENDERBUFFER,null),Ob.bindFramebuffer(Ob.FRAMEBUFFER,null)}var h,i,j,k,l;a?(h=b?a.__webglFramebuffer[a.activeCubeFace]:a.__webglFramebuffer,i=a.width,j=a.height,k=0,l=0):(h=null,i=pc,j=qc,k=nc,l=oc),h!==Xb&&(Ob.bindFramebuffer(Ob.FRAMEBUFFER,h),Ob.viewport(k,l,i,j),Xb=h),rc=i,sc=j},this.shadowMapPlugin=new g.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new g.SpritePlugin),this.addPostPlugin(new g.LensFlarePlugin)},g.WebGLRenderTarget=function(a,b,c){g.EventDispatcher.call(this),this.width=a,this.height=b,c=c||{},this.wrapS=void 0!==c.wrapS?c.wrapS:g.ClampToEdgeWrapping,this.wrapT=void 0!==c.wrapT?c.wrapT:g.ClampToEdgeWrapping,this.magFilter=void 0!==c.magFilter?c.magFilter:g.LinearFilter,this.minFilter=void 0!==c.minFilter?c.minFilter:g.LinearMipMapLinearFilter,this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1,this.offset=new g.Vector2(0,0),this.repeat=new g.Vector2(1,1),this.format=void 0!==c.format?c.format:g.RGBAFormat,this.type=void 0!==c.type?c.type:g.UnsignedByteType,this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0,this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},g.WebGLRenderTarget.prototype.clone=function(){var a=new g.WebGLRenderTarget(this.width,this.height);return a.wrapS=this.wrapS,a.wrapT=this.wrapT,a.magFilter=this.magFilter,a.minFilter=this.minFilter,a.anisotropy=this.anisotropy,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.format=this.format,a.type=this.type,a.depthBuffer=this.depthBuffer,a.stencilBuffer=this.stencilBuffer,a.generateMipmaps=this.generateMipmaps,a.shareDepthFrom=this.shareDepthFrom,a},g.WebGLRenderTarget.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},g.WebGLRenderTargetCube=function(a,b,c){g.WebGLRenderTarget.call(this,a,b,c),this.activeCubeFace=0},g.WebGLRenderTargetCube.prototype=Object.create(g.WebGLRenderTarget.prototype),g.RenderableVertex=function(){this.positionWorld=new g.Vector3,this.positionScreen=new g.Vector4,this.visible=!0},g.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld),this.positionScreen.copy(a.positionScreen)},g.RenderableFace3=function(){this.v1=new g.RenderableVertex,this.v2=new g.RenderableVertex,this.v3=new g.RenderableVertex,this.centroidModel=new g.Vector3,this.normalModel=new g.Vector3,this.normalModelView=new g.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new g.Vector3,new g.Vector3,new g.Vector3],this.vertexNormalsModelView=[new g.Vector3,new g.Vector3,new g.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},g.RenderableFace4=function(){this.v1=new g.RenderableVertex,this.v2=new g.RenderableVertex,this.v3=new g.RenderableVertex,this.v4=new g.RenderableVertex,this.centroidModel=new g.Vector3,this.normalModel=new g.Vector3,this.normalModelView=new g.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new g.Vector3,new g.Vector3,new g.Vector3,new g.Vector3],this.vertexNormalsModelView=[new g.Vector3,new g.Vector3,new g.Vector3,new g.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},g.RenderableObject=function(){this.object=null,this.z=null},g.RenderableParticle=function(){this.object=null,this.x=null,this.y=null,this.z=null,this.rotation=null,this.scale=new g.Vector2,this.material=null},g.RenderableLine=function(){this.z=null,this.v1=new g.RenderableVertex,this.v2=new g.RenderableVertex,this.material=null},g.GeometryUtils={merge:function(a,b){var c,d,e=a.vertices.length,f=(a.faceVertexUvs[0].length,b instanceof g.Mesh?b.geometry:b),h=a.vertices,i=f.vertices,j=a.faces,k=f.faces,l=a.faceVertexUvs[0],m=f.faceVertexUvs[0];b instanceof g.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),c=b.matrix,d=new g.Matrix3,d.getInverse(c),d.transpose());for(var n=0,o=i.length;o>n;n++){var p=i[n],q=p.clone();c&&q.applyMatrix4(c),h.push(q)}for(n=0,o=k.length;o>n;n++){var r,s,t,u=k[n],v=u.vertexNormals,w=u.vertexColors;u instanceof g.Face3?r=new g.Face3(u.a+e,u.b+e,u.c+e):u instanceof g.Face4&&(r=new g.Face4(u.a+e,u.b+e,u.c+e,u.d+e)),r.normal.copy(u.normal),d&&r.normal.applyMatrix3(d).normalize();for(var x=0,y=v.length;y>x;x++)s=v[x].clone(),d&&s.applyMatrix3(d).normalize(),r.vertexNormals.push(s);r.color.copy(u.color);for(var x=0,y=w.length;y>x;x++)t=w[x],r.vertexColors.push(t.clone());r.materialIndex=u.materialIndex,r.centroid.copy(u.centroid),c&&r.centroid.applyMatrix4(c),j.push(r)}for(n=0,o=m.length;o>n;n++){for(var z=m[n],A=[],x=0,y=z.length;y>x;x++)A.push(new g.Vector2(z[x].x,z[x].y));l.push(A)}},removeMaterials:function(a,b){for(var c={},d=0,e=b.length;e>d;d++)c[b[d]]=!0;for(var f,g=[],d=0,e=a.faces.length;e>d;d++)f=a.faces[d],f.materialIndex in c||g.push(f);a.faces=g},randomPointInTriangle:function(a,b,c){var d,e,f,h=new g.Vector3,i=g.GeometryUtils.__v1;return d=g.GeometryUtils.random(),e=g.GeometryUtils.random(),d+e>1&&(d=1-d,e=1-e),f=1-d-e,h.copy(a),h.multiplyScalar(d),i.copy(b),i.multiplyScalar(e),h.add(i),i.copy(c),i.multiplyScalar(f),h.add(i),h},randomPointInFace:function(a,b,c){var d,e,f,h;if(a instanceof g.Face3)return d=b.vertices[a.a],e=b.vertices[a.b],f=b.vertices[a.c],g.GeometryUtils.randomPointInTriangle(d,e,f);if(a instanceof g.Face4){d=b.vertices[a.a],e=b.vertices[a.b],f=b.vertices[a.c],h=b.vertices[a.d];var i,j;c?a._area1&&a._area2?(i=a._area1,j=a._area2):(i=g.GeometryUtils.triangleArea(d,e,h),j=g.GeometryUtils.triangleArea(e,f,h),a._area1=i,a._area2=j):(i=g.GeometryUtils.triangleArea(d,e,h),j=g.GeometryUtils.triangleArea(e,f,h));var k=g.GeometryUtils.random()*(i+j);return i>k?g.GeometryUtils.randomPointInTriangle(d,e,h):g.GeometryUtils.randomPointInTriangle(e,f,h)}},randomPointsInGeometry:function(a,b){function c(a){function b(c,d){if(c>d)return c;var e=c+Math.floor((d-c)/2);return o[e]>a?b(c,e-1):o[e]<a?b(e+1,d):e}var c=b(0,o.length-1);return c}var d,e,f,h,i,j,k=a.faces,l=a.vertices,m=k.length,n=0,o=[];for(e=0;m>e;e++)d=k[e],d instanceof g.Face3?(f=l[d.a],h=l[d.b],i=l[d.c],d._area=g.GeometryUtils.triangleArea(f,h,i)):d instanceof g.Face4&&(f=l[d.a],h=l[d.b],i=l[d.c],j=l[d.d],d._area1=g.GeometryUtils.triangleArea(f,h,j),d._area2=g.GeometryUtils.triangleArea(h,i,j),d._area=d._area1+d._area2),n+=d._area,o[e]=n;var p,q,r=[],s={};for(e=0;b>e;e++)p=g.GeometryUtils.random()*n,q=c(p),r[e]=g.GeometryUtils.randomPointInFace(k[q],a,!0),s[q]?s[q]+=1:s[q]=1;return r},triangleArea:function(a,b,c){var d=g.GeometryUtils.__v1,e=g.GeometryUtils.__v2;return d.subVectors(b,a),e.subVectors(c,a),d.cross(e),.5*d.length()},center:function(a){a.computeBoundingBox();var b=a.boundingBox,c=new g.Vector3;return c.addVectors(b.min,b.max),c.multiplyScalar(-.5),a.applyMatrix((new g.Matrix4).makeTranslation(c.x,c.y,c.z)),a.computeBoundingBox(),c},normalizeUVs:function(a){for(var b=a.faceVertexUvs[0],c=0,d=b.length;d>c;c++)for(var e=b[c],f=0,g=e.length;g>f;f++)1!==e[f].x&&(e[f].x=e[f].x-Math.floor(e[f].x)),1!==e[f].y&&(e[f].y=e[f].y-Math.floor(e[f].y))},triangulateQuads:function(a){var b,c,d,e,f=[],h=[],i=[];for(b=0,c=a.faceUvs.length;c>b;b++)h[b]=[];for(b=0,c=a.faceVertexUvs.length;c>b;b++)i[b]=[];for(b=0,c=a.faces.length;c>b;b++){var j=a.faces[b];if(j instanceof g.Face4){var k=j.a,l=j.b,m=j.c,n=j.d,o=new g.Face3,p=new g.Face3;for(o.color.copy(j.color),p.color.copy(j.color),o.materialIndex=j.materialIndex,p.materialIndex=j.materialIndex,o.a=k,o.b=l,o.c=n,p.a=l,p.b=m,p.c=n,4===j.vertexColors.length&&(o.vertexColors[0]=j.vertexColors[0].clone(),o.vertexColors[1]=j.vertexColors[1].clone(),o.vertexColors[2]=j.vertexColors[3].clone(),p.vertexColors[0]=j.vertexColors[1].clone(),p.vertexColors[1]=j.vertexColors[2].clone(),p.vertexColors[2]=j.vertexColors[3].clone()),f.push(o,p),d=0,e=a.faceVertexUvs.length;e>d;d++)if(a.faceVertexUvs[d].length){var q=a.faceVertexUvs[d][b],r=q[0],s=q[1],t=q[2],u=q[3],v=[r.clone(),s.clone(),u.clone()],w=[s.clone(),t.clone(),u.clone()];i[d].push(v,w)}for(d=0,e=a.faceUvs.length;e>d;d++)if(a.faceUvs[d].length){var x=a.faceUvs[d][b];h[d].push(x,x)}}else{for(f.push(j),d=0,e=a.faceUvs.length;e>d;d++)h[d].push(a.faceUvs[d][b]);for(d=0,e=a.faceVertexUvs.length;e>d;d++)i[d].push(a.faceVertexUvs[d][b])}}a.faces=f,a.faceUvs=h,a.faceVertexUvs=i,a.computeCentroids(),a.computeFaceNormals(),a.computeVertexNormals(),a.hasTangents&&a.computeTangents()},setMaterialIndex:function(a,b,c,d){for(var e=a.faces,f=c||0,g=d||e.length-1,h=f;g>=h;h++)e[h].materialIndex=b}},g.GeometryUtils.random=g.Math.random16,g.GeometryUtils.__v1=new g.Vector3,g.GeometryUtils.__v2=new g.Vector3,g.ImageUtils={crossOrigin:"anonymous",loadTexture:function(a,b,c,d){var e=new Image,f=new g.Texture(e,b),h=new g.ImageLoader;return h.addEventListener("load",function(a){f.image=a.content,f.needsUpdate=!0,c&&c(f)}),h.addEventListener("error",function(a){d&&d(a.message)}),h.crossOrigin=this.crossOrigin,h.load(a,e),f.sourceFile=a,f},loadCompressedTexture:function(a,b,c,d){var e=new g.CompressedTexture;e.mapping=b;var f=new XMLHttpRequest;return f.onload=function(){var a=f.response,b=g.ImageUtils.parseDDS(a,!0);e.format=b.format,e.mipmaps=b.mipmaps,e.image.width=b.width,e.image.height=b.height,e.generateMipmaps=!1,e.needsUpdate=!0,c&&c(e)},f.onerror=d,f.open("GET",a,!0),f.responseType="arraybuffer",f.send(null),e},loadTextureCube:function(a,b,c,d){var e=[];e.loadCount=0;var f=new g.Texture;f.image=e,void 0!==b&&(f.mapping=b),f.flipY=!1;for(var h=0,i=a.length;i>h;++h){var j=new Image;e[h]=j,j.onload=function(){e.loadCount+=1,6===e.loadCount&&(f.needsUpdate=!0,c&&c(f))},j.onerror=d,j.crossOrigin=this.crossOrigin,j.src=a[h]}return f},loadCompressedTextureCube:function(a,b,c,d){var e=[];e.loadCount=0;var f=new g.CompressedTexture;f.image=e,void 0!==b&&(f.mapping=b),f.flipY=!1,f.generateMipmaps=!1;var h=function(a,b){return function(){var d=a.response,h=g.ImageUtils.parseDDS(d,!0);b.format=h.format,b.mipmaps=h.mipmaps,b.width=h.width,b.height=h.height,e.loadCount+=1,6===e.loadCount&&(f.format=h.format,f.needsUpdate=!0,c&&c(f))}};if(a instanceof Array)for(var i=0,j=a.length;j>i;++i){var k={};e[i]=k;var l=new XMLHttpRequest;l.onload=h(l,k),l.onerror=d;var m=a[i];l.open("GET",m,!0),l.responseType="arraybuffer",l.send(null)}else{var m=a,l=new XMLHttpRequest;l.onload=function(){var a=l.response,b=g.ImageUtils.parseDDS(a,!0);if(b.isCubemap){for(var d=b.mipmaps.length/b.mipmapCount,h=0;d>h;h++){e[h]={mipmaps:[]};for(var i=0;i<b.mipmapCount;i++)e[h].mipmaps.push(b.mipmaps[h*b.mipmapCount+i]),e[h].format=b.format,e[h].width=b.width,e[h].height=b.height}f.format=b.format,f.needsUpdate=!0,c&&c(f)}},l.onerror=d,l.open("GET",m,!0),l.responseType="arraybuffer",l.send(null)}return f},parseDDS:function(a,b){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function d(a){return String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)}var e={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},f=542327876,h=131072,i=512,j=4,k=c("DXT1"),l=c("DXT3"),m=c("DXT5"),n=31,o=0,p=1,q=2,r=3,s=4,t=7,u=20,v=21,w=28,x=new Int32Array(a,0,n);if(x[o]!==f)return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),e;if(!x[u]&j)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),e;var y,z=x[v];switch(z){case k:y=8,e.format=g.RGB_S3TC_DXT1_Format;break;case l:y=16,e.format=g.RGBA_S3TC_DXT3_Format;break;case m:y=16,e.format=g.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",d(z)),e}e.mipmapCount=1,x[q]&h&&b!==!1&&(e.mipmapCount=Math.max(1,x[t])),e.isCubemap=x[w]&i?!0:!1,e.width=x[s],e.height=x[r];for(var A=x[p]+4,B=e.width,C=e.height,D=e.isCubemap?6:1,E=0;D>E;E++){for(var F=0;F<e.mipmapCount;F++){var G=Math.max(4,B)/4*Math.max(4,C)/4*y,H=new Uint8Array(a,A,G),I={data:H,width:B,height:C};e.mipmaps.push(I),A+=G,B=Math.max(.5*B,1),C=Math.max(.5*C,1)}B=e.width,C=e.height}return e},getNormalMap:function(a,b){var c=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]},d=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]},e=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]};b=1|b;var f=a.width,g=a.height,h=document.createElement("canvas");h.width=f,h.height=g;var i=h.getContext("2d");i.drawImage(a,0,0);for(var j=i.getImageData(0,0,f,g).data,k=i.createImageData(f,g),l=k.data,m=0;f>m;m++)for(var n=0;g>n;n++){var o=0>n-1?0:n-1,p=n+1>g-1?g-1:n+1,q=0>m-1?0:m-1,r=m+1>f-1?f-1:m+1,s=[],t=[0,0,j[4*(n*f+m)]/255*b];s.push([-1,0,j[4*(n*f+q)]/255*b]),s.push([-1,-1,j[4*(o*f+q)]/255*b]),s.push([0,-1,j[4*(o*f+m)]/255*b]),s.push([1,-1,j[4*(o*f+r)]/255*b]),s.push([1,0,j[4*(n*f+r)]/255*b]),s.push([1,1,j[4*(p*f+r)]/255*b]),s.push([0,1,j[4*(p*f+m)]/255*b]),s.push([-1,1,j[4*(p*f+q)]/255*b]);for(var u=[],v=s.length,w=0;v>w;w++){var x=s[w],y=s[(w+1)%v];x=d(x,t),y=d(y,t),u.push(e(c(x,y)))}for(var z=[0,0,0],w=0;w<u.length;w++)z[0]+=u[w][0],z[1]+=u[w][1],z[2]+=u[w][2];z[0]/=u.length,z[1]/=u.length,z[2]/=u.length;var A=4*(n*f+m);l[A]=(z[0]+1)/2*255|0,l[A+1]=(z[1]+1)/2*255|0,l[A+2]=255*z[2]|0,l[A+3]=255}return i.putImageData(k,0,0),h},generateDataTexture:function(a,b,c){for(var d=a*b,e=new Uint8Array(3*d),f=Math.floor(255*c.r),h=Math.floor(255*c.g),i=Math.floor(255*c.b),j=0;d>j;j++)e[3*j]=f,e[3*j+1]=h,e[3*j+2]=i;var k=new g.DataTexture(e,a,b,g.RGBFormat);return k.needsUpdate=!0,k}},g.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new g.Object3D,d=0,e=b.length;e>d;d++)c.add(new g.Mesh(a,b[d]));return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld),b.remove(a),c.add(a)},attach:function(a,b,c){var d=new g.Matrix4;d.getInverse(c.matrixWorld),a.applyMatrix(d),b.remove(a),c.add(a)}},g.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(a){var b=a.familyName.toLowerCase(),c=this;c.faces[b]=c.faces[b]||{},c.faces[b][a.cssFontWeight]=c.faces[b][a.cssFontWeight]||{},c.faces[b][a.cssFontWeight][a.cssFontStyle]=a;c.faces[b][a.cssFontWeight][a.cssFontStyle]=a;return a},drawText:function(a){var b,c=this.getFace(),d=this.size/c.resolution,e=0,f=String(a).split(""),h=f.length,i=[];for(b=0;h>b;b++){var j=new g.Path,k=this.extractGlyphPoints(f[b],c,d,e,j);e+=k.offset,i.push(k.path)}var l=e/2;return{paths:i,offset:l}},extractGlyphPoints:function(a,b,c,d,e){var f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=[],A=b.glyphs[a]||b.glyphs["?"];if(A){if(A.o)for(j=A._cachedOutline||(A._cachedOutline=A.o.split(" ")),l=j.length,m=c,n=c,f=0;l>f;)switch(k=j[f++]){case"m":o=j[f++]*m+d,p=j[f++]*n,e.moveTo(o,p);break;case"l":o=j[f++]*m+d,p=j[f++]*n,e.lineTo(o,p);break;case"q":if(q=j[f++]*m+d,r=j[f++]*n,u=j[f++]*m+d,v=j[f++]*n,e.quadraticCurveTo(u,v,q,r),y=z[z.length-1])for(s=y.x,t=y.y,h=1,i=this.divisions;i>=h;h++){var B=h/i;g.Shape.Utils.b2(B,s,u,q),g.Shape.Utils.b2(B,t,v,r)}break;case"b":if(q=j[f++]*m+d,r=j[f++]*n,u=j[f++]*m+d,v=j[f++]*-n,w=j[f++]*m+d,x=j[f++]*-n,e.bezierCurveTo(q,r,u,v,w,x),y=z[z.length-1])for(s=y.x,t=y.y,h=1,i=this.divisions;i>=h;h++){var B=h/i;g.Shape.Utils.b3(B,s,u,w,q),g.Shape.Utils.b3(B,t,v,x,r)}}return{offset:A.ha*c,path:e}}}},g.FontUtils.generateShapes=function(a,b){b=b||{};var c=void 0!==b.size?b.size:100,d=void 0!==b.curveSegments?b.curveSegments:4,e=void 0!==b.font?b.font:"helvetiker",f=void 0!==b.weight?b.weight:"normal",h=void 0!==b.style?b.style:"normal";g.FontUtils.size=c,g.FontUtils.divisions=d,g.FontUtils.face=e,g.FontUtils.weight=f,g.FontUtils.style=h;for(var i=g.FontUtils.drawText(a),j=i.paths,k=[],l=0,m=j.length;m>l;l++)Array.prototype.push.apply(k,j[l].toShapes());return k},function(a){var b=1e-10,c=function(a,b){var c=a.length;if(3>c)return null;var f,g,h,i=[],j=[],k=[];if(d(a)>0)for(g=0;c>g;g++)j[g]=g;else for(g=0;c>g;g++)j[g]=c-1-g;var l=c,m=2*l;for(g=l-1;l>2;){if(m--<=0)return console.log("Warning, unable to triangulate polygon!"),b?k:i;if(f=g,f>=l&&(f=0),g=f+1,g>=l&&(g=0),h=g+1,h>=l&&(h=0),e(a,f,g,h,l,j)){var n,o,p,q,r;for(n=j[f],o=j[g],p=j[h],i.push([a[n],a[o],a[p]]),k.push([j[f],j[g],j[h]]),q=g,r=g+1;l>r;q++,r++)j[q]=j[r];l--,m=2*l}}return b?k:i},d=function(a){for(var b=a.length,c=0,d=b-1,e=0;b>e;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},e=function(a,c,d,e,f,g){var h,i,j,k,l,m,n,o,p;if(i=a[g[c]].x,j=a[g[c]].y,k=a[g[d]].x,l=a[g[d]].y,m=a[g[e]].x,n=a[g[e]].y,b>(k-i)*(n-j)-(l-j)*(m-i))return!1;var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;for(q=m-k,r=n-l,s=i-m,t=j-n,u=k-i,v=l-j,h=0;f>h;h++)if(h!==c&&h!==d&&h!==e&&(o=a[g[h]].x,p=a[g[h]].y,w=o-i,x=p-j,y=o-k,z=p-l,A=o-m,B=p-n,E=q*z-r*y,C=u*x-v*w,D=s*B-t*A,E>=0&&D>=0&&C>=0))return!1;return!0};return a.Triangulate=c,a.Triangulate.area=d,a}(g.FontUtils),f._typeface_js={faces:g.FontUtils.faces,loadFace:g.FontUtils.loadFace},g.Curve=function(){},g.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},g.Curve.prototype.getPointAt=function(a){var b=this.getUtoTmapping(a);return this.getPoint(b)},g.Curve.prototype.getPoints=function(a){a||(a=5);var b,c=[];for(b=0;a>=b;b++)c.push(this.getPoint(b/a));return c},g.Curve.prototype.getSpacedPoints=function(a){a||(a=5);var b,c=[];for(b=0;a>=b;b++)c.push(this.getPointAt(b/a));return c},g.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]},g.Curve.prototype.getLengths=function(a){if(a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b,c,d=[],e=this.getPoint(0),f=0;for(d.push(0),c=1;a>=c;c++)b=this.getPoint(c/a),f+=b.distanceTo(e),d.push(f),e=b;return this.cacheArcLengths=d,d},g.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},g.Curve.prototype.getUtoTmapping=function(a,b){var c,d=this.getLengths(),e=0,f=d.length;c=b?b:a*d[f-1];for(var g,h=0,i=f-1;i>=h;)if(e=Math.floor(h+(i-h)/2),g=d[e]-c,0>g)h=e+1;else{if(!(g>0)){i=e;break}i=e-1}if(e=i,d[e]==c){var j=e/(f-1);return j}var k=d[e],l=d[e+1],m=l-k,n=(c-k)/m,j=(e+n)/(f-1);return j},g.Curve.prototype.getTangent=function(a){var b=1e-4,c=a-b,d=a+b;0>c&&(c=0),d>1&&(d=1);var e=this.getPoint(c),f=this.getPoint(d),g=f.clone().sub(e);return g.normalize()},g.Curve.prototype.getTangentAt=function(a){var b=this.getUtoTmapping(a);return this.getTangent(b)},g.LineCurve=function(a,b){this.v1=a,this.v2=b},g.LineCurve.prototype=Object.create(g.Curve.prototype),g.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);return b.multiplyScalar(a).add(this.v1),b},g.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)},g.LineCurve.prototype.getTangent=function(){var a=this.v2.clone().sub(this.v1);return a.normalize()},g.QuadraticBezierCurve=function(a,b,c){this.v0=a,this.v1=b,this.v2=c},g.QuadraticBezierCurve.prototype=Object.create(g.Curve.prototype),g.QuadraticBezierCurve.prototype.getPoint=function(a){var b,c;return b=g.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x),c=g.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y),new g.Vector2(b,c)},g.QuadraticBezierCurve.prototype.getTangent=function(a){var b,c;b=g.Curve.Utils.tangentQuadraticBezier(a,this.v0.x,this.v1.x,this.v2.x),c=g.Curve.Utils.tangentQuadraticBezier(a,this.v0.y,this.v1.y,this.v2.y);var d=new g.Vector2(b,c);return d.normalize(),d},g.CubicBezierCurve=function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},g.CubicBezierCurve.prototype=Object.create(g.Curve.prototype),g.CubicBezierCurve.prototype.getPoint=function(a){var b,c;return b=g.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),c=g.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new g.Vector2(b,c)},g.CubicBezierCurve.prototype.getTangent=function(a){var b,c;b=g.Curve.Utils.tangentCubicBezier(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),c=g.Curve.Utils.tangentCubicBezier(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var d=new g.Vector2(b,c);return d.normalize(),d},g.SplineCurve=function(a){this.points=void 0==a?[]:a},g.SplineCurve.prototype=Object.create(g.Curve.prototype),g.SplineCurve.prototype.getPoint=function(a){var b,c,d,e=new g.Vector2,f=[],h=this.points;return b=(h.length-1)*a,c=Math.floor(b),d=b-c,f[0]=0==c?c:c-1,f[1]=c,f[2]=c>h.length-2?h.length-1:c+1,f[3]=c>h.length-3?h.length-1:c+2,e.x=g.Curve.Utils.interpolate(h[f[0]].x,h[f[1]].x,h[f[2]].x,h[f[3]].x,d),e.y=g.Curve.Utils.interpolate(h[f[0]].y,h[f[1]].y,h[f[2]].y,h[f[3]].y,d),e},g.EllipseCurve=function(a,b,c,d,e,f,g){this.aX=a,this.aY=b,this.xRadius=c,this.yRadius=d,this.aStartAngle=e,this.aEndAngle=f,this.aClockwise=g},g.EllipseCurve.prototype=Object.create(g.Curve.prototype),g.EllipseCurve.prototype.getPoint=function(a){var b=this.aEndAngle-this.aStartAngle;this.aClockwise||(a=1-a);var c=this.aStartAngle+a*b,d=this.aX+this.xRadius*Math.cos(c),e=this.aY+this.yRadius*Math.sin(c);return new g.Vector2(d,e)},g.ArcCurve=function(a,b,c,d,e,f){g.EllipseCurve.call(this,a,b,c,c,d,e,f)},g.ArcCurve.prototype=Object.create(g.EllipseCurve.prototype),g.Curve.Utils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a){var b=6*a*a-6*a,c=3*a*a-4*a+1,d=-6*a*a+6*a,e=3*a*a-2*a;return b+c+d+e},interpolate:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b}},g.Curve.create=function(a,b){return a.prototype=Object.create(g.Curve.prototype),a.prototype.getPoint=b,a},g.LineCurve3=g.Curve.create(function(a,b){this.v1=a,this.v2=b},function(a){var b=new g.Vector3;return b.subVectors(this.v2,this.v1),b.multiplyScalar(a),b.add(this.v1),b}),g.QuadraticBezierCurve3=g.Curve.create(function(a,b,c){this.v0=a,this.v1=b,this.v2=c},function(a){var b,c,d;return b=g.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x),c=g.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y),d=g.Shape.Utils.b2(a,this.v0.z,this.v1.z,this.v2.z),new g.Vector3(b,c,d)}),g.CubicBezierCurve3=g.Curve.create(function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},function(a){var b,c,d;return b=g.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),c=g.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),d=g.Shape.Utils.b3(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new g.Vector3(b,c,d)}),g.SplineCurve3=g.Curve.create(function(a){this.points=void 0==a?[]:a},function(a){var b,c,d,e=new g.Vector3,f=[],h=this.points;b=(h.length-1)*a,c=Math.floor(b),d=b-c,f[0]=0==c?c:c-1,f[1]=c,f[2]=c>h.length-2?h.length-1:c+1,f[3]=c>h.length-3?h.length-1:c+2;var i=h[f[0]],j=h[f[1]],k=h[f[2]],l=h[f[3]];return e.x=g.Curve.Utils.interpolate(i.x,j.x,k.x,l.x,d),e.y=g.Curve.Utils.interpolate(i.y,j.y,k.y,l.y,d),e.z=g.Curve.Utils.interpolate(i.z,j.z,k.z,l.z,d),e}),g.ClosedSplineCurve3=g.Curve.create(function(a){this.points=void 0==a?[]:a},function(a){var b,c,d,e=new g.Vector3,f=[],h=this.points;return b=(h.length-0)*a,c=Math.floor(b),d=b-c,c+=c>0?0:(Math.floor(Math.abs(c)/h.length)+1)*h.length,f[0]=(c-1)%h.length,f[1]=c%h.length,f[2]=(c+1)%h.length,f[3]=(c+2)%h.length,e.x=g.Curve.Utils.interpolate(h[f[0]].x,h[f[1]].x,h[f[2]].x,h[f[3]].x,d),e.y=g.Curve.Utils.interpolate(h[f[0]].y,h[f[1]].y,h[f[2]].y,h[f[3]].y,d),e.z=g.Curve.Utils.interpolate(h[f[0]].z,h[f[1]].z,h[f[2]].z,h[f[3]].z,d),e
}),g.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},g.CurvePath.prototype=Object.create(g.Curve.prototype),g.CurvePath.prototype.add=function(a){this.curves.push(a)},g.CurvePath.prototype.checkConnection=function(){},g.CurvePath.prototype.closePath=function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new g.LineCurve(b,a))},g.CurvePath.prototype.getPoint=function(a){for(var b,c,d=a*this.getLength(),e=this.getCurveLengths(),f=0;f<e.length;){if(e[f]>=d){b=e[f]-d,c=this.curves[f];var g=1-b/c.getLength();return c.getPointAt(g)}f++}return null},g.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]},g.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var a,b=[],c=0,d=this.curves.length;for(a=0;d>a;a++)c+=this.curves[a].getLength(),b.push(c);return this.cacheLengths=b,b},g.CurvePath.prototype.getBoundingBox=function(){var a,b,c,d,e,f,h=this.getPoints();a=b=Number.NEGATIVE_INFINITY,d=e=Number.POSITIVE_INFINITY;var i,j,k,l,m=h[0]instanceof g.Vector3;for(l=m?new g.Vector3:new g.Vector2,j=0,k=h.length;k>j;j++)i=h[j],i.x>a?a=i.x:i.x<d&&(d=i.x),i.y>b?b=i.y:i.y<e&&(e=i.y),m&&(i.z>c?c=i.z:i.z<f&&(f=i.z)),l.add(i);var n={minX:d,minY:e,maxX:a,maxY:b,centroid:l.divideScalar(k)};return m&&(n.maxZ=c,n.minZ=f),n},g.CurvePath.prototype.createPointsGeometry=function(a){var b=this.getPoints(a,!0);return this.createGeometry(b)},g.CurvePath.prototype.createSpacedPointsGeometry=function(a){var b=this.getSpacedPoints(a,!0);return this.createGeometry(b)},g.CurvePath.prototype.createGeometry=function(a){for(var b=new g.Geometry,c=0;c<a.length;c++)b.vertices.push(new g.Vector3(a[c].x,a[c].y,a[c].z||0));return b},g.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)},g.CurvePath.prototype.getTransformedPoints=function(a,b){var c,d,e=this.getPoints(a);for(b||(b=this.bends),c=0,d=b.length;d>c;c++)e=this.getWrapPoints(e,b[c]);return e},g.CurvePath.prototype.getTransformedSpacedPoints=function(a,b){var c,d,e=this.getSpacedPoints(a);for(b||(b=this.bends),c=0,d=b.length;d>c;c++)e=this.getWrapPoints(e,b[c]);return e},g.CurvePath.prototype.getWrapPoints=function(a,b){var c,d,e,f,g,h,i=this.getBoundingBox();for(c=0,d=a.length;d>c;c++){e=a[c],f=e.x,g=e.y,h=f/i.maxX,h=b.getUtoTmapping(h,f);var j=b.getPoint(h),k=b.getNormalVector(h).multiplyScalar(g);e.x=j.x+k.x,e.y=j.y+k.y}return a},g.Gyroscope=function(){g.Object3D.call(this)},g.Gyroscope.prototype=Object.create(g.Object3D.prototype),g.Gyroscope.prototype.updateMatrixWorld=function(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var b=0,c=this.children.length;c>b;b++)this.children[b].updateMatrixWorld(a)},g.Gyroscope.prototype.translationWorld=new g.Vector3,g.Gyroscope.prototype.translationObject=new g.Vector3,g.Gyroscope.prototype.rotationWorld=new g.Quaternion,g.Gyroscope.prototype.rotationObject=new g.Quaternion,g.Gyroscope.prototype.scaleWorld=new g.Vector3,g.Gyroscope.prototype.scaleObject=new g.Vector3,g.Path=function(a){g.CurvePath.call(this),this.actions=[],a&&this.fromPoints(a)},g.Path.prototype=Object.create(g.CurvePath.prototype),g.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},g.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;c>b;b++)this.lineTo(a[b].x,a[b].y)},g.Path.prototype.moveTo=function(){var a=Array.prototype.slice.call(arguments);this.actions.push({action:g.PathActions.MOVE_TO,args:a})},g.Path.prototype.lineTo=function(a,b){var c=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args,e=d[d.length-2],f=d[d.length-1],h=new g.LineCurve(new g.Vector2(e,f),new g.Vector2(a,b));this.curves.push(h),this.actions.push({action:g.PathActions.LINE_TO,args:c})},g.Path.prototype.quadraticCurveTo=function(a,b,c,d){var e=Array.prototype.slice.call(arguments),f=this.actions[this.actions.length-1].args,h=f[f.length-2],i=f[f.length-1],j=new g.QuadraticBezierCurve(new g.Vector2(h,i),new g.Vector2(a,b),new g.Vector2(c,d));this.curves.push(j),this.actions.push({action:g.PathActions.QUADRATIC_CURVE_TO,args:e})},g.Path.prototype.bezierCurveTo=function(a,b,c,d,e,f){var h=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,j=i[i.length-2],k=i[i.length-1],l=new g.CubicBezierCurve(new g.Vector2(j,k),new g.Vector2(a,b),new g.Vector2(c,d),new g.Vector2(e,f));this.curves.push(l),this.actions.push({action:g.PathActions.BEZIER_CURVE_TO,args:h})},g.Path.prototype.splineThru=function(a){var b=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,d=c[c.length-2],e=c[c.length-1],f=[new g.Vector2(d,e)];Array.prototype.push.apply(f,a);var h=new g.SplineCurve(f);this.curves.push(h),this.actions.push({action:g.PathActions.CSPLINE_THRU,args:b})},g.Path.prototype.arc=function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args,h=g[g.length-2],i=g[g.length-1];this.absarc(a+h,b+i,c,d,e,f)},g.Path.prototype.absarc=function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},g.Path.prototype.ellipse=function(a,b,c,d,e,f,g){var h=this.actions[this.actions.length-1].args,i=h[h.length-2],j=h[h.length-1];this.absellipse(a+i,b+j,c,d,e,f,g)},g.Path.prototype.absellipse=function(a,b,c,d,e,f,h){var i=Array.prototype.slice.call(arguments),j=new g.EllipseCurve(a,b,c,d,e,f,h);this.curves.push(j);var k=j.getPoint(h?1:0);i.push(k.x),i.push(k.y),this.actions.push({action:g.PathActions.ELLIPSE,args:i})},g.Path.prototype.getSpacedPoints=function(a){a||(a=40);for(var b=[],c=0;a>c;c++)b.push(this.getPoint(c/a));return b},g.Path.prototype.getPoints=function(a,b){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(a,b);a=a||12;var c,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=[];for(c=0,d=this.actions.length;d>c;c++)switch(e=this.actions[c],f=e.action,h=e.args,f){case g.PathActions.MOVE_TO:v.push(new g.Vector2(h[0],h[1]));break;case g.PathActions.LINE_TO:v.push(new g.Vector2(h[0],h[1]));break;case g.PathActions.QUADRATIC_CURVE_TO:for(i=h[2],j=h[3],m=h[0],n=h[1],v.length>0?(q=v[v.length-1],o=q.x,p=q.y):(q=this.actions[c-1].args,o=q[q.length-2],p=q[q.length-1]),r=1;a>=r;r++)s=r/a,t=g.Shape.Utils.b2(s,o,m,i),u=g.Shape.Utils.b2(s,p,n,j),v.push(new g.Vector2(t,u));break;case g.PathActions.BEZIER_CURVE_TO:for(i=h[4],j=h[5],m=h[0],n=h[1],k=h[2],l=h[3],v.length>0?(q=v[v.length-1],o=q.x,p=q.y):(q=this.actions[c-1].args,o=q[q.length-2],p=q[q.length-1]),r=1;a>=r;r++)s=r/a,t=g.Shape.Utils.b3(s,o,m,k,i),u=g.Shape.Utils.b3(s,p,n,l,j),v.push(new g.Vector2(t,u));break;case g.PathActions.CSPLINE_THRU:q=this.actions[c-1].args;var w=new g.Vector2(q[q.length-2],q[q.length-1]),x=[w],y=a*h[0].length;x=x.concat(h[0]);var z=new g.SplineCurve(x);for(r=1;y>=r;r++)v.push(z.getPointAt(r/y));break;case g.PathActions.ARC:var A,B=h[0],C=h[1],D=h[2],E=h[3],F=h[4],G=!!h[5],H=F-E,I=2*a;for(r=1;I>=r;r++)s=r/I,G||(s=1-s),A=E+s*H,t=B+D*Math.cos(A),u=C+D*Math.sin(A),v.push(new g.Vector2(t,u));break;case g.PathActions.ELLIPSE:var A,B=h[0],C=h[1],J=h[2],K=h[3],E=h[4],F=h[5],G=!!h[6],H=F-E,I=2*a;for(r=1;I>=r;r++)s=r/I,G||(s=1-s),A=E+s*H,t=B+J*Math.cos(A),u=C+K*Math.sin(A),v.push(new g.Vector2(t,u))}var L=v[v.length-1],M=1e-10;return Math.abs(L.x-v[0].x)<M&&Math.abs(L.y-v[0].y)<M&&v.splice(v.length-1,1),b&&v.push(v[0]),v},g.Path.prototype.toShapes=function(){var a,b,c,d,e,f=[],h=new g.Path;for(a=0,b=this.actions.length;b>a;a++)c=this.actions[a],e=c.args,d=c.action,d==g.PathActions.MOVE_TO&&0!=h.actions.length&&(f.push(h),h=new g.Path),h[d].apply(h,e);if(0!=h.actions.length&&f.push(h),0==f.length)return[];var i,j,k=[],l=!g.Shape.Utils.isClockWise(f[0].getPoints());if(1==f.length)return i=f[0],j=new g.Shape,j.actions=i.actions,j.curves=i.curves,k.push(j),k;if(l)for(j=new g.Shape,a=0,b=f.length;b>a;a++)i=f[a],g.Shape.Utils.isClockWise(i.getPoints())?(j.actions=i.actions,j.curves=i.curves,k.push(j),j=new g.Shape):j.holes.push(i);else{for(a=0,b=f.length;b>a;a++)i=f[a],g.Shape.Utils.isClockWise(i.getPoints())?(j&&k.push(j),j=new g.Shape,j.actions=i.actions,j.curves=i.curves):j.holes.push(i);k.push(j)}return k},g.Shape=function(){g.Path.apply(this,arguments),this.holes=[]},g.Shape.prototype=Object.create(g.Path.prototype),g.Shape.prototype.extrude=function(a){var b=new g.ExtrudeGeometry(this,a);return b},g.Shape.prototype.makeGeometry=function(a){var b=new g.ShapeGeometry(this,a);return b},g.Shape.prototype.getPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;c>b;b++)d[b]=this.holes[b].getTransformedPoints(a,this.bends);return d},g.Shape.prototype.getSpacedPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;c>b;b++)d[b]=this.holes[b].getTransformedSpacedPoints(a,this.bends);return d},g.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}},g.Shape.prototype.extractPoints=function(a){return this.useSpacedPoints?this.extractAllSpacedPoints(a):this.extractAllPoints(a)},g.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}},g.Shape.Utils={removeHoles:function(a,b){var c,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t=a.concat(),u=t.concat(),v=[];for(h=0;h<b.length;h++){for(j=b[h],Array.prototype.push.apply(u,j),k=Number.POSITIVE_INFINITY,i=0;i<j.length;i++){n=j[i];var w=[];for(m=0;m<t.length;m++)o=t[m],l=n.distanceToSquared(o),w.push(l),k>l&&(k=l,e=i,f=m)}c=f-1>=0?f-1:t.length-1,d=e-1>=0?e-1:j.length-1;var x=[j[e],t[f],t[c]],y=g.FontUtils.Triangulate.area(x),z=[j[e],j[d],t[f]],A=g.FontUtils.Triangulate.area(z),B=1,C=-1,D=f,E=e;f+=B,e+=C,0>f&&(f+=t.length),f%=t.length,0>e&&(e+=j.length),e%=j.length,c=f-1>=0?f-1:t.length-1,d=e-1>=0?e-1:j.length-1,x=[j[e],t[f],t[c]];var F=g.FontUtils.Triangulate.area(x);z=[j[e],j[d],t[f]];var G=g.FontUtils.Triangulate.area(z);y+A>F+G&&(f=D,e=E,0>f&&(f+=t.length),f%=t.length,0>e&&(e+=j.length),e%=j.length,c=f-1>=0?f-1:t.length-1,d=e-1>=0?e-1:j.length-1),p=t.slice(0,f),q=t.slice(f),r=j.slice(e),s=j.slice(0,e);var H=[j[e],t[f],t[c]],I=[j[e],j[d],t[f]];v.push(H),v.push(I),t=p.concat(r).concat(s).concat(q)}return{shape:t,isolatedPts:v,allpoints:u}},triangulateShape:function(a,b){var c,d,e,f,h,i,j=g.Shape.Utils.removeHoles(a,b),k=j.shape,l=j.allpoints,m=j.isolatedPts,n=g.FontUtils.Triangulate(k,!1),o={};for(c=0,d=l.length;d>c;c++)h=l[c].x+":"+l[c].y,void 0!==o[h]&&console.log("Duplicate point",h),o[h]=c;for(c=0,d=n.length;d>c;c++)for(f=n[c],e=0;3>e;e++)h=f[e].x+":"+f[e].y,i=o[h],void 0!==i&&(f[e]=i);for(c=0,d=m.length;d>c;c++)for(f=m[c],e=0;3>e;e++)h=f[e].x+":"+f[e].y,i=o[h],void 0!==i&&(f[e]=i);return n.concat(m)},isClockWise:function(a){return g.FontUtils.Triangulate.area(a)<0},b2p0:function(a,b){var c=1-a;return c*c*b},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,b,c,d){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,d)},b3p0:function(a,b){var c=1-a;return c*c*c*b},b3p1:function(a,b){var c=1-a;return 3*c*c*a*b},b3p2:function(a,b){var c=1-a;return 3*c*a*a*b},b3p3:function(a,b){return a*a*a*b},b3:function(a,b,c,d,e){return this.b3p0(a,b)+this.b3p1(a,c)+this.b3p2(a,d)+this.b3p3(a,e)}},g.AnimationHandler=function(){var a=[],b={},c={};c.update=function(b){for(var c=0;c<a.length;c++)a[c].update(b)},c.addToUpdate=function(b){-1===a.indexOf(b)&&a.push(b)},c.removeFromUpdate=function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},c.add=function(a){void 0!==b[a.name]&&console.log("THREE.AnimationHandler.add: Warning! "+a.name+" already exists in library. Overwriting."),b[a.name]=a,e(a)},c.get=function(a){return"string"==typeof a?b[a]?b[a]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+a),null):void 0},c.parse=function(a){var b=[];if(a instanceof g.SkinnedMesh)for(var c=0;c<a.bones.length;c++)b.push(a.bones[c]);else d(a,b);return b};var d=function(a,b){b.push(a);for(var c=0;c<a.children.length;c++)d(a.children[c],b)},e=function(a){if(a.initialized!==!0){for(var b=0;b<a.hierarchy.length;b++){for(var c=0;c<a.hierarchy[b].keys.length;c++)if(a.hierarchy[b].keys[c].time<0&&(a.hierarchy[b].keys[c].time=0),void 0!==a.hierarchy[b].keys[c].rot&&!(a.hierarchy[b].keys[c].rot instanceof g.Quaternion)){var d=a.hierarchy[b].keys[c].rot;a.hierarchy[b].keys[c].rot=new g.Quaternion(d[0],d[1],d[2],d[3])}if(a.hierarchy[b].keys.length&&void 0!==a.hierarchy[b].keys[0].morphTargets){for(var e={},c=0;c<a.hierarchy[b].keys.length;c++)for(var f=0;f<a.hierarchy[b].keys[c].morphTargets.length;f++){var h=a.hierarchy[b].keys[c].morphTargets[f];e[h]=-1}a.hierarchy[b].usedMorphTargets=e;for(var c=0;c<a.hierarchy[b].keys.length;c++){var i={};for(var h in e){for(var f=0;f<a.hierarchy[b].keys[c].morphTargets.length;f++)if(a.hierarchy[b].keys[c].morphTargets[f]===h){i[h]=a.hierarchy[b].keys[c].morphTargetsInfluences[f];break}f===a.hierarchy[b].keys[c].morphTargets.length&&(i[h]=0)}a.hierarchy[b].keys[c].morphTargetsInfluences=i}}for(var c=1;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].time===a.hierarchy[b].keys[c-1].time&&(a.hierarchy[b].keys.splice(c,1),c--);for(var c=0;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].index=c}var j=parseInt(a.length*a.fps,10);a.JIT={},a.JIT.hierarchy=[];for(var b=0;b<a.hierarchy.length;b++)a.JIT.hierarchy.push(new Array(j));a.initialized=!0}};return c.LINEAR=0,c.CATMULLROM=1,c.CATMULLROM_FORWARD=2,c}(),g.Animation=function(a,b,c){this.root=a,this.data=g.AnimationHandler.get(b),this.hierarchy=g.AnimationHandler.parse(a),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=void 0!==c?c:g.AnimationHandler.LINEAR,this.points=[],this.target=new g.Vector3},g.Animation.prototype.play=function(a,b){if(this.isPlaying===!1){this.isPlaying=!0,this.loop=void 0!==a?a:!0,this.currentTime=void 0!==b?b:0;var c,d,e=this.hierarchy.length;for(c=0;e>c;c++){d=this.hierarchy[c],this.interpolationType!==g.AnimationHandler.CATMULLROM_FORWARD&&(d.useQuaternion=!0),d.matrixAutoUpdate=!0,void 0===d.animationCache&&(d.animationCache={},d.animationCache.prevKey={pos:0,rot:0,scl:0},d.animationCache.nextKey={pos:0,rot:0,scl:0},d.animationCache.originalMatrix=d instanceof g.Bone?d.skinMatrix:d.matrix);var f=d.animationCache.prevKey,h=d.animationCache.nextKey;f.pos=this.data.hierarchy[c].keys[0],f.rot=this.data.hierarchy[c].keys[0],f.scl=this.data.hierarchy[c].keys[0],h.pos=this.getNextKeyWith("pos",c,1),h.rot=this.getNextKeyWith("rot",c,1),h.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=!1,g.AnimationHandler.addToUpdate(this)},g.Animation.prototype.pause=function(){this.isPaused===!0?g.AnimationHandler.addToUpdate(this):g.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},g.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,g.AnimationHandler.removeFromUpdate(this)},g.Animation.prototype.update=function(a){if(this.isPlaying!==!1){{var b,c,d,e,f,h,i,j,k,l,m,n,o,p,q,r=["pos","rot","scl"];this.data.JIT.hierarchy}this.currentTime+=a*this.timeScale,n=this.currentTime,m=this.currentTime=this.currentTime%this.data.length,l=parseInt(Math.min(m*this.data.fps,this.data.length*this.data.fps),10);for(var s=0,t=this.hierarchy.length;t>s;s++){j=this.hierarchy[s],k=j.animationCache;for(var u=0;3>u;u++){if(b=r[u],h=k.prevKey[b],i=k.nextKey[b],i.time<=n){if(n>m){if(!this.loop)return this.stop(),void 0;for(h=this.data.hierarchy[s].keys[0],i=this.getNextKeyWith(b,s,1);i.time<m;)h=i,i=this.getNextKeyWith(b,s,i.index+1)}else do h=i,i=this.getNextKeyWith(b,s,i.index+1);while(i.time<m);k.prevKey[b]=h,k.nextKey[b]=i}j.matrixAutoUpdate=!0,j.matrixWorldNeedsUpdate=!0,c=(m-h.time)/(i.time-h.time),e=h[b],f=i[b],(0>c||c>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+c+" on bone "+s),c=0>c?0:1),"pos"===b?(d=j.position,this.interpolationType===g.AnimationHandler.LINEAR?(d.x=e[0]+(f[0]-e[0])*c,d.y=e[1]+(f[1]-e[1])*c,d.z=e[2]+(f[2]-e[2])*c):(this.interpolationType===g.AnimationHandler.CATMULLROM||this.interpolationType===g.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",s,h.index-1).pos,this.points[1]=e,this.points[2]=f,this.points[3]=this.getNextKeyWith("pos",s,i.index+1).pos,c=.33*c+.33,o=this.interpolateCatmullRom(this.points,c),d.x=o[0],d.y=o[1],d.z=o[2],this.interpolationType===g.AnimationHandler.CATMULLROM_FORWARD&&(p=this.interpolateCatmullRom(this.points,1.01*c),this.target.set(p[0],p[1],p[2]),this.target.sub(d),this.target.y=0,this.target.normalize(),q=Math.atan2(this.target.x,this.target.z),j.rotation.set(0,q,0)))):"rot"===b?g.Quaternion.slerp(e,f,j.quaternion,c):"scl"===b&&(d=j.scale,d.x=e[0]+(f[0]-e[0])*c,d.y=e[1]+(f[1]-e[1])*c,d.z=e[2]+(f[2]-e[2])*c)}}}},g.Animation.prototype.interpolateCatmullRom=function(a,b){var c,d,e,f,g,h,i,j,k,l=[],m=[];return c=(a.length-1)*b,d=Math.floor(c),e=c-d,l[0]=0===d?d:d-1,l[1]=d,l[2]=d>a.length-2?d:d+1,l[3]=d>a.length-3?d:d+2,h=a[l[0]],i=a[l[1]],j=a[l[2]],k=a[l[3]],f=e*e,g=e*f,m[0]=this.interpolate(h[0],i[0],j[0],k[0],e,f,g),m[1]=this.interpolate(h[1],i[1],j[1],k[1],e,f,g),m[2]=this.interpolate(h[2],i[2],j[2],k[2],e,f,g),m},g.Animation.prototype.interpolate=function(a,b,c,d,e,f,g){var h=.5*(c-a),i=.5*(d-b);return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b},g.Animation.prototype.getNextKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(this.interpolationType===g.AnimationHandler.CATMULLROM||this.interpolationType===g.AnimationHandler.CATMULLROM_FORWARD?c=c<d.length-1?c:d.length-1:c%=d.length;c<d.length;c++)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[0]},g.Animation.prototype.getPrevKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(c=this.interpolationType===g.AnimationHandler.CATMULLROM||this.interpolationType===g.AnimationHandler.CATMULLROM_FORWARD?c>0?c:0:c>=0?c:c+d.length;c>=0;c--)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[d.length-1]},g.KeyFrameAnimation=function(a,b,c){this.root=a,this.data=g.AnimationHandler.get(b),this.hierarchy=g.AnimationHandler.parse(a),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.JITCompile=void 0!==c?c:!0;for(var d=0,e=this.hierarchy.length;e>d;d++){var f=this.data.hierarchy[d].keys,h=this.data.hierarchy[d].sids,i=this.hierarchy[d];if(f.length&&h){for(var j=0;j<h.length;j++){var k=h[j],l=this.getNextKeyWith(k,d,0);l&&l.apply(k)}i.matrixAutoUpdate=!1,this.data.hierarchy[d].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}},g.KeyFrameAnimation.prototype.play=function(a,b){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==a?a:!0,this.currentTime=void 0!==b?b:0,this.startTimeMs=b,this.startTime=1e7,this.endTime=-this.startTime;var c,d,e,f=this.hierarchy.length;for(c=0;f>c;c++){d=this.hierarchy[c],e=this.data.hierarchy[c],d.useQuaternion=!0,void 0===e.animationCache&&(e.animationCache={},e.animationCache.prevKey=null,e.animationCache.nextKey=null,e.animationCache.originalMatrix=d instanceof g.Bone?d.skinMatrix:d.matrix);var h=this.data.hierarchy[c].keys;h.length&&(e.animationCache.prevKey=h[0],e.animationCache.nextKey=h[1],this.startTime=Math.min(h[0].time,this.startTime),this.endTime=Math.max(h[h.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,g.AnimationHandler.addToUpdate(this)},g.KeyFrameAnimation.prototype.pause=function(){this.isPaused?g.AnimationHandler.addToUpdate(this):g.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},g.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,g.AnimationHandler.removeFromUpdate(this);for(var a=0;a<this.data.hierarchy.length;a++){var b=this.hierarchy[a],c=this.data.hierarchy[a];if(void 0!==c.animationCache){var d=c.animationCache.originalMatrix;b instanceof g.Bone?(d.copy(b.skinMatrix),b.skinMatrix=d):(d.copy(b.matrix),b.matrix=d),delete c.animationCache}}},g.KeyFrameAnimation.prototype.update=function(a){if(this.isPlaying){var b,c,d,e,f,h,i,j,k=this.data.JIT.hierarchy;if(this.currentTime+=a*this.timeScale,i=this.currentTime,h=this.currentTime=this.currentTime%this.data.length,h<this.startTimeMs&&(h=this.currentTime=this.startTimeMs+h),f=parseInt(Math.min(h*this.data.fps,this.data.length*this.data.fps),10),j=i>h,j&&!this.loop){for(var l=0,m=this.hierarchy.length;m>l;l++){var n=this.data.hierarchy[l].keys,o=this.data.hierarchy[l].sids,p=n.length-1,q=this.hierarchy[l];if(n.length){for(var r=0;r<o.length;r++){var s=o[r],t=this.getPrevKeyWith(s,l,p);t&&t.apply(s)}this.data.hierarchy[l].node.updateMatrix(),q.matrixWorldNeedsUpdate=!0}}return this.stop(),void 0}if(!(h<this.startTime)){for(var l=0,m=this.hierarchy.length;m>l;l++){d=this.hierarchy[l],e=this.data.hierarchy[l];var n=e.keys,u=e.animationCache;if(this.JITCompile&&void 0!==k[l][f])d instanceof g.Bone?(d.skinMatrix=k[l][f],d.matrixWorldNeedsUpdate=!1):(d.matrix=k[l][f],d.matrixWorldNeedsUpdate=!0);else if(n.length){if(this.JITCompile&&u&&(d instanceof g.Bone?d.skinMatrix=u.originalMatrix:d.matrix=u.originalMatrix),b=u.prevKey,c=u.nextKey,b&&c){if(c.time<=i){if(j&&this.loop)for(b=n[0],c=n[1];c.time<h;)b=c,c=n[b.index+1];else if(!j)for(var v=n.length-1;c.time<h&&c.index!==v;)b=c,c=n[b.index+1];u.prevKey=b,u.nextKey=c}c.time>=h?b.interpolate(c,h):b.interpolate(c,c.time)}this.data.hierarchy[l].node.updateMatrix(),d.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===k[0][f]){this.hierarchy[0].updateMatrixWorld(!0);for(var l=0;l<this.hierarchy.length;l++)k[l][f]=this.hierarchy[l]instanceof g.Bone?this.hierarchy[l].skinMatrix.clone():this.hierarchy[l].matrix.clone()}}}},g.KeyFrameAnimation.prototype.getNextKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(c%=d.length;c<d.length;c++)if(d[c].hasTarget(a))return d[c];return d[0]},g.KeyFrameAnimation.prototype.getPrevKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(c=c>=0?c:c+d.length;c>=0;c--)if(d[c].hasTarget(a))return d[c];return d[d.length-1]},g.CubeCamera=function(a,b,c){g.Object3D.call(this);var d=90,e=1,f=new g.PerspectiveCamera(d,e,a,b);f.up.set(0,-1,0),f.lookAt(new g.Vector3(1,0,0)),this.add(f);var h=new g.PerspectiveCamera(d,e,a,b);h.up.set(0,-1,0),h.lookAt(new g.Vector3(-1,0,0)),this.add(h);var i=new g.PerspectiveCamera(d,e,a,b);i.up.set(0,0,1),i.lookAt(new g.Vector3(0,1,0)),this.add(i);var j=new g.PerspectiveCamera(d,e,a,b);j.up.set(0,0,-1),j.lookAt(new g.Vector3(0,-1,0)),this.add(j);var k=new g.PerspectiveCamera(d,e,a,b);k.up.set(0,-1,0),k.lookAt(new g.Vector3(0,0,1)),this.add(k);var l=new g.PerspectiveCamera(d,e,a,b);l.up.set(0,-1,0),l.lookAt(new g.Vector3(0,0,-1)),this.add(l),this.renderTarget=new g.WebGLRenderTargetCube(c,c,{format:g.RGBFormat,magFilter:g.LinearFilter,minFilter:g.LinearFilter}),this.updateCubeMap=function(a,b){var c=this.renderTarget,d=c.generateMipmaps;c.generateMipmaps=!1,c.activeCubeFace=0,a.render(b,f,c),c.activeCubeFace=1,a.render(b,h,c),c.activeCubeFace=2,a.render(b,i,c),c.activeCubeFace=3,a.render(b,j,c),c.activeCubeFace=4,a.render(b,k,c),c.generateMipmaps=d,c.activeCubeFace=5,a.render(b,l,c)}},g.CubeCamera.prototype=Object.create(g.Object3D.prototype),g.CombinedCamera=function(a,b,c,d,e,f,h){g.Camera.call(this),this.fov=c,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2,this.cameraO=new g.OrthographicCamera(a/-2,a/2,b/2,b/-2,f,h),this.cameraP=new g.PerspectiveCamera(c,a/b,d,e),this.zoom=1,this.toPerspective()},g.CombinedCamera.prototype=Object.create(g.Camera.prototype),g.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},g.CombinedCamera.prototype.toOrthographic=function(){var a=this.fov,b=this.cameraP.aspect,c=this.cameraP.near,d=this.cameraP.far,e=(c+d)/2,f=Math.tan(a/2)*e,g=2*f,h=g*b,i=h/2;f/=this.zoom,i/=this.zoom,this.cameraO.left=-i,this.cameraO.right=i,this.cameraO.top=f,this.cameraO.bottom=-f,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},g.CombinedCamera.prototype.setSize=function(a,b){this.cameraP.aspect=a/b,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2},g.CombinedCamera.prototype.setFov=function(a){this.fov=a,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},g.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},g.CombinedCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);var c=2*g.Math.radToDeg(Math.atan(b/(2*a)));return this.setFov(c),c},g.CombinedCamera.prototype.setZoom=function(a){this.zoom=a,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},g.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},g.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},g.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},g.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},g.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},g.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},g.AsteriskGeometry=function(a,b){g.Geometry.call(this);for(var c=a,d=b,e=.707*c,f=.707*d,h=[[c,0,0],[d,0,0],[-c,0,0],[-d,0,0],[0,c,0],[0,d,0],[0,-c,0],[0,-d,0],[0,0,c],[0,0,d],[0,0,-c],[0,0,-d],[e,e,0],[f,f,0],[-e,-e,0],[-f,-f,0],[e,-e,0],[f,-f,0],[-e,e,0],[-f,f,0],[e,0,e],[f,0,f],[-e,0,-e],[-f,0,-f],[e,0,-e],[f,0,-f],[-e,0,e],[-f,0,f],[0,e,e],[0,f,f],[0,-e,-e],[0,-f,-f],[0,e,-e],[0,f,-f],[0,-e,e],[0,-f,f]],i=0,j=h.length;j>i;i++){var k=h[i][0],l=h[i][1],m=h[i][2];this.vertices.push(new g.Vector3(k,l,m))}},g.AsteriskGeometry.prototype=Object.create(g.Geometry.prototype),g.CircleGeometry=function(a,b,c,d){g.Geometry.call(this),a=a||50,c=void 0!==c?c:0,d=void 0!==d?d:2*Math.PI,b=void 0!==b?Math.max(3,b):8;var e,f=[],h=new g.Vector3,i=new g.Vector2(.5,.5);for(this.vertices.push(h),f.push(i),e=0;b>=e;e++){var j=new g.Vector3;j.x=a*Math.cos(c+e/b*d),j.y=a*Math.sin(c+e/b*d),this.vertices.push(j),f.push(new g.Vector2((j.x/a+1)/2,-(j.y/a+1)/2+1))}var k=new g.Vector3(0,0,-1);for(e=1;b>=e;e++){var l=e,m=e+1,n=0;this.faces.push(new g.Face3(l,m,n,[k,k,k])),this.faceVertexUvs[0].push([f[e],f[e+1],i])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new g.Sphere(new g.Vector3,a)},g.CircleGeometry.prototype=Object.create(g.Geometry.prototype),g.CubeGeometry=function(a,b,c,d,e,f){function h(a,b,c,d,e,f,h,j){var k,l,m,n=i.widthSegments,o=i.heightSegments,p=e/2,q=f/2,r=i.vertices.length;"x"===a&&"y"===b||"y"===a&&"x"===b?k="z":"x"===a&&"z"===b||"z"===a&&"x"===b?(k="y",o=i.depthSegments):("z"===a&&"y"===b||"y"===a&&"z"===b)&&(k="x",n=i.depthSegments);var s=n+1,t=o+1,u=e/n,v=f/o,w=new g.Vector3;for(w[k]=h>0?1:-1,m=0;t>m;m++)for(l=0;s>l;l++){var x=new g.Vector3;x[a]=(l*u-p)*c,x[b]=(m*v-q)*d,x[k]=h,i.vertices.push(x)}for(m=0;o>m;m++)for(l=0;n>l;l++){var y=l+s*m,z=l+s*(m+1),A=l+1+s*(m+1),B=l+1+s*m,C=new g.Face4(y+r,z+r,A+r,B+r);C.normal.copy(w),C.vertexNormals.push(w.clone(),w.clone(),w.clone(),w.clone()),C.materialIndex=j,i.faces.push(C),i.faceVertexUvs[0].push([new g.Vector2(l/n,1-m/o),new g.Vector2(l/n,1-(m+1)/o),new g.Vector2((l+1)/n,1-(m+1)/o),new g.Vector2((l+1)/n,1-m/o)])}}g.Geometry.call(this);var i=this;this.width=a,this.height=b,this.depth=c,this.widthSegments=d||1,this.heightSegments=e||1,this.depthSegments=f||1;var j=this.width/2,k=this.height/2,l=this.depth/2;h("z","y",-1,-1,this.depth,this.height,j,0),h("z","y",1,-1,this.depth,this.height,-j,1),h("x","z",1,1,this.width,this.depth,k,2),h("x","z",1,-1,this.width,this.depth,-k,3),h("x","y",1,-1,this.width,this.height,l,4),h("x","y",-1,-1,this.width,this.height,-l,5),this.computeCentroids(),this.mergeVertices()},g.CubeGeometry.prototype=Object.create(g.Geometry.prototype),g.CylinderGeometry=function(a,b,c,d,e,f){g.Geometry.call(this),a=void 0!==a?a:20,b=void 0!==b?b:20,c=void 0!==c?c:100;var h,i,j=c/2,k=d||8,l=e||1,m=[],n=[];for(i=0;l>=i;i++){var o=[],p=[],q=i/l,r=q*(b-a)+a;for(h=0;k>=h;h++){var s=h/k,t=new g.Vector3;t.x=r*Math.sin(s*Math.PI*2),t.y=-q*c+j,t.z=r*Math.cos(s*Math.PI*2),this.vertices.push(t),o.push(this.vertices.length-1),p.push(new g.Vector2(s,1-q))}m.push(o),n.push(p)}var u,v,w=(b-a)/c;for(h=0;k>h;h++)for(0!==a?(u=this.vertices[m[0][h]].clone(),v=this.vertices[m[0][h+1]].clone()):(u=this.vertices[m[1][h]].clone(),v=this.vertices[m[1][h+1]].clone()),u.setY(Math.sqrt(u.x*u.x+u.z*u.z)*w).normalize(),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*w).normalize(),i=0;l>i;i++){var x=m[i][h],y=m[i+1][h],z=m[i+1][h+1],A=m[i][h+1],B=u.clone(),C=u.clone(),D=v.clone(),E=v.clone(),F=n[i][h].clone(),G=n[i+1][h].clone(),H=n[i+1][h+1].clone(),I=n[i][h+1].clone();this.faces.push(new g.Face4(x,y,z,A,[B,C,D,E])),this.faceVertexUvs[0].push([F,G,H,I])}if(!f&&a>0)for(this.vertices.push(new g.Vector3(0,j,0)),h=0;k>h;h++){var x=m[0][h],y=m[0][h+1],z=this.vertices.length-1,B=new g.Vector3(0,1,0),C=new g.Vector3(0,1,0),D=new g.Vector3(0,1,0),F=n[0][h].clone(),G=n[0][h+1].clone(),H=new g.Vector2(G.u,0);this.faces.push(new g.Face3(x,y,z,[B,C,D])),this.faceVertexUvs[0].push([F,G,H])}if(!f&&b>0)for(this.vertices.push(new g.Vector3(0,-j,0)),h=0;k>h;h++){var x=m[i][h+1],y=m[i][h],z=this.vertices.length-1,B=new g.Vector3(0,-1,0),C=new g.Vector3(0,-1,0),D=new g.Vector3(0,-1,0),F=n[i][h+1].clone(),G=n[i][h].clone(),H=new g.Vector2(G.u,1);this.faces.push(new g.Face3(x,y,z,[B,C,D])),this.faceVertexUvs[0].push([F,G,H])}this.computeCentroids(),this.computeFaceNormals()},g.CylinderGeometry.prototype=Object.create(g.Geometry.prototype),g.ExtrudeGeometry=function(a,b){return"undefined"==typeof a?(a=[],void 0):(g.Geometry.call(this),a=a instanceof Array?a:[a],this.shapebb=a[a.length-1].getBoundingBox(),this.addShapeList(a,b),this.computeCentroids(),this.computeFaceNormals(),void 0)},g.ExtrudeGeometry.prototype=Object.create(g.Geometry.prototype),g.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;c>d;d++){var e=a[d];this.addShape(e,b)}},g.ExtrudeGeometry.prototype.addShape=function(a,b){function c(a,b,c){return b||console.log("die"),b.clone().multiplyScalar(c).add(a)}function d(a,b,c){return f(a,b,c)}function e(a,b,c){var d=Math.atan2(b.y-a.y,b.x-a.x),e=Math.atan2(c.y-a.y,c.x-a.x);d>e&&(e+=2*Math.PI);var f=(d+e)/2,h=-Math.cos(f),i=-Math.sin(f),j=new g.Vector2(h,i);return j}function f(a,b,c){var d,f,h,i,j,k,l=g.ExtrudeGeometry.__v1,m=g.ExtrudeGeometry.__v2,n=g.ExtrudeGeometry.__v3,o=g.ExtrudeGeometry.__v4,p=g.ExtrudeGeometry.__v5,q=g.ExtrudeGeometry.__v6;return l.set(a.x-b.x,a.y-b.y),m.set(a.x-c.x,a.y-c.y),d=l.normalize(),f=m.normalize(),n.set(-d.y,d.x),o.set(f.y,-f.x),p.copy(a).add(n),q.copy(a).add(o),p.equals(q)?o.clone():(p.copy(b).add(n),q.copy(c).add(o),h=d.dot(o),i=q.sub(p).dot(o),0===h&&(console.log("Either infinite or no solutions!"),0===i?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),j=i/h,0>j?e(a,b,c):(k=d.multiplyScalar(j).add(p),k.sub(a).clone()))
}function h(){if(w){var a=0,b=V*a;for(Y=0;W>Y;Y++)U=N[Y],l(U[2]+b,U[1]+b,U[0]+b,!0);for(a=y+2*v,b=V*a,Y=0;W>Y;Y++)U=N[Y],l(U[0]+b,U[1]+b,U[2]+b,!1)}else{for(Y=0;W>Y;Y++)U=N[Y],l(U[2],U[1],U[0],!0);for(Y=0;W>Y;Y++)U=N[Y],l(U[0]+V*y,U[1]+V*y,U[2]+V*y,!1)}}function i(){var a=0;for(j(O,a),a+=O.length,F=0,G=L.length;G>F;F++)E=L[F],j(E,a),a+=E.length}function j(a,b){var c,d;for(Y=a.length;--Y>=0;){c=Y,d=Y-1,0>d&&(d=a.length-1);var e=0,f=y+2*v;for(e=0;f>e;e++){var g=V*e,h=V*(e+1),i=b+c+g,j=b+d+g,k=b+d+h,l=b+c+h;m(i,j,k,l,a,e,f,c,d)}}}function k(a,b,c){H.vertices.push(new g.Vector3(a,b,c))}function l(c,d,e,f){c+=I,d+=I,e+=I,H.faces.push(new g.Face3(c,d,e,null,null,B));var h=f?D.generateBottomUV(H,a,b,c,d,e):D.generateTopUV(H,a,b,c,d,e);H.faceVertexUvs[0].push(h)}function m(c,d,e,f,h,i,j,k,l){c+=I,d+=I,e+=I,f+=I,H.faces.push(new g.Face4(c,d,e,f,null,null,C));var m=D.generateSideWallUV(H,a,h,b,c,d,e,f,i,j,k,l);H.faceVertexUvs[0].push(m)}{var n,o,p,q,r,s=void 0!==b.amount?b.amount:100,t=void 0!==b.bevelThickness?b.bevelThickness:6,u=void 0!==b.bevelSize?b.bevelSize:t-2,v=void 0!==b.bevelSegments?b.bevelSegments:3,w=void 0!==b.bevelEnabled?b.bevelEnabled:!0,x=void 0!==b.curveSegments?b.curveSegments:12,y=void 0!==b.steps?b.steps:1,z=b.extrudePath,A=!1,B=b.material,C=b.extrudeMaterial,D=void 0!==b.UVGenerator?b.UVGenerator:g.ExtrudeGeometry.WorldUVGenerator;this.shapebb}z&&(n=z.getSpacedPoints(y),A=!0,w=!1,o=void 0!==b.frames?b.frames:new g.TubeGeometry.FrenetFrames(z,y,!1),p=new g.Vector3,q=new g.Vector3,r=new g.Vector3),w||(v=0,t=0,u=0);var E,F,G,H=this,I=this.vertices.length,J=a.extractPoints(x),K=J.shape,L=J.holes,M=!g.Shape.Utils.isClockWise(K);if(M){for(K=K.reverse(),F=0,G=L.length;G>F;F++)E=L[F],g.Shape.Utils.isClockWise(E)&&(L[F]=E.reverse());M=!1}var N=g.Shape.Utils.triangulateShape(K,L),O=K;for(F=0,G=L.length;G>F;F++)E=L[F],K=K.concat(E);for(var P,Q,R,S,T,U,V=K.length,W=N.length,X=(O.length,180/Math.PI,[]),Y=0,Z=O.length,$=Z-1,_=Y+1;Z>Y;Y++,$++,_++){$===Z&&($=0),_===Z&&(_=0);{O[Y],O[$],O[_]}X[Y]=d(O[Y],O[$],O[_])}var ab,bb=[],cb=X.concat();for(F=0,G=L.length;G>F;F++){for(E=L[F],ab=[],Y=0,Z=E.length,$=Z-1,_=Y+1;Z>Y;Y++,$++,_++)$===Z&&($=0),_===Z&&(_=0),ab[Y]=d(E[Y],E[$],E[_]);bb.push(ab),cb=cb.concat(ab)}for(P=0;v>P;P++){for(R=P/v,S=t*(1-R),Q=u*Math.sin(R*Math.PI/2),Y=0,Z=O.length;Z>Y;Y++)T=c(O[Y],X[Y],Q),k(T.x,T.y,-S);for(F=0,G=L.length;G>F;F++)for(E=L[F],ab=bb[F],Y=0,Z=E.length;Z>Y;Y++)T=c(E[Y],ab[Y],Q),k(T.x,T.y,-S)}for(Q=u,Y=0;V>Y;Y++)T=w?c(K[Y],cb[Y],Q):K[Y],A?(q.copy(o.normals[0]).multiplyScalar(T.x),p.copy(o.binormals[0]).multiplyScalar(T.y),r.copy(n[0]).add(q).add(p),k(r.x,r.y,r.z)):k(T.x,T.y,0);var db;for(db=1;y>=db;db++)for(Y=0;V>Y;Y++)T=w?c(K[Y],cb[Y],Q):K[Y],A?(q.copy(o.normals[db]).multiplyScalar(T.x),p.copy(o.binormals[db]).multiplyScalar(T.y),r.copy(n[db]).add(q).add(p),k(r.x,r.y,r.z)):k(T.x,T.y,s/y*db);for(P=v-1;P>=0;P--){for(R=P/v,S=t*(1-R),Q=u*Math.sin(R*Math.PI/2),Y=0,Z=O.length;Z>Y;Y++)T=c(O[Y],X[Y],Q),k(T.x,T.y,s+S);for(F=0,G=L.length;G>F;F++)for(E=L[F],ab=bb[F],Y=0,Z=E.length;Z>Y;Y++)T=c(E[Y],ab[Y],Q),A?k(T.x,T.y+n[y-1].y,n[y-1].x+S):k(T.x,T.y,s+S)}h(),i()},g.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,d,e,f){var h=a.vertices[d].x,i=a.vertices[d].y,j=a.vertices[e].x,k=a.vertices[e].y,l=a.vertices[f].x,m=a.vertices[f].y;return[new g.Vector2(h,i),new g.Vector2(j,k),new g.Vector2(l,m)]},generateBottomUV:function(a,b,c,d,e,f){return this.generateTopUV(a,b,c,d,e,f)},generateSideWallUV:function(a,b,c,d,e,f,h,i){var j=a.vertices[e].x,k=a.vertices[e].y,l=a.vertices[e].z,m=a.vertices[f].x,n=a.vertices[f].y,o=a.vertices[f].z,p=a.vertices[h].x,q=a.vertices[h].y,r=a.vertices[h].z,s=a.vertices[i].x,t=a.vertices[i].y,u=a.vertices[i].z;return Math.abs(k-n)<.01?[new g.Vector2(j,1-l),new g.Vector2(m,1-o),new g.Vector2(p,1-r),new g.Vector2(s,1-u)]:[new g.Vector2(k,1-l),new g.Vector2(n,1-o),new g.Vector2(q,1-r),new g.Vector2(t,1-u)]}},g.ExtrudeGeometry.__v1=new g.Vector2,g.ExtrudeGeometry.__v2=new g.Vector2,g.ExtrudeGeometry.__v3=new g.Vector2,g.ExtrudeGeometry.__v4=new g.Vector2,g.ExtrudeGeometry.__v5=new g.Vector2,g.ExtrudeGeometry.__v6=new g.Vector2,g.ShapeGeometry=function(a,b){g.Geometry.call(this),a instanceof Array==!1&&(a=[a]),this.shapebb=a[a.length-1].getBoundingBox(),this.addShapeList(a,b),this.computeCentroids(),this.computeFaceNormals()},g.ShapeGeometry.prototype=Object.create(g.Geometry.prototype),g.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;d>c;c++)this.addShape(a[c],b);return this},g.ShapeGeometry.prototype.addShape=function(a,b){void 0===b&&(b={});var c,d,e,f=void 0!==b.curveSegments?b.curveSegments:12,h=b.material,i=void 0===b.UVGenerator?g.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator,j=(this.shapebb,this.vertices.length),k=a.extractPoints(f),l=k.shape,m=k.holes,n=!g.Shape.Utils.isClockWise(l);if(n){for(l=l.reverse(),c=0,d=m.length;d>c;c++)e=m[c],g.Shape.Utils.isClockWise(e)&&(m[c]=e.reverse());n=!1}var o=g.Shape.Utils.triangulateShape(l,m),p=l;for(c=0,d=m.length;d>c;c++)e=m[c],l=l.concat(e);{var q,r,s=l.length,t=o.length;p.length}for(c=0;s>c;c++)q=l[c],this.vertices.push(new g.Vector3(q.x,q.y,0));for(c=0;t>c;c++){r=o[c];var u=r[0]+j,v=r[1]+j,w=r[2]+j;this.faces.push(new g.Face3(u,v,w,null,null,h)),this.faceVertexUvs[0].push(i.generateBottomUV(this,a,b,u,v,w))}},g.LatheGeometry=function(a,b,c,d){g.Geometry.call(this),b=b||12,c=c||0,d=d||2*Math.PI;for(var e=1/(a.length-1),f=1/b,h=0,i=b;i>=h;h++)for(var j=c+h*f*d,k=Math.cos(j),l=Math.sin(j),m=0,n=a.length;n>m;m++){var o=a[m],p=new g.Vector3;p.x=k*o.x-l*o.y,p.y=l*o.x+k*o.y,p.z=o.z,this.vertices.push(p)}for(var q=a.length,h=0,i=b;i>h;h++)for(var m=0,n=a.length-1;n>m;m++){var r=m+q*h,s=r,t=r+q,k=r+1+q,u=r+1;this.faces.push(new g.Face4(s,t,k,u));var v=h*f,w=m*e,x=v+f,y=w+e;this.faceVertexUvs[0].push([new g.Vector2(v,w),new g.Vector2(x,w),new g.Vector2(x,y),new g.Vector2(v,y)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},g.LatheGeometry.prototype=Object.create(g.Geometry.prototype),g.PlaneGeometry=function(a,b,c,d){g.Geometry.call(this),this.width=a,this.height=b,this.widthSegments=c||1,this.heightSegments=d||1;var e,f,h=a/2,i=b/2,j=this.widthSegments,k=this.heightSegments,l=j+1,m=k+1,n=this.width/j,o=this.height/k,p=new g.Vector3(0,0,1);for(f=0;m>f;f++)for(e=0;l>e;e++){var q=e*n-h,r=f*o-i;this.vertices.push(new g.Vector3(q,-r,0))}for(f=0;k>f;f++)for(e=0;j>e;e++){var s=e+l*f,t=e+l*(f+1),u=e+1+l*(f+1),v=e+1+l*f,w=new g.Face4(s,t,u,v);w.normal.copy(p),w.vertexNormals.push(p.clone(),p.clone(),p.clone(),p.clone()),this.faces.push(w),this.faceVertexUvs[0].push([new g.Vector2(e/j,1-f/k),new g.Vector2(e/j,1-(f+1)/k),new g.Vector2((e+1)/j,1-(f+1)/k),new g.Vector2((e+1)/j,1-f/k)])}this.computeCentroids()},g.PlaneGeometry.prototype=Object.create(g.Geometry.prototype),g.SphereGeometry=function(a,b,c,d,e,f,h){g.Geometry.call(this),this.radius=a||50,this.widthSegments=Math.max(3,Math.floor(b)||8),this.heightSegments=Math.max(2,Math.floor(c)||6),d=void 0!==d?d:0,e=void 0!==e?e:2*Math.PI,f=void 0!==f?f:0,h=void 0!==h?h:Math.PI;var i,j,k=[],l=[];for(j=0;j<=this.heightSegments;j++){var m=[],n=[];for(i=0;i<=this.widthSegments;i++){var o=i/this.widthSegments,p=j/this.heightSegments,q=new g.Vector3;q.x=-this.radius*Math.cos(d+o*e)*Math.sin(f+p*h),q.y=this.radius*Math.cos(f+p*h),q.z=this.radius*Math.sin(d+o*e)*Math.sin(f+p*h),this.vertices.push(q),m.push(this.vertices.length-1),n.push(new g.Vector2(o,1-p))}k.push(m),l.push(n)}for(j=0;j<this.heightSegments;j++)for(i=0;i<this.widthSegments;i++){var r=k[j][i+1],s=k[j][i],t=k[j+1][i],u=k[j+1][i+1],v=this.vertices[r].clone().normalize(),w=this.vertices[s].clone().normalize(),x=this.vertices[t].clone().normalize(),y=this.vertices[u].clone().normalize(),z=l[j][i+1].clone(),A=l[j][i].clone(),B=l[j+1][i].clone(),C=l[j+1][i+1].clone();Math.abs(this.vertices[r].y)===this.radius?(this.faces.push(new g.Face3(r,t,u,[v,x,y])),this.faceVertexUvs[0].push([z,B,C])):Math.abs(this.vertices[t].y)===this.radius?(this.faces.push(new g.Face3(r,s,t,[v,w,x])),this.faceVertexUvs[0].push([z,A,B])):(this.faces.push(new g.Face4(r,s,t,u,[v,w,x,y])),this.faceVertexUvs[0].push([z,A,B,C]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new g.Sphere(new g.Vector3,a)},g.SphereGeometry.prototype=Object.create(g.Geometry.prototype),g.TextGeometry=function(a,b){var c=g.FontUtils.generateShapes(a,b);b.amount=void 0!==b.height?b.height:50,void 0===b.bevelThickness&&(b.bevelThickness=10),void 0===b.bevelSize&&(b.bevelSize=8),void 0===b.bevelEnabled&&(b.bevelEnabled=!1),g.ExtrudeGeometry.call(this,c,b)},g.TextGeometry.prototype=Object.create(g.ExtrudeGeometry.prototype),g.TorusGeometry=function(a,b,c,d,e){g.Geometry.call(this);this.radius=a||100,this.tube=b||40,this.radialSegments=c||8,this.tubularSegments=d||6,this.arc=e||2*Math.PI;for(var f=new g.Vector3,h=[],i=[],j=0;j<=this.radialSegments;j++)for(var k=0;k<=this.tubularSegments;k++){var l=k/this.tubularSegments*this.arc,m=j/this.radialSegments*Math.PI*2;f.x=this.radius*Math.cos(l),f.y=this.radius*Math.sin(l);var n=new g.Vector3;n.x=(this.radius+this.tube*Math.cos(m))*Math.cos(l),n.y=(this.radius+this.tube*Math.cos(m))*Math.sin(l),n.z=this.tube*Math.sin(m),this.vertices.push(n),h.push(new g.Vector2(k/this.tubularSegments,j/this.radialSegments)),i.push(n.clone().sub(f).normalize())}for(var j=1;j<=this.radialSegments;j++)for(var k=1;k<=this.tubularSegments;k++){var o=(this.tubularSegments+1)*j+k-1,p=(this.tubularSegments+1)*(j-1)+k-1,q=(this.tubularSegments+1)*(j-1)+k,r=(this.tubularSegments+1)*j+k,s=new g.Face4(o,p,q,r,[i[o],i[p],i[q],i[r]]);s.normal.add(i[o]),s.normal.add(i[p]),s.normal.add(i[q]),s.normal.add(i[r]),s.normal.normalize(),this.faces.push(s),this.faceVertexUvs[0].push([h[o].clone(),h[p].clone(),h[q].clone(),h[r].clone()])}this.computeCentroids()},g.TorusGeometry.prototype=Object.create(g.Geometry.prototype),g.TorusKnotGeometry=function(a,b,c,d,e,f,h){function i(a,b,c){return k.vertices.push(new g.Vector3(a,b,c))-1}function j(a,b,c,d,e,f){var h=Math.cos(a),i=(Math.cos(b),Math.sin(a)),j=c/d*a,k=Math.cos(j),l=e*(2+k)*.5*h,m=e*(2+k)*i*.5,n=f*e*Math.sin(j)*.5;return new g.Vector3(l,m,n)}g.Geometry.call(this);var k=this;this.radius=a||100,this.tube=b||40,this.radialSegments=c||64,this.tubularSegments=d||8,this.p=e||2,this.q=f||3,this.heightScale=h||1,this.grid=new Array(this.radialSegments);for(var l=new g.Vector3,m=new g.Vector3,n=new g.Vector3,o=0;o<this.radialSegments;++o){this.grid[o]=new Array(this.tubularSegments);for(var p=0;p<this.tubularSegments;++p){var q,r,s=o/this.radialSegments*2*this.p*Math.PI,t=p/this.tubularSegments*2*Math.PI,u=j(s,t,this.q,this.p,this.radius,this.heightScale),v=j(s+.01,t,this.q,this.p,this.radius,this.heightScale);l.subVectors(v,u),m.addVectors(v,u),n.crossVectors(l,m),m.crossVectors(n,l),n.normalize(),m.normalize(),q=-this.tube*Math.cos(t),r=this.tube*Math.sin(t),u.x+=q*m.x+r*n.x,u.y+=q*m.y+r*n.y,u.z+=q*m.z+r*n.z,this.grid[o][p]=i(u.x,u.y,u.z)}}for(var o=0;o<this.radialSegments;++o)for(var p=0;p<this.tubularSegments;++p){var w=(o+1)%this.radialSegments,x=(p+1)%this.tubularSegments,y=this.grid[o][p],z=this.grid[w][p],A=this.grid[w][x],B=this.grid[o][x],C=new g.Vector2(o/this.radialSegments,p/this.tubularSegments),D=new g.Vector2((o+1)/this.radialSegments,p/this.tubularSegments),E=new g.Vector2((o+1)/this.radialSegments,(p+1)/this.tubularSegments),F=new g.Vector2(o/this.radialSegments,(p+1)/this.tubularSegments);this.faces.push(new g.Face4(y,z,A,B)),this.faceVertexUvs[0].push([C,D,E,F])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},g.TorusKnotGeometry.prototype=Object.create(g.Geometry.prototype),g.TubeGeometry=function(a,b,c,d,e,f){function h(a,b,c){return C.vertices.push(new g.Vector3(a,b,c))-1}g.Geometry.call(this),this.path=a,this.segments=b||64,this.radius=c||1,this.radiusSegments=d||8,this.closed=e||!1,f&&(this.debug=new g.Object3D),this.grid=[];var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=this,D=this.segments+1,E=new g.Vector3,F=new g.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),G=F.tangents,H=F.normals,I=F.binormals;for(this.tangents=G,this.normals=H,this.binormals=I,q=0;D>q;q++)for(this.grid[q]=[],l=q/(D-1),p=a.getPointAt(l),i=G[q],j=H[q],k=I[q],this.debug&&(this.debug.add(new g.ArrowHelper(i,p,c,255)),this.debug.add(new g.ArrowHelper(j,p,c,16711680)),this.debug.add(new g.ArrowHelper(k,p,c,65280))),r=0;r<this.radiusSegments;r++)m=r/this.radiusSegments*2*Math.PI,n=-this.radius*Math.cos(m),o=this.radius*Math.sin(m),E.copy(p),E.x+=n*j.x+o*k.x,E.y+=n*j.y+o*k.y,E.z+=n*j.z+o*k.z,this.grid[q][r]=h(E.x,E.y,E.z);for(q=0;q<this.segments;q++)for(r=0;r<this.radiusSegments;r++)s=this.closed?(q+1)%this.segments:q+1,t=(r+1)%this.radiusSegments,u=this.grid[q][r],v=this.grid[s][r],w=this.grid[s][t],x=this.grid[q][t],y=new g.Vector2(q/this.segments,r/this.radiusSegments),z=new g.Vector2((q+1)/this.segments,r/this.radiusSegments),A=new g.Vector2((q+1)/this.segments,(r+1)/this.radiusSegments),B=new g.Vector2(q/this.segments,(r+1)/this.radiusSegments),this.faces.push(new g.Face4(u,v,w,x)),this.faceVertexUvs[0].push([y,z,A,B]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},g.TubeGeometry.prototype=Object.create(g.Geometry.prototype),g.TubeGeometry.FrenetFrames=function(a,b,c){function d(){o[0]=new g.Vector3,p[0]=new g.Vector3,f=Number.MAX_VALUE,h=Math.abs(n[0].x),i=Math.abs(n[0].y),j=Math.abs(n[0].z),f>=h&&(f=h,m.set(1,0,0)),f>=i&&(f=i,m.set(0,1,0)),f>=j&&m.set(0,0,1),q.crossVectors(n[0],m).normalize(),o[0].crossVectors(n[0],q),p[0].crossVectors(n[0],o[0])}var e,f,h,i,j,k,l,m=(new g.Vector3,new g.Vector3),n=(new g.Vector3,[]),o=[],p=[],q=new g.Vector3,r=new g.Matrix4,s=b+1,t=1e-4;for(this.tangents=n,this.normals=o,this.binormals=p,k=0;s>k;k++)l=k/(s-1),n[k]=a.getTangentAt(l),n[k].normalize();for(d(),k=1;s>k;k++)o[k]=o[k-1].clone(),p[k]=p[k-1].clone(),q.crossVectors(n[k-1],n[k]),q.length()>t&&(q.normalize(),e=Math.acos(n[k-1].dot(n[k])),o[k].applyMatrix4(r.makeRotationAxis(q,e))),p[k].crossVectors(n[k],o[k]);if(c)for(e=Math.acos(o[0].dot(o[s-1])),e/=s-1,n[0].dot(q.crossVectors(o[0],o[s-1]))>0&&(e=-e),k=1;s>k;k++)o[k].applyMatrix4(r.makeRotationAxis(n[k],e*k)),p[k].crossVectors(n[k],o[k])},g.PolyhedronGeometry=function(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=l.vertices.push(b)-1;var c=i(a)/2/Math.PI+.5,d=j(a)/Math.PI+.5;return b.uv=new g.Vector2(c,1-d),b}function f(a,b,c,d){if(1>d){var e=new g.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);e.centroid.add(a).add(b).add(c).divideScalar(3),e.normal=e.centroid.clone().normalize(),l.faces.push(e);var j=i(e.centroid);l.faceVertexUvs[0].push([k(a.uv,a,j),k(b.uv,b,j),k(c.uv,c,j)])}else d-=1,f(a,h(a,b),h(a,c),d),f(h(a,b),b,h(b,c),d),f(h(a,c),h(b,c),c,d),f(h(a,b),h(b,c),h(a,c),d)}function h(a,b){o[a.index]||(o[a.index]=[]),o[b.index]||(o[b.index]=[]);var c=o[a.index][b.index];return void 0===c&&(o[a.index][b.index]=o[b.index][a.index]=c=e((new g.Vector3).addVectors(a,b).divideScalar(2))),c}function i(a){return Math.atan2(a.z,-a.x)}function j(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}function k(a,b,c){return 0>c&&1===a.x&&(a=new g.Vector2(a.x-1,a.y)),0===b.x&&0===b.z&&(a=new g.Vector2(c/2/Math.PI+.5,a.y)),a}g.Geometry.call(this),c=c||1,d=d||0;for(var l=this,m=0,n=a.length;n>m;m++)e(new g.Vector3(a[m][0],a[m][1],a[m][2]));for(var o=[],p=this.vertices,m=0,n=b.length;n>m;m++)f(p[b[m][0]],p[b[m][1]],p[b[m][2]],d);this.mergeVertices();for(var m=0,n=this.vertices.length;n>m;m++)this.vertices[m].multiplyScalar(c);this.computeCentroids(),this.boundingSphere=new g.Sphere(new g.Vector3,c)},g.PolyhedronGeometry.prototype=Object.create(g.Geometry.prototype),g.IcosahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2,d=[[-1,c,0],[1,c,0],[-1,-c,0],[1,-c,0],[0,-1,c],[0,1,c],[0,-1,-c],[0,1,-c],[c,0,-1],[c,0,1],[-c,0,-1],[-c,0,1]],e=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];g.PolyhedronGeometry.call(this,d,e,a,b)},g.IcosahedronGeometry.prototype=Object.create(g.Geometry.prototype),g.OctahedronGeometry=function(a,b){var c=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],d=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];g.PolyhedronGeometry.call(this,c,d,a,b)},g.OctahedronGeometry.prototype=Object.create(g.Geometry.prototype),g.TetrahedronGeometry=function(a,b){var c=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],d=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];g.PolyhedronGeometry.call(this,c,d,a,b)},g.TetrahedronGeometry.prototype=Object.create(g.Geometry.prototype),g.ParametricGeometry=function(a,b,c,d){g.Geometry.call(this);var e=this.vertices,f=this.faces,h=this.faceVertexUvs[0];d=void 0===d?!1:d;var i,j,k,l,m,n=b+1;for(i=0;c>=i;i++)for(m=i/c,j=0;b>=j;j++)l=j/b,k=a(l,m),e.push(k);var o,p,q,r,s,t,u,v;for(i=0;c>i;i++)for(j=0;b>j;j++)o=i*n+j,p=i*n+j+1,q=(i+1)*n+j,r=(i+1)*n+j+1,s=new g.Vector2(j/b,i/c),t=new g.Vector2((j+1)/b,i/c),u=new g.Vector2(j/b,(i+1)/c),v=new g.Vector2((j+1)/b,(i+1)/c),d?(f.push(new g.Face3(o,p,q)),f.push(new g.Face3(p,r,q)),h.push([s,t,u]),h.push([t,v,u])):(f.push(new g.Face4(o,p,r,q)),h.push([s,t,v,u]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},g.ParametricGeometry.prototype=Object.create(g.Geometry.prototype),g.ConvexGeometry=function(a){function b(b){var d=a[b].clone(),g=d.length();d.x+=g*f(),d.y+=g*f(),d.z+=g*f();for(var h=[],j=0;j<i.length;){var k=i[j];if(c(k,d)){for(var l=0;3>l;l++){for(var m=[k[l],k[(l+1)%3]],n=!0,o=0;o<h.length;o++)if(e(h[o],m)){h[o]=h[h.length-1],h.pop(),n=!1;break}n&&h.push(m)}i[j]=i[i.length-1],i.pop()}else j++}for(var o=0;o<h.length;o++)i.push([h[o][0],h[o][1],b])}function c(b,c){var e=a[b[0]],f=a[b[1]],g=a[b[2]],h=d(e,f,g),i=h.dot(e);return h.dot(c)>=i}function d(a,b,c){var d=new g.Vector3,e=new g.Vector3;return d.subVectors(c,b),e.subVectors(a,b),d.cross(e),d.normalize(),d}function e(a,b){return a[0]===b[1]&&a[1]===b[0]}function f(){return 2*(Math.random()-.5)*1e-6}function h(a){var b=a.length();return new g.Vector2(a.x/b,a.y/b)}g.Geometry.call(this);for(var i=[[0,1,2],[0,2,1]],j=3;j<a.length;j++)b(j);for(var k=0,l=new Array(a.length),j=0;j<i.length;j++)for(var m=i[j],n=0;3>n;n++)void 0===l[m[n]]&&(l[m[n]]=k++,this.vertices.push(a[m[n]])),m[n]=l[m[n]];for(var j=0;j<i.length;j++)this.faces.push(new g.Face3(i[j][0],i[j][1],i[j][2]));for(var j=0;j<this.faces.length;j++){var m=this.faces[j];this.faceVertexUvs[0].push([h(this.vertices[m.a]),h(this.vertices[m.b]),h(this.vertices[m.c])])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},g.ConvexGeometry.prototype=Object.create(g.Geometry.prototype),g.AxisHelper=function(a){var b=new g.Geometry;b.vertices.push(new g.Vector3,new g.Vector3(a||1,0,0),new g.Vector3,new g.Vector3(0,a||1,0),new g.Vector3,new g.Vector3(0,0,a||1)),b.colors.push(new g.Color(16711680),new g.Color(16755200),new g.Color(65280),new g.Color(11206400),new g.Color(255),new g.Color(43775));var c=new g.LineBasicMaterial({vertexColors:g.VertexColors});g.Line.call(this,b,c,g.LinePieces)},g.AxisHelper.prototype=Object.create(g.Line.prototype),g.ArrowHelper=function(a,b,c,d){g.Object3D.call(this),void 0===c&&(c=20),void 0===d&&(d=16776960);var e=new g.Geometry;e.vertices.push(new g.Vector3(0,0,0)),e.vertices.push(new g.Vector3(0,1,0)),this.line=new g.Line(e,new g.LineBasicMaterial({color:d})),this.add(this.line);var f=new g.CylinderGeometry(0,.05,.25,5,1);this.cone=new g.Mesh(f,new g.MeshBasicMaterial({color:d})),this.cone.position.set(0,1,0),this.add(this.cone),b instanceof g.Vector3&&(this.position=b),this.setDirection(a),this.setLength(c)},g.ArrowHelper.prototype=Object.create(g.Object3D.prototype),g.ArrowHelper.prototype.setDirection=function(a){var b=g.ArrowHelper.__v1.copy(a).normalize();if(b.y>.999)this.rotation.set(0,0,0);else if(b.y<-.999)this.rotation.set(Math.PI,0,0);else{var c=g.ArrowHelper.__v2.set(b.z,0,-b.x).normalize(),d=Math.acos(b.y),e=g.ArrowHelper.__q1.setFromAxisAngle(c,d);this.rotation.setEulerFromQuaternion(e,this.eulerOrder)}},g.ArrowHelper.prototype.setLength=function(a){this.scale.set(a,a,a)},g.ArrowHelper.prototype.setColor=function(a){this.line.material.color.setHex(a),this.cone.material.color.setHex(a)},g.ArrowHelper.__v1=new g.Vector3,g.ArrowHelper.__v2=new g.Vector3,g.ArrowHelper.__q1=new g.Quaternion,g.CameraHelper=function(a){function b(a,b,d){c(a,d),c(b,d)}function c(a,b){d.geometry.vertices.push(new g.Vector3),d.geometry.colors.push(new g.Color(b)),void 0===d.pointMap[a]&&(d.pointMap[a]=[]),d.pointMap[a].push(d.geometry.vertices.length-1)}g.Line.call(this);var d=this;this.geometry=new g.Geometry,this.material=new g.LineBasicMaterial({color:16777215,vertexColors:g.FaceColors}),this.type=g.LinePieces,this.matrixWorld=a.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap={};var e=16755200,f=16711680,h=43775,i=16777215,j=3355443;b("n1","n2",e),b("n2","n4",e),b("n4","n3",e),b("n3","n1",e),b("f1","f2",e),b("f2","f4",e),b("f4","f3",e),b("f3","f1",e),b("n1","f1",e),b("n2","f2",e),b("n3","f3",e),b("n4","f4",e),b("p","n1",f),b("p","n2",f),b("p","n3",f),b("p","n4",f),b("u1","u2",h),b("u2","u3",h),b("u3","u1",h),b("c","t",i),b("p","c",j),b("cn1","cn2",j),b("cn3","cn4",j),b("cf1","cf2",j),b("cf3","cf4",j),this.camera=a,this.update(a)},g.CameraHelper.prototype=Object.create(g.Line.prototype),g.CameraHelper.prototype.update=function(){function a(a,c,d,e){g.CameraHelper.__v.set(c,d,e),g.CameraHelper.__projector.unprojectVector(g.CameraHelper.__v,g.CameraHelper.__c);var f=b.pointMap[a];if(void 0!==f)for(var h=0,i=f.length;i>h;h++)b.geometry.vertices[f[h]].copy(g.CameraHelper.__v)}var b=this,c=1,d=1;g.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),a("c",0,0,-1),a("t",0,0,1),a("n1",-c,-d,-1),a("n2",c,-d,-1),a("n3",-c,d,-1),a("n4",c,d,-1),a("f1",-c,-d,1),a("f2",c,-d,1),a("f3",-c,d,1),a("f4",c,d,1),a("u1",.7*c,1.1*d,-1),a("u2",.7*-c,1.1*d,-1),a("u3",0,2*d,-1),a("cf1",-c,0,1),a("cf2",c,0,1),a("cf3",0,-d,1),a("cf4",0,d,1),a("cn1",-c,0,-1),a("cn2",c,0,-1),a("cn3",0,-d,-1),a("cn4",0,d,-1),this.geometry.verticesNeedUpdate=!0},g.CameraHelper.__projector=new g.Projector,g.CameraHelper.__v=new g.Vector3,g.CameraHelper.__c=new g.Camera,g.DirectionalLightHelper=function(a,b){g.Object3D.call(this),this.light=a,this.position=a.position,this.direction=new g.Vector3,this.direction.subVectors(a.target.position,a.position);var c=g.Math.clamp(a.intensity,0,1);this.color=a.color.clone(),this.color.multiplyScalar(c);var d=this.color.getHex(),e=new g.SphereGeometry(b,16,8),f=new g.AsteriskGeometry(1.25*b,2.25*b),h=new g.MeshBasicMaterial({color:d,fog:!1}),i=new g.LineBasicMaterial({color:d,fog:!1});if(this.lightSphere=new g.Mesh(e,h),this.lightRays=new g.Line(f,i,g.LinePieces),this.add(this.lightSphere),this.add(this.lightRays),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=a,this.lightSphere.properties.gizmoRoot=this,this.targetSphere=null,void 0!==a.target.properties.targetInverse){var j=new g.SphereGeometry(b,8,4),k=new g.MeshBasicMaterial({color:d,wireframe:!0,fog:!1});this.targetSphere=new g.Mesh(j,k),this.targetSphere.position=a.target.position,this.targetSphere.properties.isGizmo=!0,this.targetSphere.properties.gizmoSubject=a.target,this.targetSphere.properties.gizmoRoot=this.targetSphere;var l=new g.LineDashedMaterial({color:d,dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),m=new g.Geometry;m.vertices.push(this.position.clone()),m.vertices.push(this.targetSphere.position.clone()),m.computeLineDistances(),this.targetLine=new g.Line(m,l),this.targetLine.properties.isGizmo=!0}this.properties.isGizmo=!0},g.DirectionalLightHelper.prototype=Object.create(g.Object3D.prototype),g.DirectionalLightHelper.prototype.update=function(){this.direction.subVectors(this.light.target.position,this.light.position);var a=g.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(a),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),null!==this.targetSphere&&(this.targetSphere.material.color.copy(this.color),this.targetLine.material.color.copy(this.color),this.targetLine.geometry.vertices[0].copy(this.light.position),this.targetLine.geometry.vertices[1].copy(this.light.target.position),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0)},g.HemisphereLightHelper=function(a,b,c){g.Object3D.call(this),this.light=a,this.position=a.position;var d=g.Math.clamp(a.intensity,0,1);this.color=a.color.clone(),this.color.multiplyScalar(d);var e=this.color.getHex();this.groundColor=a.groundColor.clone(),this.groundColor.multiplyScalar(d);for(var f=this.groundColor.getHex(),h=new g.SphereGeometry(b,16,8,0,2*Math.PI,0,.5*Math.PI),i=new g.SphereGeometry(b,16,8,0,2*Math.PI,.5*Math.PI,Math.PI),j=new g.MeshBasicMaterial({color:e,fog:!1}),k=new g.MeshBasicMaterial({color:f,fog:!1}),l=0,m=h.faces.length;m>l;l++)h.faces[l].materialIndex=0;for(var l=0,m=i.faces.length;m>l;l++)i.faces[l].materialIndex=1;g.GeometryUtils.merge(h,i),this.lightSphere=new g.Mesh(h,new g.MeshFaceMaterial([j,k])),this.lightArrow=new g.ArrowHelper(new g.Vector3(0,1,0),new g.Vector3(0,1.1*(b+c),0),c,e),this.lightArrow.rotation.x=Math.PI,this.lightArrowGround=new g.ArrowHelper(new g.Vector3(0,1,0),new g.Vector3(0,-1.1*(b+c),0),c,f);var n=new g.Object3D;n.rotation.x=.5*-Math.PI,n.add(this.lightSphere),n.add(this.lightArrow),n.add(this.lightArrowGround),this.add(n),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=a,this.lightSphere.properties.gizmoRoot=this,this.properties.isGizmo=!0,this.target=new g.Vector3,this.lookAt(this.target)},g.HemisphereLightHelper.prototype=Object.create(g.Object3D.prototype),g.HemisphereLightHelper.prototype.update=function(){var a=g.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(a),this.groundColor.copy(this.light.groundColor),this.groundColor.multiplyScalar(a),this.lightSphere.material.materials[0].color.copy(this.color),this.lightSphere.material.materials[1].color.copy(this.groundColor),this.lightArrow.setColor(this.color.getHex()),this.lightArrowGround.setColor(this.groundColor.getHex()),this.lookAt(this.target)},g.PointLightHelper=function(a,b){g.Object3D.call(this),this.light=a,this.position=a.position;var c=g.Math.clamp(a.intensity,0,1);this.color=a.color.clone(),this.color.multiplyScalar(c);var d=this.color.getHex(),e=new g.SphereGeometry(b,16,8),f=new g.AsteriskGeometry(1.25*b,2.25*b),h=new g.IcosahedronGeometry(1,2),i=new g.MeshBasicMaterial({color:d,fog:!1}),j=new g.LineBasicMaterial({color:d,fog:!1}),k=new g.MeshBasicMaterial({color:d,fog:!1,wireframe:!0,opacity:.1,transparent:!0});this.lightSphere=new g.Mesh(e,i),this.lightRays=new g.Line(f,j,g.LinePieces),this.lightDistance=new g.Mesh(h,k);var l=a.distance;0===l?this.lightDistance.visible=!1:this.lightDistance.scale.set(l,l,l),this.add(this.lightSphere),this.add(this.lightRays),this.add(this.lightDistance),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=a,this.lightSphere.properties.gizmoRoot=this,this.properties.isGizmo=!0},g.PointLightHelper.prototype=Object.create(g.Object3D.prototype),g.PointLightHelper.prototype.update=function(){var a=g.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(a),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),this.lightDistance.material.color.copy(this.color);var b=this.light.distance;0===b?this.lightDistance.visible=!1:(this.lightDistance.visible=!0,this.lightDistance.scale.set(b,b,b))},g.SpotLightHelper=function(a,b){g.Object3D.call(this),this.light=a,this.position=a.position,this.direction=new g.Vector3,this.direction.subVectors(a.target.position,a.position);var c=g.Math.clamp(a.intensity,0,1);this.color=a.color.clone(),this.color.multiplyScalar(c);var d=this.color.getHex(),e=new g.SphereGeometry(b,16,8),f=new g.AsteriskGeometry(1.25*b,2.25*b),h=new g.CylinderGeometry(1e-4,1,1,8,1,!0),i=new g.Matrix4;i.rotateX(-Math.PI/2),i.translate(new g.Vector3(0,-.5,0)),h.applyMatrix(i);var j=new g.MeshBasicMaterial({color:d,fog:!1}),k=new g.LineBasicMaterial({color:d,fog:!1}),l=new g.MeshBasicMaterial({color:d,fog:!1,wireframe:!0,opacity:.3,transparent:!0});this.lightSphere=new g.Mesh(e,j),this.lightCone=new g.Mesh(h,l);var m=a.distance?a.distance:1e4,n=m*Math.tan(.5*a.angle)*2;if(this.lightCone.scale.set(n,n,m),this.lightRays=new g.Line(f,k,g.LinePieces),this.gyroscope=new g.Gyroscope,this.gyroscope.add(this.lightSphere),this.gyroscope.add(this.lightRays),this.add(this.gyroscope),this.add(this.lightCone),this.lookAt(a.target.position),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=a,this.lightSphere.properties.gizmoRoot=this,this.targetSphere=null,void 0!==a.target.properties.targetInverse){var o=new g.SphereGeometry(b,8,4),p=new g.MeshBasicMaterial({color:d,wireframe:!0,fog:!1});this.targetSphere=new g.Mesh(o,p),this.targetSphere.position=a.target.position,this.targetSphere.properties.isGizmo=!0,this.targetSphere.properties.gizmoSubject=a.target,this.targetSphere.properties.gizmoRoot=this.targetSphere;var q=new g.LineDashedMaterial({color:d,dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),r=new g.Geometry;r.vertices.push(this.position.clone()),r.vertices.push(this.targetSphere.position.clone()),r.computeLineDistances(),this.targetLine=new g.Line(r,q),this.targetLine.properties.isGizmo=!0}this.properties.isGizmo=!0},g.SpotLightHelper.prototype=Object.create(g.Object3D.prototype),g.SpotLightHelper.prototype.update=function(){this.direction.subVectors(this.light.target.position,this.light.position),this.lookAt(this.light.target.position);var a=this.light.distance?this.light.distance:1e4,b=a*Math.tan(.5*this.light.angle)*2;this.lightCone.scale.set(b,b,a);var c=g.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(c),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),this.lightCone.material.color.copy(this.color),null!==this.targetSphere&&(this.targetSphere.material.color.copy(this.color),this.targetLine.material.color.copy(this.color),this.targetLine.geometry.vertices[0].copy(this.light.position),this.targetLine.geometry.vertices[1].copy(this.light.target.position),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0)},g.ImmediateRenderObject=function(){g.Object3D.call(this),this.render=function(){}},g.ImmediateRenderObject.prototype=Object.create(g.Object3D.prototype),g.LensFlare=function(a,b,c,d,e){g.Object3D.call(this),this.lensFlares=[],this.positionScreen=new g.Vector3,this.customUpdateCallback=void 0,void 0!==a&&this.add(a,b,c,d,e)},g.LensFlare.prototype=Object.create(g.Object3D.prototype),g.LensFlare.prototype.add=function(a,b,c,d,e,f){void 0===b&&(b=-1),void 0===c&&(c=0),void 0===f&&(f=1),void 0===e&&(e=new g.Color(16777215)),void 0===d&&(d=g.NormalBlending),c=Math.min(c,Math.max(0,c)),this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:f,color:e,blending:d})},g.LensFlare.prototype.updateLensFlares=function(){var a,b,c=this.lensFlares.length,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;c>a;a++)b=this.lensFlares[a],b.x=this.positionScreen.x+d*b.distance,b.y=this.positionScreen.y+e*b.distance,b.wantedRotation=b.x*Math.PI*.25,b.rotation+=.25*(b.wantedRotation-b.rotation)},g.MorphBlendMesh=function(a,b){g.Mesh.call(this,a,b),this.animationsMap={},this.animationsList=[];var c=this.geometry.morphTargets.length,d="__default",e=0,f=c-1,h=c/1;this.createAnimation(d,e,f,h),this.setAnimationWeight(d,1)},g.MorphBlendMesh.prototype=Object.create(g.Mesh.prototype),g.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){var e={startFrame:b,endFrame:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};
this.animationsMap[a]=e,this.animationsList.push(e)},g.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b,c=/([a-z]+)(\d+)/,d={},e=this.geometry,f=0,g=e.morphTargets.length;g>f;f++){var h=e.morphTargets[f],i=h.name.match(c);if(i&&i.length>1){{var j=i[1];i[2]}d[j]||(d[j]={start:1/0,end:-1/0});var k=d[j];f<k.start&&(k.start=f),f>k.end&&(k.end=f),b||(b=j)}}for(var j in d){var k=d[j];this.createAnimation(j,k.start,k.end,a)}this.firstAnimation=b},g.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){var b=this.animationsMap[a];b&&(b.direction=1,b.directionBackwards=!1)},g.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){var b=this.animationsMap[a];b&&(b.direction=-1,b.directionBackwards=!0)},g.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)},g.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)},g.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)},g.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)},g.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0,c=this.animationsMap[a];return c&&(b=c.time),b},g.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1,c=this.animationsMap[a];return c&&(b=c.duration),b},g.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("animation["+a+"] undefined")},g.MorphBlendMesh.prototype.stopAnimation=function(a){var b=this.animationsMap[a];b&&(b.active=!1)},g.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;c>b;b++){var d=this.animationsList[b];if(d.active){var e=d.duration/d.length;d.time+=d.direction*a,d.mirroredLoop?(d.time>d.duration||d.time<0)&&(d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),d.time<0&&(d.time=0,d.directionBackwards=!1)):(d.time=d.time%d.duration,d.time<0&&(d.time+=d.duration));var f=d.startFrame+g.Math.clamp(Math.floor(d.time/e),0,d.length-1),h=d.weight;f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*h,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);var i=d.time%e/e;d.directionBackwards&&(i=1-i),this.morphTargetInfluences[d.currentFrame]=i*h,this.morphTargetInfluences[d.lastFrame]=(1-i)*h}}},g.LensFlarePlugin=function(){function a(a,c){var d=b.createProgram(),e=b.createShader(b.FRAGMENT_SHADER),f=b.createShader(b.VERTEX_SHADER),g="precision "+c+" float;\n";return b.shaderSource(e,g+a.fragmentShader),b.shaderSource(f,g+a.vertexShader),b.compileShader(e),b.compileShader(f),b.attachShader(d,e),b.attachShader(d,f),b.linkProgram(d),d}var b,c,d,e={};this.init=function(f){b=f.context,c=f,d=f.getPrecision(),e.vertices=new Float32Array(16),e.faces=new Uint16Array(6);var h=0;e.vertices[h++]=-1,e.vertices[h++]=-1,e.vertices[h++]=0,e.vertices[h++]=0,e.vertices[h++]=1,e.vertices[h++]=-1,e.vertices[h++]=1,e.vertices[h++]=0,e.vertices[h++]=1,e.vertices[h++]=1,e.vertices[h++]=1,e.vertices[h++]=1,e.vertices[h++]=-1,e.vertices[h++]=1,e.vertices[h++]=0,e.vertices[h++]=1,h=0,e.faces[h++]=0,e.faces[h++]=1,e.faces[h++]=2,e.faces[h++]=0,e.faces[h++]=2,e.faces[h++]=3,e.vertexBuffer=b.createBuffer(),e.elementBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,e.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,e.vertices,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e.elementBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,e.faces,b.STATIC_DRAW),e.tempTexture=b.createTexture(),e.occlusionTexture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,e.tempTexture),b.texImage2D(b.TEXTURE_2D,0,b.RGB,16,16,0,b.RGB,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.bindTexture(b.TEXTURE_2D,e.occlusionTexture),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,16,16,0,b.RGBA,b.UNSIGNED_BYTE,null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(e.hasVertexTexture=!1,e.program=a(g.ShaderFlares.lensFlare,d)):(e.hasVertexTexture=!0,e.program=a(g.ShaderFlares.lensFlareVertexTexture,d)),e.attributes={},e.uniforms={},e.attributes.vertex=b.getAttribLocation(e.program,"position"),e.attributes.uv=b.getAttribLocation(e.program,"uv"),e.uniforms.renderType=b.getUniformLocation(e.program,"renderType"),e.uniforms.map=b.getUniformLocation(e.program,"map"),e.uniforms.occlusionMap=b.getUniformLocation(e.program,"occlusionMap"),e.uniforms.opacity=b.getUniformLocation(e.program,"opacity"),e.uniforms.color=b.getUniformLocation(e.program,"color"),e.uniforms.scale=b.getUniformLocation(e.program,"scale"),e.uniforms.rotation=b.getUniformLocation(e.program,"rotation"),e.uniforms.screenPosition=b.getUniformLocation(e.program,"screenPosition")},this.render=function(a,d,f,h){var i=a.__webglFlares,j=i.length;if(j){var k=new g.Vector3,l=h/f,m=.5*f,n=.5*h,o=16/h,p=new g.Vector2(o*l,o),q=new g.Vector3(1,1,0),r=new g.Vector2(1,1),s=e.uniforms,t=e.attributes;b.useProgram(e.program),b.enableVertexAttribArray(e.attributes.vertex),b.enableVertexAttribArray(e.attributes.uv),b.uniform1i(s.occlusionMap,0),b.uniform1i(s.map,1),b.bindBuffer(b.ARRAY_BUFFER,e.vertexBuffer),b.vertexAttribPointer(t.vertex,2,b.FLOAT,!1,16,0),b.vertexAttribPointer(t.uv,2,b.FLOAT,!1,16,8),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,e.elementBuffer),b.disable(b.CULL_FACE),b.depthMask(!1);var u,v,w,x,y;for(u=0;j>u;u++)if(o=16/h,p.set(o*l,o),x=i[u],k.set(x.matrixWorld.elements[12],x.matrixWorld.elements[13],x.matrixWorld.elements[14]),k.applyMatrix4(d.matrixWorldInverse),k.applyProjection(d.projectionMatrix),q.copy(k),r.x=q.x*m+m,r.y=q.y*n+n,e.hasVertexTexture||r.x>0&&r.x<f&&r.y>0&&r.y<h)for(b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,e.tempTexture),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGB,r.x-8,r.y-8,16,16,0),b.uniform1i(s.renderType,0),b.uniform2f(s.scale,p.x,p.y),b.uniform3f(s.screenPosition,q.x,q.y,q.z),b.disable(b.BLEND),b.enable(b.DEPTH_TEST),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,e.occlusionTexture),b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,r.x-8,r.y-8,16,16,0),b.uniform1i(s.renderType,1),b.disable(b.DEPTH_TEST),b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,e.tempTexture),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0),x.positionScreen.copy(q),x.customUpdateCallback?x.customUpdateCallback(x):x.updateLensFlares(),b.uniform1i(s.renderType,2),b.enable(b.BLEND),v=0,w=x.lensFlares.length;w>v;v++)y=x.lensFlares[v],y.opacity>.001&&y.scale>.001&&(q.x=y.x,q.y=y.y,q.z=y.z,o=y.size*y.scale/h,p.x=o*l,p.y=o,b.uniform3f(s.screenPosition,q.x,q.y,q.z),b.uniform2f(s.scale,p.x,p.y),b.uniform1f(s.rotation,y.rotation),b.uniform1f(s.opacity,y.opacity),b.uniform3f(s.color,y.color.r,y.color.g,y.color.b),c.setBlending(y.blending,y.blendEquation,y.blendSrc,y.blendDst),c.setTexture(y.texture,1),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0));b.enable(b.CULL_FACE),b.enable(b.DEPTH_TEST),b.depthMask(!0)}}},g.ShadowMapPlugin=function(){function a(a,b){var c=new g.DirectionalLight;c.isVirtual=!0,c.onlyShadow=!0,c.castShadow=!0,c.shadowCameraNear=a.shadowCameraNear,c.shadowCameraFar=a.shadowCameraFar,c.shadowCameraLeft=a.shadowCameraLeft,c.shadowCameraRight=a.shadowCameraRight,c.shadowCameraBottom=a.shadowCameraBottom,c.shadowCameraTop=a.shadowCameraTop,c.shadowCameraVisible=a.shadowCameraVisible,c.shadowDarkness=a.shadowDarkness,c.shadowBias=a.shadowCascadeBias[b],c.shadowMapWidth=a.shadowCascadeWidth[b],c.shadowMapHeight=a.shadowCascadeHeight[b],c.pointsWorld=[],c.pointsFrustum=[];for(var d=c.pointsWorld,e=c.pointsFrustum,f=0;8>f;f++)d[f]=new g.Vector3,e[f]=new g.Vector3;var h=a.shadowCascadeNearZ[b],i=a.shadowCascadeFarZ[b];return e[0].set(-1,-1,h),e[1].set(1,-1,h),e[2].set(-1,1,h),e[3].set(1,1,h),e[4].set(-1,-1,i),e[5].set(1,-1,i),e[6].set(-1,1,i),e[7].set(1,1,i),c}function b(a,b){var c=a.shadowCascadeArray[b];c.position.copy(a.position),c.target.position.copy(a.target.position),c.lookAt(c.target),c.shadowCameraVisible=a.shadowCameraVisible,c.shadowDarkness=a.shadowDarkness,c.shadowBias=a.shadowCascadeBias[b];var d=a.shadowCascadeNearZ[b],e=a.shadowCascadeFarZ[b],f=c.pointsFrustum;f[0].z=d,f[1].z=d,f[2].z=d,f[3].z=d,f[4].z=e,f[5].z=e,f[6].z=e,f[7].z=e}function c(a,b){var c=b.shadowCamera,d=b.pointsFrustum,e=b.pointsWorld;n.set(1/0,1/0,1/0),o.set(-1/0,-1/0,-1/0);for(var f=0;8>f;f++){var h=e[f];h.copy(d[f]),g.ShadowMapPlugin.__projector.unprojectVector(h,a),h.applyMatrix4(c.matrixWorldInverse),h.x<n.x&&(n.x=h.x),h.x>o.x&&(o.x=h.x),h.y<n.y&&(n.y=h.y),h.y>o.y&&(o.y=h.y),h.z<n.z&&(n.z=h.z),h.z>o.z&&(o.z=h.z)}c.left=n.x,c.right=o.x,c.top=o.y,c.bottom=n.y,c.updateProjectionMatrix()}function d(a){return a.material instanceof g.MeshFaceMaterial?a.material.materials[0]:a.material}var e,f,h,i,j,k,l=new g.Frustum,m=new g.Matrix4,n=new g.Vector3,o=new g.Vector3,p=new g.Vector3;this.init=function(a){e=a.context,f=a;var b=g.ShaderLib.depthRGBA,c=g.UniformsUtils.clone(b.uniforms);h=new g.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:c}),i=new g.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:c,morphTargets:!0}),j=new g.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:c,skinning:!0}),k=new g.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:c,morphTargets:!0,skinning:!0}),h._shadowPass=!0,i._shadowPass=!0,j._shadowPass=!0,k._shadowPass=!0},this.render=function(a,b){f.shadowMapEnabled&&f.shadowMapAutoUpdate&&this.update(a,b)},this.update=function(n,o){var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=[],F=0,G=null;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),f.shadowMapCullFace===g.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.BACK),f.setDepthTest(!0),q=0,r=n.__lights.length;r>q;q++)if(C=n.__lights[q],C.castShadow)if(C instanceof g.DirectionalLight&&C.shadowCascade)for(u=0;u<C.shadowCascadeCount;u++){var H;if(C.shadowCascadeArray[u])H=C.shadowCascadeArray[u];else{H=a(C,u),H.originalCamera=o;var I=new g.Gyroscope;I.position=C.shadowCascadeOffset,I.add(H),I.add(H.target),o.add(I),C.shadowCascadeArray[u]=H,console.log("Created virtualLight",H)}b(C,u),E[F]=H,F++}else E[F]=C,F++;for(q=0,r=E.length;r>q;q++){if(C=E[q],!C.shadowMap){var J=g.LinearFilter;f.shadowMapType===g.PCFSoftShadowMap&&(J=g.NearestFilter);var K={minFilter:J,magFilter:J,format:g.RGBAFormat};C.shadowMap=new g.WebGLRenderTarget(C.shadowMapWidth,C.shadowMapHeight,K),C.shadowMapSize=new g.Vector2(C.shadowMapWidth,C.shadowMapHeight),C.shadowMatrix=new g.Matrix4}if(!C.shadowCamera){if(C instanceof g.SpotLight)C.shadowCamera=new g.PerspectiveCamera(C.shadowCameraFov,C.shadowMapWidth/C.shadowMapHeight,C.shadowCameraNear,C.shadowCameraFar);else{if(!(C instanceof g.DirectionalLight)){console.error("Unsupported light type for shadow");continue}C.shadowCamera=new g.OrthographicCamera(C.shadowCameraLeft,C.shadowCameraRight,C.shadowCameraTop,C.shadowCameraBottom,C.shadowCameraNear,C.shadowCameraFar)}n.add(C.shadowCamera),f.autoUpdateScene&&n.updateMatrixWorld()}for(C.shadowCameraVisible&&!C.cameraHelper&&(C.cameraHelper=new g.CameraHelper(C.shadowCamera),C.shadowCamera.add(C.cameraHelper)),C.isVirtual&&H.originalCamera==o&&c(o,C),v=C.shadowMap,w=C.shadowMatrix,x=C.shadowCamera,x.position.getPositionFromMatrix(C.matrixWorld),p.getPositionFromMatrix(C.target.matrixWorld),x.lookAt(p),x.updateMatrixWorld(),x.matrixWorldInverse.getInverse(x.matrixWorld),C.cameraHelper&&(C.cameraHelper.visible=C.shadowCameraVisible),C.shadowCameraVisible&&C.cameraHelper.update(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(x.projectionMatrix),w.multiply(x.matrixWorldInverse),m.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),l.setFromMatrix(m),f.setRenderTarget(v),f.clear(),D=n.__webglObjects,s=0,t=D.length;t>s;s++)A=D[s],B=A.object,A.render=!1,B.visible&&B.castShadow&&((B instanceof g.Mesh||B instanceof g.ParticleSystem)&&B.frustumCulled&&!l.intersectsObject(B)||(B._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,B.matrixWorld),A.render=!0));var L,M,N;for(s=0,t=D.length;t>s;s++)A=D[s],A.render&&(B=A.object,y=A.buffer,L=d(B),M=B.geometry.morphTargets.length>0&&L.morphTargets,N=B instanceof g.SkinnedMesh&&L.skinning,z=B.customDepthMaterial?B.customDepthMaterial:N?M?k:j:M?i:h,y instanceof g.BufferGeometry?f.renderBufferDirect(x,n.__lights,G,z,y,B):f.renderBuffer(x,n.__lights,G,z,y,B));for(D=n.__webglObjectsImmediate,s=0,t=D.length;t>s;s++)A=D[s],B=A.object,B.visible&&B.castShadow&&(B._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,B.matrixWorld),f.renderImmediateObject(x,n.__lights,G,h,B))}var O=f.getClearColor(),P=f.getClearAlpha();e.clearColor(O.r,O.g,O.b,P),e.enable(e.BLEND),f.shadowMapCullFace===g.CullFaceFront&&e.cullFace(e.BACK)}},g.ShadowMapPlugin.__projector=new g.Projector,g.SpritePlugin=function(){function a(a,b){var d=c.createProgram(),e=c.createShader(c.FRAGMENT_SHADER),f=c.createShader(c.VERTEX_SHADER),g="precision "+b+" float;\n";return c.shaderSource(e,g+a.fragmentShader),c.shaderSource(f,g+a.vertexShader),c.compileShader(e),c.compileShader(f),c.attachShader(d,e),c.attachShader(d,f),c.linkProgram(d),d}function b(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}var c,d,e,f={};this.init=function(b){c=b.context,d=b,e=b.getPrecision(),f.vertices=new Float32Array(16),f.faces=new Uint16Array(6);var h=0;f.vertices[h++]=-1,f.vertices[h++]=-1,f.vertices[h++]=0,f.vertices[h++]=0,f.vertices[h++]=1,f.vertices[h++]=-1,f.vertices[h++]=1,f.vertices[h++]=0,f.vertices[h++]=1,f.vertices[h++]=1,f.vertices[h++]=1,f.vertices[h++]=1,f.vertices[h++]=-1,f.vertices[h++]=1,f.vertices[h++]=0,f.vertices[h++]=1,h=0,f.faces[h++]=0,f.faces[h++]=1,f.faces[h++]=2,f.faces[h++]=0,f.faces[h++]=2,f.faces[h++]=3,f.vertexBuffer=c.createBuffer(),f.elementBuffer=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,f.vertexBuffer),c.bufferData(c.ARRAY_BUFFER,f.vertices,c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,f.elementBuffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,f.faces,c.STATIC_DRAW),f.program=a(g.ShaderSprite.sprite,e),f.attributes={},f.uniforms={},f.attributes.position=c.getAttribLocation(f.program,"position"),f.attributes.uv=c.getAttribLocation(f.program,"uv"),f.uniforms.uvOffset=c.getUniformLocation(f.program,"uvOffset"),f.uniforms.uvScale=c.getUniformLocation(f.program,"uvScale"),f.uniforms.rotation=c.getUniformLocation(f.program,"rotation"),f.uniforms.scale=c.getUniformLocation(f.program,"scale"),f.uniforms.alignment=c.getUniformLocation(f.program,"alignment"),f.uniforms.color=c.getUniformLocation(f.program,"color"),f.uniforms.map=c.getUniformLocation(f.program,"map"),f.uniforms.opacity=c.getUniformLocation(f.program,"opacity"),f.uniforms.useScreenCoordinates=c.getUniformLocation(f.program,"useScreenCoordinates"),f.uniforms.sizeAttenuation=c.getUniformLocation(f.program,"sizeAttenuation"),f.uniforms.screenPosition=c.getUniformLocation(f.program,"screenPosition"),f.uniforms.modelViewMatrix=c.getUniformLocation(f.program,"modelViewMatrix"),f.uniforms.projectionMatrix=c.getUniformLocation(f.program,"projectionMatrix"),f.uniforms.fogType=c.getUniformLocation(f.program,"fogType"),f.uniforms.fogDensity=c.getUniformLocation(f.program,"fogDensity"),f.uniforms.fogNear=c.getUniformLocation(f.program,"fogNear"),f.uniforms.fogFar=c.getUniformLocation(f.program,"fogFar"),f.uniforms.fogColor=c.getUniformLocation(f.program,"fogColor"),f.uniforms.alphaTest=c.getUniformLocation(f.program,"alphaTest")},this.render=function(a,e,h,i){var j=a.__webglSprites,k=j.length;if(k){var l=f.attributes,m=f.uniforms,n=i/h,o=.5*h,p=.5*i;c.useProgram(f.program),c.enableVertexAttribArray(l.position),c.enableVertexAttribArray(l.uv),c.disable(c.CULL_FACE),c.enable(c.BLEND),c.bindBuffer(c.ARRAY_BUFFER,f.vertexBuffer),c.vertexAttribPointer(l.position,2,c.FLOAT,!1,16,0),c.vertexAttribPointer(l.uv,2,c.FLOAT,!1,16,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,f.elementBuffer),c.uniformMatrix4fv(m.projectionMatrix,!1,e.projectionMatrix.elements),c.activeTexture(c.TEXTURE0),c.uniform1i(m.map,0);var q=0,r=0,s=a.fog;s?(c.uniform3f(m.fogColor,s.color.r,s.color.g,s.color.b),s instanceof g.Fog?(c.uniform1f(m.fogNear,s.near),c.uniform1f(m.fogFar,s.far),c.uniform1i(m.fogType,1),q=1,r=1):s instanceof g.FogExp2&&(c.uniform1f(m.fogDensity,s.density),c.uniform1i(m.fogType,2),q=2,r=2)):(c.uniform1i(m.fogType,0),q=0,r=0);var t,u,v,w,x,y=[];for(t=0;k>t;t++)u=j[t],v=u.material,u.visible&&0!==v.opacity&&(v.useScreenCoordinates?u.z=-u.position.z:(u._modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,u.matrixWorld),u.z=-u._modelViewMatrix.elements[14]));for(j.sort(b),t=0;k>t;t++)u=j[t],v=u.material,u.visible&&0!==v.opacity&&v.map&&v.map.image&&v.map.image.width&&(c.uniform1f(m.alphaTest,v.alphaTest),v.useScreenCoordinates===!0?(c.uniform1i(m.useScreenCoordinates,1),c.uniform3f(m.screenPosition,(u.position.x*d.devicePixelRatio-o)/o,(p-u.position.y*d.devicePixelRatio)/p,Math.max(0,Math.min(1,u.position.z))),y[0]=d.devicePixelRatio,y[1]=d.devicePixelRatio):(c.uniform1i(m.useScreenCoordinates,0),c.uniform1i(m.sizeAttenuation,v.sizeAttenuation?1:0),c.uniformMatrix4fv(m.modelViewMatrix,!1,u._modelViewMatrix.elements),y[0]=1,y[1]=1),x=a.fog&&v.fog?r:0,q!==x&&(c.uniform1i(m.fogType,x),q=x),w=1/(v.scaleByViewport?i:1),y[0]*=w*n*u.scale.x,y[1]*=w*u.scale.y,c.uniform2f(m.uvScale,v.uvScale.x,v.uvScale.y),c.uniform2f(m.uvOffset,v.uvOffset.x,v.uvOffset.y),c.uniform2f(m.alignment,v.alignment.x,v.alignment.y),c.uniform1f(m.opacity,v.opacity),c.uniform3f(m.color,v.color.r,v.color.g,v.color.b),c.uniform1f(m.rotation,u.rotation),c.uniform2fv(m.scale,y),d.setBlending(v.blending,v.blendEquation,v.blendSrc,v.blendDst),d.setDepthTest(v.depthTest),d.setDepthWrite(v.depthWrite),d.setTexture(v.map,0),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0));c.enable(c.CULL_FACE)}}},g.DepthPassPlugin=function(){function a(a){return a.material instanceof g.MeshFaceMaterial?a.material.materials[0]:a.material}this.enabled=!1,this.renderTarget=null;var b,c,d,e,f,h,i=new g.Frustum,j=new g.Matrix4;this.init=function(a){b=a.context,c=a;var i=g.ShaderLib.depthRGBA,j=g.UniformsUtils.clone(i.uniforms);d=new g.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j}),e=new g.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j,morphTargets:!0}),f=new g.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j,skinning:!0}),h=new g.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:j,morphTargets:!0,skinning:!0}),d._shadowPass=!0,e._shadowPass=!0,f._shadowPass=!0,h._shadowPass=!0},this.render=function(a,b){this.enabled&&this.update(a,b)},this.update=function(k,l){var m,n,o,p,q,r,s,t=null;for(b.clearColor(1,1,1,1),b.disable(b.BLEND),c.setDepthTest(!0),c.autoUpdateScene&&k.updateMatrixWorld(),l.matrixWorldInverse.getInverse(l.matrixWorld),j.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),i.setFromMatrix(j),c.setRenderTarget(this.renderTarget),c.clear(),s=k.__webglObjects,m=0,n=s.length;n>m;m++)q=s[m],r=q.object,q.render=!1,r.visible&&((r instanceof g.Mesh||r instanceof g.ParticleSystem)&&r.frustumCulled&&!i.intersectsObject(r)||(r._modelViewMatrix.multiplyMatrices(l.matrixWorldInverse,r.matrixWorld),q.render=!0));var u,v,w;for(m=0,n=s.length;n>m;m++)if(q=s[m],q.render){if(r=q.object,o=q.buffer,r instanceof g.ParticleSystem&&!r.customDepthMaterial)continue;u=a(r),u&&c.setMaterialFaces(r.material),v=r.geometry.morphTargets.length>0&&u.morphTargets,w=r instanceof g.SkinnedMesh&&u.skinning,p=r.customDepthMaterial?r.customDepthMaterial:w?v?h:f:v?e:d,o instanceof g.BufferGeometry?c.renderBufferDirect(l,k.__lights,t,p,o,r):c.renderBuffer(l,k.__lights,t,p,o,r)}for(s=k.__webglObjectsImmediate,m=0,n=s.length;n>m;m++)q=s[m],r=q.object,r.visible&&(r._modelViewMatrix.multiplyMatrices(l.matrixWorldInverse,r.matrixWorld),c.renderImmediateObject(l,k.__lights,t,d,r));var x=c.getClearColor(),y=c.getClearAlpha();b.clearColor(x.r,x.g,x.b,y),b.enable(b.BLEND)}},g.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility = (       visibility.r / 9.0 ) *","( 1.0 - visibility.g / 9.0 ) *","(       visibility.b / 9.0 ) *","( 1.0 - visibility.a / 9.0 );","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},g.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=g),c.THREE=g):this.THREE=g},{__browserify_process:40}],200:[function(a,b){function c(){this._things=[]}b.exports=function(){return new c},c.prototype._stack=function(a){var b=this;b._things.push(a);var c=b._things.length-1;return function(){delete b._things[c]}},c.prototype.interval=c.prototype.setInterval=function(a,b){return this._stack({fn:a,at:b,args:Array.prototype.slice.call(arguments,2),elapsed:0,once:!1})},c.prototype.timeout=c.prototype.setTimeout=function(a,b){return this._stack({fn:a,at:b,args:Array.prototype.slice.call(arguments,2),elapsed:0,once:!0})},c.prototype.tick=function(a){var b=this;b._things.forEach(function(c,d){c.elapsed+=a,c.elapsed>c.at&&(c.elapsed-=c.at,c.fn.apply(c.fn,c.args||[]),c.once&&delete b._things[d])})}},{}],201:[function(a,b){function c(a,b){return new d(a,b)}function d(a,b){f.call(this),b=b||{},this.state=a,this._pitch_target=this._yaw_target=this._roll_target=this._target=null,this.speed=b.speed||.0032,this.max_speed=b.maxSpeed||.0112,this.jump_max_speed=b.jumpMaxSpeed||.016,this.jump_max_timer=b.jumpTimer||200,this.jump_speed=b.jumpSpeed||.004,this.jump_timer=this.jump_timer_max,this.jumping=!1,this.acceleration=b.accelerationCurve||this.acceleration,this.fire_rate=b.fireRate||0,this.needs_discrete_fire=b.discreteFire||!1,this.onfire=b.onfire||this.onfire,this.firing=0,this.x_rotation_per_ms=b.rotationXMax||b.rotationMax||33,this.y_rotation_per_ms=b.rotationYMax||b.rotationMax||33,this.z_rotation_per_ms=b.rotationZMax||b.rotationMax||33,this.x_rotation_clamp=b.rotationXClamp||Math.PI/2,this.y_rotation_clamp=b.rotationYClamp||1/0,this.z_rotation_clamp=b.rotationZClamp||0,this.rotation_scale=b.rotationScale||.002,this.air_control="airControl"in b?b.airControl:!0,this.state.x_rotation_accum=this.state.y_rotation_accum=this.state.z_rotation_accum=0,this.accel_max_timer=b.accelTimer||200,this.x_accel_timer=this.accel_max_timer+0,this.z_accel_timer=this.accel_max_timer+0,this.readable=this.writable=!0,this.buffer=[],this.paused=!1}function e(a,b){return isFinite(b)?i(j(a,b),-b):a}b.exports=c;var f=a("stream").Stream,g=d,h=g.prototype=new f;h.constructor=g;var i=Math.max,j=Math.min,k=Math.sin,l=Math.abs,m=Math.floor,n=Math.PI;h.tick=function(a){if(this._target){var b=this.state,c=this._target,d=this.speed,f=this.jump_speed,g=(l(c.velocity.z)<this.max_speed,l(c.velocity.x)<this.max_speed,c.atRestY());if(this._target){(b.forward||b.backward)&&(this.z_accel_timer=i(0,this.z_accel_timer-a)),b.backward?c.velocity.z<this.max_speed&&(c.velocity.z=i(j(this.max_speed,d*a*this.acceleration(this.z_accel_timer,this.accel_max_timer)),c.velocity.z)):b.forward?c.velocity.z>-this.max_speed&&(c.velocity.z=j(i(-this.max_speed,-d*a*this.acceleration(this.z_accel_timer,this.accel_max_timer)),c.velocity.z)):this.z_accel_timer=this.accel_max_timer,(b.left||b.right)&&(this.x_accel_timer=i(0,this.x_accel_timer-a)),b.right?c.velocity.x<this.max_speed&&(c.velocity.x=i(j(this.max_speed,d*a*this.acceleration(this.x_accel_timer,this.accel_max_timer)),c.velocity.x)):b.left?c.velocity.x>-this.max_speed&&(c.velocity.x=j(i(-this.max_speed,-d*a*this.acceleration(this.x_accel_timer,this.accel_max_timer)),c.velocity.x)):this.x_accel_timer=this.accel_max_timer,b.jump?(this.jumping||g)&&(g>0?this.jumping=!1:(this.jumping=!0,this.jump_timer>0&&(c.velocity.y=j(c.velocity.y+f*j(a,this.jump_timer),this.jump_max_speed)),this.jump_timer=i(this.jump_timer-a,0))):this.jumping=!1,this.jump_timer=0>g?this.jump_max_timer:this.jump_timer;b.fire||b.firealt?this.firing&&this.needs_discrete_fire?this.firing+=a:(this.fire_rate&&m(this.firing/this.fire_rate)===m((this.firing+a)/this.fire_rate)||this.onfire(b),this.firing+=a):this.firing=0;var h=this.state.x_rotation_accum*this.rotation_scale,k=this.state.y_rotation_accum*this.rotation_scale,n=this.state.z_rotation_accum*this.rotation_scale,o=this._pitch_target,p=this._yaw_target,q=this._roll_target;o.rotation.x=e(o.rotation.x+e(h,this.x_rotation_per_ms),this.x_rotation_clamp),p.rotation.y=e(p.rotation.y+e(k,this.y_rotation_per_ms),this.y_rotation_clamp),q.rotation.z=e(q.rotation.z+e(n,this.z_rotation_per_ms),this.z_rotation_clamp),this.listeners("data").length&&this.emitUpdate(),this.state.x_rotation_accum=this.state.y_rotation_accum=this.state.z_rotation_accum=0}}},h.write=function(a){for(var b in a)this.state[b]=a[b]},h.end=function(a){a&&this.write(a)},h.createWriteRotationStream=function(){function a(a){c.x_rotation_accum-=a.dy||0,c.y_rotation_accum-=a.dx||0,c.z_rotation_accum+=a.dz||0}function b(a){a&&d.write(a)}var c=this.state,d=new f;return c.x_rotation_accum=c.y_rotation_accum=c.z_rotation_accum=0,d.writable=!0,d.write=a,d.end=b,d},h.emitUpdate=function(){return this.queue({x_rotation_accum:this.state.x_rotation_accum,y_rotation_accum:this.state.y_rotation_accum,z_rotation_accum:this.state.z_rotation_accum,forward:this.state.forward,backward:this.state.backward,left:this.state.left,right:this.state.right,fire:this.state.fire,firealt:this.state.firealt,jump:this.state.jump})},h.drain=function(){for(var a,b=this.buffer;b.length&&!this.paused;){if(a=b.shift(),null===a)return this.emit("end");this.emit("data",a)}},h.resume=function(){return this.paused=!1,this.drain(),this.paused||this.emit("drain"),this},h.pause=function(){return this.paused?void 0:(this.paused=!0,this.emit("pause"),this)},h.queue=function(a){return this.buffer.push(a),this.drain(),this},h.acceleration=function(a,b){var c=(b-a)/b;return k(n/2*c)},h.target=function(a){return a&&(this._target=a,this._yaw_target=a.yaw||a,this._pitch_target=a.pitch||a,this._roll_target=a.roll||a),this._target},h.onfire=function(){}},{stream:50}],202:[function(a,b){function c(a,b,c,e){this.THREE=e||d,this.data=a;var f=this.geometry=new this.THREE.Geometry;this.scale=c||new this.THREE.Vector3(10,10,10);var g=b(a.voxels,a.dims);this.meshed=g,f.vertices.length=0,f.faces.length=0;for(var h=0;h<g.vertices.length;++h){var i=g.vertices[h];f.vertices.push(new this.THREE.Vector3(i[0],i[1],i[2]))}for(var h=0;h<g.faces.length;++h){f.faceVertexUvs[0].push(this.faceVertexUv(h));var i=g.faces[h];if(5===i.length){var j=new this.THREE.Face4(i[0],i[1],i[2],i[3]);j.color=new this.THREE.Color(i[4]),f.faces.push(j)}else if(4==i.length){var j=new this.THREE.Face3(i[0],i[1],i[2]);j.color=new this.THREE.Color(i[3]),f.faces.push(j)
}}f.computeFaceNormals();for(var k=new d.Color(16777215),l=new d.Color(5263440),h=0;h<f.faces.length;++h){var m=f.faces[h];m.vertexColors=1===m.normal.y?[k,k,k,k]:-1===m.normal.y?[l,l,l,l]:1===m.normal.x?[l,k,k,l]:-1===m.normal.x?[l,l,k,k]:1===m.normal.z?[l,l,k,k]:[l,k,k,l]}f.verticesNeedUpdate=!0,f.elementsNeedUpdate=!0,f.normalsNeedUpdate=!0,f.computeBoundingBox(),f.computeBoundingSphere()}var d=a("three");b.exports=function(a,b,d,e){return new c(a,b,d,e)},b.exports.Mesh=c,c.prototype.createWireMesh=function(a){var b=new this.THREE.MeshBasicMaterial({color:a||16777215,wireframe:!0});return wireMesh=new d.Mesh(this.geometry,b),wireMesh.scale=this.scale,wireMesh.doubleSided=!0,this.wireMesh=wireMesh,wireMesh},c.prototype.createSurfaceMesh=function(a){a=a||new this.THREE.MeshNormalMaterial;var b=new this.THREE.Mesh(this.geometry,a);return b.scale=this.scale,b.doubleSided=!1,this.surfaceMesh=b,b},c.prototype.addToScene=function(a){this.wireMesh&&a.add(this.wireMesh),this.surfaceMesh&&a.add(this.surfaceMesh)},c.prototype.setPosition=function(a,b,c){this.wireMesh&&(this.wireMesh.position=new this.THREE.Vector3(a,b,c)),this.surfaceMesh&&(this.surfaceMesh.position=new this.THREE.Vector3(a,b,c))},c.prototype.faceVertexUv=function(a){var b=[this.meshed.vertices[4*a+0],this.meshed.vertices[4*a+1],this.meshed.vertices[4*a+2],this.meshed.vertices[4*a+3]],c={x0:b[0][0]-b[1][0],x1:b[1][0]-b[2][0],y0:b[0][1]-b[1][1],y1:b[1][1]-b[2][1],z0:b[0][2]-b[1][2],z1:b[1][2]-b[2][2]},d={x:Math.max(Math.abs(c.x0),Math.abs(c.x1)),y:Math.max(Math.abs(c.y0),Math.abs(c.y1)),z:Math.max(Math.abs(c.z0),Math.abs(c.z1))};if(0===d.x)if(c.y0>c.y1)var e=d.y,f=d.z;else var e=d.z,f=d.y;if(0===d.y)if(c.x0>c.x1)var e=d.x,f=d.z;else var e=d.z,f=d.x;if(0===d.z)if(c.x0>c.x1)var e=d.x,f=d.y;else var e=d.y,f=d.x;return 0===d.z&&c.x0<c.x1||0===d.x&&c.y0>c.y1?[new this.THREE.Vector2(f,0),new this.THREE.Vector2(0,0),new this.THREE.Vector2(0,e),new this.THREE.Vector2(f,e)]:[new this.THREE.Vector2(0,0),new this.THREE.Vector2(0,f),new this.THREE.Vector2(e,f),new this.THREE.Vector2(e,0)]}},{three:199}],203:[function(a,b){function c(a,b,c,e){return new d(a,b,c,e)}function d(a,b,c,d){this.avatar=a,this.terminal=d||new g.Vector3(.9,.1,.9),this.dimensions=c=c||[1,1,1],this._aabb=f([0,0,0],c),this.resting={x:!1,y:!1,z:!1},this.collidables=b,this.friction=new g.Vector3(1,1,1),this.rotation=this.avatar.rotation,this.default_friction=1,this.yaw=this.pitch=this.roll=a,this.forces=new g.Vector3(0,0,0),this.attractors=[],this.acceleration=new g.Vector3(0,0,0),this.velocity=new g.Vector3(0,0,0)}function e(a){return function(b){var c=this.avatar.worldToLocal(b);this[a].x+=c.x,this[a].y+=c.y,this[a].z+=c.z}}b.exports=c;var f=a("aabb-3d"),g=a("three"),h=d,i=h.prototype,j=Math.abs,k=new g.Vector3(0,0,0),l=new g.Vector3(0,0,0),m=new g.Vector3(0,0,0),n=new g.Vector3(0,0,0),o=new g.Vector3,p=new g.Vector3,q=new g.Vector3;i.applyWorldAcceleration=e("acceleration"),i.applyWorldVelocity=e("velocity"),i.tick=function(a){var b,c,d=this.forces,e=this.acceleration,f=this.velocity,g=this.terminal,h=this.friction,i=l,r=k;q.multiplyScalar(0),i.x=i.y=i.z=r.x=r.y=r.z=0;for(var s=0;s<this.attractors.length;s++){var t=this.avatar.position.distanceToSquared(this.attractors[s]);p.copy(this.attractors[s]),p=this.avatar.worldToLocal(p),o.sub(p,this.avatar.position),o.divideScalar(o.length()*t),o.multiplyScalar(this.attractors[s].mass),q.addSelf(o)}this.resting.x?e.x=f.x=0:(e.x/=8*a,e.x+=q.x*a,e.x+=d.x*a,f.x+=e.x*a,f.x*=h.x,j(f.x)<g.x?i.x=f.x*a:0!==f.x&&(i.x=f.x/j(f.x)*g.x)),this.resting.y?e.y=f.y=0:(e.y/=8*a,e.y+=q.y*a,e.y+=d.y*a,f.y+=e.y*a,f.y*=h.y,j(f.y)<g.y?i.y=f.y*a:0!==f.y&&(i.y=f.y/j(f.y)*g.y)),this.resting.z?e.z=f.z=0:(e.z/=8*a,e.z+=q.z*a,e.z+=d.z*a,f.z+=e.z*a,f.z*=h.z,j(f.z)<g.z?i.z=f.z*a:0!==f.z&&(i.z=f.z/j(f.z)*g.z)),m.copy(this.avatar.position),this.avatar.translateX(i.x),this.avatar.translateY(i.y),this.avatar.translateZ(i.z),n.copy(this.avatar.position),this.avatar.position.copy(m),r.x=n.x-m.x,r.y=n.y-m.y,r.z=n.z-m.z,this.friction.x=this.friction.y=this.friction.z=this.default_friction,this.resting.x=this.resting.y=this.resting.z=!1,b=this.aabb(),c=this.collidables;for(var s=0,u=c.length;u>s;++s)c[s]!==this&&c[s].collide(this,b,r,this.resting);this.avatar.position.x+=r.x,this.avatar.position.y+=r.y,this.avatar.position.z+=r.z},i.subjectTo=function(a){return this.forces.x+=a[0],this.forces.y+=a[1],this.forces.z+=a[2],this},i.removeForce=function(a){return this.forces.x-=a[0],this.forces.y-=a[1],this.forces.z-=a[2],this},i.attractTo=function(a,b){a.mass=b,this.attractors.push(a)},i.aabb=function(){var a=this.avatar.position,b=this.dimensions;return f([a.x-b[0]/2,a.y,a.z-b[2]/2],this.dimensions)},i.collide=function(){},i.atRestX=function(){return this.resting.x},i.atRestY=function(){return this.resting.y},i.atRestZ=function(){return this.resting.z}},{"aabb-3d":5,three:199}],204:[function(a,b){"use strict";function c(a,b,c,d,e,f,g,h,i,j,k){for(var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=0,B=0,C=0,D=0,E=Math.floor;h>=A;){if(r=b+A*e,s=c+A*f,t=d+A*g,l=0|E(r),m=0|E(s),n=0|E(t),o=r-l,p=s-m,q=t-n,x=a.getBlock(l,m,n))return i&&(i[0]=k>o?+l:o>1-k?l+1-k:r,i[1]=k>p?+m:p>1-k?m+1-k:s,i[2]=k>q?+n:q>1-k?n+1-k:t),j&&(j[0]=B,j[1]=C,j[2]=D),x;if(z=+(k*(1+A)),A>z){if(u=0>B?z>=o:o>=1-z,v=0>C?z>=p:p>=1-z,w=0>D?z>=q:q>=1-z,u&&v&&w&&(x=a.getBlock(l+B,m+C,n)||a.getBlock(l,m+C,n+D)||a.getBlock(l+B,m,n+D)))return i&&(i[0]=0>B?l-k:l+1-k,i[1]=0>C?m-k:m+1-k,i[2]=0>D?n-k:n+1-k),j&&(j[0]=B,j[1]=C,j[2]=D),x;if(u&&(v||w)&&(x=a.getBlock(l+B,m,n)))return i&&(i[0]=0>B?l-k:l+1-k,i[1]=k>p?+m:s,i[2]=k>q?+n:t),j&&(j[0]=B,j[1]=C,j[2]=D),x;if(v&&(u||w)&&(x=a.getBlock(l,m+C,n)))return i&&(i[0]=k>o?+l:r,i[1]=0>C?m-k:m+1-k,i[2]=k>q?+n:t),j&&(j[0]=B,j[1]=C,j[2]=D),x;if(w&&(u||v)&&(x=a.getBlock(l,m,n+D)))return i&&(i[0]=k>o?+l:r,i[1]=k>p?+m:s,i[2]=0>D?n-k:n+1-k),j&&(j[0]=B,j[1]=C,j[2]=D),x}if(B=C=D=0,y=2,-k>e){var F=-o/e;B=1,y=F}if(e>k){var F=(1-o)/e;B=-1,y=F}if(-k>f){var F=-p/f;y-z>F?(B=0,C=1,y=F):y+z>F&&(C=1)}if(f>k){var F=(1-p)/f;y-z>F?(B=0,C=-1,y=F):y+z>F&&(C=-1)}if(-k>g){var F=-q/g;y-z>F?(B=C=0,D=1,y=F):y+z>F&&(D=1)}if(g>k){var F=(1-q)/g;y-z>F?(B=C=0,D=-1,y=F):y+z>F&&(D=-1)}y>h-A&&(y=h-A-z),z>y&&(y=z),A+=y}return i&&(i[0]=r,i[1]=s,i[2]=t),j&&(j[0]=j[1]=j[2]=0),0}function d(a,b,d,e,f,g,h){var i=+b[0],j=+b[1],k=+b[2],l=+d[0],m=+d[1],n=+d[2],o=Math.sqrt(l*l+m*m+n*n);return"undefined"==typeof h&&(h=1e-8),h>o?(f&&(f[0]=f[1]=f[2]),g&&(g[0]=g[1]=g[2]),0):(l/=o,m/=o,n/=o,e="undefined"==typeof e?64:+e,c(a,i,j,k,l,m,n,e,f,g,h))}b.exports=d},{}],205:[function(a,b){function c(a,b,c){function f(a){g=[Math.floor(a[0]/c),Math.floor(a[1]/c),Math.floor(a[2]/c)],(g[0]!==i[0]||g[1]!==i[1]||g[2]!==i[2])&&h.emit("change",g),i=g}var g,h=new e.EventEmitter,i=[0/0,0/0,0/0];return 2===arguments.length&&(c=b,b=d([-1/0,-1/0,-1/0],[1/0,1/0,1/0])),a.on("position",b,f),h}b.exports=c;var d=a("aabb-3d"),e=a("events")},{"aabb-3d":5,events:33}],206:[function(a,b){function c(a){if(!(this instanceof c))return new c(a||{});var b=this;this.game=a.game,delete a.game,this.THREE=this.game.THREE,this.materials=[],this.texturePath=a.texturePath||"/textures/",this.loading=0;var d=a.materialFlatColor===!0;delete a.materialFlatColor,this.options=g(a||{},{crossOrigin:"Anonymous",materialParams:g(a.materialParams||{},{ambient:12303291}),materialType:this.THREE.MeshLambertMaterial,applyTextureParams:function(a){a.magFilter=b.THREE.NearestFilter,a.minFilter=b.THREE.LinearMipMapLinearFilter}}),this.canvas="undefined"!=typeof document?document.createElement("canvas"):{},this.canvas.width=a.atlasWidth||512,this.canvas.height=a.atlasHeight||512,this.atlas=l(this.canvas),this.atlas.tilepad=!0,this._atlasuv=!1,this._atlaskey=!1,this.texture=new this.THREE.Texture(this.canvas),this.options.applyTextureParams(this.texture),d?this.material=new this.THREE.MeshBasicMaterial({vertexColors:this.THREE.VertexColors}):(this.material=new this.options.materialType(this.options.materialParams),this.material.map=this.texture,this.material.transparent=!0),this._meshQueue=[]}function d(a,b){if(0===b)return a;for(var c=[],d=(4-Math.ceil(b/90))%4,e=0;4>e;e++)c.push(a[d]),3===d?d=0:d++;return c}function e(a){var b=a.slice(0);return[b[3],b[2],b[1],b[0]]}function f(a){return-1!==String(a).indexOf(".")?a:a+".png"}function g(a){return[].slice.call(arguments,1).forEach(function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a}function h(a,b,c){var d=0;a.forEach(function(e){b(e,function(){d++,d>=a.length&&c()})})}function i(a){return"#"===a[0]&&(a=a.substr(1)),[parseInt(a.substr(0,2),16)/255,parseInt(a.substr(2,2),16)/255,parseInt(a.substr(4,2),16)/255]}function j(a){function b(){var c=b.cache,d=arguments[0];return hasOwnProperty.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}return b.cache={},b}var k=a("tic")(),l=a("atlaspack");b.exports=c,c.prototype.load=function(a,b){var c=this;Array.isArray(a)||(a=[a]),b=b||function(){},this.loading++;var d=a.map(c._expandName);c.materials=c.materials.concat(d);var e=Object.create(null);d.forEach(function(a){a.forEach(function(a){"#"!==a.slice(0,1)&&(e[a]=!0)})}),Object.keys(e).length>0?h(Object.keys(e),c.pack.bind(c),function(){c._afterLoading(),b(d)}):c._afterLoading()},c.prototype.pack=function(a,b){function c(a){var c=d.atlas.pack(a);c===!1&&(d.atlas=d.atlas.expand(a),d.atlas.tilepad=!0),b()}var d=this;if("string"==typeof a){var e=new Image;e.id=a,e.crossOrigin=d.options.crossOrigin,e.src=d.texturePath+f(a),e.onload=function(){c(e)},e.onerror=function(){console.error("Couldn't load URL ["+e.src+"]"),b()}}else c(a);return d},c.prototype.find=function(a){var b=this,c=0;return b.materials.forEach(function(b,d){return b.forEach(function(b){return b===a?(c=d+1,!1):void 0}),0!==c?!1:void 0}),c},c.prototype._expandName=function(a){return null===a?Array(6):a.top?[a.back,a.front,a.top,a.bottom,a.left,a.right]:(Array.isArray(a)||(a=[a]),1===a.length&&(a=[a[0],a[0],a[0],a[0],a[0],a[0]]),2===a.length&&(a=[a[1],a[1],a[0],a[0],a[1],a[1]]),3===a.length&&(a=[a[2],a[2],a[0],a[1],a[2],a[2]]),4===a.length&&(a=[a[2],a[2],a[0],a[1],a[3],a[3]]),a)},c.prototype._afterLoading=function(){function a(){b.loading--,b._atlasuv=b.atlas.uv(b.canvas.width,b.canvas.height),b._atlaskey=Object.create(null),b.atlas.index().forEach(function(a){b._atlaskey[a.name]=a}),b.texture.needsUpdate=!0,b.material.needsUpdate=!0,b._meshQueue.length>0&&b._meshQueue.forEach(function(a,c){b.paint.apply(a.self,a.args),delete b._meshQueue[c]})}var b=this;b._powerof2(function(){setTimeout(a,100)})},c.prototype._powerof2=function(a){function b(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,a++,a}var c=this.canvas.width,d=this.canvas.height;d>c&&(c=d);var e=this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height);this.canvas.width=this.canvas.height=b(c),this.canvas.getContext("2d").putImageData(e,0,0),a()},c.prototype.paint=function(a,b){var c=this;if(c.loading>0)return c._meshQueue.push({self:c,args:arguments}),!1;var f=b?!1:!0;f||(b=c._expandName(b)),a.geometry.faces.forEach(function(g,h){if(!(a.geometry.faceVertexUvs[0].length<1)){if(f){var i=Math.floor(255*g.color.b+255*g.color.g*255+255*g.color.r*255*255);b=c.materials[i-1],b||(b=c.materials[0])}var j=b[0]||"";if(1===g.normal.z?j=b[1]||"":1===g.normal.y?j=b[2]||"":-1===g.normal.y?j=b[3]||"":-1===g.normal.x?j=b[4]||"":1===g.normal.x&&(j=b[5]||""),"#"===j.slice(0,1))return c.setColor(a.geometry.faces[h],j),void 0;var k=c._atlasuv[j];if(k){f?((-1===g.normal.z||1===g.normal.x)&&(k=d(k,90)),k=e(k)):k=d(k,-90);for(var l=0;4>l;l++)a.geometry.faceVertexUvs[0][h][l].set(k[l][0],1-k[l][1])}}}),a.geometry.uvsNeedUpdate=!0},c.prototype.sprite=function(a,b,c,d){var e=this;"function"==typeof b&&(d=b,b=null),"function"==typeof c&&(d=c,c=null),b=b||16,c=c||b,e.loading++;var g=new Image;return g.src=e.texturePath+f(a),g.onerror=d,g.onload=function(){for(var f=[],i=0;i<g.width;i+=b)for(var j=0;j<g.height;j+=c){var k=document.createElement("canvas");k.width=b,k.height=c,k.name=a+"_"+i+"_"+j,k.getContext("2d").drawImage(g,i,j,b,c,0,0,b,c),f.push(k)}var l=[];h(f,function(a,b){var c=new Image;c.name=a.name,c.src=a.toDataURL(),c.onload=function(){e.pack(c,b)},c.onerror=b,l.push([c.name,c.name,c.name,c.name,c.name,c.name])},function(){e._afterLoading(),delete f,e.materials=e.materials.concat(l),d(l)})},e},c.prototype.animate=function(a,b,c){var d=this;if(c=c||1e3,!Array.isArray(b)||b.length<2)return!1;var e=0,f=new this.options.materialType(this.options.materialParams);return f.map=this.texture,f.transparent=!0,f.needsUpdate=!0,k.interval(function(){d.paint(a,b[e%b.length]),e++},c),f},c.prototype.tick=function(a){k.tick(a)},c.prototype.setColor=function(a,b){var c=i(b);a.color.setRGB(c[0],c[1],c[2]);var d=this._lightDark(b);a.vertexColors=1===a.normal.y?[d[0],d[0],d[0],d[0]]:-1===a.normal.y?[d[1],d[1],d[1],d[1]]:1===a.normal.x?[d[1],d[0],d[0],d[1]]:-1===a.normal.x?[d[1],d[1],d[0],d[0]]:1===a.normal.z?[d[1],d[1],d[0],d[0]]:[d[1],d[0],d[0],d[1]]},c.prototype._lightDark=j(function(a){var b=new this.THREE.Color(a),c=b.getHSL(),d=b.clone();return d.setHSL(c.h,c.s,c.l-.1),[b,d]})},{atlaspack:207,tic:200}],207:[function(a,b){function c(a,b,c,d){this.x=a,this.y=b,this.w=c,this.h=d}function d(a,b,d,e){1===arguments.length&&(this.canvas=a,a=b=0,d=this.canvas.width,e=this.canvas.height),2===arguments.length&&(d=a,e=b,a=b=0),this.left=this.right=null,this.rect=new c(a,b,d,e),this.filled=!1,this.tilepad=!1,this._cache=[],this._uvcache=Object.create(null)}c.prototype.fitsIn=function(a){return a.w>=this.w&&a.h>=this.h},c.prototype.sameSizeAs=function(a){return this.w===a.w&&this.h===a.h},b.exports=function(){return 1===arguments.length?new d(arguments[0]):2===arguments.length?new d(arguments[0],arguments[1]):new d(arguments[0],arguments[1],arguments[2],arguments[3])},b.exports.Atlas=d,b.exports.Rect=c,d.prototype.pack=function(a){return this._cache=[],this._uvcache=[],a=this._toRect(a),this.img&&this.tilepad&&(a=this._tilepad(a)),null!==this.left?this._ontoCanvas(this.left.pack(a)||this.right.pack(a)):this.filled||!a.fitsIn(this.rect)?!1:a.sameSizeAs(this.rect)?(this.filled=!0,this._ontoCanvas(this)):(this.rect.w-a.w>this.rect.h-a.h?(this.left=new d(this.rect.x,this.rect.y,a.w,this.rect.h),this.right=new d(this.rect.x+a.w,this.rect.y,this.rect.w-a.w,this.rect.h)):(this.left=new d(this.rect.x,this.rect.y,this.rect.w,a.h),this.right=new d(this.rect.x,this.rect.y+a.h,this.rect.w,this.rect.h-a.h)),this._ontoCanvas(this.left.pack(a)))},d.prototype.expand=function(a){var b=this;a=this._toRect(a),this.img&&this.tilepad&&(a=this._tilepad(a));var c;if(this.rect.w<this.rect.h?(c=new d(0,0,this.rect.w+a.w,this.rect.h),c.right=new d(this.rect.w,0,a.w,this.rect.h),c.left=this):(c=new d(0,0,this.rect.w,this.rect.h+a.h),c.right=new d(0,this.rect.h,this.rect.w,a.h),c.left=this),["canvas","context","img"].forEach(function(a){b[a]&&(c[a]=b[a],b[a]=null)}),c.canvas){c.context||(c.context=c.canvas.getContext("2d"));var e=c.context.getImageData(0,0,c.canvas.width,c.canvas.height);c.canvas.width=c.rect.w,c.canvas.height=c.rect.h,c.context.putImageData(e,0,0)}return c.pack(a)===!1?c.expand(a):c},d.prototype.index=function(){var a=this;return a._cache.length>0?a._cache:(function b(c){null!==c.left?(b(c.left),b(c.right)):c.rect.name&&a._cache.push(c.rect)}(a),a._cache)},d.prototype.uv=function(a,b){var c=this;if(c._uvcache.length>0)return c._uvcache;a=a||c.rect.w,b=b||c.rect.h;var d=this.tilepad;return function e(f){if(null!==f.left)e(f.left),e(f.right);else if("undefined"!=typeof f.rect.name){var g=d?f.rect.w/4:0;c._uvcache[f.rect.name]=[[f.rect.x+g,f.rect.y+g],[f.rect.x+g+(f.rect.w-2*g),f.rect.y+g],[f.rect.x+g+(f.rect.w-2*g),f.rect.y+g+(f.rect.h-2*g)],[f.rect.x+g,f.rect.y+g+(f.rect.h-2*g)]].map(function(c){return 0!==c[0]&&(c[0]=c[0]/a),0!==c[1]&&(c[1]=c[1]/b),c})}}(c),c._uvcache},d.prototype.json=function(a){var b=this;return a?("string"==typeof a&&(a=JSON.parse(a)),function c(a){if(a&&a.rect){var b=new d(a.rect.x,a.rect.y,a.rect.w,a.rect.h);return a.left&&(b.left=c(a.left)),a.right&&(b.right=c(a.right)),b}}(a)):JSON.stringify(function e(a){var b={left:null,right:null,rect:a.rect,filled:a.filled};return null!==a.left&&(b.left=e(a.left),b.right=e(a.right)),b}(b),null,2)},d.prototype._tilepad=function(a){var b=this.img;if(!b)return a;var d=b.width/2,e=document.createElement("canvas");e.name=b.name||b.src,e.id=b.id||"",e.width=b.width+b.width,e.height=b.height+b.height;var f=e.getContext("2d"),g=f.createPattern(b,"repeat");return f.fillStyle=g,f.translate(d,d),f.fillRect(-d,-d,e.width+d,e.height+d),f.translate(-d,-d),this.img=e,new c(a.x,a.y,this.img.width,this.img.height)},d.prototype._ontoCanvas=function(a){return a&&this.img&&this.canvas&&(this.context||(this.context=this.canvas.getContext("2d")),this.context.clearRect(a.rect.x,a.rect.y,a.rect.w,a.rect.h),this.context.drawImage(this.img,a.rect.x,a.rect.y,a.rect.w,a.rect.h),a.rect.name=this.img.id||this.img.name||this.img.src||null),a},d.prototype._toRect=function(a){return a.nodeName&&"IMG"===a.nodeName&&(this.img=a,a=new c(a.x,a.y,a.width,a.height)),a instanceof c||(a=new c(a.x||0,a.y||0,a.w||a.width,a.h||a.height)),a},d.prototype._debug=function(){if(this.canvas){var a=this.canvas.getContext("2d");this.index().forEach(function(b){a.lineWidth=1,a.strokeStyle="red",a.strokeRect(b.x,b.y,b.w,b.h)})}}},{}],208:[function(a,b){function c(a,b){d=a,this.fov=b.fov||60,this.width=b.width||512,this.height=b.height||512,this.aspectRatio=b.aspectRatio||this.width/this.height,this.nearPlane=b.nearPlane||1,this.farPlane=b.farPlane||1e4,this.skyColor=b.skyColor||12571109,this.ortho=b.ortho,this.camera=this.ortho?new d.OrthographicCamera(this.width/-2,this.width/2,this.height/2,this.height/-2,this.nearPlane,this.farPlane):new d.PerspectiveCamera(this.fov,this.aspectRatio,this.nearPlane,this.farPlane),this.camera.lookAt(new d.Vector3(0,0,0)),g.browser&&(this.createRenderer(),this.element=this.renderer.domElement)}var d,e,f,g=a("__browserify_process");b.exports=function(a,b){return e=new a.Vector3,f=new a.Vector3,new c(a,b)},c.prototype.createRenderer=function(){this.renderer=new d.WebGLRenderer({antialias:!0}),this.renderer.setSize(this.width,this.height),this.renderer.setClearColorHex(this.skyColor,1),this.renderer.clear()},c.prototype.bindToScene=function(a){a.add(this.camera)},c.prototype.getCamera=function(){return this.camera},c.prototype.cameraPosition=function(){return e.multiplyScalar(0),e.applyMatrix4(this.camera.matrixWorld),[e.x,e.y,e.z]},c.prototype.cameraVector=function(){return f.multiplyScalar(0),f.z=-1,this.camera.matrixWorld.rotateAxis(f),[f.x,f.y,f.z]},c.prototype.resizeWindow=function(a,b){this.element.parentElement&&(a=a||this.element.parentElement.clientWidth,b=b||this.element.parentElement.clientHeight),this.camera.aspect=this.aspectRatio=a/b,this.width=a,this.height=b,this.camera.updateProjectionMatrix(),this.renderer.setSize(a,b)},c.prototype.render=function(a){this.renderer.render(a,this.camera)},c.prototype.appendTo=function(a){"object"==typeof a?a.appendChild(this.element):document.querySelector(a).appendChild(this.element),this.resizeWindow(this.width,this.height)}},{__browserify_process:40}],209:[function(a,b){function c(a,b,c){return"object"==typeof a&&Array.isArray(a)?{x:a[0],y:a[1],z:a[2]}:"object"==typeof a?{x:a.x||0,y:a.y||0,z:a.z||0}:{x:Number(a),y:Number(b),z:Number(c)}}var d=a("minecraft-skin");b.exports=function(a){var b;return function(e,f){f||(f={}),f.scale=f.scale||new a.THREE.Vector3(.04,.04,.04);var g=d(a.THREE,e,f),h=g.mesh,i=a.makePhysical(h);i.playerSkin=g,h.position.set(0,562,-20),a.scene.add(h),a.addItem(i),i.yaw=h,i.pitch=h.head,i.subjectTo(a.gravity),i.blocksCreation=!0,a.control(i),i.move=function(a,b,d){var e=c(a,b,d);i.yaw.position.x+=e.x,i.yaw.position.y+=e.y,i.yaw.position.z+=e.z},i.moveTo=function(a,b,d){var e=c(a,b,d);i.yaw.position.x=e.x,i.yaw.position.y=e.y,i.yaw.position.z=e.z};var j=1;return i.pov=function(a){"first"===a||1===a?j=1:("third"===a||3===a)&&(j=3),i.possess()},i.toggle=function(){i.pov(1===j?3:1)},i.possess=function(){b&&b.remove(a.camera);var c=1===j?"cameraInside":"cameraOutside";h[c].add(a.camera),b=h[c]},i.position=i.yaw.position,i}}},{"minecraft-skin":162}],210:[function(a,b){function c(){return d[~~(Math.random()*d.length)]}var d=["alpha","space","beta","omega","zone","base","bass","centaur","official","free","fresh","freedom","power","synth","lazer","gamma","red","green","ultra","net","cafe","secret","open","track","wisdom","genghis","tron","grid","plus","maximum","pre","post","mid","pyramid","core","fast","dragon","wizard","yak","crystal","electric","rizzle","tiny","pantry","dry","bleeding","fruit","mower","whiskey","marble","cake","meat","donkey","wewo","banana","rooster","bear","bacon","moon","glitter","grandma","walrus","party","junk","crazy","turbo","hyper","mega","boss","dunk","pow","icy","bobo","pile","tater","wiz","gnarl","mix","pop","mustard","bizzler","fog","punch","planar"];b.exports=function(a){a=a||2;for(var b="";a>0;)b+=c(),a--;return b}},{}],211:[function(a,b){function c(a,b){if(!(this instanceof c))return new c(a,b);this.game=a,b=b||{};var d=this.geometry=b.geometry||new a.THREE.CubeGeometry(1,1,1),e=b.material||new a.THREE.MeshBasicMaterial({color:b.color||0,wireframe:!0,wireframeLinewidth:b.wireframeLinewidth||3,transparent:!0,opacity:b.wireframeOpacity||.5});this.mesh=new a.THREE.Mesh(d,e),this.distance=b.distance||10,this.currVoxelPos,this.currVoxelAdj,this.targetPosition,this.adjacentActive=b.adjacentActive||function(){return a.controls.state.alt},this.selectActive=b.selectActive||function(){return a.controls.state.select},this.animate=b.animate,this.animateFunction=b.animateFunction||function(a,b,c){if(a&&b&&c){var d=10;return Math.abs(b[0]-a[0])<.05&&Math.abs(b[1]-a[1])<.05&&Math.abs(b[2]-a[2])<.05?b:(c/=1e3,a[0]+=d*c*(b[0]-a[0]),a[1]+=d*c*(b[1]-a[1]),a[2]+=d*c*(b[2]-a[2]),a)}};var g=this;this.animate&&a.on("tick",function(a){var b=[g.mesh.position.x,g.mesh.position.y,g.mesh.position.z];b=g.animateFunction(b,g.targetPosition,a),b&&g.mesh.position.set(b[0],b[1],b[2])}),a.on("tick",f.throttle(this.highlight.bind(this),b.frequency||100)),this.selectStart,this.selectEnd}var d=a("inherits"),e=a("events"),f=a("underscore");b.exports=c,d(c,e.EventEmitter),c.prototype.highlight=function(){var a,b=this.game.cameraPosition(),c=this.game.cameraVector(),d=this.game.raycastVoxels(b,c,this.distance),e=function(a){a.currVoxelAdj&&(a.emit("remove-adjacent",a.currVoxelAdj),a.currVoxelAdj=void 0)};if(!d){if(!this.currVoxelPos)return;return this.game.scene.remove(this.mesh),this.emit("remove",this.currVoxelPos.slice()),this.currVoxelPos=void 0,e(this),void 0}var f=d.voxel;if(this.currVoxelPos&&f[0]===this.currVoxelPos[0]&&f[1]===this.currVoxelPos[1]&&f[2]===this.currVoxelPos[2]||(this.currVoxelPos?this.emit("remove",this.currVoxelPos.slice()):this.game.scene.add(this.mesh),this.emit("highlight",f.slice()),this.currVoxelPos=f.slice()),a=[this.currVoxelPos[0]+.5,this.currVoxelPos[1]+.5,this.currVoxelPos[2]+.5],this.adjacentActive()){var g=d.adjacent;this.currVoxelAdj&&g[0]===this.currVoxelAdj[0]&&g[1]===this.currVoxelAdj[1]&&g[2]===this.currVoxelAdj[2]||(this.currVoxelAdj&&this.emit("remove-adjacent",this.currVoxelAdj.slice()),this.emit("highlight-adjacent",g.slice()),this.currVoxelAdj=g.slice()),a=[this.currVoxelAdj[0]+.5,this.currVoxelAdj[1]+.5,this.currVoxelAdj[2]+.5]}else e(this);if(this.selectActive())if(this.selectStart){var h=this.currVoxelAdj||this.currVoxelPos;if(h[0]!==this.selectEnd[0]||h[1]!==this.selectEnd[1]||h[2]!==this.selectEnd[2]){this.selectEnd=h,this.emit("highlight-select",{start:this.selectStart.slice(),end:this.selectEnd.slice()});var i=[];i[0]=Math.abs(this.selectEnd[0]-this.selectStart[0])+1,i[1]=Math.abs(this.selectEnd[1]-this.selectStart[1])+1,i[2]=Math.abs(this.selectEnd[2]-this.selectStart[2])+1,this.mesh.scale.set(i[0],i[1],i[2]);var j=[];j[0]=this.selectStart[0]+.5+(this.selectEnd[0]-this.selectStart[0])/2,j[1]=this.selectStart[1]+.5+(this.selectEnd[1]-this.selectStart[1])/2,j[2]=this.selectStart[2]+.5+(this.selectEnd[2]-this.selectStart[2])/2,this.targetPosition=j}}else this.selectStart=this.selectEnd=this.currVoxelAdj||this.currVoxelPos;else this.selectStart&&(this.emit("highlight-deselect",{start:this.selectStart.slice(),end:this.selectEnd.slice()}),this.selectStart=null,this.mesh.scale.set(1,1,1)),this.targetPosition=a;this.animate||this.mesh.position.set(this.targetPosition[0],this.targetPosition[1],this.targetPosition[2])}},{events:33,inherits:212,underscore:213}],212:[function(a,b){b.exports=a(66)},{}],213:[function(a,b,c){(function(){var a=this,d=a._,e={},f=Array.prototype,g=Object.prototype,h=Function.prototype,i=f.push,j=f.slice,k=f.concat,l=g.toString,m=g.hasOwnProperty,n=f.forEach,o=f.map,p=f.reduce,q=f.reduceRight,r=f.filter,s=f.every,t=f.some,u=f.indexOf,v=f.lastIndexOf,w=Array.isArray,x=Object.keys,y=h.bind,z=function(a){return a instanceof z?a:this instanceof z?(this._wrapped=a,void 0):new z(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=z),c._=z):a._=z,z.VERSION="1.4.4";var A=z.each=z.forEach=function(a,b,c){if(null!=a)if(n&&a.forEach===n)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,f=a.length;f>d;d++)if(b.call(c,a[d],d,a)===e)return}else for(var g in a)if(z.has(a,g)&&b.call(c,a[g],g,a)===e)return};z.map=z.collect=function(a,b,c){var d=[];return null==a?d:o&&a.map===o?a.map(b,c):(A(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var B="Reduce of empty array with no initial value";z.reduce=z.foldl=z.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),p&&a.reduce===p)return d&&(b=z.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(A(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(B);return c},z.reduceRight=z.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),q&&a.reduceRight===q)return d&&(b=z.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=z.keys(a);f=g.length}if(A(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(B);return c},z.find=z.detect=function(a,b,c){var d;return C(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},z.filter=z.select=function(a,b,c){var d=[];return null==a?d:r&&a.filter===r?a.filter(b,c):(A(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},z.reject=function(a,b,c){return z.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},z.every=z.all=function(a,b,c){b||(b=z.identity);var d=!0;return null==a?d:s&&a.every===s?a.every(b,c):(A(a,function(a,f,g){return(d=d&&b.call(c,a,f,g))?void 0:e}),!!d)};var C=z.some=z.any=function(a,b,c){b||(b=z.identity);var d=!1;return null==a?d:t&&a.some===t?a.some(b,c):(A(a,function(a,f,g){return d||(d=b.call(c,a,f,g))?e:void 0}),!!d)};z.contains=z.include=function(a,b){return null==a?!1:u&&a.indexOf===u?-1!=a.indexOf(b):C(a,function(a){return a===b})},z.invoke=function(a,b){var c=j.call(arguments,2),d=z.isFunction(b);return z.map(a,function(a){return(d?b:a[b]).apply(a,c)})},z.pluck=function(a,b){return z.map(a,function(a){return a[b]})},z.where=function(a,b,c){return z.isEmpty(b)?c?null:[]:z[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},z.findWhere=function(a,b){return z.where(a,b,!0)},z.max=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&z.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return A(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},z.min=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&z.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return A(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},z.shuffle=function(a){var b,c=0,d=[];return A(a,function(a){b=z.random(c++),d[c-1]=d[b],d[b]=a}),d};var D=function(a){return z.isFunction(a)?a:function(b){return b[a]}};z.sortBy=function(a,b,c){var d=D(b);return z.pluck(z.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var E=function(a,b,c,d){var e={},f=D(b||z.identity);return A(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};z.groupBy=function(a,b,c){return E(a,b,c,function(a,b,c){(z.has(a,b)?a[b]:a[b]=[]).push(c)})},z.countBy=function(a,b,c){return E(a,b,c,function(a,b){z.has(a,b)||(a[b]=0),a[b]++})},z.sortedIndex=function(a,b,c,d){c=null==c?z.identity:D(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},z.toArray=function(a){return a?z.isArray(a)?j.call(a):a.length===+a.length?z.map(a,z.identity):z.values(a):[]},z.size=function(a){return null==a?0:a.length===+a.length?a.length:z.keys(a).length},z.first=z.head=z.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:j.call(a,0,b)},z.initial=function(a,b,c){return j.call(a,0,a.length-(null==b||c?1:b))},z.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:j.call(a,Math.max(a.length-b,0))},z.rest=z.tail=z.drop=function(a,b,c){return j.call(a,null==b||c?1:b)},z.compact=function(a){return z.filter(a,z.identity)};var F=function(a,b,c){return A(a,function(a){z.isArray(a)?b?i.apply(c,a):F(a,b,c):c.push(a)}),c};z.flatten=function(a,b){return F(a,b,[])},z.without=function(a){return z.difference(a,j.call(arguments,1))},z.uniq=z.unique=function(a,b,c,d){z.isFunction(b)&&(d=c,c=b,b=!1);var e=c?z.map(a,c,d):a,f=[],g=[];return A(e,function(c,d){(b?d&&g[g.length-1]===c:z.contains(g,c))||(g.push(c),f.push(a[d]))}),f},z.union=function(){return z.uniq(k.apply(f,arguments))},z.intersection=function(a){var b=j.call(arguments,1);return z.filter(z.uniq(a),function(a){return z.every(b,function(b){return z.indexOf(b,a)>=0})})},z.difference=function(a){var b=k.apply(f,j.call(arguments,1));return z.filter(a,function(a){return!z.contains(b,a)})},z.zip=function(){for(var a=j.call(arguments),b=z.max(z.pluck(a,"length")),c=new Array(b),d=0;b>d;d++)c[d]=z.pluck(a,""+d);return c},z.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},z.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=z.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(u&&a.indexOf===u)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},z.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(v&&a.lastIndexOf===v)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},z.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f},z.bind=function(a,b){if(a.bind===y&&y)return y.apply(a,j.call(arguments,1));var c=j.call(arguments,2);return function(){return a.apply(b,c.concat(j.call(arguments)))}},z.partial=function(a){var b=j.call(arguments,1);return function(){return a.apply(this,b.concat(j.call(arguments)))}},z.bindAll=function(a){var b=j.call(arguments,1);return 0===b.length&&(b=z.functions(a)),A(b,function(b){a[b]=z.bind(a[b],a)}),a},z.memoize=function(a,b){var c={};return b||(b=z.identity),function(){var d=b.apply(this,arguments);return z.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},z.delay=function(a,b){var c=j.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},z.defer=function(a){return z.delay.apply(z,[a,1].concat(j.call(arguments,1)))},z.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},z.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e
}},z.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},z.wrap=function(a,b){return function(){var c=[a];return i.apply(c,arguments),b.apply(this,c)}},z.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},z.after=function(a,b){return 0>=a?b():function(){return--a<1?b.apply(this,arguments):void 0}},z.keys=x||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)z.has(a,c)&&(b[b.length]=c);return b},z.values=function(a){var b=[];for(var c in a)z.has(a,c)&&b.push(a[c]);return b},z.pairs=function(a){var b=[];for(var c in a)z.has(a,c)&&b.push([c,a[c]]);return b},z.invert=function(a){var b={};for(var c in a)z.has(a,c)&&(b[a[c]]=c);return b},z.functions=z.methods=function(a){var b=[];for(var c in a)z.isFunction(a[c])&&b.push(c);return b.sort()},z.extend=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},z.pick=function(a){var b={},c=k.apply(f,j.call(arguments,1));return A(c,function(c){c in a&&(b[c]=a[c])}),b},z.omit=function(a){var b={},c=k.apply(f,j.call(arguments,1));for(var d in a)z.contains(c,d)||(b[d]=a[d]);return b},z.defaults=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a},z.clone=function(a){return z.isObject(a)?z.isArray(a)?a.slice():z.extend({},a):a},z.tap=function(a,b){return b(a),a};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof z&&(a=a._wrapped),b instanceof z&&(b=b._wrapped);var e=l.call(a);if(e!=l.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=G(a[g],b[g],c,d)););}else{var i=a.constructor,j=b.constructor;if(i!==j&&!(z.isFunction(i)&&i instanceof i&&z.isFunction(j)&&j instanceof j))return!1;for(var k in a)if(z.has(a,k)&&(g++,!(h=z.has(b,k)&&G(a[k],b[k],c,d))))break;if(h){for(k in b)if(z.has(b,k)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};z.isEqual=function(a,b){return G(a,b,[],[])},z.isEmpty=function(a){if(null==a)return!0;if(z.isArray(a)||z.isString(a))return 0===a.length;for(var b in a)if(z.has(a,b))return!1;return!0},z.isElement=function(a){return!(!a||1!==a.nodeType)},z.isArray=w||function(a){return"[object Array]"==l.call(a)},z.isObject=function(a){return a===Object(a)},A(["Arguments","Function","String","Number","Date","RegExp"],function(a){z["is"+a]=function(b){return l.call(b)=="[object "+a+"]"}}),z.isArguments(arguments)||(z.isArguments=function(a){return!(!a||!z.has(a,"callee"))}),"function"!=typeof/./&&(z.isFunction=function(a){return"function"==typeof a}),z.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},z.isNaN=function(a){return z.isNumber(a)&&a!=+a},z.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==l.call(a)},z.isNull=function(a){return null===a},z.isUndefined=function(a){return void 0===a},z.has=function(a,b){return m.call(a,b)},z.noConflict=function(){return a._=d,this},z.identity=function(a){return a},z.times=function(a,b,c){for(var d=Array(a),e=0;a>e;e++)d[e]=b.call(c,e);return d},z.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var H={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};H.unescape=z.invert(H.escape);var I={escape:new RegExp("["+z.keys(H.escape).join("")+"]","g"),unescape:new RegExp("("+z.keys(H.unescape).join("|")+")","g")};z.each(["escape","unescape"],function(a){z[a]=function(b){return null==b?"":(""+b).replace(I[a],function(b){return H[a][b]})}}),z.result=function(a,b){if(null==a)return null;var c=a[b];return z.isFunction(c)?c.call(a):c},z.mixin=function(a){A(z.functions(a),function(b){var c=z[b]=a[b];z.prototype[b]=function(){var a=[this._wrapped];return i.apply(a,arguments),N.call(this,c.apply(z,a))}})};var J=0;z.uniqueId=function(a){var b=++J+"";return a?a+b:b},z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;z.template=function(a,b,c){var d;c=z.defaults({},c,z.templateSettings);var e=new RegExp([(c.escape||K).source,(c.interpolate||K).source,(c.evaluate||K).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(M,function(a){return"\\"+L[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,z);var i=function(a){return d.call(this,a,z)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},z.chain=function(a){return z(a).chain()};var N=function(a){return this._chain?z(a).chain():a};z.mixin(z),A(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=f[a];z.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],N.call(this,c)}}),A(["concat","join","slice"],function(a){var b=f[a];z.prototype[a]=function(){return N.call(this,b.apply(this._wrapped,arguments))}}),z.extend(z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}],214:[function(a,b){function c(a){return this instanceof c?(this.db=a,!0):new c(a)}var d=(a("level-js"),a("voxel-crunch"));b.exports=c,c.prototype.load=function(a,b,c,e){var f=c[0]*c[1]*c[2],g=b.join("|")+"|"+f;this.db.sublevel(a).get(g,{valueEncoding:"binary"},function(a,g){if(a)return e(a);var h=new Uint8Array(f);d.decode(g,h),e(!1,{position:b,voxels:h,dimensions:c})})},c.prototype.store=function(a,b,c){var e=d.encode(b.voxels),f=b.position.join("|");return f+="|"+b.voxels.length,80===e.length?c("empty chunk",e.length):(this.db.sublevel(a).put(f,e,{valueEncoding:"binary"},function(a){c(a,e.length)}),void 0)}},{"level-js":215,"voxel-crunch":222}],215:[function(a,b,c){arguments[4][73][0].apply(c,arguments)},{"./iterator":216,"abstract-leveldown":219,"idb-wrapper":220,isbuffer:221,util:59}],216:[function(a,b,c){arguments[4][74][0].apply(c,arguments)},{"abstract-leveldown":219,util:59}],217:[function(a,b){b.exports=a(75)},{__browserify_process:40}],218:[function(a,b){b.exports=a(76)},{__browserify_process:40}],219:[function(a,b){b.exports=a(77)},{"./abstract-chained-batch":217,"./abstract-iterator":218,__browserify_Buffer:39,__browserify_process:40}],220:[function(a,b){b.exports=a(78)},{}],221:[function(a,b){b.exports=a(79)},{buffer:41}],222:[function(a,b,c){function d(a){for(var b,c,d=0,e=a.length,f=0;f<a.length;){for(b=a[f],c=0;e>f&&a[f]===b;)++f,++c;d+=g.log2(c)/7|0,d+=g.log2(b>>>0)/7|0,d+=2}return d}function e(a,b){b||(b=new Uint8Array(d(a)));for(var c,e,f=0,g=b.length,h=0;h<a.length;){for(c=a[h],e=0;h<a.length&&a[h]===c;)++h,++e;for(;g>f&&e>=128;)b[f++]=128+(127&e),e>>>=7;if(f>=g)throw new Error("RLE buffer overflow");for(b[f++]=e,c>>>=0;g>f&&c>=128;)b[f++]=128+(127&c),c>>>=7;if(f>=g)throw new Error("RLE buffer overflow");b[f++]=c}return b}function f(a,b){for(var c,d,e,f,g=b.length,h=a.length,i=0,j=0;h>j;){for(c=0,d=0;h>j&&a[j]>=128;)c+=(127&a[j++])<<d,d+=7;if(c+=a[j++]<<d,j>=h)throw new Error("RLE buffer underrun");if(i+c>g)throw new Error("Chunk buffer overflow");for(e=0,d=0;h>j&&a[j]>=128;)e+=(127&a[j++])<<d,d+=7;if(j>=h)throw new Error("RLE buffer underrun");for(e+=a[j++]<<d,f=0;c>f;++f)b[i++]=e}return b}var g=a("bit-twiddle");c.size=d,c.encode=e,c.decode=f},{"bit-twiddle":223}],223:[function(a,b,c){"use strict";"use restrict";function d(a){var b=32;return a&=-a,a&&b--,65535&a&&(b-=16),16711935&a&&(b-=8),252645135&a&&(b-=4),858993459&a&&(b-=2),1431655765&a&&(b-=1),b}var e=32;c.INT_BITS=e,c.INT_MAX=2147483647,c.INT_MIN=-1<<e-1,c.sign=function(a){return(a>0)-(0>a)},c.abs=function(a){var b=a>>e-1;return(a^b)-b},c.min=function(a,b){return b^(a^b)&-(b>a)},c.max=function(a,b){return a^(a^b)&-(b>a)},c.isPow2=function(a){return!(a&a-1||!a)},c.log2=function(a){var b,c;return b=(a>65535)<<4,a>>>=b,c=(a>255)<<3,a>>>=c,b|=c,c=(a>15)<<2,a>>>=c,b|=c,c=(a>3)<<1,a>>>=c,b|=c,b|a>>1},c.log10=function(a){return a>=1e9?9:a>=1e8?8:a>=1e7?7:a>=1e6?6:a>=1e5?5:a>=1e4?4:a>=1e3?3:a>=100?2:a>=10?1:0},c.popCount=function(a){return a-=a>>>1&1431655765,a=(858993459&a)+(a>>>2&858993459),16843009*(a+(a>>>4)&252645135)>>>24},c.countTrailingZeros=d,c.nextPow2=function(a){return a+=0===a,--a,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a+1},c.prevPow2=function(a){return a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a-(a>>>1)},c.parity=function(a){return a^=a>>>16,a^=a>>>8,a^=a>>>4,a&=15,27030>>>a&1};var f=new Array(256);!function(a){for(var b=0;256>b;++b){var c=b,d=b,e=7;for(c>>>=1;c;c>>>=1)d<<=1,d|=1&c,--e;a[b]=d<<e&255}}(f),c.reverse=function(a){return f[255&a]<<24|f[a>>>8&255]<<16|f[a>>>16&255]<<8|f[a>>>24&255]},c.interleave2=function(a,b){return a&=65535,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),b&=65535,b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),a|b<<1},c.deinterleave2=function(a,b){return a=a>>>b&1431655765,a=858993459&(a|a>>>1),a=252645135&(a|a>>>2),a=16711935&(a|a>>>4),a=65535&(a|a>>>16),a<<16>>16},c.interleave3=function(a,b,c){return a&=1023,a=4278190335&(a|a<<16),a=251719695&(a|a<<8),a=3272356035&(a|a<<4),a=1227133513&(a|a<<2),b&=1023,b=4278190335&(b|b<<16),b=251719695&(b|b<<8),b=3272356035&(b|b<<4),b=1227133513&(b|b<<2),a|=b<<1,c&=1023,c=4278190335&(c|c<<16),c=251719695&(c|c<<8),c=3272356035&(c|c<<4),c=1227133513&(c|c<<2),a|c<<2},c.deinterleave3=function(a,b){return a=a>>>b&1227133513,a=3272356035&(a|a>>>2),a=251719695&(a|a>>>4),a=4278190335&(a|a>>>8),a=1023&(a|a>>>16),a<<22>>22},c.nextCombination=function(a){var b=a|a-1;return b+1|(~b&-~b)-1>>>d(a)+1}},{}],224:[function(a,b){function c(a,b){b||(b={}),this.opts=b,this.game=a,this.game.on("tick",f.throttle(this.checkPosition.bind(this),this.opts.frequency||h));var c=this.opts.startingPosition||this.game.startingPosition;this.position=c;var d=b.fudgeFactor||5,e=b.groundMinimum||-20;this.rescueBB=g([c[0]+d,c[1]+d,c[2]+d],[e,c[2]-d])}var d=a("inherits"),e=a("events"),f=a("lodash"),g=a("aabb-3d");b.exports=function(a,b){return new c(a,b)};var h=500,i={lower:{x:-1/0,y:-1/0,z:-1/0},upper:{x:1/0,y:-200,z:1/0}};d(c,e.EventEmitter),c.prototype.checkPosition=function(){var a=this.opts.dangerZone||i,b=this.game.controls._target.position;b.x<a.upper.x&&b.y<a.upper.y&&b.z<a.upper.z&&b.x>a.lower.x&&b.y>a.lower.y&&b.z>a.lower.z&&this.rescue(b.clone())},c.prototype.rescue=function(){console.log("It's true! teleporting to : "+JSON.stringify(this.opts.startingPosition||this.game.startingPosition));var a=this.game.controls.target();a.position.x=this.position[0],a.position.y=this.position[1],a.position.z=this.position[2],a.velocity.x=0,a.velocity.y=0,a.velocity.z=0,this.game.spatial.emit("Respawning",this.rescueBB),this.game.spatial.emit("Reloading level",g([1/0,1/0,1/0],[-1/0,-1/0,-1/0]))}},{"aabb-3d":5,events:33,inherits:225,lodash:226}],225:[function(a,b){b.exports=a(66)},{}],226:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};(function(){function a(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}function e(b,c){var d=typeof c;if(b=b.cache,"boolean"==d||null==c)return b[c]?0:-1;"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:u+c;return b=(b=b[d])&&b[e],"object"==d?b&&a(b,c)>-1?0:-1:b?0:-1}function f(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:u+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a):e[d]=!0}}function g(a){return a.charCodeAt(0)}function h(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||"undefined"==typeof c)return 1;if(d>c||"undefined"==typeof d)return-1}return a.index-b.index}function i(a){var b=-1,c=a.length,d=a[0],e=a[c-1];if(d&&"object"==typeof d&&e&&"object"==typeof e)return!1;var g=l();g["false"]=g["null"]=g["true"]=g.undefined=!1;var h=l();for(h.array=a,h.cache=g,h.push=f;++b<c;)h.push(a[b]);return h}function j(a){return"\\"+W[a]}function k(){return r.pop()||[]}function l(){return s.pop()||{array:null,cache:null,configurable:!1,criteria:null,enumerable:!1,"false":!1,index:0,leading:!1,maxWait:0,"null":!1,number:null,object:null,push:null,string:null,trailing:!1,"true":!1,undefined:!1,value:null,writable:!1}}function m(a){a.length=0,r.length<w&&r.push(a)}function n(a){var b=a.cache;b&&n(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,s.length<w&&s.push(a)}function o(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function p(b){function c(a){return a&&"object"==typeof a&&!Ud(a)&&vd.call(a,"__wrapped__")?a:new d(a)}function d(a,b){this.__chain__=!!b,this.__wrapped__=a}function f(a,b,c,d,e){var g=a;if(c){if(g=c(g),"undefined"!=typeof g)return g;g=a}var h=xb(g);if(h){var i=Bd.call(g);if(!U[i])return g;var j=Ud(g)}if(!h||!b)return h?j?o(g):_d({},g):g;var l=Rd[i];switch(i){case N:case O:return new l(+g);case Q:case T:return new l(g);case S:return l(g.source,C.exec(g))}var n=!d;d||(d=k()),e||(e=k());for(var p=d.length;p--;)if(d[p]==a)return e[p];return g=j?l(g.length):{},j&&(vd.call(a,"index")&&(g.index=a.index),vd.call(a,"input")&&(g.input=a.input)),d.push(a),e.push(g),(j?Qb:ce)(a,function(a,h){g[h]=f(a,b,c,d,e)}),n&&(m(d),m(e)),g}function r(a,b,c){if("function"!=typeof a)return Qc;if("undefined"==typeof b)return a;var d=a.__bindData__||Sd.funcNames&&!a.name;if("undefined"==typeof d){var e=H&&td.call(a);Sd.funcNames||!e||D.test(e)||(d=!0),(Sd.funcNames||!d)&&(d=!H||H.test(e),Td(a,d))}if(d!==!0&&d&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Ac(a,b)}function s(a,b,c,d){for(var e=(d||0)-1,f=a?a.length:0,g=[];++e<f;){var h=a[e];h&&"object"==typeof h&&(Ud(h)||gb(h))?xd.apply(g,b?h:s(h,b,c)):c||g.push(h)}return g}function w(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;var h=typeof a,i=typeof b;if(!(a!==a||a&&V[h]||b&&V[i]))return!1;if(null==a||null==b)return a===b;var j=Bd.call(a),l=Bd.call(b);if(j==L&&(j=R),l==L&&(l=R),j!=l)return!1;switch(j){case N:case O:return+a==+b;case Q:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case S:case T:return a==kd(b)}var n=j==M;if(!n){if(vd.call(a,"__wrapped__ ")||vd.call(b,"__wrapped__"))return w(a.__wrapped__||a,b.__wrapped__||b,c,d,e,f);if(j!=R)return!1;var o=a.constructor,p=b.constructor;if(o!=p&&!(wb(o)&&o instanceof o&&wb(p)&&p instanceof p))return!1}var q=!e;e||(e=k()),f||(f=k());for(var r=e.length;r--;)if(e[r]==a)return f[r]==b;var s=0;if(g=!0,e.push(a),f.push(b),n){if(r=a.length,s=b.length,g=s==a.length,!g&&!d)return g;for(;s--;){var t=r,u=b[s];if(d)for(;t--&&!(g=w(a[t],u,c,d,e,f)););else if(!(g=w(a[s],u,c,d,e,f)))break}return g}return be(b,function(b,h,i){return vd.call(i,h)?(s++,g=vd.call(a,h)&&w(a[h],b,c,d,e,f)):void 0}),g&&!d&&be(a,function(a,b,c){return vd.call(c,b)?g=--s>-1:void 0}),q&&(m(e),m(f)),g}function W(a,b,c,d,e){(Ud(b)?Qb:ce)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Ud(b))||de(b))){for(var k=d.length;k--;)if(g=d[k]==b){j=e[k];break}if(!g){var l;c&&(i=c(j,b),(l="undefined"!=typeof i)&&(j=i)),l||(j=h?Ud(j)?j:[]:de(j)?j:{}),d.push(b),e.push(j),l||W(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function Y(b,c,d){var f=-1,g=db(),h=b?b.length:0,j=[],l=!c&&h>=v&&g===a,o=d||l?k():j;if(l){var p=i(o);p?(g=e,o=p):(l=!1,o=d?o:(m(o),j))}for(;++f<h;){var q=b[f],r=d?d(q,f,b):q;(c?!f||o[o.length-1]!==r:g(o,r)<0)&&((d||l)&&o.push(r),j.push(q))}return l?(m(o.array),n(o)):d&&m(o),j}function $(a){return function(b,d,e){var f={};d=c.createCallback(d,e,3);var g=-1,h=b?b.length:0;if("number"==typeof h)for(;++g<h;){var i=b[g];a(f,i,d(i,g,b),b)}else ce(b,function(b,c,e){a(f,b,d(b,c,e),e)});return f}}function ab(a,b,c,d,e,f){var g=1&b,h=2&b,i=4&b,j=8&b,k=16&b,l=32&b,m=a;if(!h&&!wb(a))throw new ld;k&&!c.length&&(b&=-17,k=c=!1),l&&!d.length&&(b&=-33,l=d=!1);var n=a&&a.__bindData__;if(n)return!g||1&n[1]||(n[4]=e),!g&&1&n[1]&&(b|=8),!i||4&n[1]||(n[5]=f),k&&xd.apply(n[2]||(n[2]=[]),c),l&&xd.apply(n[3]||(n[3]=[]),d),n[1]|=b,ab.apply(null,n);if(g&&!(h||i||l)&&(Sd.fastBind||Ed&&k)){if(k){var o=[e];xd.apply(o,c)}var p=k?Ed.apply(a,o):Ed.call(a,e)}else p=function(){var n=arguments,o=g?e:this;if((i||k||l)&&(n=Od.call(n),k&&Cd.apply(n,c),l&&xd.apply(n,d),i&&n.length<f))return b|=16,ab(a,j?b:-4&b,n,null,e,f);if(h&&(a=o[m]),this instanceof p){o=bb(a.prototype);var q=a.apply(o,n);return xb(q)?q:o}return a.apply(o,n)};return Td(p,Od.call(arguments)),p}function bb(a){return xb(a)?Fd(a):{}}function cb(a){return Xd[a]}function db(){var b=(b=c.indexOf)===kc?a:b;return b}function eb(a){var b,c;return a&&Bd.call(a)==R&&(b=a.constructor,!wb(b)||b instanceof b)?(be(a,function(a,b){c=b}),"undefined"==typeof c||vd.call(a,c)):!1}function fb(a){return Yd[a]}function gb(a){return a&&"object"==typeof a?Bd.call(a)==L:!1}function hb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),f(a,b,"function"==typeof c&&r(c,d,1))}function ib(a,b,c){return f(a,!0,"function"==typeof b&&r(b,c,1))}function jb(a,b,d){var e;return b=c.createCallback(b,d,3),ce(a,function(a,c,d){return b(a,c,d)?(e=c,!1):void 0}),e}function kb(a,b,d){var e;return b=c.createCallback(b,d,3),mb(a,function(a,c,d){return b(a,c,d)?(e=c,!1):void 0}),e}function lb(a,b,c){var d=[];be(a,function(a,b){d.push(b,a)});var e=d.length;for(b=r(b,c,3);e--&&b(d[e--],d[e],a)!==!1;);return a}function mb(a,b,c){var d=Wd(a),e=d.length;for(b=r(b,c,3);e--;){var f=d[e];if(b(a[f],f,a)===!1)break}return a}function nb(a){var b=[];return be(a,function(a,c){wb(a)&&b.push(c)}),b.sort()}function ob(a,b){return a?vd.call(a,b):!1}function pb(a){for(var b=-1,c=Wd(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function qb(a){return a===!0||a===!1||Bd.call(a)==N}function rb(a){return a?"object"==typeof a&&Bd.call(a)==O:!1}function sb(a){return a?1===a.nodeType:!1}function tb(a){var b=!0;if(!a)return b;var c=Bd.call(a),d=a.length;return c==M||c==T||c==L||c==R&&"number"==typeof d&&wb(a.splice)?!d:(ce(a,function(){return b=!1}),b)}function ub(a,b,c,d){return w(a,b,"function"==typeof c&&r(c,d,2))}function vb(a){return Hd(a)&&!Id(parseFloat(a))}function wb(a){return"function"==typeof a}function xb(a){return!(!a||!V[typeof a])}function yb(a){return Ab(a)&&a!=+a}function zb(a){return null===a}function Ab(a){return"number"==typeof a||Bd.call(a)==Q}function Bb(a){return a?"object"==typeof a&&Bd.call(a)==S:!1}function Cb(a){return"string"==typeof a||Bd.call(a)==T}function Db(a){return"undefined"==typeof a}function Eb(a){var b=arguments,c=2;if(!xb(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=r(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var e=Od.call(arguments,1,c),f=-1,g=k(),h=k();++f<c;)W(a,e[f],d,g,h);return m(g),m(h),a}function Fb(a,b,d){var e=db(),f="function"==typeof b,g={};if(f)b=c.createCallback(b,d,3);else var h=s(arguments,!0,!1,1);return be(a,function(a,c,d){(f?!b(a,c,d):e(h,c)<0)&&(g[c]=a)}),g}function Gb(a){for(var b=-1,c=Wd(a),d=c.length,e=cd(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Hb(a,b,d){var e={};if("function"!=typeof b)for(var f=-1,g=s(arguments,!0,!1,1),h=xb(a)?g.length:0;++f<h;){var i=g[f];i in a&&(e[i]=a[i])}else b=c.createCallback(b,d,3),be(a,function(a,c,d){b(a,c,d)&&(e[c]=a)});return e}function Ib(a,b,c,d){var e=Ud(a);if(b=r(b,d,4),null==c)if(e)c=[];else{var f=a&&a.constructor,g=f&&f.prototype;c=bb(g)}return(e?Qb:ce)(a,function(a,d,e){return b(c,a,d,e)}),c}function Jb(a){for(var b=-1,c=Wd(a),d=c.length,e=cd(d);++b<d;)e[b]=a[c[b]];return e}function Kb(a){for(var b=arguments,c=-1,d=s(b,!0,!1,1),e=b[2]&&b[2][b[1]]===a?1:d.length,f=cd(e);++c<e;)f[c]=a[d[c]];return f}function Lb(a,b,c){var d=-1,e=db(),f=a?a.length:0,g=!1;return c=(0>c?Kd(0,f+c):c)||0,Ud(a)?g=e(a,b,c)>-1:"number"==typeof f?g=(Cb(a)?a.indexOf(b,c):e(a,b,c))>-1:ce(a,function(a){return++d>=c?!(g=a===b):void 0}),g}function Mb(a,b,d){var e=!0;b=c.createCallback(b,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&(e=!!b(a[f],f,a)););else ce(a,function(a,c,d){return e=!!b(a,c,d)});return e}function Nb(a,b,d){var e=[];b=c.createCallback(b,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g;){var h=a[f];b(h,f,a)&&e.push(h)}else ce(a,function(a,c,d){b(a,c,d)&&e.push(a)});return e}function Ob(a,b,d){b=c.createCallback(b,d,3);var e=-1,f=a?a.length:0;if("number"!=typeof f){var g;return ce(a,function(a,c,d){return b(a,c,d)?(g=a,!1):void 0}),g}for(;++e<f;){var h=a[e];if(b(h,e,a))return h}}function Pb(a,b,d){var e;return b=c.createCallback(b,d,3),Rb(a,function(a,c,d){return b(a,c,d)?(e=a,!1):void 0}),e}function Qb(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:r(b,c,3),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==!1;);else ce(a,b);return a}function Rb(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:r(b,c,3),"number"==typeof d)for(;d--&&b(a[d],d,a)!==!1;);else{var e=Wd(a);d=e.length,ce(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function Sb(a,b){var c=Od.call(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=cd("number"==typeof f?f:0);return Qb(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function Tb(a,b,d){var e=-1,f=a?a.length:0;if(b=c.createCallback(b,d,3),"number"==typeof f)for(var g=cd(f);++e<f;)g[e]=b(a[e],e,a);else g=[],ce(a,function(a,c,d){g[++e]=b(a,c,d)});return g}function Ub(a,b,d){var e=-1/0,f=e;if(!b&&Ud(a))for(var h=-1,i=a.length;++h<i;){var j=a[h];j>f&&(f=j)}else b=!b&&Cb(a)?g:c.createCallback(b,d,3),Qb(a,function(a,c,d){var g=b(a,c,d);g>e&&(e=g,f=a)});return f}function Vb(a,b,d){var e=1/0,f=e;if(!b&&Ud(a))for(var h=-1,i=a.length;++h<i;){var j=a[h];f>j&&(f=j)}else b=!b&&Cb(a)?g:c.createCallback(b,d,3),Qb(a,function(a,c,d){var g=b(a,c,d);e>g&&(e=g,f=a)});return f}function Wb(a,b){var c=-1,d=a?a.length:0;if("number"==typeof d)for(var e=cd(d);++c<d;)e[c]=a[c][b];return e||Tb(a,b)}function Xb(a,b,c,d){if(!a)return c;var e=arguments.length<3;b=r(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else ce(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function Yb(a,b,c,d){var e=arguments.length<3;return b=r(b,d,4),Rb(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)}),c}function Zb(a,b,d){return b=c.createCallback(b,d,3),Nb(a,function(a,c,d){return!b(a,c,d)})}function $b(a,b,c){var d=a?a.length:0;if("number"!=typeof d&&(a=Jb(a)),null==b||c)return a?a[Tc(d-1)]:q;var e=_b(a);return e.length=Ld(Kd(0,b),e.length),e}function _b(a){var b=-1,c=a?a.length:0,d=cd("number"==typeof c?c:0);return Qb(a,function(a){var c=Tc(++b);d[b]=d[c],d[c]=a}),d}function ac(a){var b=a?a.length:0;return"number"==typeof b?b:Wd(a).length}function bc(a,b,d){var e;b=c.createCallback(b,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&!(e=b(a[f],f,a)););else ce(a,function(a,c,d){return!(e=b(a,c,d))});return!!e}function cc(a,b,d){var e=-1,f=a?a.length:0,g=cd("number"==typeof f?f:0);for(b=c.createCallback(b,d,3),Qb(a,function(a,c,d){var f=g[++e]=l();f.criteria=b(a,c,d),f.index=e,f.value=a}),f=g.length,g.sort(h);f--;){var i=g[f];g[f]=i.value,n(i)}return g}function dc(a){return a&&"number"==typeof a.length?o(a):Jb(a)}function ec(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function fc(b){var c=-1,d=db(),f=b?b.length:0,g=s(arguments,!0,!0,1),h=[],j=f>=v&&d===a;if(j){var k=i(g);k?(d=e,g=k):j=!1}for(;++c<f;){var l=b[c];d(g,l)<0&&h.push(l)}return j&&n(g),h}function gc(a,b,d){var e=-1,f=a?a.length:0;for(b=c.createCallback(b,d,3);++e<f;)if(b(a[e],e,a))return e;return-1}function hc(a,b,d){var e=a?a.length:0;for(b=c.createCallback(b,d,3);e--;)if(b(a[e],e,a))return e;return-1}function ic(a,b,d){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=-1;for(b=c.createCallback(b,d,3);++g<f&&b(a[g],g,a);)e++}else if(e=b,null==e||d)return a?a[0]:q;return o(a,0,Ld(Kd(0,e),f))}function jc(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=d&&d[b]===a?null:b,b=!1),null!=c&&(a=Tb(a,c,d)),s(a,b)}function kc(b,c,d){if("number"==typeof d){var e=b?b.length:0;d=0>d?Kd(0,e+d):d||0}else if(d){var f=tc(b,c);return b[f]===c?f:-1}return a(b,c,d)}function lc(a,b,d){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=f;for(b=c.createCallback(b,d,3);g--&&b(a[g],g,a);)e++}else e=null==b||d?1:b||e;return o(a,0,Ld(Kd(0,f-e),f))}function mc(b){for(var c=arguments,d=c.length,f=-1,g=k(),h=-1,j=db(),l=b?b.length:0,o=[],p=k();++f<d;){var q=c[f];g[f]=j===a&&(q?q.length:0)>=v&&i(f?c[f]:p)}a:for(;++h<l;){var r=g[0];if(q=b[h],(r?e(r,q):j(p,q))<0){for(f=d,(r||p).push(q);--f;)if(r=g[f],(r?e(r,q):j(c[f],q))<0)continue a;o.push(q)}}for(;d--;)r=g[d],r&&n(r);return m(g),m(p),o}function nc(a,b,d){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=f;for(b=c.createCallback(b,d,3);g--&&b(a[g],g,a);)e++}else if(e=b,null==e||d)return a?a[f-1]:q;return o(a,Kd(0,f-e))}function oc(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Kd(0,d+c):Ld(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function pc(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(Ad.call(a,f--,1),e--);return a}function qc(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Kd(0,qd((b-a)/(c||1))),f=cd(e);++d<e;)f[d]=a,a+=c;return f}function rc(a,b,d){var e=-1,f=a?a.length:0,g=[];for(b=c.createCallback(b,d,3);++e<f;){var h=a[e];b(h,e,a)&&(g.push(h),Ad.call(a,e--,1),f--)}return g}function sc(a,b,d){if("number"!=typeof b&&null!=b){var e=0,f=-1,g=a?a.length:0;for(b=c.createCallback(b,d,3);++f<g&&b(a[f],f,a);)e++}else e=null==b||d?1:Kd(0,b);return o(a,e)}function tc(a,b,d,e){var f=0,g=a?a.length:f;for(d=d?c.createCallback(d,e,1):Qc,b=d(b);g>f;){var h=f+g>>>1;d(a[h])<b?f=h+1:g=h}return f}function uc(){return Y(s(arguments,!0,!0))}function vc(a,b,d,e){return"boolean"!=typeof b&&null!=b&&(e=d,d=e&&e[b]===a?null:b,b=!1),null!=d&&(d=c.createCallback(d,e,3)),Y(a,b,d)}function wc(a){return fc(a,Od.call(arguments,1))}function xc(){for(var a=arguments.length>1?arguments:arguments[0],b=-1,c=a?Ub(Wb(a,"length")):0,d=cd(0>c?0:c);++b<c;)d[b]=Wb(a,b);return d}function yc(a,b){for(var c=-1,d=a?a.length:0,e={};++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function zc(a,b){if(!wb(b))throw new ld;return function(){return--a<1?b.apply(this,arguments):void 0}}function Ac(a,b){return arguments.length>2?ab(a,17,Od.call(arguments,2),null,b):ab(a,1,null,null,b)}function Bc(a){for(var b=arguments.length>1?s(arguments,!0,!1,1):nb(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=ab(a[e],1,null,null,a)}return a}function Cc(a,b){return arguments.length>2?ab(b,19,Od.call(arguments,2),null,a):ab(b,3,null,null,a)}function Dc(){for(var a=arguments,b=a.length||1;b--;)if(!wb(a[b]))throw new ld;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Ec(a,b,c){var d=typeof a;if(null==a||"function"==d)return r(a,b,c);if("object"!=d)return function(b){return b[a]};var e=Wd(a),f=e[0],g=a[f];return 1!=e.length||g!==g||xb(g)?function(b){for(var c=e.length,d=!1;c--&&(d=w(b[e[c]],a[e[c]],null,!0)););return d}:function(a){var b=a[f];return g===b&&(0!==g||1/g==1/b)}}function Fc(a,b){return b="number"==typeof b?b:+b||a.length,ab(a,4,null,null,null,b)}function Gc(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!wb(a))throw new ld;if(b=Kd(0,b)||0,c===!0){var n=!0;m=!1}else xb(c)&&(n=c.leading,l="maxWait"in c&&(Kd(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var o=function(){var c=b-(wd()-g);if(0>=c){e&&rd(e);var l=j;e=i=j=q,l&&(k=wd(),f=a.apply(h,d))}else i=zd(o,c)},p=function(){i&&rd(i),e=i=j=q,(m||l!==b)&&(k=wd(),f=a.apply(h,d))};return function(){if(d=arguments,g=wd(),h=this,j=m&&(i||!n),l===!1)var c=n&&!i;else{e||n||(k=g);var q=l-(g-k);0>=q?(e&&(e=rd(e)),k=g,f=a.apply(h,d)):e||(e=zd(p,q))}return i||b===l||(i=zd(o,b)),c&&(f=a.apply(h,d)),f}}function Hc(a){if(!wb(a))throw new ld;var b=Od.call(arguments,1);return zd(function(){a.apply(q,b)},1)}function Ic(a,b){if(!wb(a))throw new ld;var c=Od.call(arguments,2);return zd(function(){a.apply(q,c)},b)}function Jc(a,b){if(!wb(a))throw new ld;var c=function(){var d=c.cache,e=b?b.apply(this,arguments):u+arguments[0];return vd.call(d,e)?d[e]:d[e]=a.apply(this,arguments)};return c.cache={},c}function Kc(a){var b,c;if(!wb(a))throw new ld;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Lc(a){return ab(a,16,Od.call(arguments,1))}function Mc(a){return ab(a,32,null,Od.call(arguments,1))}function Nc(a,b,c){var d=!0,e=!0;if(!wb(a))throw new ld;c===!1?d=!1:xb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),c=l(),c.leading=d,c.maxWait=b,c.trailing=e;var f=Gc(a,b,c);return n(c),f}function Oc(a,b){if(!wb(b))throw new ld;return function(){var c=[a];return xd.apply(c,arguments),b.apply(this,c)}}function Pc(a){return null==a?"":kd(a).replace($d,cb)}function Qc(a){return a}function Rc(a,b){var e=a,f=!b||wb(e);b||(e=d,b=a,a=c),Qb(nb(b),function(c){var d=a[c]=b[c];f&&(e.prototype[c]=function(){var b=this.__wrapped__,c=[b];xd.apply(c,arguments);var f=d.apply(a,c);return b&&"object"==typeof b&&b===f?this:new e(f)})})}function Sc(){return b._=od,this}function Tc(a,b){null==a&&null==b&&(b=1),a=+a||0,null==b?(b=a,a=0):b=+b||0;var c=Nd();return a%1||b%1?a+Ld(c*(b-a+parseFloat("1e-"+((c+"").length-1))),b):a+sd(c*(b-a+1))}function Uc(a,b){if(a){var c=a[b];return wb(c)?a[b]():c}}function Vc(a,b,d){var e=c.templateSettings;a||(a=""),d=ae({},d,e);var f,g=ae({},d.imports,e.imports),h=Wd(g),i=Jb(g),k=0,l=d.interpolate||G,m="__p += '",n=jd((d.escape||G).source+"|"+l.source+"|"+(l===E?B:G).source+"|"+(d.evaluate||G).source+"|$","g");a.replace(n,function(b,c,d,e,g,h){return d||(d=e),m+=a.slice(k,h).replace(I,j),c&&(m+="' +\n__e("+c+") +\n'"),g&&(f=!0,m+="';\n"+g+";\n__p += '"),d&&(m+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),k=h+b.length,b}),m+="';\n";var o=d.variable,p=o;p||(o="obj",m="with ("+o+") {\n"+m+"\n}\n"),m=(f?m.replace(y,""):m).replace(z,"$1").replace(A,"$1;"),m="function("+o+") {\n"+(p?"":o+" || ("+o+" = {});\n")+"var __t, __p = '', __e = _.escape"+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var r="\n/*\n//# sourceURL="+(d.sourceURL||"/lodash/template/source["+K++ +"]")+"\n*/";try{var s=fd(h,"return "+m+r).apply(q,i)}catch(t){throw t.source=m,t}return b?s(b):(s.source=m,s)}function Wc(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=cd(a);for(b=r(b,c,1);++d<a;)e[d]=b(d);return e}function Xc(a){return null==a?"":kd(a).replace(Zd,fb)}function Yc(a){var b=++t;return kd(null==a?"":a)+b}function Zc(a){return a=new d(a),a.__chain__=!0,a}function $c(a,b){return b(a),a}function _c(){return this.__chain__=!0,this}function ad(){return kd(this.__wrapped__)}function bd(){return this.__wrapped__}b=b?_.defaults(X.Object(),b,_.pick(X,J)):X;var cd=b.Array,dd=b.Boolean,ed=b.Date,fd=b.Function,gd=b.Math,hd=b.Number,id=b.Object,jd=b.RegExp,kd=b.String,ld=b.TypeError,md=[],nd=id.prototype,od=b._,pd=jd("^"+kd(nd.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),qd=gd.ceil,rd=b.clearTimeout,sd=gd.floor,td=fd.prototype.toString,ud=pd.test(ud=id.getPrototypeOf)&&ud,vd=nd.hasOwnProperty,wd=pd.test(wd=ed.now)&&wd||function(){return+new ed
},xd=md.push,yd=b.setImmediate,zd=b.setTimeout,Ad=md.splice,Bd=nd.toString,Cd=md.unshift,Dd=function(){try{var a={},b=pd.test(b=id.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),Ed=pd.test(Ed=Bd.bind)&&Ed,Fd=pd.test(Fd=id.create)&&Fd,Gd=pd.test(Gd=cd.isArray)&&Gd,Hd=b.isFinite,Id=b.isNaN,Jd=pd.test(Jd=id.keys)&&Jd,Kd=gd.max,Ld=gd.min,Md=b.parseInt,Nd=gd.random,Od=md.slice,Pd=pd.test(b.attachEvent),Qd=Ed&&!/\n|true/.test(Ed+Pd),Rd={};Rd[M]=cd,Rd[N]=dd,Rd[O]=ed,Rd[P]=fd,Rd[R]=id,Rd[Q]=hd,Rd[S]=jd,Rd[T]=kd,d.prototype=c.prototype;var Sd=c.support={};Sd.fastBind=Ed&&!Qd,Sd.funcNames="string"==typeof fd.name,c.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:E,variable:"",imports:{_:c}};var Td=function(a,b){var c=l();c.value=b,Dd(a,"__bindData__",c),n(c)},Ud=Gd||function(a){return a&&"object"==typeof a?Bd.call(a)==M:!1},Vd=function(a){var b,c=a,d=[];if(!c)return d;if(!V[typeof a])return d;for(b in c)vd.call(c,b)&&d.push(b);return d},Wd=Jd?function(a){return xb(a)?Jd(a):[]}:Vd,Xd={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Yd=pb(Xd),Zd=jd("("+Wd(Yd).join("|")+")","g"),$d=jd("["+Wd(Xd).join("")+"]","g"),_d=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=r(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if(e=g[h],e&&V[typeof e])for(var k=-1,l=V[typeof e]&&Wd(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f},ae=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&V[typeof e])for(var j=-1,k=V[typeof e]&&Wd(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},be=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!V[typeof e])return f;b=b&&"undefined"==typeof c?b:r(b,c,3);for(d in e)if(b(e[d],d,a)===!1)return f;return f},ce=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!V[typeof e])return f;b=b&&"undefined"==typeof c?b:r(b,c,3);for(var g=-1,h=V[typeof e]&&Wd(e),i=h?h.length:0;++g<i;)if(d=h[g],b(e[d],d,a)===!1)return f;return f},de=function(a){if(!a||Bd.call(a)!=R)return!1;var b=a.valueOf,c="function"==typeof b&&(c=ud(b))&&ud(c);return c?a==c||ud(a)==c:eb(a)},ee=$(function(a,b,c){vd.call(a,c)?a[c]++:a[c]=1}),fe=$(function(a,b,c){(vd.call(a,c)?a[c]:a[c]=[]).push(b)}),ge=$(function(a,b,c){a[c]=b}),he=Nb;Qd&&Z&&"function"==typeof yd&&(Hc=function(a){if(!wb(a))throw new ld;return yd.apply(b,arguments)});var ie=8==Md(x+"08")?Md:function(a,b){return Md(Cb(a)?a.replace(F,""):a,b||0)};return c.after=zc,c.assign=_d,c.at=Kb,c.bind=Ac,c.bindAll=Bc,c.bindKey=Cc,c.chain=Zc,c.compact=ec,c.compose=Dc,c.countBy=ee,c.createCallback=Ec,c.curry=Fc,c.debounce=Gc,c.defaults=ae,c.defer=Hc,c.delay=Ic,c.difference=fc,c.filter=Nb,c.flatten=jc,c.forEach=Qb,c.forEachRight=Rb,c.forIn=be,c.forInRight=lb,c.forOwn=ce,c.forOwnRight=mb,c.functions=nb,c.groupBy=fe,c.indexBy=ge,c.initial=lc,c.intersection=mc,c.invert=pb,c.invoke=Sb,c.keys=Wd,c.map=Tb,c.max=Ub,c.memoize=Jc,c.merge=Eb,c.min=Vb,c.omit=Fb,c.once=Kc,c.pairs=Gb,c.partial=Lc,c.partialRight=Mc,c.pick=Hb,c.pluck=Wb,c.pull=pc,c.range=qc,c.reject=Zb,c.remove=rc,c.rest=sc,c.shuffle=_b,c.sortBy=cc,c.tap=$c,c.throttle=Nc,c.times=Wc,c.toArray=dc,c.transform=Ib,c.union=uc,c.uniq=vc,c.values=Jb,c.where=he,c.without=wc,c.wrap=Oc,c.zip=xc,c.zipObject=yc,c.collect=Tb,c.drop=sc,c.each=Qb,c.eachRight=Rb,c.extend=_d,c.methods=nb,c.object=yc,c.select=Nb,c.tail=sc,c.unique=vc,c.unzip=xc,Rc(c),c.clone=hb,c.cloneDeep=ib,c.contains=Lb,c.escape=Pc,c.every=Mb,c.find=Ob,c.findIndex=gc,c.findKey=jb,c.findLast=Pb,c.findLastIndex=hc,c.findLastKey=kb,c.has=ob,c.identity=Qc,c.indexOf=kc,c.isArguments=gb,c.isArray=Ud,c.isBoolean=qb,c.isDate=rb,c.isElement=sb,c.isEmpty=tb,c.isEqual=ub,c.isFinite=vb,c.isFunction=wb,c.isNaN=yb,c.isNull=zb,c.isNumber=Ab,c.isObject=xb,c.isPlainObject=de,c.isRegExp=Bb,c.isString=Cb,c.isUndefined=Db,c.lastIndexOf=oc,c.mixin=Rc,c.noConflict=Sc,c.parseInt=ie,c.random=Tc,c.reduce=Xb,c.reduceRight=Yb,c.result=Uc,c.runInContext=p,c.size=ac,c.some=bc,c.sortedIndex=tc,c.template=Vc,c.unescape=Xc,c.uniqueId=Yc,c.all=Mb,c.any=bc,c.detect=Ob,c.findWhere=Ob,c.foldl=Xb,c.foldr=Yb,c.include=Lb,c.inject=Xb,ce(c,function(a,b){c.prototype[b]||(c.prototype[b]=function(){var b=[this.__wrapped__],e=this.__chain__;xd.apply(b,arguments);var f=a.apply(c,b);return e?new d(f,e):f})}),c.first=ic,c.last=nc,c.sample=$b,c.take=ic,c.head=ic,ce(c,function(a,b){var e="sample"!==b;c.prototype[b]||(c.prototype[b]=function(b,c){var f=this.__chain__,g=a(this.__wrapped__,b,c);return f||null!=b&&(!c||e&&"function"==typeof b)?new d(g,f):g})}),c.VERSION="2.0.0",c.prototype.chain=_c,c.prototype.toString=ad,c.prototype.value=bd,c.prototype.valueOf=bd,Qb(["join","pop","shift"],function(a){var b=md[a];c.prototype[a]=function(){var a=this.__chain__,c=b.apply(this.__wrapped__,arguments);return a?new d(c,a):c}}),Qb(["push","reverse","sort","unshift"],function(a){var b=md[a];c.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Qb(["concat","slice","splice"],function(a){var b=md[a];c.prototype[a]=function(){return new d(b.apply(this.__wrapped__,arguments),this.__chain__)}}),c}var q,r=[],s=[],t=0,u=+new Date+"",v=75,w=40,x=" 	\f\n\r\u2028\u2029",y=/\b__p \+= '';/g,z=/\b(__p \+=) '' \+/g,A=/(__e\(.*?\)|\b__t\)) \+\n'';/g,B=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,D=/^function[ \n\r\t]+\w/,E=/<%=([\s\S]+?)%>/g,F=RegExp("^["+x+"]*0+(?=.$)"),G=/($^)/,H=(H=/\bthis\b/)&&H.test(p)&&H,I=/['\n\r\t\u2028\u2029\\]/g,J=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],K=0,L="[object Arguments]",M="[object Array]",N="[object Boolean]",O="[object Date]",P="[object Function]",Q="[object Number]",R="[object Object]",S="[object RegExp]",T="[object String]",U={};U[P]=!1,U[L]=U[M]=U[N]=U[O]=U[Q]=U[R]=U[S]=U[T]=!0;var V={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},W={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},X=V[typeof window]&&window||this,Y=V[typeof c]&&c,Z=V[typeof b]&&b&&b.exports==Y&&b,$=V[typeof d]&&d;!$||$.global!==$&&$.window!==$||(X=$);var _=p();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(X._=_,define(function(){return _})):Y&&!Y.nodeType?Z?(Z.exports=_)._=_:Y._=_:X._=_}).call(this)},{}],227:[function(a,b){function c(a){return this instanceof c?(this.initialize(a),void 0):new c(a)}var d="/node_modules/voxel-server",e=a("extend"),f=a("eventemitter2").EventEmitter2,g=(a("path"),a("hat")),h=(a("voxel"),a("voxel-crunch")),i=a("voxel-engine"),j=a("painterly-textures")(d);b.exports=c,c.prototype.initialize=function(a){var b=this,c={isClient:!1,chunkDistance:2,materials:[["grass","dirt","grass_dirt"],"obsidian","brick","grass"],texturePath:j,worldOrigin:[0,0,0],controls:{discreteFire:!0},avatarInitialPosition:[2,20,2]},d=b.settings=e({},c,a);e(b,new f({wildcard:!0}));{var g=b.game=i(d);b.clients={},b.chunkCache={}}setInterval(b.handleErrors(function(){b.sendUpdate()}),1e3/22),g.voxels.on("missingChunk",function(a){b.emit("missingChunk",a)})},c.prototype.connectClient=function(a){var b=this,c=b.settings,d=b.game,e=a.id=g();b.broadcast(e,"join",e);var f=b.clients[e]={id:e,connection:a,player:{rotation:new d.THREE.Vector3,position:new d.THREE.Vector3}};b.bindClientEvents(f),a.emit("id",e),a.emit("settings",c),b.emit(["client","join"],f)},c.prototype.removeClient=function(a){var b=this,c=a.id,d=b.clients[c];delete b.clients[c],b.emit(["client",c,"leave"],d),b.broadcast(c,"leave",c)},c.prototype.bindClientEvents=function(a){var b=this,c=b.game,d=a.id,e=a.connection;e.on("chat",b.handleErrors(function(c){c.text&&(c.text.length>140&&(c.text=c.text.substr(0,140)),b.emit(["chat"],c,a),b.broadcast(null,"chat",c))})),e.on("created",b.handleErrors(function(){b.sendInitialChunks(e),b.emit(["client","created"],a)})),e.on("state",b.handleErrors(function(c){b.emit(["client",d,"state"],c),a.player.rotation.x=c.rotation.x,a.player.rotation.y=c.rotation.y;var e=a.player.position,f=e.distanceTo(c.position);if(f>20){{e.clone()}return e.lerp(c.position,.1),void 0}e.copy(c.position)}));var f=b.chunkCache;e.on("set",b.handleErrors(function(d,e){b.emit(["set"],d,e,a),c.setBlock(d,e);var g=c.voxels.chunkAtPosition(d),h=g.join("|");f[h]&&delete f[h],b.broadcast(null,"set",d,e)})),b.settings.forwardEvents.map(function(a){e.on(a,function(){var c=[].slice.apply(arguments);c.unshift(a),c.unshift(d),b.broadcast.apply(b,c)})})},c.prototype.broadcast=function(a){var b=this,c=[].slice.apply(arguments);c.shift(),b.emit.apply(b,c),Object.keys(b.clients).map(function(d){if(d!==a){var e=b.clients[d].connection;e.emit.apply(e,c)}})},c.prototype.sendUpdate=function(){var a=this,b=Object.keys(a.clients);if(0!==b.length){var c={positions:{},date:+new Date};b.map(function(b){var d=a.clients[b];c.positions[b]={position:d.player.position,rotation:{x:d.player.rotation.x,y:d.player.rotation.y}}}),a.broadcast(null,"update",c)}},c.prototype.sendInitialChunks=function(a){var b=this,c=b.game.voxels.chunks,d=b.chunkCache;Object.keys(c).map(function(b){var e=c[b],f=d[b];f||(f=h.encode(e.voxels),d[b]=f),a.emit("chunk",f,{position:e.position,dims:e.dims,length:e.voxels.length})}),a.emit("noMoreChunks",!0)},c.prototype.handleErrors=function(a){var b=this;return function(){try{return a.apply(this,arguments)}catch(c){b.emit(["error"],c)}}}},{eventemitter2:228,extend:30,hat:60,"painterly-textures":163,path:44,voxel:265,"voxel-crunch":229,"voxel-engine":230}],228:[function(a,b,c){var d=a("__browserify_process");!function(a){function b(){this._events={},this._conf&&c.call(this,this._conf)}function c(a){a&&(this._conf=a,a.delimiter&&(this.delimiter=a.delimiter),a.maxListeners&&(this._events.maxListeners=a.maxListeners),a.wildcard&&(this.wildcard=a.wildcard),a.newListener&&(this.newListener=a.newListener),this.wildcard&&(this.listenerTree={}))}function d(a){this._events={},this.newListener=!1,c.call(this,a)}function e(a,b,c,d){if(!c)return[];var f,g,h,i,j,k,l,m=[],n=b.length,o=b[d],p=b[d+1];if(d===n&&c._listeners){if("function"==typeof c._listeners)return a&&a.push(c._listeners),[c];for(f=0,g=c._listeners.length;g>f;f++)a&&a.push(c._listeners[f]);return[c]}if("*"===o||"**"===o||c[o]){if("*"===o){for(h in c)"_listeners"!==h&&c.hasOwnProperty(h)&&(m=m.concat(e(a,b,c[h],d+1)));return m}if("**"===o){l=d+1===n||d+2===n&&"*"===p,l&&c._listeners&&(m=m.concat(e(a,b,c,n)));for(h in c)"_listeners"!==h&&c.hasOwnProperty(h)&&("*"===h||"**"===h?(c[h]._listeners&&!l&&(m=m.concat(e(a,b,c[h],n))),m=m.concat(e(a,b,c[h],d))):m=h===p?m.concat(e(a,b,c[h],d+2)):m.concat(e(a,b,c[h],d)));return m}m=m.concat(e(a,b,c[o],d+1))}if(i=c["*"],i&&e(a,b,i,d+1),j=c["**"])if(n>d){j._listeners&&e(a,b,j,n);for(h in j)"_listeners"!==h&&j.hasOwnProperty(h)&&(h===p?e(a,b,j[h],d+2):h===o?e(a,b,j[h],d+1):(k={},k[h]=j[h],e(a,b,{"**":k},d+1)))}else j._listeners?e(a,b,j,n):j["*"]&&j["*"]._listeners&&e(a,b,j["*"],n);return m}function f(a,b){a="string"==typeof a?a.split(this.delimiter):a.slice();for(var c=0,d=a.length;d>c+1;c++)if("**"===a[c]&&"**"===a[c+1])return;for(var e=this.listenerTree,f=a.shift();f;){if(e[f]||(e[f]={}),e=e[f],0===a.length){if(e._listeners){if("function"==typeof e._listeners)e._listeners=[e._listeners,b];else if(g(e._listeners)&&(e._listeners.push(b),!e._listeners.warned)){var i=h;"undefined"!=typeof this._events.maxListeners&&(i=this._events.maxListeners),i>0&&e._listeners.length>i&&(e._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",e._listeners.length),console.trace())}}else e._listeners=b;return!0}f=a.shift()}return!0}var g=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},h=10;d.prototype.delimiter=".",d.prototype.setMaxListeners=function(a){this._events||b.call(this),this._events.maxListeners=a,this._conf||(this._conf={}),this._conf.maxListeners=a},d.prototype.event="",d.prototype.once=function(a,b){return this.many(a,1,b),this},d.prototype.many=function(a,b,c){function d(){0===--b&&e.off(a,d),c.apply(this,arguments)}var e=this;if("function"!=typeof c)throw new Error("many only accepts instances of Function");return d._origin=c,this.on(a,d),e},d.prototype.emit=function(){this._events||b.call(this);var a=arguments[0];if("newListener"===a&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var c=arguments.length,d=new Array(c-1),f=1;c>f;f++)d[f-1]=arguments[f];for(f=0,c=this._all.length;c>f;f++)this.event=a,this._all[f].apply(this,d)}if("error"===a&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var g;if(this.wildcard){g=[];var h="string"==typeof a?a.split(this.delimiter):a.slice();e.call(this,g,h,this.listenerTree,0)}else g=this._events[a];if("function"==typeof g){if(this.event=a,1===arguments.length)g.call(this);else if(arguments.length>1)switch(arguments.length){case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);break;default:for(var c=arguments.length,d=new Array(c-1),f=1;c>f;f++)d[f-1]=arguments[f];g.apply(this,d)}return!0}if(g){for(var c=arguments.length,d=new Array(c-1),f=1;c>f;f++)d[f-1]=arguments[f];for(var i=g.slice(),f=0,c=i.length;c>f;f++)this.event=a,i[f].apply(this,d);return i.length>0||this._all}return this._all},d.prototype.on=function(a,c){if("function"==typeof a)return this.onAny(a),this;if("function"!=typeof c)throw new Error("on only accepts instances of Function");if(this._events||b.call(this),this.emit("newListener",a,c),this.wildcard)return f.call(this,a,c),this;if(this._events[a]){if("function"==typeof this._events[a])this._events[a]=[this._events[a],c];else if(g(this._events[a])&&(this._events[a].push(c),!this._events[a].warned)){var d=h;"undefined"!=typeof this._events.maxListeners&&(d=this._events.maxListeners),d>0&&this._events[a].length>d&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}}else this._events[a]=c;return this},d.prototype.onAny=function(a){if(this._all||(this._all=[]),"function"!=typeof a)throw new Error("onAny only accepts instances of Function");return this._all.push(a),this},d.prototype.addListener=d.prototype.on,d.prototype.off=function(a,b){if("function"!=typeof b)throw new Error("removeListener only takes instances of Function");var c,d=[];if(this.wildcard){var f="string"==typeof a?a.split(this.delimiter):a.slice();d=e.call(this,null,f,this.listenerTree,0)}else{if(!this._events[a])return this;c=this._events[a],d.push({_listeners:c})}for(var h=0;h<d.length;h++){var i=d[h];if(c=i._listeners,g(c)){for(var j=-1,k=0,l=c.length;l>k;k++)if(c[k]===b||c[k].listener&&c[k].listener===b||c[k]._origin&&c[k]._origin===b){j=k;break}if(0>j)continue;return this.wildcard?i._listeners.splice(j,1):this._events[a].splice(j,1),0===c.length&&(this.wildcard?delete i._listeners:delete this._events[a]),this}(c===b||c.listener&&c.listener===b||c._origin&&c._origin===b)&&(this.wildcard?delete i._listeners:delete this._events[a])}return this},d.prototype.offAny=function(a){var b,c=0,d=0;if(a&&this._all&&this._all.length>0){for(b=this._all,c=0,d=b.length;d>c;c++)if(a===b[c])return b.splice(c,1),this}else this._all=[];return this},d.prototype.removeListener=d.prototype.off,d.prototype.removeAllListeners=function(a){if(0===arguments.length)return!this._events||b.call(this),this;if(this.wildcard)for(var c="string"==typeof a?a.split(this.delimiter):a.slice(),d=e.call(this,null,c,this.listenerTree,0),f=0;f<d.length;f++){var g=d[f];g._listeners=null}else{if(!this._events[a])return this;this._events[a]=null}return this},d.prototype.listeners=function(a){if(this.wildcard){var c=[],d="string"==typeof a?a.split(this.delimiter):a.slice();return e.call(this,c,d,this.listenerTree,0),c}return this._events||b.call(this),this._events[a]||(this._events[a]=[]),g(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},d.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return d}):a.EventEmitter2=d}("undefined"!=typeof d&&"undefined"!=typeof d.title&&"undefined"!=typeof c?c:window)},{__browserify_process:40}],229:[function(a,b){b.exports=a(174)},{}],230:[function(a,b,c){arguments[4][175][0].apply(c,arguments)},{"./lib/detector":231,"./lib/stats":232,__browserify_process:40,"aabb-3d":5,"collide-3d-tilemap":233,events:33,"gl-matrix":234,inherits:235,interact:236,"kb-controls":245,path:44,"pin-it":250,raf:251,"spatial-events":252,three:254,tic:255,voxel:265,"voxel-control":256,"voxel-mesh":257,"voxel-physical":258,"voxel-raycast":259,"voxel-region-change":260,"voxel-texture":261,"voxel-view":263}],231:[function(a,b){b.exports=a(176)},{}],232:[function(a,b){b.exports=a(177)},{}],233:[function(a,b){b.exports=a(178)},{}],234:[function(a,b){b.exports=a(6)},{}],235:[function(a,b){b.exports=a(66)},{}],236:[function(a,b,c){arguments[4][181][0].apply(c,arguments)},{"drag-stream":237,events:33,fullscreen:243,"pointer-lock":244,stream:50}],237:[function(a,b,c){arguments[4][182][0].apply(c,arguments)},{"domnode-dom":238,stream:50,through:242}],238:[function(a,b,c){arguments[4][183][0].apply(c,arguments)},{"./lib/index":239}],239:[function(a,b){b.exports=a(184)},{"./readable":240,"./writable":241}],240:[function(a,b){b.exports=a(185)},{stream:50}],241:[function(a,b){b.exports=a(186)},{stream:50}],242:[function(a,b){b.exports=a(187)},{__browserify_process:40,stream:50}],243:[function(a,b){b.exports=a(188)},{events:33}],244:[function(a,b){b.exports=a(189)},{events:33,stream:50}],245:[function(a,b,c){arguments[4][190][0].apply(c,arguments)},{ever:246,vkey:249}],246:[function(a,b){b.exports=a(191)},{"./init.json":247,"./types.json":248,events:33}],247:[function(a,b){b.exports=a(192)},{}],248:[function(a,b){b.exports=a(193)},{}],249:[function(a,b){b.exports=a(194)},{}],250:[function(a,b){b.exports=a(195)},{}],251:[function(a,b){b.exports=a(196)},{events:33}],252:[function(a,b){b.exports=a(197)},{"./tree":253,"aabb-3d":5}],253:[function(a,b){b.exports=a(198)},{"aabb-3d":5}],254:[function(a,b){b.exports=a(199)},{__browserify_process:40}],255:[function(a,b){b.exports=a(200)},{}],256:[function(a,b){b.exports=a(201)},{stream:50}],257:[function(a,b){b.exports=a(202)},{three:254}],258:[function(a,b){b.exports=a(203)},{"aabb-3d":5,three:254}],259:[function(a,b){b.exports=a(204)},{}],260:[function(a,b){b.exports=a(205)},{"aabb-3d":5,events:33}],261:[function(a,b){b.exports=a(206)},{atlaspack:262,tic:255}],262:[function(a,b){b.exports=a(207)},{}],263:[function(a,b){b.exports=a(208)},{__browserify_process:40}],264:[function(a,b){function c(a){if(this.distance=a.chunkDistance||2,this.chunkSize=a.chunkSize||32,this.cubeSize=a.cubeSize||25,this.generateVoxelChunk=a.generateVoxelChunk,this.chunks={},this.meshes={},this.chunkSize&this.chunkSize-1!==0)throw new Error("chunkSize must be a power of 2");for(var b=0,c=this.chunkSize;c>0;c>>=1)b++;this.chunkBits=b-1}var d=a("events"),e=a("inherits");b.exports=function(a){return new c(a)},b.exports.Chunker=c,e(c,d.EventEmitter),c.prototype.nearbyChunks=function(a,b){for(var c=this.chunkAtPosition(a),d=c[0],e=c[1],f=c[2],g=b||this.distance,h=[],i=d-g;i!==d+g;++i)for(var j=e-g;j!==e+g;++j)for(var k=f-g;k!==f+g;++k)h.push([i,j,k]);return h},c.prototype.requestMissingChunks=function(a){var b=this;this.nearbyChunks(a).map(function(a){b.chunks[a.join("|")]||b.emit("missingChunk",a)})},c.prototype.getBounds=function(a,b,c){var d=this.chunkBits,e=[a<<d,b<<d,c<<d],f=[a+1<<d,b+1<<d,c+1<<d];return[e,f]},c.prototype.generateChunk=function(a,b,c){var d=this.getBounds(a,b,c),e=this.generateVoxelChunk(d[0],d[1],a,b,c),f=[a,b,c];return e.position=f,this.chunks[f.join("|")]=e,e},c.prototype.chunkAtCoordinates=function(a,b,c){var d=this.chunkBits,e=a>>d,f=b>>d,g=c>>d,h=[e,f,g];return h},c.prototype.chunkAtPosition=function(a){var b=this.cubeSize,c=Math.floor(a[0]/b),d=Math.floor(a[1]/b),e=Math.floor(a[2]/b),f=this.chunkAtCoordinates(c,d,e);return f},c.prototype.voxelIndexFromCoordinates=function(a,b,c){var d=this.chunkBits,e=(1<<d)-1,f=(a&e)+((b&e)<<d)+((c&e)<<2*d);return f},c.prototype.voxelIndexFromPosition=function(a){var b=this.voxelVector(a);return this.voxelIndex(b)},c.prototype.voxelAtCoordinates=function(a,b,c,d){var e=this.chunkAtCoordinates(a,b,c).join("|"),f=this.chunks[e];if(!f)return!1;var g=this.voxelIndexFromCoordinates(a,b,c),h=f.voxels[g];return"undefined"!=typeof d&&(f.voxels[g]=d),h},c.prototype.voxelAtPosition=function(a,b){var c=this.cubeSize,d=Math.floor(a[0]/c),e=Math.floor(a[1]/c),f=Math.floor(a[2]/c),g=this.voxelAtCoordinates(d,e,f,b);return g},c.prototype.voxelIndex=function(a){var b=this.voxelIndexFromCoordinates(a[0],a[1],a[2]);return b},c.prototype.voxelVector=function(a){var b=this.cubeSize,c=(1<<this.chunkBits)-1,d=Math.floor(a[0]/b)&c,e=Math.floor(a[1]/b)&c,f=Math.floor(a[2]/b)&c;return[d,e,f]}},{events:33,inherits:270}],265:[function(a,b){function c(a,b,c,d){for(var e=[b[0]-a[0],b[1]-a[1],b[2]-a[2]],f=new Int8Array(e[0]*e[1]*e[2]),g=0,h=a[2];h<b[2];++h)for(var i=a[1];i<b[1];++i)for(var j=a[0];j<b[0];++j,++g)f[g]=c(j,i,h,g,d);return{voxels:f,dims:e}}var d=a("./chunker");b.exports=function(a){return a.generateVoxelChunk||(a.generateVoxelChunk=function(a,d){return c(a,d,b.exports.generator.Valley)}),d(a)},b.exports.meshers={culled:a("./meshers/culled").mesher,greedy:a("./meshers/greedy").mesher,monotone:a("./meshers/monotone").mesher,stupid:a("./meshers/stupid").mesher},b.exports.Chunker=d.Chunker,b.exports.geometry={},b.exports.generator={},b.exports.generate=c,b.exports.generator.Sphere=function(a,b,c){return 256>=a*a+b*b+c*c?1:0},b.exports.generator.Noise=function(){return Math.random()<.1?16777215*Math.random():0},b.exports.generator["Dense Noise"]=function(){return Math.round(16777215*Math.random())},b.exports.generator.Checker=function(a,b,c){return a+b+c&1?2&(a^b^c)?1:16777215:0},b.exports.generator.Hill=function(a,b,c){return b<=16*Math.exp(-(a*a+c*c)/64)?1:0},b.exports.generator.Valley=function(a,b,c){return 31*(a*a+c*c)/2048+1>=b?1:0},b.exports.generator["Hilly Terrain"]=function(a,b,c){var d=3*Math.sin(Math.PI*a/12-Math.PI*c*.1)+27;if(b>d+1)return 0;if(b>=d)return 1;var e=2*Math.sin(Math.PI*a*.25-Math.PI*c*.3)+20;return b>=e?2:b>2?Math.random()<.1?2236962:11184810:3},b.exports.scale=function(a,b,c,d,e){return(a-b)*(e-d)/(c-b)+d},b.exports.generateExamples=function(){return{Sphere:c([-16,-16,-16],[16,16,16],b.exports.generator.Sphere),Noise:c([0,0,0],[16,16,16],b.exports.generator.Noise),"Dense Noise":c([0,0,0],[16,16,16],b.exports.generator["Dense Noise"]),Checker:c([0,0,0],[8,8,8],b.exports.generator.Checker),Hill:c([-16,0,-16],[16,16,16],b.exports.generator.Hill),Valley:c([0,0,0],[32,32,32],b.exports.generator.Valley),"Hilly Terrain":c([0,0,0],[32,32,32],b.exports.generator["Hilly Terrain"])}}},{"./chunker":264,"./meshers/culled":266,"./meshers/greedy":267,"./meshers/monotone":268,"./meshers/stupid":269}],266:[function(a,b,c){function d(a,b){for(var c=new Array(3),d=0;3>d;++d)c[d]=[[0,0,0],[0,0,0]],c[d][0][(d+1)%3]=1,c[d][1][(d+2)%3]=1;var e=[],f=[],g=[0,0,0],h=[[!1,!0],[!1,!0],[!1,!0]],i=-b[0]*b[1];for(h[2]=[!1,!0],g[2]=-1;g[2]<b[2];h[2]=[!0,++g[2]<b[2]-1])for(i-=b[0],h[1]=[!1,!0],g[1]=-1;g[1]<b[1];h[1]=[!0,++g[1]<b[1]-1])for(i-=1,h[0]=[!1,!0],g[0]=-1;g[0]<b[0];h[0]=[!0,++g[0]<b[0]-1],++i)for(var j=h[0][0]&&h[1][0]&&h[2][0]?a[i]:0,k=[h[0][1]&&h[1][0]&&h[2][0]?a[i+1]:0,h[0][0]&&h[1][1]&&h[2][0]?a[i+b[0]]:0,h[0][0]&&h[1][0]&&h[2][1]?a[i+b[0]*b[1]]:0],l=0;3>l;++l)if(!!j!=!!k[l]){var m=j?0:1,n=[g[0],g[1],g[2]],o=c[l][m],p=c[l][1^m];++n[l];var q=e.length;e.push([n[0],n[1],n[2]]),e.push([n[0]+o[0],n[1]+o[1],n[2]+o[2]]),e.push([n[0]+o[0]+p[0],n[1]+o[1]+p[1],n[2]+o[2]+p[2]]),e.push([n[0]+p[0],n[1]+p[1],n[2]+p[2]]),f.push([q,q+1,q+2,q+3,m?k[l]:j])}return{vertices:e,faces:f}}c&&(c.mesher=d)},{}],267:[function(a,b,c){var d=function(){var a=new Int32Array(4096);return function(b,c){for(var d=[],e=[],f=c[0],g=c[1],h=f*g,i=0;3>i;++i){var j,k,l,m,n,o,p,q,r,s,t,u,v=(i+1)%3,w=(i+2)%3,x=[0,0,0],y=[0,0,0],z=[0,0,0],A=[0,0,0],B=c[i],C=c[v],D=c[w];for(a.length<C*D&&(a=new Int32Array(C*D)),y[i]=1,x[i]=-1,s=f*y[1],t=h*y[2];x[i]<B;){for(u=x[i],q=0,x[w]=0;x[w]<D;++x[w])for(x[v]=0;x[v]<C;++x[v],++q){var E=u>=0&&b[x[0]+f*x[1]+h*x[2]],F=B-1>u&&b[x[0]+y[0]+f*x[1]+s+h*x[2]+t];a[q]=(E?!F:F)?E?E:-F:0}for(++x[i],q=0,k=0;D>k;++k)for(j=0;C>j;)if(r=a[q]){for(n=1;r===a[q+n]&&C>j+n;)n++;for(p=1;D>k+p;++p){for(l=0;n>l&&r===a[q+l+p*C];)l++;if(n>l)break}z[i]=0,A[i]=0,x[v]=j,x[w]=k,r>0?(A[w]=p,A[v]=0,z[v]=n,z[w]=0):(r=-r,z[w]=p,z[v]=0,A[v]=n,A[w]=0);var G=d.length;for(d.push([x[0],x[1],x[2]]),d.push([x[0]+z[0],x[1]+z[1],x[2]+z[2]]),d.push([x[0]+z[0]+A[0],x[1]+z[1]+A[1],x[2]+z[2]+A[2]]),d.push([x[0]+A[0],x[1]+A[1],x[2]+A[2]]),e.push([G,G+1,G+2,G+3,r]),o=q+n,m=0;p>m;++m)for(l=q;o>l;++l)a[l+m*C]=0;j+=n,q+=n}else j++,q++}}return{vertices:d,faces:e}}}();c&&(c.mesher=d)},{}],268:[function(a,b,c){"use strict";var d=function(){function a(a,b,c,d){this.color=a,this.left=[[c,b]],this.right=[[d,b]]}return a.prototype.close_off=function(a){this.left.push([this.left[this.left.length-1][0],a]),this.right.push([this.right[this.right.length-1][0],a])},a.prototype.merge_run=function(a,b,c){var d=this.left[this.left.length-1][0],e=this.right[this.right.length-1][0];d!==b&&(this.left.push([d,a]),this.left.push([b,a])),e!==c&&(this.right.push([e,a]),this.right.push([c,a]))},function(b,c){function d(a,d,e){return b[a+c[0]*(d+c[1]*e)]}for(var e=[],f=[],g=0;3>g;++g){var h,i,j,k=(g+1)%3,l=(g+2)%3,m=new Int32Array(3),n=new Int32Array(3),o=new Int32Array(2*(c[k]+1)),p=new Int32Array(c[k]),q=new Int32Array(c[k]),r=new Int32Array(2*c[l]),s=new Int32Array(2*c[l]),t=new Int32Array(24*c[l]),u=[[0,0],[0,0]];for(n[g]=1,m[g]=-1;m[g]<c[g];){var v=[],w=0;for(m[l]=0;m[l]<c[l];++m[l]){var x=0,y=0,z=0;for(m[k]=0;m[k]<c[k];++m[k],y=z){var A=0<=m[g]?d(m[0],m[1],m[2]):0,B=m[g]<c[g]-1?d(m[0]+n[0],m[1]+n[1],m[2]+n[2]):0;z=A,!A==!B?z=0:A||(z=-B),y!==z&&(o[x++]=m[k],o[x++]=z)}o[x++]=c[k],o[x++]=0;for(var C=0,h=0,i=0;w>h&&x-2>i;){var y=v[p[h]],D=y.left[y.left.length-1][0],E=y.right[y.right.length-1][0],F=y.color,G=o[i],H=o[i+2],I=o[i+1];if(H>D&&E>G&&I===F)y.merge_run(m[l],G,H),q[C++]=p[h],++h,i+=2;else{if(E>=H){if(I){var J=new a(I,m[l],G,H);q[C++]=v.length,v.push(J)}i+=2}H>=E&&(y.close_off(m[l]),++h)}}for(;w>h;++h)v[p[h]].close_off(m[l]);for(;x-2>i;i+=2){var G=o[i],H=o[i+2],I=o[i+1];if(I){var J=new a(I,m[l],G,H);q[C++]=v.length,v.push(J)}}var K=q;q=p,p=K,w=C}for(var h=0;w>h;++h){var y=v[p[h]];y.close_off(c[l])}m[g]++;for(var h=0;h<v.length;++h){var y=v[h],z=y.color,L=!1;0>z&&(L=!0,z=-z);for(var i=0;i<y.left.length;++i){r[i]=e.length;var M=[0,0,0],N=y.left[i];M[g]=m[g],M[k]=N[0],M[l]=N[1],e.push(M)}for(var i=0;i<y.right.length;++i){s[i]=e.length;var M=[0,0,0],N=y.right[i];M[g]=m[g],M[k]=N[0],M[l]=N[1],e.push(M)}var O=0,P=0,Q=1,R=1,S=!0;for(t[P++]=r[0],t[P++]=y.left[0][0],t[P++]=y.left[0][1],t[P++]=s[0],t[P++]=y.right[0][0],t[P++]=y.right[0][1];Q<y.left.length||R<y.right.length;){var T=!1;if(Q===y.left.length)T=!0;else if(R!==y.right.length){var U=y.left[Q],V=y.right[R];T=U[1]>V[1]}var W=T?s[R]:r[Q],X=T?y.right[R]:y.left[Q];if(T!==S)for(;P>O+3;)L===T?f.push([t[O],t[O+3],W,z]):f.push([t[O+3],t[O],W,z]),O+=3;else for(;P>O+3;){for(var i=0;2>i;++i)for(var j=0;2>j;++j)u[i][j]=t[P-3*(i+1)+j+1]-X[j];var Y=u[0][0]*u[1][1]-u[1][0]*u[0][1];if(T===Y>0)break;0!==Y&&(L===T?f.push([t[P-3],t[P-6],W,z]):f.push([t[P-6],t[P-3],W,z])),P-=3}t[P++]=W,t[P++]=X[0],t[P++]=X[1],T?++R:++Q,S=T}}}}return{vertices:e,faces:f}}}();c&&(c.mesher=d)},{}],269:[function(a,b,c){function d(a,b){var c=[],d=[],e=[0,0,0],f=0;for(e[2]=0;e[2]<b[2];++e[2])for(e[1]=0;e[1]<b[1];++e[1])for(e[0]=0;e[0]<b[0];++e[0],++f)if(a[f])for(var g=0;3>g;++g){var h=[e[0],e[1],e[2]],i=[0,0,0],j=[0,0,0];i[(g+1)%3]=1,j[(g+2)%3]=1;for(var k=0;2>k;++k){h[g]=e[g]+k;var l=i;i=j,j=l;var m=c.length;c.push([h[0],h[1],h[2]]),c.push([h[0]+i[0],h[1]+i[1],h[2]+i[2]]),c.push([h[0]+i[0]+j[0],h[1]+i[1]+j[1],h[2]+i[2]+j[2]]),c.push([h[0]+j[0],h[1]+j[1],h[2]+j[2]]),d.push([m,m+1,m+2,m+3,a[f]])}}return{vertices:c,faces:d}}c&&(c.mesher=d)},{}],270:[function(a,b){b.exports=a(66)},{}],271:[function(a,b){var c=a("./lib/channel.js");b.exports=function(){return new c}},{"./lib/channel.js":272}],272:[function(a,b){function c(a){return this instanceof c?(this._initialize(a),void 0):new c(a)}function d(a,b){var c=b.indexOf(a);-1!==c&&b.splice(c,1)}var e=a("./walkietalkie.js");b.exports=c,c.prototype.WalkieTalkie=function(){var a=this,b=new e(a);return a.subscribers.push(b),b},c.prototype._initialize=function(){var a=this;a.subscribers=[]},c.prototype._emit=function(a,b){var c=this;c.subscribers.map(function(c){if(c!==a){var d=c.emitter;d.emit.call(d,"*",b),d.emit.apply(d,b)}})},c.prototype._unsubscribe=function(a){var b=this;-1===b.subscribers.indexOf(a)&&(d(a,b.subscribers),a.destroy())}},{"./walkietalkie.js":273}],273:[function(a,b){function c(a){return this instanceof c?(this._initialize(a),void 0):new c(a)}var d=(a("extend"),a("async")),e=a("events").EventEmitter;b.exports=c,c.prototype.emit=function(){var a=this,b=arguments;d.nextTick(function(){a.channel._emit(a,b)})},c.prototype.on=function(){var a=this,b=a.emitter;b.on.apply(b,arguments)},c.prototype.destroy=function(){var a=this;a.emitter&&delete a.emitter,a.channel._unsubscribe(a)},c.prototype._initialize=function(a){var b=this;b.channel=a,b.emitter=new e}},{async:274,events:33,extend:30}],274:[function(a,b){var c=a("__browserify_process");!function(){function a(a){var b=!1;return function(){if(b)throw new Error("Callback was already called.");b=!0,a.apply(d,arguments)}}var d,e,f={};d=this,null!=d&&(e=d.async),f.noConflict=function(){return d.async=e,f};var g=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},h=function(a,b){if(a.map)return a.map(b);var c=[];return g(a,function(a,d,e){c.push(b(a,d,e))}),c},i=function(a,b,c){return a.reduce?a.reduce(b,c):(g(a,function(a,d,e){c=b(c,a,d,e)}),c)},j=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};"undefined"!=typeof c&&c.nextTick?(f.nextTick=c.nextTick,f.setImmediate="undefined"!=typeof setImmediate?setImmediate:f.nextTick):"function"==typeof setImmediate?(f.nextTick=function(a){setImmediate(a)},f.setImmediate=f.nextTick):(f.nextTick=function(a){setTimeout(a,0)},f.setImmediate=f.nextTick),f.each=function(b,c,d){if(d=d||function(){},!b.length)return d();var e=0;g(b,function(f){c(f,a(function(a){a?(d(a),d=function(){}):(e+=1,e>=b.length&&d(null))}))})},f.forEach=f.each,f.eachSeries=function(a,b,c){if(c=c||function(){},!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c(null):e())})};e()},f.forEachSeries=f.eachSeries,f.eachLimit=function(a,b,c,d){var e=k(b);e.apply(null,[a,c,d])},f.forEachLimit=f.eachLimit;var k=function(a){return function(b,c,d){if(d=d||function(){},!b.length||0>=a)return d();var e=0,f=0,g=0;!function h(){if(e>=b.length)return d();for(;a>g&&f<b.length;)f+=1,g+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,g-=1,e>=b.length?d():h())})}()}},l=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[f.each].concat(b))}},m=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[k(a)].concat(c))}},n=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[f.eachSeries].concat(b))}},o=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)
})},function(a){d(a,e)})};f.map=l(o),f.mapSeries=n(o),f.mapLimit=function(a,b,c,d){return p(b)(a,c,d)};var p=function(a){return m(a,o)};f.reduce=function(a,b,c,d){f.eachSeries(a,function(a,d){c(b,a,function(a,c){b=c,d(a)})},function(a){d(a,b)})},f.inject=f.reduce,f.foldl=f.reduce,f.reduceRight=function(a,b,c,d){var e=h(a,function(a){return a}).reverse();f.reduce(e,b,c,d)},f.foldr=f.reduceRight;var q=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c&&e.push(a),b()})},function(){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};f.filter=l(q),f.filterSeries=n(q),f.select=f.filter,f.selectSeries=f.filterSeries;var r=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c||e.push(a),b()})},function(){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};f.reject=l(r),f.rejectSeries=n(r);var s=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(){d()})};f.detect=l(s),f.detectSeries=n(s),f.some=function(a,b,c){f.each(a,function(a,d){b(a,function(a){a&&(c(!0),c=function(){}),d()})},function(){c(!1)})},f.any=f.some,f.every=function(a,b,c){f.each(a,function(a,d){b(a,function(a){a||(c(!1),c=function(){}),d()})},function(){c(!0)})},f.all=f.every,f.sortBy=function(a,b,c){f.map(a,function(a,c){b(a,function(b,d){b?c(b):c(null,{value:a,criteria:d})})},function(a,b){if(a)return c(a);var d=function(a,b){var c=a.criteria,d=b.criteria;return d>c?-1:c>d?1:0};c(null,h(b.sort(d),function(a){return a.value}))})},f.auto=function(a,b){b=b||function(){};var c=j(a);if(!c.length)return b(null);var d={},e=[],h=function(a){e.unshift(a)},k=function(a){for(var b=0;b<e.length;b+=1)if(e[b]===a)return e.splice(b,1),void 0},l=function(){g(e.slice(0),function(a){a()})};h(function(){j(d).length===c.length&&(b(null,d),b=function(){})}),g(c,function(c){var e=a[c]instanceof Function?[a[c]]:a[c],m=function(a){var e=Array.prototype.slice.call(arguments,1);if(e.length<=1&&(e=e[0]),a){var h={};g(j(d),function(a){h[a]=d[a]}),h[c]=e,b(a,h),b=function(){}}else d[c]=e,f.setImmediate(l)},n=e.slice(0,Math.abs(e.length-1))||[],o=function(){return i(n,function(a,b){return a&&d.hasOwnProperty(b)},!0)&&!d.hasOwnProperty(c)};if(o())e[e.length-1](m,d);else{var p=function(){o()&&(k(p),e[e.length-1](m,d))};h(p)}})},f.waterfall=function(a,b){if(b=b||function(){},a.constructor!==Array){var c=new Error("First argument to waterfall must be an array of functions");return b(c)}if(!a.length)return b();var d=function(a){return function(c){if(c)b.apply(null,arguments),b=function(){};else{var e=Array.prototype.slice.call(arguments,1),g=a.next();g?e.push(d(g)):e.push(b),f.setImmediate(function(){a.apply(null,e)})}}};d(f.iterator(a))()};var t=function(a,b,c){if(c=c||function(){},b.constructor===Array)a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.each(j(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}};f.parallel=function(a,b){t({map:f.map,each:f.each},a,b)},f.parallelLimit=function(a,b,c){t({map:p(b),each:k(b)},a,c)},f.series=function(a,b){if(b=b||function(){},a.constructor===Array)f.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},b);else{var c={};f.eachSeries(j(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),c[b]=e,d(a)})},function(a){b(a,c)})}},f.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},f.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var u=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};f.concat=l(u),f.concatSeries=n(u),f.whilst=function(a,b,c){a()?b(function(d){return d?c(d):(f.whilst(a,b,c),void 0)}):c()},f.doWhilst=function(a,b,c){a(function(d){return d?c(d):(b()?f.doWhilst(a,b,c):c(),void 0)})},f.until=function(a,b,c){a()?c():b(function(d){return d?c(d):(f.until(a,b,c),void 0)})},f.doUntil=function(a,b,c){a(function(d){return d?c(d):(b()?c():f.doUntil(a,b,c),void 0)})},f.queue=function(b,c){function d(a,b,d,e){b.constructor!==Array&&(b=[b]),g(b,function(b){var g={data:b,callback:"function"==typeof e?e:null};d?a.tasks.unshift(g):a.tasks.push(g),a.saturated&&a.tasks.length===c&&a.saturated(),f.setImmediate(a.process)})}void 0===c&&(c=1);var e=0,h={tasks:[],concurrency:c,saturated:null,empty:null,drain:null,push:function(a,b){d(h,a,!1,b)},unshift:function(a,b){d(h,a,!0,b)},process:function(){if(e<h.concurrency&&h.tasks.length){var c=h.tasks.shift();h.empty&&0===h.tasks.length&&h.empty(),e+=1;var d=function(){e-=1,c.callback&&c.callback.apply(c,arguments),h.drain&&h.tasks.length+e===0&&h.drain(),h.process()},f=a(d);b(c.data,f)}},length:function(){return h.tasks.length},running:function(){return e}};return h},f.cargo=function(a,b){var c=!1,d=[],e={tasks:d,payload:b,saturated:null,empty:null,drain:null,push:function(a,c){a.constructor!==Array&&(a=[a]),g(a,function(a){d.push({data:a,callback:"function"==typeof c?c:null}),e.saturated&&d.length===b&&e.saturated()}),f.setImmediate(e.process)},process:function i(){if(!c){if(0===d.length)return e.drain&&e.drain(),void 0;var f="number"==typeof b?d.splice(0,b):d.splice(0),j=h(f,function(a){return a.data});e.empty&&e.empty(),c=!0,a(j,function(){c=!1;var a=arguments;g(f,function(b){b.callback&&b.callback.apply(null,a)}),i()})}},length:function(){return d.length},running:function(){return c}};return e};var v=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(b?console.error&&console.error(b):console[a]&&g(c,function(b){console[a](b)}))}]))}};f.log=v("log"),f.dir=v("dir"),f.memoize=function(a,b){var c={},d={};b=b||function(a){return a};var e=function(){var e=Array.prototype.slice.call(arguments),f=e.pop(),g=b.apply(null,e);g in c?f.apply(null,c[g]):g in d?d[g].push(f):(d[g]=[f],a.apply(null,e.concat([function(){c[g]=arguments;var a=d[g];delete d[g];for(var b=0,e=a.length;e>b;b++)a[b].apply(null,arguments)}])))};return e.memo=c,e.unmemoized=a,e},f.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}},f.times=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return f.map(d,b,c)},f.timesSeries=function(a,b,c){for(var d=[],e=0;a>e;e++)d.push(e);return f.mapSeries(d,b,c)},f.compose=function(){var a=Array.prototype.reverse.call(arguments);return function(){var b=this,c=Array.prototype.slice.call(arguments),d=c.pop();f.reduce(a,c,function(a,c,d){c.apply(b,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,c){d.apply(b,[a].concat(c))})}};var w=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,function(a,b){a.apply(c,d.concat([b]))},e)};if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);return c.apply(this,d)}return c};f.applyEach=l(w),f.applyEachSeries=n(w),f.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d}a(c)}c()},"undefined"!=typeof define&&define.amd?define([],function(){return f}):"undefined"!=typeof b&&b.exports?b.exports=f:d.async=f}()},{__browserify_process:40}],275:[function(a,b){function c(a,b){var c=this;d.Stream.call(this),this.readable=!0,this.writable=!0,"object"==typeof a?(this.ws=a,this.ws.on("message",this.onMessage.bind(this)),this.ws.on("error",this.onError.bind(this)),this.ws.on("close",this.onClose.bind(this)),this.ws.on("open",function(){c.emit("open")})):(this.ws=new WebSocket(a,b),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this),this.ws.onclose=this.onClose.bind(this))}var d=a("stream"),e=a("util");e.inherits(c,d.Stream),b.exports=function(a,b){return new c(a,b)},b.exports.WebsocketStream=c,c.prototype.onMessage=function(a,b){return a.data?this.emit("data",a.data,b):(this.emit("data",a,b),void 0)},c.prototype.onError=function(a){this.emit("error",a)},c.prototype.onClose=function(){this.emit("end")},c.prototype.write=function(a){return this.ws.send(a)},c.prototype.end=function(){this.ws.close()}},{stream:50,util:59}],276:[function(a){window.App=Ember.Application.create({LOG_TRANSITIONS:!0,LOG_TRANSITIONS_INTERNAL:!0,LOG_ACTIVE_GENERATION:!0}),a("./routes/_index.js"),a("./controllers/_index.js"),a("./views/_index.js")},{"./controllers/_index.js":277,"./routes/_index.js":281,"./views/_index.js":294}],277:[function(a){a("./application.js"),a("./create/index.js"),a("./host/index.js")},{"./application.js":278,"./create/index.js":279,"./host/index.js":280}],278:[function(a){var b=a("websocket-stream"),c=a("duplex-emitter"),d=a("level-user"),e=a("voxel-level"),f=a("hat"),g=(a("walkietalkie"),a("concat-stream")),h=a("../voxel/client.js"),i=a("../voxel/server.js"),j=a("../util/rtc_utils.js");App.ApplicationController=Em.Controller.extend({joinGame:function(a){var b=this,c=b.get("rtcConnectionHash");a===c?Em.run.next(function(){var a=document.getElementById("gameContainer");a.innerText="Temporary: This is the server only. Open current URL in new window to join."}):b.connectToRtcHost(a)},joinLobby:function(){var a=this,d="ws://"+document.domain+":8000/",e=b(d);e.on("end",function(){console.log("disconnected from server :(")}),e.on("error",function(a){console.log(a)});var f=c(e);a.connectClientToServer(f)},startGameServer:function(a,b){var c=this,d=c.get("voxelDb"),e=new i({worldId:a.name,voxelDb:d});c.set("server",e),e.on("ready",function(){var a=c.setupRtcHost();c.set("rtcConnectionHash",a),b(a)})},getWorlds:function(a){var b,c=this.get("user"),d=c.db.sublevel("worlds").createValueStream({valueEncoding:"json"});d.pipe(g(function(c){c||(c=[]),b||a(!1,c)})),d.on("error",function(c){b=!0,a(c)})},showGame:!1,user:d({dbName:"voxeljs",baseURL:document.domain}),voxelDb:Em.computed("user",function(){var a=this.get("user");return a?e(a.db):void 0}),client:null,server:null,rtcConnection:null,connectClientToServer:function(a,b){var c=this;Em.run.next(function(){var d=new h({connection:a,container:document.querySelector("#container")});c.set("client",d),b&&c.get("server").connectClient(b)})},setupRtcHost:function(){var a=f(),b=j.RtcConnection(a);return b.on("connectionEstablished",server.connectClient.bind(server)),b.on("connectionLost",server.removeClient.bind(server)),a},connectToRtcHost:function(a){var b=this,c=j.connectToHost(a);return c.on("connectionEstablished",b.connectClientToServer.bind(b)),c.on("connectionLost",function(){console.error("connection lost")}),c}})},{"../util/rtc_utils.js":293,"../voxel/client.js":296,"../voxel/server.js":305,"concat-stream":7,"duplex-emitter":22,hat:60,"level-user":67,"voxel-level":214,walkietalkie:271,"websocket-stream":275}],279:[function(a){var b=a("hat"),c=a("voxel");App.CreateIndexController=Em.ArrayController.extend({needs:["application"],content:null,worldName:null,worldNameEmpty:Em.computed.empty("worldName"),worldSettingsInvalid:Em.computed.alias("worldNameEmpty"),actions:{generateWorld:function(a){var d=this,e=d.controllerFor("application"),f=d.get("worldName"),g=2,h=c({});voxelDb=e.get("voxelDb");for(var a={id:b(),name:f,published:!1},i=-g;g>=i;i++)for(var j=-g;g>=j;j++)for(var k=-g;g>=k;k++){var l=h.generateChunk(i,j,k);voxelDb.store(f,l,function(a){if(a)throw a})}voxelDb.db.sublevel("worlds").put(a.id,a,{valueEncoding:"json"},function(a){if(a)throw a;d.transitionToRoute("host")})}}})},{hat:60,voxel:265}],280:[function(){App.HostIndexController=Em.ArrayController.extend({content:null,actions:{launchWorld:function(a){var b=this,c=b.controllerFor("application");c.startGameServer(a,function(a){b.transitionToRoute("join.rtc",a)})}}})},{}],281:[function(a){a("./router.js"),a("./application.js"),a("./menu/route.js"),a("./join/route.js"),a("./host/route.js")},{"./application.js":282,"./host/route.js":284,"./join/route.js":288,"./menu/route.js":291,"./router.js":292}],282:[function(a){App.ApplicationRoute=Em.Route.extend({}),a("./index.js")},{"./index.js":285}],283:[function(){App.HostIndexRoute=Em.Route.extend({needs:["application"],setupController:function(a){var b=this,c=b.controllerFor("application");c.getWorlds(function(b,c){if(b)throw b;a.set("content",c)})}})},{}],284:[function(a){App.HostRoute=Em.Route.extend({}),a("./index.js")},{"./index.js":283}],285:[function(){App.IndexRoute=Em.Route.extend({activate:function(){console.log("index route")},redirect:function(){this.transitionTo("menu")}})},{}],286:[function(){App.JoinIndexRoute=Em.Route.extend({})},{}],287:[function(){App.JoinLobbyRoute=Em.Route.extend({needs:["application"],setupController:function(){var a=this,b=a.controllerFor("application");b.joinLobby()}})},{}],288:[function(a){App.JoinRoute=Em.Route.extend({activate:function(){this.controllerFor("application").set("showGame",!0)},deactivate:function(){this.controllerFor("application").set("showGame",!1)}}),a("./index.js"),a("./lobby/route.js"),a("./rtc/route.js")},{"./index.js":286,"./lobby/route.js":287,"./rtc/route.js":289}],289:[function(){App.JoinRtcRoute=Em.Route.extend({needs:["application"],model:function(a){return a.server_id},setupController:function(a,b){var c=this,d=c.controllerFor("application");d.joinGame(b)}})},{}],290:[function(){App.MenuIndexRoute=Em.Route.extend({})},{}],291:[function(a){App.MenuRoute=Em.Route.extend({}),a("./index.js")},{"./index.js":290}],292:[function(){App.Router.map(function(){this.resource("menu",function(){this.route("settings")}),this.resource("create",function(){}),this.resource("join",function(){this.route("lobby"),this.resource("join.rtc",{path:"rtc/:server_id"})}),this.resource("host",function(){})})},{}],293:[function(a,b){function c(a){var b=d(),c=b.connect(a,{reliable:!0});return c.on("open",function(){e(b,c)}),b}function d(a){var b=new f(a,{key:i});return b.on("open",function(a){console.log(">> opened, got id:",a)}),b.on("error",function(a){throw console.log(">> had error:"),a}),b.on("close",function(){console.log(">> closed")}),b.on("connection",function(a){console.log(">> got connection"),a.on("open",function(){e(b,a)})}),b}function e(a,b){console.log(">-> connection opened");var c=g(b.dataChannel),d=h(c);b.on("error",function(a){throw console.log(">-> connection had error:"),a}),b.on("close",function(){console.log(">-> connection closed"),a.emit("connectionLost",d)}),a.emit("connectionEstablished",d)}var f=a("peerjs").Peer,g=a("rtc-data-stream"),h=a("duplex-emitter");const i="2pl4khtrswa8m2t9";b.exports={RtcConnection:d,connectToHost:c}},{"duplex-emitter":22,peerjs:164,"rtc-data-stream":165}],294:[function(){},{}],295:[function(a,b){b.exports=function(a){function b(a){a.stopPropagation()}function c(a){var b=a.user+": "+a.text;d(b)}function d(a){var b=document.createElement("li");b.innerHTML=a,f.appendChild(b),f.scrollTop=f.scrollHeight}var e=a.element.querySelector("#cmd"),f=a.element.querySelector("#messages");return a.emitter.on("chat",c),a.element.addEventListener("keyup",function(b){if(13===b.keyCode){var c=e.value;if(c){c=c.slice(0,140);var d={user:a.user,text:c};a.emitter.emit("chat",d),e.value="",e.blur()}}}),window.addEventListener("keyup",function(a){13===a.keyCode&&e.focus()}),a.element.addEventListener("keypress",b),a.element.addEventListener("keydown",b),a.element.addEventListener("keyup",b),{showMessage:d,emitChat:c}}},{}],296:[function(require,module,exports){function Client(a){return this instanceof Client?(this.initialize(a),void 0):new Client(a)}var extend=require("extend"),toolbar=require("toolbar"),createClient=require("voxel-client"),highlight=require("voxel-highlight"),rescue=require("voxel-rescue"),chat=require("./chat.js"),codeBeam=require("./codeBeam.js"),codeEditor=require("./codeEditor.js"),playerTools=require("./defaultTools.js"),modvox=require("./features/modvox/client.js"),entity=require("./features/entity/client.js");require("minecraft-skin");var trigger=require("spatial-trigger"),aabb=require("aabb-3d");module.exports=Client,Client.prototype.initialize=function(a){var b=this;window.client=b;var c={container:document.body,texturePath:"./textures/",playerTexture:"player.png"},d=b.settings=extend({},c,a);b.connection=d.connection,b.baseClient=createClient(d),b.bindServerEvents(),b.bindClientEvents(),b.modvox=modvox(b),b.entity=entity(b)},Client.prototype.bindServerEvents=function(){var self=this,connection=self.connection;connection.on("id",function(a){console.log("got id",a)}),connection.on("settings",function(){console.log("got settings")}),self.spatialTriggers=[],connection.on("spatialTrigger",function(spatialTrigger){spatialTrigger.enter=eval("(function(){ return "+spatialTrigger.enter+" })()")||function(){},spatialTrigger.exit=eval("(function(){ return "+spatialTrigger.exit+" })()")||function(){},self.baseClient.on("loadComplete",function(){self._createSpatialTrigger(spatialTrigger)})})},Client.prototype.bindClientEvents=function(){var a=this,b=a.baseClient;b.on("missingChunk",function(){throw"missing chunk"}),b.on("loadComplete",function(){console.log("got initial chunks");var c=a.game=b.game;c.appendTo(a.settings.container),a.setup()}),b.on("error",function(a){"game not capable"==a?alert("Browser does not meet requirements, sry :("):console.error(a)})},Client.prototype.setup=function(){function a(a,c){k++,setTimeout(function(){k--,b(a,c)},100*k)}function b(a,b){f.setBlock(a,b),h.emit("set",a,b)}function c(a,b,c,e){"function"!=typeof c&&(c=function(){}),"function"!=typeof e&&(e=function(){}),d._createSpatialTrigger({pos:a,size:b,enter:c,exit:e}),d.connection.emit("spatialTrigger",{pos:a,size:b,enter:c.toString(),exit:e.toString()})}var d=this,e=d.baseClient,f=e.game,g=e.avatar,h=d.connection;d.chat=chat({user:e.name,element:document.getElementById("chat"),emitter:h}),h.on("join",function(a){var b=a+" joined.";d.chat.showMessage(b)}),h.on("leave",function(a){var b=a+" left.";d.chat.showMessage(b)}),d.codeEditor=codeEditor.initialize(f),d.codeBeam=codeBeam.initialize(d.codeEditor),window.addEventListener("keydown",function(a){192===a.keyCode&&(a.stopPropagation(),a.preventDefault(),d.codeEditor.isOpen?d.codeEditor.close():d.codeBeam.editTool())}),rescue(f,{dangerZone:{lower:{x:-1/0,y:-1/0,z:-1/0},upper:{x:1/0,y:-20,z:1/0}},startingPosition:f.settings.avatarInitialPosition}),f.highlighter=highlight(f,{color:16711680}),window.addEventListener("keydown",function(a){a.keyCode==="R".charCodeAt(0)&&g.toggle()});var i=toolbar({el:"#blocks",toolbarKeys:["t","y","u","i","o","p","openbracket","closebracket","backslash","g","h","j","k","l","semicolon","singlequote"]});i.setContent(f.materialNames.map(function(a,b){return Array.isArray(a)&&(a=a[0]),{id:b+1,icon:"textures/"+a+".png",label:a}})),i.on("select",function(a){g.currentMaterial=Number(a)}),i.switchToolbar(0);var j=toolbar({el:"#tools"});j.setContent(playerTools.map(function(a,b){var c=(b+1)%10;return{id:b,icon:"img/numIcon-"+c+".gif",label:a.name}})),j.on("select",function(a){var b=playerTools[a];d.codeBeam.setCurrentTool(b)}),j.switchToolbar(0),f.on("fire",function(){var b=Boolean(f.controls.state.alt||f.controls.state.firealt);f.highlighter.highlight(),d.codeBeam.runCode({game:f,avatar:g,hitBlock:b?f.highlighter.currVoxelAdj:f.highlighter.currVoxelPos,secondaryClick:b,client:d,setBlock:a,getBlock:f.getBlock.bind(f),require:require,createSpatialTrigger:c,openModVox:d.modvox.openModVox,setModVox:d.modvox.setModVox,createNpc:d.entity.createNpc,selectEntity:d.entity.selectEntity,updateEntity:d.entity.updateEntity})});var k=0},Client.prototype._createSpatialTrigger=function(a){var b=this,c=b.baseClient.game;b.spatialTriggers.push(a);var d=aabb(a.pos,a.size);c.addAABBMarker(d),trigger(c.spatial,d).on("exit",a.exit).on("enter",a.enter)}},{"./chat.js":295,"./codeBeam.js":297,"./codeEditor.js":298,"./defaultTools.js":299,"./features/entity/client.js":300,"./features/modvox/client.js":302,"aabb-3d":5,extend:30,"minecraft-skin":162,"spatial-trigger":166,toolbar:167,"voxel-client":172,"voxel-highlight":211,"voxel-rescue":224}],297:[function(require,module,exports){var envVars=["game","avatar","hitBlock","secondaryClick","setBlock","getBlock","client","require","createSpatialTrigger","setModVox","openModVox","createNpc","selectEntity","updateEntity"],self=module.exports={currentTool:null,initialize:function(a){return self.codeEditor=a,self},setCurrentTool:function(a){self.currentTool=a,self.codeEditor.isOpen&&self.editTool(a)},editTool:function(a){a=a||self.currentTool,self.codeEditor.open(a.code,function(b){a.code=b,a.func=self.compile(b)})},runCode:function(a){console.log("running code:\n",self.currentTool.code),self.currentTool.func(a)},compile:function(userCode){var preamble=envVars.map(function(a){return"var "+a+" = environment."+a+";"}).join("\n")+"\n\n//======= end of preamble ========\n\n",code=preamble+userCode,compiledFunc;return eval("compiledFunc = function(environment) {\n"+code+"\n}"),compiledFunc}}},{}],298:[function(a,b){var c=a("javascript-editor"),d=b.exports={jsEditor:null,container:null,isOpen:!1,initialize:function(a){function b(a){192!==a.keyCode&&a.stopPropagation()}return d.game=a,d.container=document.getElementById("jseditor"),d.jsEditor=c({container:d.container,theme:"monokai"}),d.container.addEventListener("keydown",function(a){27===a.keyCode&&d.isOpen&&d.container.childNodes[0].classList.contains("CodeMirror-focused")&&(d.jsEditor.editor.getInputField().blur(),a.stopPropagation())}),window.addEventListener("keydown",function(a){27===a.keyCode&&d.isOpen&&(d.close(),a.stopPropagation())}),d.container.addEventListener("keypress",b),d.container.addEventListener("keydown",b),d.container.addEventListener("keyup",b),d.jsEditor.element.parentElement.classList.add("hidden"),d},close:function(){d.isOpen&&(d.isOpen=!1,d.jsEditor.element.parentElement.classList.add("hidden"),d.game.interact.request(),d.finalizeCode())},open:function(a,b){a=a||String(),d.isOpen&&d.finalizeCode(),d.isOpen=!0,d.jsEditor.editor.focus(),d.jsEditor.element.parentElement.classList.remove("hidden"),d.game.interact.release(),d.jsEditor.setValue(a),d.onComplete=b},finalizeCode:function(){var a=d.jsEditor.getValue();d.onComplete&&d.onComplete(a)}}},{"javascript-editor":61}],299:[function(a,b){function c(a,b){return{name:a,code:b,func:e(b)}}function d(){return c("","//write your own tool here")}for(var e=(a("fs"),a("./codeBeam.js").compile),f={mine:"// click to remove block, control-click to place block\nif (!hitBlock) return\n\nif (secondaryClick) {\n  setBlock(hitBlock, avatar.currentMaterial)\n} else {\n  setBlock(hitBlock, 0)\n}",activate:"// activate a modvox... hope its safe!\n\nvar code = client.modvoxes[hitBlock.join('|')]\neval(code)",modvox:"// click to activate a modvox, control-click to place modvox\n\nif (secondaryClick) {\n  // color box\n  setBlock(hitBlock,11)\n  // default code\n  var code = \"alert('i haz a modvox')\"\n  // create modvox\n  setModVox(hitBlock,code)\n  // open modvox in editor\n  openModVox(hitBlock)\n} else {\n  // open modvox in editor\n  openModVox(hitBlock)\n}",change:"//change highlighted block to selected material\nsetBlock(hitBlock,avatar.currentMaterial)",stairs:"// Make stairs\n \nvar pos\n  \nfor (var i=0;i<10;i++)\n{\n  // copy hit location\n  pos = hitBlock.slice()\n  // increase `x` by i\n  pos[0] += i\n  for (var g=0;g<i;g++)\n  {\n    // copy `pos`\n    newPos = pos.slice()\n    // increase `y` by g\n    newPos[1] += g\n    // set the block\n    setBlock(newPos,avatar.currentMaterial)\n  }\n \n}",house:"// Make stairs\n \nvar pos = hitBlock.slice()\n\nvar width = 8\n\nvar xmax = width\nvar ymax = width\nvar zmax = width\n\nfor (var x=0;x<xmax;x++)\n{\n  for (var y=0;y<ymax;y++)\n  {\n    for (var z=0;z<zmax;z++)\n    {\n      var fillBlock = false\n      \n      // walls\n      if (x==0 || x==(xmax-1)) fillBlock = true\n      if (z==0 || z==(zmax-1)) fillBlock = true\n      if (y==0 || y==(ymax-1)) fillBlock = true\n      \n      // door\n      var doorx = Math.floor(xmax/2)\n      if ((x==doorx || x==doorx+1) && z==0 && (y<(ymax/2) && y!=0)) fillBlock = false\n\n      // set voxel\n      if (fillBlock) {\n        var newPos = pos.slice()\n        newPos[0] += x\n        newPos[1] += y\n        newPos[2] += z\n        setBlock(newPos,avatar.currentMaterial)\n      }\n    }\n  }\n}",teleport:"//teleport on top of the selected block\n\n// copy hit position\nvar pos = hitBlock.slice()\n// increase `y` by one\npos[1] += 1\n// set player position\navatar.position.set(pos[0],pos[1],pos[2])",npc:"// Create or Edit an NPC\n\n// Create Entity\nif (secondaryClick) {\n\n  // copy hit location\n  var pos = hitBlock.slice()\n  // create npc\n  var maxogden = createNpc('player.png',pos)\n\n// Modify Entity\n} else {\n\n  var entity = selectEntity()\n  if (entity) {\n    // open code in editor\n    client.codeEditor.open(entity.update, function(newCode) {\n      // update entity code when done\n      updateEntity({\n        uuid: entity.uuid,\n        update: newCode,\n      })\n    })  \n  }\n\n}\n"},g=b.exports=Object.keys(f).map(function(a){return c(a,f[a].toString())});g.length<10;)g.push(d())},{"./codeBeam.js":297,fs:31}],300:[function(a,b){function c(a,b,c,d,e){return(a-b)*(e-d)/(c-b)+d}var d=a("hat"),e=a("extend"),f=a("minecraft-skin");b.exports=function(a){function b(b,c){var c=c||[0,1,0],e=e||[0,0,0],f={uuid:d(),pos:c,rot:e,skinName:b};a.connection.emit("npc",f);var g=i(f);return g}function g(b){if(!b.uuid)throw"no uuid specified";if(!b.uuid in a.entities)throw"no entity with specified uuid: "+b.uuid;a.connection.emit("npc",b),j(b)}function h(){var b=a.game,c=b.THREE,d=b.cameraPosition(),e=b.cameraVector(),f=new c.Vector3,g=new c.Vector3,h=0,i=50;f.set.apply(f,d),g.set.apply(g,e);var j=new c.Raycaster(f,g,h,i),l=j.intersectObjects(b.scene.children,!0),m=l[0];if(m){var n=k(m.object);return n.entity}}function i(b){var c=b.uuid,d=b.skinName,g=a.game.THREE,h=f(g,d,{scale:new g.Vector3(.04,.04,.04)}),i=h.mesh;i.children[0].position.y=10,a.game.scene.add(i);var j=e({},b,{object:i,npc:h});i.entity=j,delete j.skinName,a.entities[c]=j,a.npcs[c]=h;{var k=h.pos=b.pos;h.rot=b.rot}return i.position.set(k[0],k[1],k[2]),h}function j(b){var c=a.entities[b.uuid];e(c,b)}function k(b){var c=a.game.THREE,d=b.parent;return d instanceof c.Scene||(b=k(d)),b}function l(b,c){var d,e,f=a.npcs[b];a.game&&f&&(d=a.game.THREE,e=f.mesh,c.position&&(f.pos=c.position),c.rotation&&(f.rot=c.rotation))}return a.entities={},a.npcs={},a.connection.on("npc",function(b){b.uuid in a.entities?j(b):i(b)}),a.baseClient.on("loadComplete",function(){a.connection.on("npc.update",l),a.game.on("tick",function(b){var d=a.game.THREE,e=Math.min(b/100,1),f=Object.keys(a.npcs);f.map(function(b){var f=a.npcs[b],g=f.mesh,h=new d.Vector3(f.pos[0],f.pos[1],f.pos[2]),i=new d.Vector3(f.rot[0],f.rot[1],f.rot[2]);g.position.lerp(h,e);var j=i.clone().add(new d.Vector3(0,Math.PI/2,0));g.children[0].rotation.y=g.children[0].rotation.clone().lerp(j,e).y;var k=f.head.rotation.clone().setZ(c(i.x,-1.5,1.5,-.75,.75));f.head.rotation.z=f.head.rotation.clone().lerp(k,e).z})})}),{createNpc:b,updateEntity:g,selectEntity:h}}},{extend:30,hat:60,"minecraft-skin":162}],301:[function(a,b){var c=a("extend"),d=a("../../secureEval.js");b.exports=function(a){function b(){a.voxelDb.db.put("npcs",JSON.stringify(a.entities))}function e(){var b=Object.keys(a.entities),c=b.map(function(b){return a.entities[b]});c.map(function(a){a.update&&f(a,a.update)}),setTimeout(e,500)}function f(b,c){function e(c){b.pos=c,a.baseServer.broadcast(null,"npc.update",b.uuid,{position:c})}function f(c){b.rot=c,a.baseServer.broadcast(null,"npc.update",b.uuid,{rotation:c})}function g(a){var c=b.pos.slice();c[0]+=a[0],c[1]+=a[1],c[2]+=a[2],e(c)}function h(a){var c=b.rot.slice();c[0]+=a[0],c[1]+=a[1],c[2]+=a[2],f(c)}d(c,b,{setPosition:e,setRotation:f,move:g,rotate:h})}a.entities={},a.voxelDb.db.get("npcs",function(b,c){a.entities=c?JSON.parse(c):{}}),a.baseServer.on("npc",function(d){console.log("npc incomming!",d);var e=d.uuid,f=a.entities[e];f?c(f,d):a.entities[e]=d,b()}),a.baseServer.on("client.created",function(b){Object.keys(a.entities).map(function(c){var d=a.entities[c];b.connection.emit("npc",d)})}),setTimeout(e,500)}},{"../../secureEval.js":304,extend:30}],302:[function(a,b){b.exports=function(a){function b(b,c){a.modvoxes[b.join("|")]=c,a.connection.emit("modvox",b,c)}function c(c){if(void 0!==a.modvoxes[c.join("|")]){var d=a.modvoxes[c.join("|")];a.codeEditor.open(d,function(a){b(c,a)})}}return a.modvoxes={},a.connection.on("modvox",function(b,c){a.modvoxes[b.join("|")]=c}),{setModVox:b,openModVox:c}}},{}],303:[function(a,b){b.exports=function(a){function b(){a.voxelDb.db.put("modvoxes",JSON.stringify(a.modvoxes))}a.modvoxes={},a.voxelDb.db.get("modvoxes",function(b,c){a.modvoxes=c?JSON.parse(c):{}}),a.baseServer.on("modvox",function(c,d){a.modvoxes[c.join("|")]=d,b()}),a.baseServer.on("set",function(c){var d=a.modvoxes[c.join("|")];d&&(delete a.modvoxes[c.join("|")],b())}),a.baseServer.on("client.join",function(b){Object.keys(a.modvoxes).map(function(c){var d=a.modvoxes[c],e=c.split("|");b.connection.emit("modvox",e,d)})})}},{}],304:[function(require,module,exports){module.exports=function(userCode,self,environment){environment=environment||{};var output,envVars=Object.keys(environment);try{var process={},window={},require=function(){throw"require not supported in NPC scripts"},preamble=String();preamble+="\n\n//======= start of preamble ========\n\n",preamble+=envVars.map(function(a){return"var "+a+" = environment."+a+";"}).join("\n"),preamble+="\n\n//======= end of preamble ========\n\n";var code=preamble+userCode;func=eval("(function(environment) {\n"+code+"\n})"),output=func.call(self,environment)}catch(error){console.error("-- secureEval error --"),console.log(error,error.stack,code)}return output}},{}],305:[function(a,b){function c(a){return this instanceof c?(this.initialize(a),void 0):new c(a)}var d=(a("path"),a("extend")),e=a("events").EventEmitter,f=a("voxel-server"),g=a("./features/modvox/server.js"),h=a("./features/entity/server.js");b.exports=c,c.prototype.connectClient=function(a){var b=this;b.baseServer.connectClient(a),console.log(a.id,"joined")},c.prototype.removeClient=function(a){var b=this;b.baseServer.removeClient(a),console.log(a.id,"left")},c.prototype.initialize=function(a){var b=this;"undefined"!=typeof window&&(window.server=b);var c={generateChunks:!1,chunkDistance:2,materials:[["grass","dirt","grass_dirt"],"dirt","plank","cobblestone","brick","bedrock","glowstone","netherrack","obsidian","diamond","whitewool","redwool","bluewool"],avatarInitialPosition:[2,20,2],forwardEvents:["chat","spatialTrigger"]},i=b.settings=d({},c,a);b.voxelDb=i.voxelDb,delete i.voxelDb,i.forwardEvents.push("modvox"),i.forwardEvents.push("npc");var j=b.baseServer=f(i);b.game=j.game,b.spatialTriggers=[],d(b,new e),b.bindEvents(),g(b),h(b)},c.prototype.bindEvents=function(){function a(a){c.voxelDb.store(d.worldId,a,function(a){a&&console.error("chunk store error",a.stack)})}function b(a){var b=c.game,e=b.chunkSize,f=[e,e,e];c.voxelDb.load(d.worldId,a,f,function(d,e){if(d)return console.error("chunk load error",d.stack);var e={position:a,voxels:new Uint8Array(e.voxels.buffer),dims:e.dimensions};b.showChunk(e),c.emit("chunkLoaded",e)})}var c=this,d=c.settings,e=c.baseServer,f=c.game;c.setupSpatialTriggers(),e.on("missingChunk",b),e.on("set",function(b){var c=f.getChunkAtPosition(b);a(c)});var g=0,h=Math.pow(2*c.game.voxels.distance,3);c.on("chunkLoaded",function(){g++,g===h&&c.emit("ready")}),f.voxels.requestMissingChunks(f.worldOrigin),e.on("chat",function(a){console.log("chat - ",a)
}),e.on("error",function(a){console.log("error - error caught in server:"),console.log(a.stack)})},c.prototype.setupSpatialTriggers=function(){function a(){b.voxelDb.db.put("spatialTriggers",JSON.stringify(b.spatialTriggers))}var b=this,c=b.baseServer;b.voxelDb.db.get("spatialTriggers",function(a,c){b.spatialTriggers=c?JSON.parse(c):[]}),c.on("spatialTrigger",function(c){b.spatialTriggers.push(c),a()}),c.on("client.join",function(a){b.spatialTriggers.map(function(b){a.connection.emit("spatialTrigger",b)})})}},{"./features/entity/server.js":301,"./features/modvox/server.js":303,events:33,extend:30,path:44,"voxel-server":227}]},{},[276]);